import{ofetch_default as e}from"./ofetch-CWQqZcqz.js";import{cache_default as t}from"./cache-CvppK6AM.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{timezone as r}from"./timezone-CCdTtC9I.js";import{load as i}from"cheerio";async function a(a,o,s,c,l,u,d){let f=await e(o).catch(()=>null);if(!f)return[];let p=i(f),m=p(d).toArray().map(e=>(e=p(e),{title:e.find(c).attr(`title`),link:s+e.find(c).attr(`href`),pubDate:r(n(e.find(l).text(),`YYYY-MM-DD`),8)})),h=await Promise.all(m.map(a=>t.tryGet(a.link,async()=>{let t=await e(a.link).catch(()=>null);if(!t||t.status>=300&&t.status<400)return{...a,description:`该通知无法直接预览，请点击原文链接↑查看`};let o=i(t);if(o(`.wp_error_msg`).length>0)a.description=`您当前ip并非校内地址，该信息仅允许校内地址访问`;else if(o(`.wp_pdf_player`).length>0)a.description=`该通知无法直接预览，请点击原文链接↑查看`;else{let e=o(u.content).html(),t=i(e);t(`a`).each(function(){let e=o(this),t=e.attr(`href`);t&&!t.startsWith(`http`)&&e.attr(`href`,new URL(t,s).href)}),a.description=t.html(),a.title=o(u.title).text();let c=o(u.date).text().replace(`编辑：`,``).replace(`发布日期：`,``).replace(`发布时间：`,``);a.pubDate=r(n(c,`YYYY-MM-DD`),8)}return a})));return h}export{a as getNoticeList};