import"./esm-shims-CtP6w_ML.js";import{config as e}from"./config-DYqAlsU3.js";import{logger_default as t}from"./logger-BlLSmUdl.js";import{ofetch_default as n}from"./ofetch-CWQqZcqz.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{rss_parser_default as a}from"./rss-parser-YsVv5RZS.js";import{load as o}from"cheerio";const s={path:`/`,categories:[`finance`],example:`/blockworks`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`blockworks.co/`],target:`/`}],name:`News`,maintainers:[`pseudoyu`],handler:c,description:`Blockworks news with full text support.`};async function c(e){let t=`https://blockworks.co/feed`,n=await a.parseURL(t),o=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):20,s=n.items.slice(0,o),c=await u(),d=await Promise.all(s.map(e=>({...e,link:e.link?.split(`?`)[0]})).map(e=>r.tryGet(e.link,async()=>{let t=await l(e.link.split(`/`).pop(),c);return{title:e.title||`Untitled`,pubDate:e.isoDate?i(e.isoDate):void 0,link:e.link,description:t.description||e.content||e.contentSnippet||e.summary||``,author:e.author,category:t.category,media:t.imageUrl?{content:{url:t.imageUrl}}:void 0}})));return{title:n.title||`Blockworks News`,link:n.link||`https://blockworks.co`,description:n.description||`Latest news from Blockworks`,item:d,language:n.language||`en`}}async function l(e,r){try{let t=await n(`https://blockworks.co/_next/data/${r}/news/${e}.json?slug=${e}`),i=t.pageProps.article,a=o(i.content,null,!1);return a(`hr`).remove(),a(`p > em, p > strong`).each((e,t)=>{let n=a(t);(n.text().includes(`To read full editions`)||n.text().includes(`Get the news in your inbox`))&&n.parent().remove()}),a(`ul.wp-block-list > li > a`).each((e,t)=>{let n=a(t);n.attr(`href`)===`https://blockworks.co/newsletter/daily`&&n.parent().parent().remove()}),{description:a.html(),imageUrl:i.imageUrl,category:[...new Set([...i.categories,...i.tags])]}}catch(e){return t.error(`Error extracting full text from Blockworks:`,e),{description:``,imageUrl:``,category:[]}}}const u=()=>r.tryGet(`blockworks:buildId`,async()=>{let e=await n(`https://blockworks.co`),t=o(e);return t(`script#__NEXT_DATA__`).text()?.match(/"buildId":"(.*?)",/)?.[1]||``},e.cache.routeExpire,!1);export{s as route};