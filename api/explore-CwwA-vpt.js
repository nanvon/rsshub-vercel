import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as e}from"./ofetch-CWQqZcqz.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{md5 as n}from"./md5-BJqXla8f.js";import r from"sanitize-html";import i from"crypto-js";import a from"node:crypto";const o=`6m6pingbinwaktg227gngifoocrfbo95`,s=i.enc.Utf8.parse(`eRtYuIoPaSdFgHqW`),c=i.enc.Utf8.parse(`Nmc09JkLzX8765Vb`),l=`https://pubscholar.cn`,u=e=>a.createHash(`sha1`).update(e).digest(`hex`),d=()=>a.randomUUID(),f=e=>{if(!e)return null;let t=``;for(;t.length<e;){let e=Math.random().toString(36).slice(2).toUpperCase();t+=e}return t.slice(0,e)},p=()=>{let e=f(6),t=Date.now().toString(),n=u([o,t,e].sort().join(``));return{nonce:e,timestamp:t,signature:n}},m=e=>{let t=i.AES.encrypt(i.enc.Utf8.parse(e),s,{iv:c,mode:i.mode.CBC,padding:i.pad.Pkcs7}).ciphertext.toString();return t},h={path:`/explore/:category?/:keyword?`,name:`Explore`,maintainers:[`TonyRL`],example:`/pubscholar/explore`,parameters:{category:"Category, see the table below, `articles` by default",keyword:`Search Keyword`},handler:g,description:`| Articles / 论文 | Patents / 专利 | Reports / 领域快报 | Information / 动态快讯 | Datasets / 科学数据 | Books / 图书 |
| --------------- | -------------- | ------------------ | ---------------------- | ------------------- | ------------ |
| articles        | patents        | bulletins          | reports                | sciencedata         | books        |`};async function g(i){let{category:a=`articles`,keyword:o}=i.req.param(),s=d(),c=await e(`${l}/hky/open/resources/api/v1/${a}`,{method:`POST`,headers:{...p(),Cookie:`XSRF-TOKEN=${s}`,"X-XSRF-TOKEN":s},body:{page:1,size:10,order_field:`date`,order_direction:`desc`,user_id:n(Date.now().toString()),lang:`zh`,query:o,strategy:null,orderField:`default`}}),u=c.content.map(e=>({title:(e.is_free||e.links.some(e=>e.is_open_access)?`「Open Access」`:``)+r(e.title,{allowedTags:[],allowedAttributes:{}}),description:e.abstracts+`<br>${e.links.map(e=>`<a href="${e.url}">${e.is_open_access?`「Open Access」`:``}${e.name}</a>`).join(`<br>`)}`,author:e.author.join(`; `),pubDate:t(e.date),category:e.keywords.map(e=>r(e,{allowedTags:[],allowedAttributes:{}})),link:`${l}/${a}/${m(e.id)}`}));return{title:`PubScholar 公益学术平台`,link:`${l}/explore`,item:u}}export{h as route};