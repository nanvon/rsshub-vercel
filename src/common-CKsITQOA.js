import{n as e,t}from"./esm-shims-mGm6WwCc.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-CgQXMNWI.js";import{t as o}from"./invalid-parameter-CLGd_tte.js";import s from"node:path";import{load as c}from"cheerio";e();const l={1:`同人誌 漢化`,2:`同人誌 CG畫集`,3:`同人誌 Cosplay`,5:`同人誌`,6:`單行本`,7:`雜誌&短篇`,9:`單行本 漢化`,10:`雜誌&短篇 漢化`,12:`同人誌 日語`,13:`單行本 日語`,14:`雜誌&短篇 日語`,16:`同人誌 English`,17:`單行本 English`,18:`雜誌&短篇 English`,19:`韓漫`,20:`韓漫 漢化`,21:`韓漫 生肉`,22:`同人誌 3D漫畫`},u=`https://www.wnacg.com`;async function d(e){let{cid:d,tag:f}=e.req.param();if(d&&!Object.keys(l).includes(d))throw new o(`此分类不存在`);let p=`${u}/albums${d?`-index-cate-${d}`:``}${f?`-index-tag-${f}`:``}.html`,{data:m}=await a(p),h=c(m),g=h(`.gallary_item`).toArray().map(e=>{e=h(e);let t=e.find(`a`).attr(`href`),n=t.match(/^\/photos-index-aid-(\d+)\.html$/)[1];return{title:e.find(`a`).attr(`title`),link:`${u}${t}`,pubDate:i(e.find(`.info_col`).text().replace(/\d+張照片，\n創建於/,``),`YYYY-MM-DD`),aid:n}}),_=await Promise.all(g.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link,{headers:{referer:encodeURI(p)}}),i=c(n),o=i(`.uwuinfo p`).first().text(),l=i(`.tagshow`).toArray().map(e=>i(e).text());i(`.addtags`).remove();let d=i(`.uwconn`).html(),{data:f}=await a(`${u}/photos-gallery-aid-${e.aid}.html`,{headers:{referer:`${u}/photos-slide-aid-${e.aid}.html`}});i=c(f);let m=i(`script`).text().match(/var imglist = (\[.*]);"\);/)[1],h=JSON.parse(m.replaceAll(`url:`,`"url":`).replaceAll(`caption:`,`"caption":`).replaceAll(`fast_img_host+\\`,``).replaceAll(`\\`,``));return e.author=o,e.category=l,e.description=r(s.join(t,`templates/manga-9c92a0ba.art`),{description:d,imgList:h}),e})));return{title:h(`head title`).text(),link:p,item:_}}export{d as t};