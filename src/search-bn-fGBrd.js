import"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import{cache_default as e}from"./cache-Dfid4xgQ.js";import"./render-DftO2d-b.js";import"./parse-date-DHsdom8D.js";import{MercariOrder as t,MercariSort as n,MercariStatus as r,fetchItemDetail as i,fetchSearchItems as a,formatItemDetail as o}from"./util-DNWTOtzr.js";const s={path:`/search/:query`,categories:[`shopping`],example:`/mercari/search/keyword=シャツ&7bd3eacc-ae45-4d73-bc57-a611c9432014=340258ac-e220-4722-8c35-7f73b7382831`,parameters:{query:`Search parameters in URL query string format.`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Search`,maintainers:[`yana9i, Tsuyumi25`],url:`jp.mercari.com`,handler:l};function c(e){let i=new URLSearchParams(e),a=i.get(`keyword`)||``,o=n[i.get(`sort`)]||n.default,s=t[i.get(`order`)]||t.desc,c={on_sale:`onsale`,"sold_out|trading":`soldout`},l=i.get(`status`)?.split(`,`).map(e=>r[c[e]]).filter(Boolean)||[],u=[`7bd3eacc-ae45-4d73-bc57-a611c9432014`,`47295d80-5839-4237-bbfc-deb44b4e7999`,`f42ae390-04ff-46ea-808b-f5d97cb45db4`,`d664efe3-ae5a-4824-b729-e789bf93aba9`],d=[];for(let e of u){let t=i.get(e);t&&d.push({id:e,values:t.split(`,`)})}return{keyword:a,sort:o,order:s,status:l,options:{categoryId:i.get(`category_id`)?.split(`,`).map(Number),brandId:i.get(`brand_id`)?.split(`,`).map(Number),priceMin:i.get(`price_min`)?Number(i.get(`price_min`)):void 0,priceMax:i.get(`price_max`)?Number(i.get(`price_max`)):void 0,itemConditionId:i.get(`item_condition_id`)?.split(`,`).map(Number),excludeKeyword:i.get(`exclude_keyword`)||void 0,itemTypes:i.get(`item_types`)?.split(`,`).map(e=>e===`mercari`?`ITEM_TYPE_MERCARI`:e===`beyond`?`ITEM_TYPE_BEYOND`:e),attributes:d}}}async function l(t){let n=t.req.param(`query`),{keyword:r,sort:s,order:l,status:u,options:d}=c(n),f=(await a(s,l,u,r,d)).items,p=await Promise.all(f.map(t=>e.tryGet(`mercari:${t.id}`,async()=>await i(t.id,t.itemType).then(e=>o(e)))));return{title:`${r} の検索結果`,link:`https://jp.mercari.com/search?${n}`,description:`Mercari advanced search results for: ${n}`,item:p}}export{s as route};