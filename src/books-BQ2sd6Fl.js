import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-dCh-Ojgc.js";import{t as o}from"./types-Bn7An2Wc.js";import s from"node:path";import{load as c}from"cheerio";e();const l={path:`/books/:language`,categories:[`design`],view:o.Articles,example:`/jimmyspa/books/tw`,parameters:{language:{description:`语言`,options:[{value:`tw`,label:`臺灣正體`},{value:`en`,label:`English`},{value:`jp`,label:`日本語`}]}},radar:[{source:[`www.jimmyspa.com/:language/Books`]}],name:`Books`,description:`
| language | Description |
| ---   | ---   |
| tw | 臺灣正體 |
| en | English |
| jp | 日本語 |
    `,maintainers:[`Cedaric`],handler:u};async function u(e){let o=e.req.param(`language`),l=`https://www.jimmyspa.com`,u=new URL(`/${o}/Books/Ajax/changeList?year=&keyword=&categoryId=0&page=1`,l).href,d=c((await a(u)).data.view)(`ul#appendWork li.work_block`).toArray().map(async e=>{let o=c(e),u=o(`p.tit`).text(),d=o(`div.work_img img`).prop(`src`)||``,f=d?l+d:``,p=o(`li.work_block`).prop(`data-route`),{renderedDescription:m,publishDate:h}=await n.tryGet(p,async()=>{let e=c((await a(p)).data),n=e(`article.intro_cont`).html()||``,o=e(`div.info_wrap`).html()||``,d=n.replaceAll(/<img\b[^>]*>/g,e=>e.replaceAll(/\b(src|data-src)="(?!http|https|\/\/)([^"]*)"/g,(e,t,n)=>`${t}="${new URL(n,l).href}"`)),m=o.match(/<span>(首次出版|First Published|初版)<\/span>\s*<span class="num">([^<]+)<\/span>/),h=m?i(m[2]+`-02`):``;return{renderedDescription:r(s.join(t,`templates/description-16be3a2a.art`),{images:f?[{src:f,alt:u}]:void 0,description:d}),publishDate:h}});return{title:u,link:p,description:m,pubDate:h,content:{html:m,text:u}}});return{title:`幾米 - 幾米創作(${o})`,link:`${l}/${o}/Books`,allowEmpty:!0,item:await Promise.all(d)}}export{l as route};