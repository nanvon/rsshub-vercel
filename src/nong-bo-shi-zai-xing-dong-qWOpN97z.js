import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BlqYKpVp.js";import{t as o}from"./timezone-BPfwRbwD.js";import s from"node:path";import{load as c}from"cheerio";e();const l=`https://web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`,u={path:`/nbszxd`,categories:[`traditional-media`],example:`/hebtv/nbszxd`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!0,supportPodcast:!0,supportScihub:!1},radar:[{source:[`web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`]}],name:`农博士在行动`,maintainers:[`iamqiz`,`nczitzk`],handler:d,url:`web.cmc.hebtv.com/cms/rmt0336/19/19js/st/ds/nmpd/nbszxd/index.shtml`};async function d(e){let u=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):40,d=new URL(`cmsback/api/article/getMyArticleDetail`,`http://api.cmc.hebtv.com`).href,f=c((await a(l)).data),p=f(`.video_box .tv_items`).first().children().toArray().map(e=>{e=f(e);let t=e.find(`a`).first(),n=t.text().match(/\d+/),r=n?n[0]:``;return{title:t.text(),link:`${l}/../${t.attr(`href`)}`,pubDate:r?o(i(r,`YYYYMMDD`),8):null,author:`时间|`+r}}),m=await Promise.all(p.slice(0,u).map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link),c=n.match(/tenantid = '(\w+)';/)[1],l=e.link.match(/\/nbszxd\/(\d+)/)[1],{data:u}=await a(d,{searchParams:{tenantId:c,articleId:l}}),f=u.data,p;return f.articleContentDto?.videoDtoList?.length>0&&(p=f.articleContentDto?.videoDtoList[0]),e.title=f.title,e.author=f.source,e.guid=`hebtv-nbszxd-${l}`,e.pubDate=o(i(f.publishDate),8),e.updated=o(i(f.modifyTime),8),p&&(e.itunes_item_image=p.poster,e.itunes_duration=f.articleContentDto?.videoEditDtoList[0]?.sourceMediaInfo?.duration,e.enclosure_url=p.formats[0]?.url,e.enclosure_length=f.articleContentDto?.videoEditDtoList[0].sourceMediaInfo?.fileSize,e.enclosure_type=e.enclosure_url?`video/${e.enclosure_url?.split(/\./)?.pop()}`:void 0),e.description=r(s.join(t,`templates/description-676d5a69.art`),{video:p?{src:e.enclosure_url,type:e.enclosure_type,poster:e.itunes_item_image}:void 0}),e}))),h=f(`meta[name="description"]`).prop(`content`),g=h.split(/,/)[0],_=f(`link[rel="shortcut icon"]`).prop(`href`);return{item:m,title:f(`title`).text(),link:l,description:h,language:f(`html`).prop(`lang`),image:f(`div.logo a img`).prop(`src`),icon:_,logo:_,subtitle:f(`meta[name="keywords"]`).prop(`content`),author:g,itunes_author:g,itunes_category:`News`,allowEmpty:!0}}export{u as route};