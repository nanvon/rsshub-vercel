import"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-DqHh1IN2.js";import"./helpers-gUVC02jt.js";import{cache_default as e}from"./cache-Dfid4xgQ.js";import{got_default as t}from"./got-VGofQtEf.js";const n={path:`/manga/update/:comicid`,categories:[`social-media`],example:`/bilibili/manga/update/26009`,parameters:{comicid:"漫画 id, 可在 URL 中找到, 支持带有`mc`前缀"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`manga.bilibili.com/detail/:comicid`]}],name:`漫画更新`,maintainers:[`hoilc`],handler:i};async function r(n,r){let{Go:i}=await import(`./wasm-exec-C3M0CV3H.js`),a=await e.tryGet(`bilibili-manga-wasm-20250208`,async()=>{let e=await t(`https://s1.hdslb.com/bfs/manga-static/manga-pc/6732b1bf426cfc634293.wasm`,{responseType:`arrayBuffer`});return Buffer.from(e.data).toString(`base64`)}),o=Buffer.from(a,`base64`),s=new i,{instance:c}=await WebAssembly.instantiate(o,s.importObject);if(s.run(c),globalThis.genReqSign===void 0)throw Error(`WASM function not available`);return globalThis.genReqSign(n,r,Date.now()).sign}async function i(e){let n=e.req.param(`comicid`).startsWith(`mc`)?e.req.param(`comicid`).replace(`mc`,``):e.req.param(`comicid`),i=`https://manga.bilibili.com/detail/mc${n}`,a=await t(`https://api.bilibili.com/x/frontend/finger/spi`),o=`device=pc&platform=web&nov=25`,s=JSON.stringify({comic_id:Number(n)}),c=await r(o,s),l=(await t({method:`POST`,url:`https://manga.bilibili.com/twirp/comic.v2.Comic/ComicDetail?${o}&ultra_sign=${c}`,body:s,headers:{Referer:i,Cookie:`buvid3=${a.data.data.b_3}; buvid4=${a.data.data.b_4}`}})).data.data,u=l.author_name.join(`, `);return{title:`${l.title} - 哔哩哔哩漫画`,link:i,image:l.vertical_cover,description:l.classic_lines,item:l.ep_list.slice(0,20).map(e=>({title:e.short_title===e.title?e.short_title:`${e.short_title} ${e.title}`,author:u,description:`<img src="${e.cover}">`,pubDate:new Date(e.pub_time+` +0800`),link:`https://manga.bilibili.com/mc${n}/${e.id}`}))}}export{n as route};