import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as t}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as n}from"./got-CB83B8oA.js";import{baseUrl as r,parseContent as i}from"./utils-DztYsq-5.js";import*as a from"cheerio";function o(t,n){return n(`.tr1:nth-child(1)`).toArray().map(a=>{let o=n(a),s=i(o.html()),c=o.next(),l=c.find(`.tipad a[title]`).attr(`id`)?.slice(2);return{title:s?.split(`<br>`)[0],description:s,author:o.find(`b`).contents().filter((e,t)=>t.type===`text`).text().trim(),pubDate:e(String(c.find(`span[data-timestamp]`).data(`timestamp`)),`X`),link:`${r}/read.php?tid=${t}${l?`&pid=${l}`:``}`}})}const s={path:`/post/:tid`,categories:[`multimedia`],example:`/t66y/post/3286088`,parameters:{tid:`帖子 id, 可在帖子 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`帖子跟踪`,maintainers:[`cnzgray`],handler:c,description:`::: tip
  帖子 id 查找办法:

  打开想跟踪的帖子，比如：\`https://t66y.com/htm_data/20/1811/3286088.html\` 其中 \`3286088\` 就是帖子 id。
:::`};async function c(e){let i=e.req.param(`tid`),{data:s}=await n(`${r}/read.php?tid=${i}`),c=a.load(s),l=c(`a:last-child`).attr(`href`);if(!l)throw Error(`Cannot get the redirect link`);let{data:u,url:d}=await n(new URL(l,r).href);c=a.load(u);let f=o(i,c),p=c(`.w70 input`).eq(0).attr(`value`)?.split(`/`)[1],m=[];if(p){let e=Number.parseInt(p);m=Array.from({length:e},(e,t)=>`${r}/read.php?tid=${i}&page=${t+1}`).slice(1)}let h=p?await Promise.all(m.map(e=>t.tryGet(e,async()=>{let{data:t}=await n(e),r=a.load(t);return o(i,r)}))):[],g=[...f,...h.flat()];return{title:c(`head title`).text(),link:d,item:g}}export{s as route};