import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import{t as n}from"./md5-DQN6cWFb.mjs";import{t as r}from"./render-CSqLtqb8.mjs";import{t as i}from"./got-BglkE51W.mjs";import a from"node:path";import{load as o}from"cheerio";e();const s=`https://www.iyingdi.com`,c=async(e,t)=>await Promise.all(t.map(t=>e.tryGet(t.link,async()=>{let e={post_id:t.postId,timestamp:``},{body:n}=await i({method:`post`,url:`https://api.iyingdi.com/web/post/info`,headers:{Host:`api.iyingdi.com`,"Login-Token":`nologin`,Origin:s,Platform:`pc`,Referer:`${s}/`},form:l(e)});return t.description=u(JSON.parse(n).post.content),t}))),l=(e,t)=>(e.key=t?`8a11ed3712b699e749185674f1dc20b4`:`b8d5b38577b8bb382b0c783b474b95f9`,e.timestamp=Math.floor(Date.now()/1e3),e.sign=n(new URLSearchParams(e).toString()),delete e.key,e),u=e=>{let n=o(e.replace(/(<p>|<div>)(.*?)?<strong>(标准|狂野)日报投稿.*?<\/strong>(.*?)?(<\/p>|<\/div>)(.|\n)*$/,``));return n(`.yingdi-car,.bbspost,.deck-set`).each((e,i)=>{let o=n(i).attr(`class`),c=n(i).attr(`data-id`),l=`${s}/web/tools/hearthstone/decks/setdetail?setid=${c}`,u=o===`yingdi-card bbspost`?`${s}/tz/post/${c}`:l,d=n(i).find(`.card-status .time`).text();n(i).find(`.card-info .title`).text((e,t)=>`${t} ${d}`),n(i).find(`.card-status`).remove(),n(i).find(`.card-info`).wrap(r(a.join(t,`templates/card-038fc8ce.art`),{url:u}))}),n(`.yingdi-image.gif`).each((e,t)=>{let r=n(t).attr(`data-original`);n(t).attr(`src`,r)}),n(`.yingdi-audio`).each((e,t)=>{n(t).find(`.audio-cover`).remove(),n(t).find(`.audio-area.hidden`).attr(`class`,`audio-area`)}),n(`.yingdi-video iframe`).each((e,i)=>{let o=n(i).attr(`src`).match(/bvid=(.*?)&/)[1];if(o){let e=`https://www.bilibili.com/video/${o}`;n(i).after(r(a.join(t,`templates/video-54339745.art`),{url:e}))}}),n(`.yingdi-card.user`).each((e,t)=>{n(t).prev(`p`).remove(),n(t).remove()}),n(`.action-button`).remove(),n(`.yingdi-ballot`).remove(),n(`hr`).remove(),n.html()};export{l as n,c as t};