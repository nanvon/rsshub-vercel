import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./got-BlqYKpVp.js";import{i,t as a}from"./readable-social-D1ub39Fn.js";import o from"node:path";e();const s={path:`/recommended/:type?/:routeParams?`,categories:[`social-media`],example:`/douban/recommended/tv`,parameters:{type:`片单类型剧集/电影，tv或movie，默认为tv`,routeParams:`额外参数；请参阅以下说明和表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`豆瓣每月推荐片单`,maintainers:[`honue`],handler:c,description:`| 额外参数 | 含义                   | 接受的值 | 默认值 |
| -------- | ---------------------- | -------- | ------ |
| playable | 仅看有可播放片源的影片 | 0/1      | 0      |
| score    | 筛选评分               | 0-10     | 0      |

  用例：\`/douban/recommended/tv/playable=0&score=8\`

::: tip
  整合了 /douban/list/ 路由，省去每月手动更新 id 参数，因为当月推荐剧集片单中，会有还未播出 / 开评分剧集、海外平台播出剧集，请自行考虑是否使用额外参数。
:::`};async function c(e){let s=`https://frodo.douban.com/api/v2/skynet/new_playlists?apikey=0ac44ae016490db2204ce0a042db2916&subject_type=${e.req.param(`type`)||`tv`}`,c=await r({method:`get`,url:s,headers:{"User-Agent":`MicroMessenger/`,Referer:`https://servicewechat.com/wx2f9b06c1de1ccfca/91/page-frame.html`}}),l=new Date,u=l.getFullYear(),d=l.getMonth()+1,f=d<10?`0`+d:d.toString(),p=c.data.data[0].items,m=p.find(e=>e.title.startsWith(`${u}年${f}月`)).id,h=Object.fromEntries(new URLSearchParams(e.req.param(`routeParams`))),g=a(void 0,i(h.playable),0),_=a(void 0,i(h.score),0);s=`https://m.douban.com/rexxar/api/v2/subject_collection/${m}/items?playable=${g}`,c=await r({method:`get`,url:s,headers:{Referer:`https://m.douban.com/subject_collection/${m}`}});let v=c.data.subject_collection.description;return p=c.data.subject_collection_items.filter(e=>(e.rating?e.rating.value:0)>=_).map(e=>{let r=e.title;return{title:r,link:e.url,description:n(o.join(t,`templates/list_description-833a570f.art`),{ranking_value:e.ranking_value,title:r,original_title:e.original_title,rate:e.rating?e.rating.value:null,card_subtitle:e.card_subtitle,description:e.cards?e.cards[0].content:e.abstract,cover:e.cover_url||e.cover?.url})}}),{title:`豆瓣 - ${c.data.subject_collection.name}`,link:`https://m.douban.com/subject_collection/${m}`,item:p,description:v}}export{s as route};