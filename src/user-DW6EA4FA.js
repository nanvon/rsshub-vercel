import{__dirname as e,init_esm_shims as t}from"./esm-shims-B6VgfGYP.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CHIwZNTj.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{got_default as i}from"./got-BXZNsAGk.js";import{ViewType as a}from"./types-Bi82qguM.js";import o from"node:path";import{load as s}from"cheerio";t();const c={"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`},l={path:`/:userid`,categories:[`social-media`],view:a.Audios,example:`/changba/skp6hhF59n48R-UpqO3izw`,parameters:{userid:`用户ID, 可在对应分享页面的 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`changba.com/s/:userid`]}],name:`用户`,maintainers:[`kt286`,`xizeyoupan`,`pseudoyu`],handler:u};async function u(t){let a=`https://changba.com/wap/index.php?s=${t.req.param(`userid`)}`,l=(await i({method:`get`,url:a,headers:c})).data,u=s(l),d=u(`.user-work .work-info`).toArray(),f=u(`div.user-main-info > span.txt-info > a.uname`).text(),p=u(`div.user-main-info > .poster > img`).attr(`data-src`),m=await Promise.all(d.map(t=>{let a=s(t),l=a(`a`).attr(`href`);return n.tryGet(l,async()=>{let t=await i({method:`get`,url:l,headers:c}),n=/workid: '\d+'/,s;try{s=t.data.match(n)[0]}catch{return null}if(s=s.split(`'`)[1],!s)return null;let u=`https://upscuw.changba.com/${s}.mp3`,d=r(o.join(e,`templates/work_description-7637ee4a.art`),{desc:a(`div.des`).text(),mp3url:u}),p=a(`div.work-cover`).attr(`style`).replace(`)`,``).split(`url(`)[1];return{title:a(`.work-title`).text(),description:d,link:l,author:f,itunes_item_image:p,enclosure_url:u,enclosure_type:`audio/mpeg`}})}));return m=m.filter(Boolean),{title:f+` - 唱吧`,link:a,description:u(`meta[name="description"]`).attr(`content`)||f+` - 唱吧`,item:m,image:p,itunes_author:f,itunes_category:`唱吧`}}export{l as route};