import{n as e,t}from"./esm-shims-DhF_MXa4.mjs";import{t as n}from"./render-ZYpwNl2L.mjs";import{t as r}from"./invalid-parameter-BazIyKVP.mjs";import i from"node:path";import a from"query-string";import{GenreNotation as o,NarouNovelFetch as s,R18Site as c,SearchBuilder as l,SearchBuilderR18 as u}from"narou";e();let d=function(e){return e.YOMOU=`yomou`,e.NOCTURNE=`noc`,e.MOONLIGHT=`mnlt`,e.MIDNIGHT=`mid`,e}({});const f={[d.YOMOU]:`小説を読もう`,[d.NOCTURNE]:`ノクターン`,[d.MOONLIGHT]:`ムーンライト`,[d.MIDNIGHT]:`ミッドナイト`},p={path:`/search/:sub/:query`,categories:[`reading`],example:`/syosetu/search/noc/word=ハーレム&notword=&type=r&mintime=&maxtime=&minlen=30000&maxlen=&min_globalpoint=&max_globalpoint=&minlastup=&maxlastup=&minfirstup=&maxfirstup=&isgl=1&notbl=1&order=new?limit=5`,parameters:{sub:{description:`The target Syosetu subsite.`,options:Object.entries(d).map(([,e])=>({value:e,label:f[e]}))},query:`Search parameters in Syosetu format.`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Search`,maintainers:[`SnowAgar25`],handler:v},m=e=>e??void 0;function h(e,t){let n=a.parse(e),r={gzip:5,lim:t,word:m(n.word),notword:m(n.notword),title:m(n.title),ex:m(n.ex),keyword:m(n.keyword),wname:m(n.wname),sasie:m(n.sasie),iszankoku:m(n.iszankoku),isbl:m(n.isbl),isgl:m(n.isgl),istensei:m(n.istensei),istenni:m(n.istenni),stop:m(n.stop),notzankoku:m(n.notzankoku),notbl:m(n.notbl),notgl:m(n.notgl),nottensei:m(n.nottensei),nottenni:m(n.nottenni),minlen:m(n.minlen),maxlen:m(n.maxlen),type:m(n.type),order:m(n.order),genre:m(n.genre),nocgenre:m(n.nocgenre)};return(n.mintime||n.maxtime)&&(r.time=`${n.mintime||``}-${n.maxtime||``}`),r}const g=e=>e===d.YOMOU;function _(e,t){if(g(e))return new l(t,new s);let n={...t};switch(e){case d.NOCTURNE:n.nocgenre=c.Nocturne;break;case d.MOONLIGHT:n.nocgenre||=[c.MoonLight,c.MoonLightBL].join(`-`);break;case d.MIDNIGHT:n.nocgenre=c.Midnight;break;default:throw new r(`Invalid Syosetu subsite.
Valid subsites are: yomou, noc, mnlt, mid`)}return new u(n,new s)}async function v(e){let{sub:r,query:a}=e.req.param(),s=`https://${r}.syosetu.com/search/search/search.php?${a}`,c=h(a,Math.min(Number(e.req.query(`limit`)??40),40)),l=(await _(r,c).execute()).values.map(e=>({title:e.title,link:`https://${g(r)?`ncode`:`novel18`}.syosetu.com/${String(e.ncode).toLowerCase()}`,description:n(i.join(t,`templates/description-e1f33e28.art`),{novel:e,genreText:o[e.genre]}),author:e.writer,category:e.keyword.split(/[\s/\uFF0F]/).filter(Boolean)})),u=[];return c.word&&u.push(c.word),c.notword&&u.push(`-${c.notword}`),{title:u.length>0?`Syosetu Search: ${u.join(` `)}`:`Syosetu Search`,link:s,item:l}}export{p as route};