import"./esm-shims-BFmOnnpb.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-am9EnuPq.js";import"./cache-Dfid4xgQ.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{ViewType as n}from"./types-Bi82qguM.js";import{fetchArticle as r}from"./utils-BUmP54h0.js";import i from"p-map";const a={path:`/mobile/:path{.+}?`,categories:[`traditional-media`],example:`/apnews/mobile/ap-top-news`,view:n.Articles,parameters:{path:{description:`Corresponding path from AP News website`,default:`ap-top-news`}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`apnews.com/`]}],name:`News (from mobile client API)`,maintainers:[`dzx-dzx`],handler:o};async function o(n){let a=n.req.param(`path`)?`/${n.req.param(`path`)}`:`/hub/ap-top-news`,o=(await e(`https://apnews.com/graphql/delivery/ap/v1`,{query:{operationName:`ContentPageQuery`,variables:{path:a},extensions:{persistedQuery:{version:1,sha256Hash:`3bc305abbf62e9e632403a74cc86dc1cba51156d2313f09b3779efec51fc3acb`}}}})).data.Screen,s=[...o.main.filter(e=>e.__typename===`ColumnContainer`).flatMap(e=>e.columns),...o.main.filter(e=>e.__typename!==`ColumnContainer`)].filter(e=>e.__typename!==`GoogleDfPAdModule`).flatMap(e=>{switch(e.__typename){case`PageListModule`:return e.items;case`VideoPlaylistModule`:return e.playlist;default:return}}).filter(Boolean).map(e=>{if(e.__typename===`PagePromo`)return{title:e.title,link:e.url,pubDate:t(e.publishDateStamp),category:e.category,description:e.description,guid:e.id};if(e.__typename===`VideoPlaylistItem`)return{title:e.title,link:e.url,description:e.description,guid:e.contentId}}).filter(Boolean).toSorted((e,t)=>t.pubDate-e.pubDate).slice(0,n.req.query(`limit`)?Number.parseInt(n.req.query(`limit`),10):20),c=n.req.query(`fulltext`)===`true`?await i(s,e=>r(e),{concurrency:10}):s;return{title:o.category??o.title,item:c,link:`https://apnews.com`}}export{a as route};