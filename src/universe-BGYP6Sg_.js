import"./esm-shims-Dqvxr0BZ.js";import"./config-BpwDbAkH.js";import"./logger-B3QfaIfn.js";import{ofetch_default as e}from"./ofetch-TsvCL7Kz.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{load as n}from"cheerio";import r from"markdown-it";import i from"node:vm";const a=`https://raw.githubusercontent.com`,o=`${a}/typst/packages/main/packages/preview`;function s(e,t){if(e.includes(`://`))e.startsWith(`https://typst.app/universe/package`)?e=e.replaceAll(`https://typst.app/universe/package`,`${o}/${t.name}/${t.version}`):e.startsWith(`https://github.com/`)&&e.match(/\.(jpeg|jpg|gif|png|bmp|webp)$/gi)?.length&&(e=e.replace(`https://github.com/`,`${a}/`));else{let n=e.startsWith(`/`)?``:`/`,r=`${o}/${t.name}/${t.version}${n}`,i=new URL(e,r);e=i.toString()}return e}const c={path:`/universe`,categories:[`program-update`],example:`/typst/universe`,radar:[{source:[`typst.app/universe`],target:`/universe`}],name:`Universe`,maintainers:[`HPDell`],handler:async()=>{let a=`https://typst.app/universe/search?kind=packages%2Ctemplates&packages=last-updated`,o=await e(a),c=n(o),l=c(`script`).toArray().map(e=>e.attribs.src).find(e=>e&&e.startsWith(`/scripts/universe-search`)),u=await e(`https://typst.app${l}`,{parseResponse:e=>e}),d=u.match(/(an.exports=[\S\s]+);var ([$A-Z_a-z][\w$]*)=new Intl.Collator/)?.[1];if(d){d=d.slice(0,-2);let e={an:{exports:[]}};i.createContext(e),i.runInContext(d,e,{displayErrors:!0});let o=r(`commonmark`),c=e.an.exports.sort((e,t)=>e.updatedAt-t.updatedAt),l=new Map(c.map(e=>[e.name,e])),u=[...l.values()].map(e=>{let r=n(o.render(e.readme));return r(`img`).each((t,n)=>{let r=n.attribs.src;n.attribs.src=s(r,e)}),{title:`${e.name} (${e.version}) | ${e.description}`,link:`https://typst.app/universe/package/${e.name}`,description:r.html(),pubDate:t(e.updatedAt,`X`)}});return{title:`Typst universe`,link:a,item:u}}else return{title:`Typst universe`,link:a,item:[]}}};export{c as route};