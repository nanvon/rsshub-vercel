import"./esm-shims-CGUM9TC6.js";import{config as e}from"./config-C9m9eBw5.js";import{logger_default as t}from"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./proxy-C5Qog9Rm.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import{invalid_parameter_default as a}from"./invalid-parameter-CUJdROXf.js";import{puppeteer_default as o}from"./puppeteer-U-cQNky4.js";import{fallback as s,queryToBoolean as c}from"./readable-social-D4KJOlrJ.js";import{getOriginAvatar as l,proxyVideo as u,resolveUrl as d,templates as f}from"./utils-CMceas-a.js";const p={path:`/user/:uid/:routeParams?`,categories:[`social-media`],example:`/douyin/user/MS4wLjABAAAARcAHmmF9mAG3JEixq_CdP72APhBlGlLVbN-1eBcPqao`,parameters:{uid:`uid，可在用户页面 URL 中找到`,routeParams:`额外参数，query string 格式，请参阅上面的表格`},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`douyin.com/user/:uid`],target:`/user/:uid`}],name:`博主`,maintainers:[`Max-Tortoise`,`Rongronggg9`],handler:m};async function m(p){let m=p.req.param(`uid`);if(!m.startsWith(`MS4wLjABAAAA`))throw new a(`Invalid UID. UID should start with <b>MS4wLjABAAAA</b>.`);let h=Object.fromEntries(new URLSearchParams(p.req.param(`routeParams`))),g=s(void 0,c(h.embed),!1),_=s(void 0,c(h.iframe),!1),v=d(h.relay,!0,!0),y=`https://www.douyin.com/user/${m}`,b=await r.tryGet(`douyin:user:${m}`,async()=>{let e,n=await o(),r=await n.newPage();if(await r.setRequestInterception(!0),r.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),r.on(`response`,async t=>{let n=t.request();n.url().includes(`/web/aweme/post`)&&!e&&(e=await t.json())}),t.http(`Requesting ${y}`),await r.goto(y,{waitUntil:`networkidle2`}),await n.close(),!e)throw Error(`Empty post data. The request may be filtered by WAF.`);return e},e.cache.routeExpire,!1);if(!b.aweme_list?.length)throw Error(`Empty post data. The request may be filtered by WAF.`);let x=b.aweme_list[0].author,S=x.nickname,C=l(x.avatar_thumb.url_list.at(-1)),w=b.aweme_list.map(e=>{let t=e.video?.bit_rate?.map(e=>d(e.play_addr.url_list.at(-1)));v&&(t=t.map(e=>u(e,v)));let r=e.video?.duration;r=r&&r/1e3;let a;a=a||e.video?.cover?.url_list.at(-1)||e.video?.origin_cover?.url_list.at(-1),a=a&&d(a);let o=e.desc?.replaceAll(`
`,`<br>`),s=i(g&&t?f.embed:f.cover,{img:a,videoList:t,duration:r});s=g&&t&&_?i(f.iframe,{content:s}):s;let c=i(f.desc,{desc:o,media:s});return{title:e.desc.split(`
`)[0],description:c,link:`https://www.douyin.com/video/${e.aweme_id}`,pubDate:n(e.create_time*1e3),category:e.video_tag.map(e=>e.tag_name)}});return{title:S,image:C,link:y,item:w}}export{p as route};