import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CSnicFA3.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{got_default as i}from"./got-DF7DsGgk.js";import a from"node:path";import o from"@bbob/html";import s from"@bbob/preset-html5";t();const c=`https://instant.1point3acres.com`,l=`https://api.1point3acres.com`,u={new:`最新帖子`,hot:`热门帖子`},d=e=>e.walk(e=>typeof e==`string`&&e===`
`?{tag:`br`,content:null}:e),f=async(t,u,f)=>{let p=await i({method:`get`,url:u,headers:{referer:c}});return await Promise.all(p.data.threads.map(u=>{let p={guid:u.tid,title:u.subject,author:u.author,link:`${c}/thread/${u.tid}`,description:u.summary,pubDate:r((f===``?u.lastpost:u.dateline)*1e3),category:[u.forum_name,...u.tags.map(e=>e.displayname)]};return t(p.link,async()=>{try{let t=(await i({method:`get`,url:`${l}/api/v3/threads/${p.guid}`,headers:{referer:c}})).data.thread,r=s.extend(e=>({...e,attach:(e,{render:n})=>{let r=n(e.content),i=t.attachment_list.find(e=>e.aid===Number.parseInt(r));return i.isimage?{tag:`img`,attrs:{src:i.url}}:{tag:`a`,attrs:{href:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${r}`,rel:`noopener`,target:`_blank`},content:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${r}`}},url:e=>{let t=Object.keys(e.attrs)[0];return t.startsWith(`https://link.1p3a.com/?url=`)?{tag:`a`,attrs:{href:decodeURIComponent(t.replace(`https://link.1p3a.com/?url=`,``)),rel:`noopener`,target:`_blank`},content:e.content}:{tag:`a`,attrs:{href:t,rel:`noopener`,target:`_blank`},content:e.content}}}));if(p.description=o(t.message_bbcode,[r(),d]),!t.message_bbcode.includes(`[attach]`)&&t.attachment_list.length>0)for(let r of t.attachment_list)p.description+=r.isimage===1?`<br>`+n(a.join(e,`templates/image-8260a861.art`),{url:r.url,height:r.height,width:r.width}):``}catch{}return p})}))};export{f as ProcessThreads,l as apiRootUrl,c as rootUrl,u as types};