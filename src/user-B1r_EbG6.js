import"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as e}from"./parse-date-CHEO0z5G.js";import{t}from"./got-dCh-Ojgc.js";import{t as n}from"./types-Bn7An2Wc.js";import{t as r}from"./invalid-parameter-CLGd_tte.js";import{t as i}from"./valid-host-COjFWLEv.js";const a={path:`/user/:name?`,categories:[`social-media`],example:`/lofter/user/i`,view:n.Articles,parameters:{name:`Lofter user name, can be found in the URL`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`User`,maintainers:[`hondajojo`,`nczitzk`,`LucunJi`],handler:o};async function o(n){let a=n.req.param(`name`)??`i`,o=n.req.query(`limit`)?Number.parseInt(n.req.query(`limit`)):`50`;if(!i(a))throw new r(`Invalid name`);let s=`${a}.lofter.com`,c=await t({method:`post`,url:`http://api.lofter.com/v2.0/blogHomePage.api?product=lofter-iphone-10.0.0`,body:new URLSearchParams({blogdomain:s,checkpwd:`1`,following:`0`,limit:o,method:`getPostLists`,needgetpoststat:`1`,offset:`0`,postdigestnew:`1`,supportposttypes:`1,2,3,4,5,6`})});if(!c.data.response||c.data.response.posts.length===0)throw Error(`Blog Not Found`);let l=c.data.response.posts.map(t=>({title:t.post.title||t.post.noticeLinkTitle,link:t.post.blogPageUrl,description:JSON.parse(t.post.photoLinks||`[]`).map(e=>(e.raw?.match(/\/\/nos\.netease\.com\//)&&(e.raw=`https://${e.raw.match(/(imglf\d)/)[0]}.lf127.net${e.raw.match(/\/\/nos\.netease\.com\/imglf\d(.*)/)[1]}`),`<img src="${e.raw||e.orign}">`)).join(``)+JSON.parse(t.post.embed?`[${t.post.embed}]`:`[]`).map(e=>`<video src="${e.originUrl}" poster="${e.video_img_url}" controls="controls"></video>`).join(``)+t.post.content,pubDate:e(t.post.publishTime),author:t.post.blogInfo.blogNickName,category:t.post.tag.split(`,`)}));return{title:`${l[0].author} | LOFTER`,link:`https://${s}`,item:l,description:c.data.response.posts[0].post.blogInfo.selfIntro}}export{a as route};