import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-Di2lBekK.js";import o from"node:path";t();const s=[`misskey.io`,`madost.one`,`mk.nixnet.social`],c=(t,n,a=!1)=>t.map(t=>{let c=t.renote&&Object.keys(t.renote).length>0,l=t.reply&&Object.keys(t.reply).length>0,u=c?t.renote:t,d=u.user.host??n,f=a?String(u.user.name):`${u.user.name} (${u.user.username}@${d})`,p=r(o.join(e,`templates/note-b4364264.art`),{text:u.text,files:u.files,reply:t.reply,site:n}),m=``;if(l&&t.reply){let e=t.reply.user.host??n;m=`Reply to ${a?t.reply.user.name:`${t.reply.user.name} (${t.reply.user.username}@${e})`}: "${u.text??``}"`}else m=c?`Renote: ${f}: "${u.text??``}"`:`${f}: "${u.text??``}"`;let h=u.id;if(c){let e=t.user.host??n,r=u.user.host??n;(e!==r||!s.includes(r))&&(h=t.id)}let g=`https://${d}/notes/${h}`,_=i(u.createdAt);return{title:m,description:p,pubDate:_,link:g,author:f}});async function l(e,t,{withRenotes:r=!1,mediaOnly:i=!1}){let o=`https://${t}/api/users/search-by-username-and-host`,s=`misskey_username/${t}/${e}`,c=await n.tryGet(s,async()=>{let n=(await a({method:`post`,url:o,json:{username:e,host:t,detail:!0,limit:1}})).data.find(t=>t.username===e);if(!n)throw Error(`username ${e} not found`);return n}),l=c.id,u=c.avatarUrl;return{site:t,accountId:l,accountData:(await a({method:`post`,url:`https://${t}/api/users/notes`,json:{userId:l,withChannelNotes:!0,withRenotes:r,withReplies:!i,withFiles:i,limit:10,offset:0}})).data,avatarUrl:u}}var u={parseNotes:c,getUserTimelineByUsername:l,allowSiteList:s};export{u as utils_default};