import"./esm-shims-BFmOnnpb.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-am9EnuPq.js";import{cache_default as t}from"./cache-Dfid4xgQ.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{timezone as r}from"./timezone-CMz5pnRe.js";import{invalid_parameter_default as i}from"./invalid-parameter-B0jPSaWz.js";import{isValidHost as a}from"./valid-host-C5HGyJZ_.js";import{load as o}from"cheerio";import s from"iconv-lite";const c={path:`/:site?/:category{.+}?`,name:`首页头条`,maintainers:[`nczitzk`,`pseudoyu`],example:`/people`,handler:l};async function l(c){let{site:l=`www`}=c.req.param(),{category:u=l===`www`?`59476`:``}=c.req.param();u=l===`cpc`&&u===`24h`?`87228`:u;let d=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`),10):30;if(!a(l))throw new i(`Invalid site`);let f=`http://${l}.people.com.cn`,p=new URL(`GB/${u}`,f).href,m=await e(p,{responseType:`arrayBuffer`}),h=s.decode(Buffer.from(m),`utf-8`),g=h.match(/<meta.*?charset=["']?([^"'>]+)["']?/i),_=g?g[1].toLowerCase():`utf-8`;h=_===`utf-8`?h:s.decode(Buffer.from(m),_);let v=o(h);v(`em`).remove(),v(`.bshare-more, .page_n, .page`).remove(),v(`a img, h3 img`).each((e,t)=>{v(t).parent().remove()});let y=v(`.p6, div.p2j_list, div.headingNews, div.ej_list_box, .leftItem`).find(`a`).slice(0,d).toArray().map(e=>{e=v(e);let t=e.attr(`href`).trim();return{title:e.text(),link:t.indexOf(`http`)===0?t:new URL(t.replace(/^\.\./,``),f).href}});return y=await Promise.all(y.map(i=>t.tryGet(i.link,async()=>{try{let t=await e(i.link,{responseType:`arrayBuffer`}),a=s.decode(Buffer.from(t),_),c=o(a);c(`.paper_num, #rwb_tjyd`).remove(),i.description=c(`#rwb_zw`).html(),i.pubDate=r(n(a.match(/(\d{4}年\d{2}月\d{2}日\d{2}:\d{2})/)?.[1]||``,`YYYY年MM月DD日 HH:mm`),8)}catch(e){i.description=String(e)}return i}))),{title:v(`title`).text(),link:p,item:y}}export{c as route};