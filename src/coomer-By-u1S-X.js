import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{art as n}from"./render-DftO2d-b.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{got_default as i}from"./got-Di2lBekK.js";import a from"node:path";import{load as o}from"cheerio";t();const s={Accept:`text/css`},c={path:`/:source?/:id?`,categories:[`multimedia`],example:`/coomer`,parameters:{source:`Source, see below, Posts by default`,id:`User id, can be found in URL`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},radar:[{source:[`coomer.st/`],target:``},{source:[`coomer.st/:source/user/:id`],target:`/:source/:id`}],name:`Posts`,maintainers:[`nczitzk`,`AiraNadih`],handler:l,description:`Sources

| Posts | OnlyFans | Fansly | CandFans |
| ----- | -------- | ------- | -------- |
| posts | onlyfans | fansly   | candfans |

::: tip
  When \`posts\` is selected as the value of the parameter **source**, the parameter **id** does not take effect.
  There is an optinal parameter **limit** which controls the number of posts to fetch, default value is 25.
:::`};async function l(t){let c=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):25,l=t.req.param(`source`)??`posts`,d=t.req.param(`id`),f=l===`posts`,p=`https://coomer.st`,m=`${p}/api/v1`,h=await i({method:`get`,url:f?`${m}/posts`:`${m}/${l}/user/${d}/posts`,headers:s}),g=f?h.data.posts:h.data,_=f?``:await u(`${m}/${l}/user/${d}`),v=f?`Coomer Posts`:`Posts of ${_} from ${l} | Coomer`,y=f?`${p}/favicon.ico`:`https://img.coomer.st/icons/${l}/${d}`,b=g.filter(e=>e.content||e.attachments).slice(0,c).map(t=>{t.files=[],`path`in t.file&&t.files.push({name:t.file.name,path:t.file.path,extension:t.file.path.replace(/.*\./,``).toLowerCase()});for(let e of t.attachments)t.files.push({name:e.name,path:e.path,extension:e.path.replace(/.*\./,``).toLowerCase()});let i=o(n(a.join(e,`templates/source-8cc27d8b.art`),{i:t})),s=i(`img, a, audio, video`).map(function(){return i(this).prop(`outerHTML`)}),c=``;t.content&&(c+=`<div>${t.content}</div>`),i=o(c);let l=0,u=/downloads.fanbox.cc/;i(`a`).each(function(){let e=i(this).attr(`href`);u.test(e)&&(l++,i(this).replaceWith(s[l]))}),c=(s.length>0?s[0]:``)+i.html();for(let e of s.slice(l+1))c+=e;let d={};return o(c)(`audio source, video source`).each(function(){let e=i(this).attr(`src`)??``,t={m4a:`audio/mp4`,mp3:`audio/mpeg`,mp4:`video/mp4`}[e.replace(/.*\./,``).toLowerCase()]||null;t!==null&&(d={enclosure_url:new URL(e,p).toString(),enclosure_type:t})}),{title:t.title||r(t.published),description:c,author:_,pubDate:r(t.published),guid:`coomer:${t.service}:${t.user}:post:${t.id}`,link:`${p}/${t.service}/user/${t.user}/post/${t.id}`,...d}});return{title:v,image:y,link:f?`${p}/posts`:`${p}/${l}/user/${d}`,item:b}}async function u(e){return(await i({method:`get`,url:`${e}/profile`,headers:s})).data.name}export{c as route};