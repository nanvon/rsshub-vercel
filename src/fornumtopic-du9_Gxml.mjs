import{n as e,t}from"./esm-shims-D5mxTuu_.mjs";import"./config-CDM38Tpk.mjs";import"./logger-B0B1yUZ6.mjs";import"./ofetch-FkpIOIxH.mjs";import"./helpers-CMl_ndRq.mjs";import{t as n}from"./cache-C6z2tE2n.mjs";import{t as r}from"./render-D2i47mnC.mjs";import{t as i}from"./parse-date-Cv8vEJfE.mjs";import{t as a}from"./got-CxBlPaz_.mjs";import{t as o}from"./timezone-DuBj3K5r.mjs";import s from"node:path";import{load as c}from"cheerio";import l from"iconv-lite";e();const u=`https://www.txrjy.com`,d={path:`/fornumtopic/:channel?`,categories:[`bbs`],example:`/txrjy/fornumtopic`,parameters:{channel:`频道的 id，见下表，默认为最新500个主题帖`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`论坛 频道`,maintainers:[`Fatpandac`],handler:f,description:`| 最新 500 个主题帖 | 最新 500 个回复帖 | 最新精华帖 | 最新精华帖 | 一周热帖 | 本月热帖 |
| :---------------: | :---------------: | :--------: | :--------: | :------: | :------: |
|         1         |         2         |      3     |      4     |     5    |     6    |`};async function f(e){let d=`${u}/c114-listnewtopic.php?typeid=${e.req.param(`channel`)??`1`}`,f=await a(d,{responseType:`buffer`}),p=c(l.decode(f.data,`gbk`)),m=p(`div.z > a`).last().text(),h=p(`tbody > tr`).slice(0,25).toArray().map(e=>({title:p(e).find(`td.title2`).text(),link:new URL(p(e).find(`td.title2 > a`).attr(`href`),u).href,author:p(e).find(`td.author`).text(),pubDate:o(i(p(e).find(`td.dateline`).text(),`YYYY-M-D HH:mm`),8),category:p(e).find(`td.forum`).text()})).filter(e=>e.title),g=await Promise.all(h.map(e=>n.tryGet(e.link,async()=>{let n=await a(e.link,{responseType:`buffer`}),i=c(l.decode(n.data,`gbk`));return e.description=i(`div.c_table`).toArray().map(e=>r(s.join(t,`templates/fornumtopic-4778c7bd.art`),{content:i(e).find(`td.t_f`).find(`div.a_pr`).remove().end().html()?.replaceAll(/(<img.*?) src=".*?"(.*?>)/g,`$1$2`).replaceAll(/(<img.*?)zoomfile(.*?>)/g,`$1src$2`),pattl:i(e).find(`div.pattl`).html()?.replaceAll(/(<img.*?) src=".*?"(.*?>)/g,`$1$2`).replaceAll(/(<img.*?)zoomfile(.*?>)/g,`$1src$2`),author:i(e).find(`a.xw1`).text().trim()})).join(`
`),e})));return{title:`通信人家园 - 论坛 ${m}`,link:d,item:g}}export{d as route};