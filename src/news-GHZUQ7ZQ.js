import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import{rand_user_agent_default as n}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-DqHh1IN2.js";import"./helpers-gUVC02jt.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-VGofQtEf.js";import s from"node:path";import{load as c}from"cheerio";import l from"p-map";t();const u=n({browser:`chrome`,os:`android`,device:`mobile`}),d=t=>r.tryGet(t.link,async()=>{let n=t.link.replace(/(?<=^https:\/\/\w+\.wsj\.com)/,`/amp`),r=(await o({url:n,method:`get`,headers:{"User-Agent":u}})).data,l=c(r),d=l(`head > meta[name="description"]`).attr(`content`),f=l(`meta[itemprop="dateModified"]`).attr(`content`),p=l(`meta[itemprop="datePublished"]`).attr(`content`),m=l(`.author > a[rel="author"]`).text(),h=l(`meta[name="keywords"]`).attr(`content`).split(`,`).map(e=>e.trim()),g=l(`article`);t.subTitle=l(`h2.sub-head`).html(),g.find(`.media-object-podcast`).remove(),g.find(`.bylineWrap`).each((e,t)=>{l(t).find(`p`).each(function(){l(this).replaceWith(l(this).html())})}),g.find(`.bigTop-hero`).each((e,t)=>{let n=l(t).find(`amp-img`).attr(`src`),r=l(t).find(`amp-img`).attr(`alt`),i=l(t).find(`.imageCaption`).text().trim(),a=l(t).find(`.imageCredit`).text().trim(),o=l(`<figure><img src="${n}" alt="${r}"><figcaption>${i} <span>${a}</span></figcaption></figure>`);l(o).insertBefore(t),l(t).remove()}),g.find(`amp-img`).each((e,t)=>{let n=l(`<img width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}" alt="${t.attribs.alt}">`);l(n).insertBefore(t),l(t).remove()}),g.find(`amp-iframe`).each((e,t)=>{let n=l(`<iframe width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}">`);l(n).insertBefore(t),l(t).remove()});for(let e of[`amp-ad`,`.wsj-ad`,`h1`,`h2`,`.zonedModule`,`.snippet`,`.newsletter-inset`])g.find(e).each((e,t)=>{l(t).remove()});return g.find(`.paywall`).each((e,t)=>{l(t.childNodes).insertBefore(t),l(t).remove()}),t.article=g.html(),t.description=i(s.join(e,`templates/article-description-8e28f8db.art`),{item:t}),{title:t.title,pubDate:a(p),updated:a(f),author:m,link:t.link,summary:d,description:t.description,category:h,icon:`https://s.wsj.net/media/wsj_launcher-icon-4x.png`,logo:`https://vir.wsj.net/fp/assets/webpack4/img/wsj-logo-big-black.165e51cc.svg`}}),f={"en-us":`https://www.wsj.com`,"zh-cn":`https://cn.wsj.com/zh-hans`,"zh-tw":`https://cn.wsj.com/zh-hant`},p={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/wsj/en-us/opinion`,parameters:{lang:"Language, `en-us`, `zh-cn`, `zh-tw`",category:`Category. See below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`News`,maintainers:[`oppilate`],handler:m,description:`en_us

| World | U.S. | Politics | Economy | Business | Tech       | Markets | Opinion | Books & Arts | Real Estate | Life & Work | Sytle               | Sports |
| ----- | ---- | -------- | ------- | -------- | ---------- | ------- | ------- | ------------ | ----------- | ----------- | ------------------- | ------ |
| world | us   | politics | economy | business | technology | markets | opinion | books-arts   | realestate  | life-work   | style-entertainment | sports |

  zh-cn / zh-tw

| 国际  | 中国  | 金融市场 | 经济    | 商业     | 科技       | 派        | 专栏与观点 |
| ----- | ----- | -------- | ------- | -------- | ---------- | --------- | ---------- |
| world | china | markets  | economy | business | technology | life-arts | opinion    |

  Provide full article RSS for WSJ topics.`};async function m(e){let t=e.req.param(`lang`),n=e.req.param(`category`)||``,r=f[t],i=` - ${t.toUpperCase()}`,a=r;n.length>0&&(a=`${r}/news/${n}`,i=`${i} - ${n}`);let s=await o({method:`get`,url:a}),u=c(s.data)(`script:contains("window.__STATE__")`).text(),p=JSON.parse(u.match(/{.*}/)[0]).data,m=Object.entries(p).filter(([e,t])=>e.startsWith(`article`)?t.data.data.url.includes(`wsj.com/articles/`):!1).map(([e])=>e).map(e=>{let t={};return t.title=p[e].data.data.headline,t.link=p[e].data.data.url,t.test=e,t}),h=await l(m,e=>d(e),{concurrency:10});return{title:`WSJ${i}`,link:a,description:`WSJ${i}`,item:h}}export{p as route};