import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{art as n}from"./render-DftO2d-b.js";import{got_default as r}from"./got-Di2lBekK.js";import{invalid_parameter_default as i}from"./invalid-parameter-CfUmvEUg.js";import{isValidHost as a}from"./valid-host-BYPA8xwv.js";import o from"node:path";import{load as s}from"cheerio";import{CookieJar as c}from"tough-cookie";t();const l=new c,u=r.extend({cookieJar:l});function d(e){let t=new URLSearchParams(e);return t.set(`is_format_data`,`1`),t.set(`is_new_list`,`1`),t.set(`type`,`1`),t.toString()}async function f(){let e=s(await u(`https://rent.591.com.tw`).text())(`meta[name="csrf-token"]`).attr(`content`);if(!e)throw Error(`CSRF token not found`);return e}async function p(e){let t=await f(),{data:{data:n}}=await u({url:e,headers:{"X-CSRF-TOKEN":t}}).json();return n}const m=t=>n(o.join(e,`templates/house-68aed177.art`),{house:t}),h={path:`/:country/rent/:query?`,categories:[`other`],example:`/591/tw/rent/order=posttime&orderType=desc`,parameters:{country:`Country code. Only tw is supported now`,query:`Query Parameters`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Rental house`,maintainers:[`Yukaii`],handler:g,description:`::: tip
  Copy the URL of the 591 filter housing page and remove the front part \`https://rent.591.com.tw/?\`, you will get the query parameters.
:::`};async function g(e){let t=e.req.param(`query`)??``,n=e.req.param(`country`)??`tw`;if(!a(n)&&n!==`tw`)throw new i(`Invalid country codes. Only "tw" is supported now.`);let r=await p(`https://rent.591.com.tw/home/search/rsList?${d(t)}`),o=`https://rent.591.com.tw/?${t}`,s=r.map(e=>{let{title:t,post_id:n,price:r,price_unit:i}=e,a=`https://rent.591.com.tw/home/${n}`;return{title:`${t} - ${r} ${i}`,description:m(e),link:a}});return e.set(`json`,{houses:r}),{title:`591 租屋 - 自訂查詢`,link:o,description:`591 租屋 - 自訂查詢, query: ${t}`,item:s}}export{h as route};