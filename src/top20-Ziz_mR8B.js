import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{n as i,t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./got-CgQXMNWI.js";import s from"node:path";import{load as c}from"cheerio";e();const l=e=>r(s.join(t,`templates/description-4270576b.art`),{content:e});r.defaults.imports.parseContent=l;const u={path:`/top20`,categories:[`blog`],example:`/zhubai/top20`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`analy.zhubai.love/`]}],name:`上周热门 TOP 20`,maintainers:[`nczitzk`],handler:d,url:`analy.zhubai.love/`};async function d(e){let t=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):20,r=`http://analy.zhubai.wiki`,s=new URL(`a/zb/s/ht/pl/wk`,`https://open.zhubai.wiki`).href,{data:u}=await o.post(s),d=u.data.slice(0,t).map(e=>({title:e.pn,link:e.pu??e.pq??e.fp,description:e.pa,author:e.zn,pubDate:i(e.lu.replace(/\.\d+/,``))}));d=await Promise.all(d.map(e=>n.tryGet(e.link,async()=>{let t=e.link.match(/\/(?:pl|pq|fp)\/([\w-]+)\/(\d+)/),{data:n}=await o(`https://${t[1]}.zhubai.love/api/posts/${t[2]}`);return e.title=n.title??e.title,e.description=n.content?l(JSON.parse(n.content)):e.description,e.author=n.author?.name??e.author,e.pubDate=n.created_at?a(n.created_at):e.pubDate,e})));let{data:f}=await o(r),p=c(f),m=p(`link[rel="apple-touch-icon"]`).prop(`href`);return{item:d,title:`${p(`meta[property="og:title"]`).prop(`content`)} - TOP20`,link:r,description:p(`meta[property="og:description"]`).prop(`content`),language:p(`html`).prop(`lang`),image:p(`meta[property="og:image"]`).prop(`content`),icon:m,logo:m,subtitle:p(`meta[property="og:description"]`).prop(`content`),author:p(`meta[name="twitter:site"]`).prop(`content`)}}export{u as route};