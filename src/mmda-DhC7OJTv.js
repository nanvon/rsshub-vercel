import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-dCh-Ojgc.js";import o from"node:path";import{load as s}from"cheerio";import c from"query-string";e();const l={path:`/mmda/tags/:tags?`,categories:[`picture`],example:`/booru/mmda/tags/full_body%20blue_eyes`,parameters:{tags:"标签，多个标签使用 `%20` 连接，如需根据作者查询则在 `user:` 后接上作者名，如：`user:xxxx`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},radar:[{source:[`mmda.booru.org/index.php`]}],name:`MMDArchive 标签查询`,maintainers:[`N78Wy`],handler:u,description:"For example:\n\n  -   默认查询 (什么 tag 都不加)：`/booru/mmda/tags`\n  -   默认查询单个 tag：`/booru/mmda/tags/full_body`\n  -   默认查询多个 tag：`/booru/mmda/tags/full_body%20blue_eyes`\n  -   默认查询根据作者查询：`/booru/mmda/tags/user:xxxx`"};async function u(e){let l=`https://mmda.booru.org`,u=e.req.param(`tags`),d=c.stringify({tags:u,page:`post`,s:`list`},{skipNull:!0}),{data:f}=await a(`${l}/index.php`,{searchParams:d}),p=s(f),m=p(`#post-list > div.content > div > div:nth-child(3) span`).toArray().map(e=>{e=p(e);let n=e.find(`a`).first(),i=e.find(`script[type="text/javascript"]`).first().text().match(/user':'(.*?)'/)?.[1]??``,a=n.find(`img`).first().attr(`title`)??``,s=n.find(`img`).first().attr(`src`)??``;return{title:a,link:`${l}/${n.attr(`href`)}`,image:s,author:i,description:r(o.join(t,`templates/description-0e2d1b3e.art`),{title:a,image:s,by:i})}}),h=await Promise.all(m.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link),c=s(n),l=c(`#tag_list > ul`);l.find(`li, br, strong`).remove();let u=l.text(),d=/(?<key>[^\s:]+)\s*:\s*(?<value>.+)/gm,f={};for(let e of u.matchAll(d)){let{key:t,value:n}=e.groups??{};f[t.trim().toLocaleLowerCase()]=n.trim()}let p=c(`#image`).attr(`src`);return f.posted&&(e.pubDate=i(f.posted)),e.description=r(o.join(t,`templates/description-0e2d1b3e.art`),{title:e.title,image:p??e.image,posted:e.pubDate??``,by:f.by,source:f.source,rating:f.rating,score:f.score}),e})));return{title:u,link:`${l}/index.php?${d}`,item:h}}export{l as route};