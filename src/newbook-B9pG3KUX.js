import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BlqYKpVp.js";import{t as o}from"./timezone-BPfwRbwD.js";import s from"node:path";e();const c={path:String.raw`/lib/space/:path{newbook.*}`,name:`图书馆 - 新书速递`,url:`space.lib.buaa.edu.cn/mspace/newBook`,maintainers:[`OverflowCat`],example:`/buaa/lib/space/newbook/`,handler:l,description:"可通过参数进行筛选：`/buaa/lib/space/newbook/key1=value1&key2=value2...`\n- `dcpCode`：学科分类代码\n  - 例：\n    - 工学：`08`\n    - 工学 > 计算机 > 计算机科学与技术：`080901`\n  - 默认值：`nolimit`\n  - 注意事项：不可与 `clsNo` 同时使用。\n- `clsNo`：中图分类号\n  - 例：\n    - 计算机科学：`TP3`\n  - 默认值：无\n  - 注意事项\n    - 不可与 `dcpCode` 同时使用。\n    - 此模式下获取不到上架日期。\n- `libCode`：图书馆代码\n  - 例：\n    - 本馆：`00000`\n  - 默认值：无\n  - 注意事项：只有本馆一个可选值。\n- `locaCode`：馆藏地代码\n  - 例：\n    - 五层西-中文新书借阅室(A-Z类)：`02503`\n  - 默认值：无\n  - 注意事项：必须与 `libCode` 同时使用。\n\n示例：\n- `buaa/lib/space/newbook` 为所有新书\n- `buaa/lib/space/newbook/clsNo=U&libCode=00000&locaCode=60001` 为沙河教2图书馆所有中图分类号为 U（交通运输）的书籍\n",categories:[`university`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1}};async function l(e){let t=e.req.param(`path`),n=t.indexOf(`/`),r=n===-1?``:t.slice(n+1),i=new URLSearchParams(r),o=i.get(`dcpCode`),s=i.get(`clsNo`);if(o&&s)throw Error(`dcpCode and clsNo cannot be used at the same time`);i.set(`pageSize`,`100`),i.set(`page`,`1`),!o&&!s&&i.set(`dcpCode`,`nolimit`);let{data:c}=await a(`https://space.lib.buaa.edu.cn/meta-local/opac/new/100/${s?`byclass`:`bysubject`}?${i.toString()}`),l=c?.data?.dataList||[];return{title:`北航图书馆 - 新书速递`,item:await Promise.all(l.map(async e=>await u(e))),description:`北京航空航天大学图书馆新书速递`,language:`zh-CN`,link:`https://space.lib.buaa.edu.cn/space/newBook`,author:`北京航空航天大学图书馆`,allowEmpty:!0,image:`https://lib.buaa.edu.cn/apple-touch-icon.png`}}async function u(e){return await n.tryGet(e.isbn,async()=>{let n=await d(e.isbn),a=JSON.parse(e.holdings),c=`https://space.lib.buaa.edu.cn/space/searchDetailLocal/${e.bibId}`,l=r(s.join(t,`templates/newbook-d3aea22a.art`),{item:e,info:n,holdings:a});return{language:e.language===`eng`?`en`:`zh-CN`,title:e.title,pubDate:e.onSelfDate?o(i(e.onSelfDate),8):void 0,description:l,link:c}})}async function d(e){let t=await a(`https://space.lib.buaa.edu.cn/meta-local/opac/third_api/douban/${e}/info`);return JSON.parse(t.body).data}export{c as route};