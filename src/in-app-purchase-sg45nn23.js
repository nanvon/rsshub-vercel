import"./esm-shims-Dqvxr0BZ.js";import"./config-BL2l-VlN.js";import"./logger-DWogN5HJ.js";import"./ofetch-e4r9n7lx.js";import"./helpers-gUVC02jt.js";import{got_default as e}from"./got-DF7DsGgk.js";import*as t from"node:url";import{load as n}from"cheerio";const r={path:`/iap/:country/:id`,categories:[`program-update`],example:`/appstore/iap/us/id953286746`,parameters:{country:"App Store Country, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `us`",id:"App Store app id, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `id953286746`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`In-App-Purchase Price Drop Alert`,maintainers:[`HenryQW`],handler:i};async function i(r){let i=r.req.param(`country`),a=r.req.param(`id`),o=`https://apps.apple.com/${i}/app/${a}`,s=t.resolve(o,`?mt=8#see-all/in-app-purchases`),c=await e.get(s),l=n(c.data)(`html`).attr(`lang`),u=(await e({method:`get`,url:`https://amp-api.apps.apple.com/v1/catalog/${i}/apps/${a.replace(`id`,``)}?platform=web&include=Cmerchandised-in-apps%2Ctop-in-apps%2Ceula&l=${l}`,headers:{authorization:`Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkNSRjVITkJHUFEifQ.eyJpc3MiOiI4Q1UyNk1LTFM0IiwiaWF0IjoxNjA3MDMxMTcwLCJleHAiOjE2MTAwNTUxNzB9.qzq2PKkPBNDwHbShoBY3T7J2IjgWsR_MyAvTnZtQB5FZjsH_ZY5esBa0qXbA9kUiq_90GkRoNVMR03meOQQ7SQ`,authority:`amp-api.apps.apple.com`,referer:s}})).data.data[0],d=u.attributes,f=d.name,p=d.deviceFamilies.includes(`mac`)?`macOS`:`iOS`,m,h=[],g=u.relationships[`top-in-apps`].data;return g&&(m=`${i===`cn`?`内购限免提醒`:`IAP price watcher`}: ${f} for ${p}`,h=g.map(e=>{let t=`${e.attributes.name} is now ${e.attributes.offers[0].priceFormatted}`;return{link:o,guid:e.attributes.url,description:e.attributes.artwork?e.attributes.description.standard+`<br><img src=${e.attributes.artwork.url.replace(`{w}x{h}{c}.{f}`,`320x0w.jpg`)}>`:e.attributes.description.standard,title:t,pubDate:new Date().toUTCString()}})),{title:m,link:o,item:h}}export{r as route};