import"./esm-shims-BKVRry6h.mjs";import{n as e,t}from"./ofetch-BRplXtiZ.mjs";import{t as n}from"./config-D7dgKYF5.mjs";import{n as r,r as i}from"./header-generator-CwJlvunE.mjs";import{t as a}from"./logger-CkUWGGaS.mjs";import{t as o}from"./proxy-DbO2Yx6a.mjs";import{t as s}from"./not-found-C-Horq2w.mjs";import{t as c}from"./reject-BES9cPty.mjs";import{t as l}from"./md5-DQN6cWFb.mjs";import{t as u}from"./request-in-progress-DJ9USKmm.mjs";import{t as d}from"./cache-Bv3_kFbE.mjs";import{n as f,o as ee,r as te}from"./helpers-Tm7Pw8Vq.mjs";import"./parse-date-_GmTZfjS.mjs";import{n as p,t as m}from"./common-utils-Cdz0xo5t.mjs";import{a as ne,i as re,n as ie,r as ae}from"./render-CSqLtqb8.mjs";import h from"node:http";import g from"node:https";import oe,{FormData as se,Headers as ce,Request as le,Response as ue}from"undici";import de from"node:path";import{RateLimiterMemory as fe,RateLimiterQueue as pe}from"rate-limiter-flexible";import{Hono as me}from"hono";import{compress as he}from"hono/compress";import{jsxRenderer as ge}from"hono/jsx-renderer";import{trimTrailingSlash as _e}from"hono/trailing-slash";import{OpenAPIHono as ve,createRoute as _,z as v}from"@hono/zod-openapi";import{Scalar as ye}from"@scalar/hono-api-reference";import{serveStatic as be}from"@hono/node-server/serve-static";import{directoryImport as xe}from"directory-import";import{routePath as y}from"hono/route";import{execSync as Se}from"node:child_process";import{Fragment as b,jsx as x,jsxs as S}from"hono/jsx/jsx-runtime";import{PrometheusExporter as Ce,PrometheusSerializer as we}from"@opentelemetry/exporter-prometheus";import{resourceFromAttributes as Te}from"@opentelemetry/resources";import{MeterProvider as Ee}from"@opentelemetry/sdk-metrics";import{ATTR_SERVICE_NAME as C}from"@opentelemetry/semantic-conventions";import{trace as De}from"@opentelemetry/api";import{OTLPTraceExporter as Oe}from"@opentelemetry/exporter-trace-otlp-http";import{BasicTracerProvider as ke,BatchSpanProcessor as Ae}from"@opentelemetry/sdk-trace-base";import{parse as w}from"tldts";import*as T from"@sentry/node";import{load as E}from"cheerio";import je from"xxhash-wasm";import Me from"etag";import Ne from"@postlight/parser";import*as D from"entities";import{convert as O}from"html-to-text";import Pe from"markdown-it";import{RE2JS as k}from"re2js";import Fe from"sanitize-html";import{simplecc as Ie}from"simplecc-wasm";const Le=new pe(new fe({points:10,duration:1,execEvenly:!0}),{maxQueueSize:4800}),Re=t=>{process.env.NODE_ENV===`dev`&&e(e=>{for(let[n,r]of t.entries())e.requestHeaders[n]=r;return e})};var ze=async(e,t)=>{let s=new le(e,t),c={};a.debug(`Outgoing request: ${s.method} ${s.url}`);let l=r(t?.headerGeneratorOptions);s.headers.has(`user-agent`)||s.headers.set(`user-agent`,n.ua);for(let e of i)!s.headers.has(e)&&l[e]&&s.headers.set(e,l[e]);if(!s.headers.get(`referer`))try{let e=new URL(s.url);s.headers.set(`referer`,e.origin)}catch{}let u=!1;if(s.headers.get(`x-prefer-proxy`)&&(u=!0,s.headers.delete(`x-prefer-proxy`)),n.enableRemoteDebugging&&Re(s.headers),!t?.dispatcher&&(o.proxyObj.strategy!==`on_retry`||u)){let e=new RegExp(o.proxyObj.url_regex),t;try{t=new URL(s.url)}catch{}if(e.test(s.url)&&s.url.startsWith(`http`)&&!(t&&t.host===o.proxyUrlHandler?.host)){let e=o.getCurrentProxy();if(e){let t=o.getDispatcherForProxy(e);t&&(c.dispatcher=t,a.debug(`Proxying request via ${e.uri}: ${s.url}`))}}}await Le.removeTokens(1);let d=o.multiProxy?.allProxies.length||1,f=async e=>{try{return await oe.fetch(s,c)}catch(t){if(c.dispatcher&&o.multiProxy&&e<d-1){let n=o.getCurrentProxy();if(n){a.warn(`Request failed with proxy ${n.uri}, trying next proxy: ${t}`),o.markProxyFailed(n.uri);let r=o.getCurrentProxy();if(r&&r.uri!==n.uri){let t=o.getDispatcherForProxy(r);return t&&(c.dispatcher=t),a.debug(`Retrying request with proxy ${r.uri}: ${s.url}`),f(e+1)}else return a.warn(`No more proxies available, trying without proxy`),delete c.dispatcher,f(e+1)}}throw t}};return f(0)},A=e=>function(...t){let s,c={},l;if(typeof t[0]==`string`||t[0]instanceof URL)s=new URL(t[0]),typeof t[1]==`object`?(c=t[1],l=t[2]):typeof t[1]==`function`&&(c={},l=t[1]);else{c=t[0];try{s=new URL(c.href||`${c.protocol||`http:`}//${c.hostname||c.host}${c.path}${c.search||(c.query?`?${c.query}`:``)}`)}catch{s=null}typeof t[1]==`function`&&(l=t[1])}if(!s)return Reflect.apply(e,this,t);a.debug(`Outgoing request: ${c.method||`GET`} ${s}`),c.headers=c.headers||{};let u=new Set(Object.keys(c.headers).map(e=>e.toLowerCase())),d=r(c.headerGeneratorOptions);u.has(`user-agent`)||(c.headers[`user-agent`]=n.ua);for(let e of i)!u.has(e)&&d[e]&&(c.headers[e]=d[e]);u.has(`referer`)||(c.headers.referer=s.origin),!c.agent&&o.agent&&new RegExp(o.proxyObj.url_regex).test(s.toString())&&s.protocol.startsWith(`http`)&&s.host!==o.proxyUrlHandler?.host&&s.host!==`localhost`&&!s.host.startsWith(`127.`)&&!(n.puppeteerWSEndpoint?.includes(s.host)??!1)&&(c.agent=o.agent);let{headerGeneratorOptions:f,...ee}=c;return Reflect.apply(e,this,[s,ee,l])};Object.defineProperties(globalThis,{fetch:{value:ze},Headers:{value:ce},FormData:{value:se},Request:{value:le},Response:{value:ue}}),h.get=A(h.get),h.request=A(h.request),g.get=A(g.get),g.request=A(g.request);var Be=e=>(e.header(`Cache-Control`,`no-cache`),e.text(`ok`));const Ve={hitCache:0,request:0,etag:0,error:0,routes:{},paths:{},errorRoutes:{},errorPaths:{}},j=()=>Ve,M=e=>Object.assign(Ve,e);let N=process.env.HEROKU_SLUG_COMMIT?.slice(0,8)||process.env.VERCEL_GIT_COMMIT_SHA?.slice(0,8),P;if(!N)try{N=Se(`git rev-parse HEAD`).toString().trim().slice(0,8),P=new Date(Se(`git log -1 --format=%cd`).toString().trim())}catch{N=`unknown`}const He=e=>S(`html`,{children:[S(`head`,{children:[x(`title`,{children:`Welcome to RSSHub!`}),x(`script`,{src:`https://cdn.tailwindcss.com`}),x(`style`,{children:`
                details::-webkit-scrollbar {
                    width: 0.25rem;
                }
                details::-webkit-scrollbar-thumb {
                    border-radius: 0.125rem;
                    background-color: #e4e4e7;
                }
                details::-webkit-scrollbar-thumb:hover {
                    background-color: #a1a1aa;
                }

                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 400;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-400-normal.woff2) format(woff2);
                }
                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 500;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-500-normal.woff2) format(woff2);
                }
                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 700;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-700-normal.woff2) format(woff2);
                }
                body {
                    font-family: SN Pro, sans-serif;
                }
                `})]}),x(`body`,{className:`antialiased min-h-screen text-zinc-700 flex flex-col`,children:e.children})]}),Ue=Date.now();var We=({debugQuery:e})=>{let t=j(),r=!n.debugInfo||n.debugInfo===`false`?!1:n.debugInfo===`true`||n.debugInfo===e,{disallowRobot:i,nodeName:a,cache:o}=n,s=Date.now()-Ue,c={showDebug:r,disallowRobot:i,debug:[...a?[{name:`Node Name`,value:a}]:[],...N?[{name:`Git Hash`,value:x(`a`,{className:`underline`,href:`https://github.com/DIYgod/RSSHub/commit/${N}`,children:N})}]:[],...P?[{name:`Git Date`,value:P.toUTCString()}]:[],{name:`Cache Duration`,value:o.routeExpire+`s`},{name:`Request Amount`,value:t.request},{name:`Request Frequency`,value:(t.request/(s/1e3)*60).toFixed(3)+` times/minute`},{name:`Cache Hit Ratio`,value:t.request?(t.hitCache/t.request*100).toFixed(2)+`%`:0},{name:`ETag Matched Ratio`,value:t.request?(t.etag/t.request*100).toFixed(2)+`%`:0},{name:`Health`,value:t.request?((1-t.error/t.request)*100).toFixed(2)+`%`:0},{name:`Uptime`,value:(s/36e5).toFixed(2)+` hour(s)`},{name:`Hot Routes`,value:Object.keys(t.routes).toSorted((e,n)=>t.routes[n]-t.routes[e]).slice(0,30).map(e=>S(b,{children:[t.routes[e],` `,e,x(`br`,{})]}))},{name:`Hot Paths`,value:Object.keys(t.paths).toSorted((e,n)=>t.paths[n]-t.paths[e]).slice(0,30).map(e=>S(b,{children:[t.paths[e],` `,e,x(`br`,{})]}))},{name:`Hot Error Routes`,value:Object.keys(t.errorRoutes).toSorted((e,n)=>t.errorRoutes[n]-t.errorRoutes[e]).slice(0,30).map(e=>S(b,{children:[t.errorRoutes[e],` `,e,x(`br`,{})]}))},{name:`Hot Error Paths`,value:Object.keys(t.errorPaths).toSorted((e,n)=>t.errorPaths[n]-t.errorPaths[e]).slice(0,30).map(e=>S(b,{children:[t.errorPaths[e],` `,e,x(`br`,{})]}))}]};return S(He,{children:[x(`div`,{className:`pointer-events-none absolute w-full min-h-screen`,style:{backgroundImage:`url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAzMiAzMicgd2lkdGg9JzMyJyBoZWlnaHQ9JzMyJyBmaWxsPSdub25lJyBzdHJva2U9J3JnYigxNSAyMyA0MiAvIDAuMDQpJz48cGF0aCBkPSdNMCAuNUgzMS41VjMyJy8+PC9zdmc+')`,maskImage:`linear-gradient(transparent, black, transparent)`}}),S(`div`,{className:`w-full grow shrink-0 py-8 flex items-center justify-center flex-col space-y-4`,children:[x(`img`,{src:`./logo.png`,alt:`RSSHub`,width:`100`,loading:`lazy`}),S(`h1`,{className:`text-4xl font-bold`,children:[`Welcome to `,x(`span`,{className:`text-[#F5712C]`,children:`RSSHub`}),`!`]}),x(`p`,{className:`text-xl font-medium text-zinc-600`,children:`The world's largest RSS Network.`}),x(`p`,{className:`text-zinc-500`,children:`If you see this page, the RSSHub is successfully installed and working.`}),S(`div`,{className:`font-bold space-x-4 text-sm`,children:[x(`a`,{target:`_blank`,href:`https://docs.rsshub.app`,children:x(`button`,{className:`text-white bg-[#F5712C] hover:bg-[#DD4A15] py-2 px-4 rounded-full transition-colors`,children:`Home`})}),x(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:x(`button`,{className:`bg-zinc-200 hover:bg-zinc-300 py-2 px-4 rounded-full transition-colors`,children:`GitHub`})})]}),c.showDebug?S(`details`,{className:`text-xs w-96 !mt-8 max-h-[400px] overflow-auto`,children:[x(`summary`,{className:`text-sm cursor-pointer`,children:`Debug Info`}),c.debug.map(e=>S(`div`,{class:`debug-item my-3 pl-8`,children:[S(`span`,{class:`debug-key w-32 text-right inline-block mr-2`,children:[e.name,`: `]}),x(`span`,{class:`debug-value inline-block break-all align-top`,children:e.value})]}))]}):null]}),S(`div`,{className:`text-center pt-4 pb-8 w-full text-sm font-medium space-y-2`,children:[S(`p`,{className:`space-x-4`,children:[x(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/github/_/fff`,alt:`github`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://t.me/rsshub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram group`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram channel`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:x(`img`,{className:`inline`,src:`https://icons.ly/x`,alt:`X`,width:`20`,height:`20`})})]}),S(`p`,{className:`!mt-6`,children:[`Please consider`,` `,x(`a`,{target:`_blank`,href:`https://docs.rsshub.app/sponsor`,className:`text-[#F5712C]`,children:`sponsoring`}),` `,`to help keep this open source project alive.`]}),S(`p`,{children:[`Made with ❤️ by`,` `,x(`a`,{target:`_blank`,href:`https://diygod.cc`,className:`text-[#F5712C]`,children:`DIYgod`}),` `,`and`,` `,x(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub/graphs/contributors`,className:`text-[#F5712C]`,children:`Contributors`}),` `,`under MIT License.`]})]})]})},Ge=e=>(e.header(`Cache-Control`,`no-cache`),e.html(x(We,{debugQuery:e.req.query(`debug`)})));const F=`rsshub`,Ke=new Ce({}),qe=new Ee({resource:Te({[C]:`rsshub`}),readers:[Ke]}),Je=new we,I=qe.getMeter(`rsshub`),Ye=I.createCounter(`${F}_request_total`),Xe=I.createCounter(`${F}_request_error_total`),Ze=I.createHistogram(`${F}_request_duration_seconds_bucket`,{advice:{explicitBucketBoundaries:n.otel.seconds_bucket?.split(`,`).map(Number)}}),Qe=I.createHistogram(`${F}_request_duration_milliseconds_bucket`,{advice:{explicitBucketBoundaries:n.otel.milliseconds_bucket?.split(`,`).map(Number)}}),L={success:(e,t)=>{Ye.add(1,t),Qe.record(e,{unit:`millisecond`,...t}),Ze.record(e/1e3,{unit:`second`,...t})},error:e=>{Xe.add(1,e)}},$e=()=>new Promise((e,t)=>{Ke.collect().then(t=>{e(Je.serialize(t.resourceMetrics))}).finally(()=>{t(``)})}),et=new Oe({}),tt=new ke({resource:Te({[C]:`rsshub`}),spanProcessors:[new Ae(et,{maxQueueSize:4096,scheduledDelayMillis:3e4})]});De.setGlobalTracerProvider(tt);const nt=tt.getTracer(`rsshub`);nt.startSpan(`main`);var rt=e=>$e().then(t=>e.text(t)).catch(t=>{e.status(500),e.json({error:t})}),it=e=>n.disallowRobot?e.text(`User-agent: *
Disallow: /`):(e.status(404),e.text(``));const at=import.meta.dirname;function ot(e){return Object.values(e).every(e=>!e.features?.nsfw)}function st(e){let t={};for(let[n,r]of Object.entries(e))(r.routes===null||r.routes===void 0||ot(r.routes))&&(t[n]=r);return t}let R={},z={};if(n.isPackage)z=(await import(`./routes-Dsi_Wq7n.mjs`)).default;else switch(process.env.NODE_ENV||process.env.VERCEL_ENV){case`production`:z=(await import(`./routes-Dsi_Wq7n.mjs`)).default;break;case`test`:z=await import(`./routes-D700R2dH.mjs`),z.default&&(z=z.default);break;default:R=xe({targetDirectoryPath:de.join(at,`./routes`),importPattern:/\.ts$/})}if(n.feature.disable_nsfw&&(z=st(z)),Object.keys(R).length)for(let e in R){let t=R[e],n=e.split(/[/\\]/)[1];if(`namespace`in t)z[n]=Object.assign({routes:{}},z[n],t.namespace);else if(`route`in t)if(z[n]||(z[n]={name:n,routes:{},apiRoutes:{}}),Array.isArray(t.route.path))for(let r of t.route.path)z[n].routes[r]={...t.route,location:e.split(/[/\\]/).slice(2).join(`/`)};else z[n].routes[t.route.path]={...t.route,location:e.split(/[/\\]/).slice(2).join(`/`)};else if(`apiRoute`in t)if(z[n]||(z[n]={name:n,routes:{},apiRoutes:{}}),Array.isArray(t.apiRoute.path))for(let r of t.apiRoute.path)z[n].apiRoutes[r]={...t.apiRoute,location:e.split(/[/\\]/).slice(2).join(`/`)};else z[n].apiRoutes[t.apiRoute.path]={...t.apiRoute,location:e.split(/[/\\]/).slice(2).join(`/`)}}const B=new me,ct=e=>Object.entries(e).toSorted(([e],[t])=>{let n=e.split(`/`),r=t.split(`/`),i=n.length,a=r.length,o=Math.min(i,a);for(let e=0;e<o;e++){let t=n[e],i=r[e];if(t.startsWith(`:`)!==i.startsWith(`:`))return t.startsWith(`:`)?1:-1}return 0});for(let e in z){let t=B.basePath(`/${e}`),n=z[e];if(!n||!n.routes)continue;let r=ct(n.routes);for(let[n,i]of r)t.get(n,async t=>{if(a.debug(`Matched route: ${y(t)}`),!t.get(`data`)){if(typeof i.handler!=`function`){if(process.env.NODE_ENV===`test`){let{route:t}=await import(`./routes/${e}/${i.location}`);i.handler=t.handler}else if(i.module){let{route:e}=await i.module();i.handler=e.handler}}let n=await i.handler(t);if(n instanceof Response)return n;t.set(`data`,n)}})}for(let e in z){let t=B.basePath(`/api/${e}`),n=z[e];if(!n||!n.apiRoutes)continue;let r=Object.entries(n.apiRoutes);for(let[n,i]of r)t.get(n,async t=>{if(!t.get(`apiData`)){if(typeof i.handler!=`function`){if(process.env.NODE_ENV===`test`){let{apiRoute:t}=await import(`./routes/${e}/${i.location}`);i.handler=t.handler}else if(i.module){let{apiRoute:e}=await i.module();i.handler=e.handler}}let n=await i.handler(t);t.set(`apiData`,n)}})}B.get(`/`,Ge),B.get(`/healthz`,Be),B.get(`/robots.txt`,it),n.debugInfo&&B.get(`/metrics`,rt),n.isPackage||B.use(`/*`,be({root:de.join(at,`assets`),rewriteRequestPath:e=>e===`/favicon.ico`?`/favicon.png`:e}));var lt=B;const V={};for(let e in z)for(let t in z[e].routes)if(z[e].routes[t].categories?.length)for(let n of z[e].routes[t].categories)V[n]||(V[n]={}),V[n][e]||(V[n][e]={...z[e],routes:{}}),V[n][e].routes[t]=z[e].routes[t];const ut=v.object({category:v.string().openapi({param:{name:`category`,in:`path`},example:`popular`})}),dt=_({method:`get`,path:`/category/{category}`,tags:[`Category`],request:{query:v.object({categories:v.string().transform(e=>e.split(`,`)).optional(),lang:v.string().optional()}),params:ut},responses:{200:{description:`Namespace list by categories and language`}}}),ft=e=>{let{categories:t,lang:n}=e.req.valid(`query`),{category:r}=e.req.valid(`param`),i=[r];t&&t.length>0&&(i=[...i,...t]);let a=Object.keys(V[r]||{}).filter(e=>i.every(t=>V[t]?.[e])),o=Object.fromEntries(a.map(e=>[e,V[r][e]]));return n&&(o=Object.fromEntries(Object.entries(o).filter(([,e])=>e.lang===n))),e.json(o)},pt=_({method:`get`,path:`/follow/config`,tags:[`Follow`],responses:{200:{description:`Follow config`}}}),mt=e=>e.json({ownerUserId:n.follow.ownerUserId,description:n.follow.description,price:n.follow.price,userLimit:n.follow.userLimit,cacheTime:n.cache.routeExpire,gitHash:N,gitDate:P?.getTime()}),ht=_({method:`get`,path:`/namespace`,tags:[`Namespace`],responses:{200:{description:`Information about all namespaces`}}}),gt=e=>e.json(z),_t=_({method:`get`,path:`/namespace/{namespace}`,tags:[`Namespace`],request:{params:v.object({namespace:v.string().openapi({param:{name:`namespace`,in:`path`},example:`github`})})},responses:{200:{description:`Information about a namespace`}}}),vt=e=>{let{namespace:t}=e.req.valid(`param`);return e.json(z[t])},H={};for(let e in z)for(let t in z[e].routes){let n=`/${e}${t}`,r=z[e].routes[t];if(r.radar?.length)for(let t of r.radar){let i=w(new URL(`https://`+t.source[0]).hostname),a=i.subdomain||`.`,o=i.domain;o&&(H[o]||(H[o]={_name:z[e].name}),H[o][a]||(H[o][a]=[]),H[o][a].push({title:t.title||r.name,docs:`https://docs.rsshub.app/routes/${r.categories?.[0]||`other`}`,source:t.source.map(e=>{let t=new URL(`https://`+e);return t.pathname+t.search+t.hash}),target:t.target?`/${e}${t.target}`:n}))}}const yt=_({method:`get`,path:`/radar/rules`,tags:[`Radar`],responses:{200:{description:`All Radar rules`}}}),bt=e=>e.json(H),U={};for(let e in z)for(let t in z[e].routes){let n=`/${e}${t}`,r=z[e].routes[t];if(r.radar?.length)for(let t of r.radar){let i=w(new URL(`https://`+t.source[0]).hostname),a=i.subdomain||`.`,o=i.domain;o&&(U[o]||(U[o]={_name:z[e].name}),U[o][a]||(U[o][a]=[]),U[o][a].push({title:t.title||r.name,docs:`https://docs.rsshub.app/routes/${r.categories?.[0]||`other`}`,source:t.source.map(e=>{let t=new URL(`https://`+e);return t.pathname+t.search+t.hash}),target:t.target?`/${e}${t.target}`:n}))}}const xt=_({method:`get`,path:`/radar/rules/{domain}`,tags:[`Radar`],request:{params:v.object({domain:v.string().openapi({param:{name:`domain`,in:`path`},example:`github.com`})})},responses:{200:{description:`Radar rules for a domain name (does not support subdomains)`}}}),St=e=>{let{domain:t}=e.req.valid(`param`);return e.json(U[t])},W=new ve;W.openapi(ht,gt),W.openapi(_t,vt),W.openapi(yt,bt),W.openapi(xt,St),W.openapi(dt,ft),W.openapi(pt,mt);const G=W.getOpenAPI31Document({openapi:`3.1.0`,info:{version:`0.0.1`,title:`RSSHub API`}});for(let e in G.paths)G.paths[`/api${e}`]=G.paths[e],delete G.paths[e];W.get(`/openapi.json`,e=>e.json(G)),W.get(`/reference`,ye({content:G}));var Ct=W,wt=({requestPath:e,message:t,errorRoute:n,nodeVersion:r})=>S(He,{children:[x(`div`,{className:`pointer-events-none absolute w-full min-h-screen`,style:{backgroundImage:`url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAzMiAzMicgd2lkdGg9JzMyJyBoZWlnaHQ9JzMyJyBmaWxsPSdub25lJyBzdHJva2U9J3JnYigxNSAyMyA0MiAvIDAuMDQpJz48cGF0aCBkPSdNMCAuNUgzMS41VjMyJy8+PC9zdmc+')`,maskImage:`linear-gradient(transparent, black, transparent)`}}),S(`div`,{className:`w-full grow shrink-0 py-8 flex items-center justify-center flex-col space-y-4`,children:[x(`img`,{className:`grayscale`,src:`/logo.png`,alt:`RSSHub`,width:`100`,loading:`lazy`}),x(`h1`,{className:`text-4xl font-bold`,children:`Looks like something went wrong`}),S(`div`,{className:`text-left w-[800px] space-y-6 !mt-10`,children:[S(`div`,{className:`space-y-2`,children:[x(`p`,{className:`mb-2 font-bold`,children:`Helpful Information`}),S(`p`,{className:`message`,children:[`Error Message:`,x(`br`,{}),x(`code`,{className:`mt-2 block max-h-28 overflow-auto bg-zinc-100 align-bottom w-fit details whitespace-pre-line`,children:t})]}),S(`p`,{className:`message`,children:[`Route: `,x(`code`,{className:`ml-2 bg-zinc-100`,children:n})]}),S(`p`,{className:`message`,children:[`Full Route: `,x(`code`,{className:`ml-2 bg-zinc-100`,children:e})]}),S(`p`,{className:`message`,children:[`Node Version: `,x(`code`,{className:`ml-2 bg-zinc-100`,children:r})]}),S(`p`,{className:`message`,children:[`Git Hash: `,x(`code`,{className:`ml-2 bg-zinc-100`,children:N})]}),S(`p`,{className:`message`,children:[`Git Date: `,x(`code`,{className:`ml-2 bg-zinc-100`,children:P?.toUTCString()})]})]}),S(`div`,{children:[x(`p`,{className:`mb-2 font-bold`,children:`Report`}),S(`p`,{children:[`After carefully reading the`,` `,x(`a`,{className:`text-[#F5712C]`,href:`https://docs.rsshub.app/`,target:`_blank`,children:`document`}),`, if you think this is a bug of RSSHub, please`,` `,x(`a`,{className:`text-[#F5712C]`,href:`https://github.com/DIYgod/RSSHub/issues/new?assignees=&labels=RSS+bug&template=bug_report_en.yml`,target:`_blank`,children:`submit an issue`}),` `,`on GitHub.`]}),S(`p`,{children:[`在仔细阅读`,x(`a`,{className:`text-[#F5712C]`,href:`https://docs.rsshub.app/zh/`,target:`_blank`,children:`文档`}),`后，如果你认为这是 RSSHub 的 bug，请在 GitHub`,` `,x(`a`,{className:`text-[#F5712C]`,href:`https://github.com/DIYgod/RSSHub/issues/new?assignees=&labels=RSS+bug&template=bug_report_zh.yml`,target:`_blank`,children:`提交 issue`}),`。`]})]}),S(`div`,{children:[x(`p`,{className:`mb-2 font-bold`,children:`Community`}),S(`p`,{children:[`You can also join our`,` `,x(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/rsshub`,children:`Telegram group`}),`, or follow our`,` `,x(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:`Telegram channel`}),` `,`and`,` `,x(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:`Twitter`}),` `,`to get community support and news.`]}),S(`p`,{children:[`你也可以加入我们的`,` `,x(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/rsshub`,children:`Telegram 群组`}),`，或关注我们的`,` `,x(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:`Telegram 频道`}),`和`,` `,x(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:`Twitter`}),` `,`获取社区支持和新闻。`]})]})]})]}),S(`div`,{className:`mt-4 pb-8 text-center w-full text-sm font-medium space-y-2`,children:[S(`p`,{className:`space-x-4`,children:[x(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/github/_/fff`,alt:`github`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://t.me/rsshub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram group`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:x(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram channel`,width:`20`,height:`20`})}),x(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:x(`img`,{className:`inline`,src:`https://icons.ly/x`,alt:`X`,width:`20`,height:`20`})})]}),S(`p`,{className:`!mt-6`,children:[`Please consider`,` `,x(`a`,{target:`_blank`,href:`https://docs.rsshub.app/sponsor`,className:`text-[#F5712C]`,children:`sponsoring`}),` `,`to help keep this open source project alive.`]}),S(`p`,{children:[`Made with ❤️ by`,` `,x(`a`,{target:`_blank`,href:`https://diygod.cc`,className:`text-[#F5712C]`,children:`DIYgod`}),` `,`and`,` `,x(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub/graphs/contributors`,className:`text-[#F5712C]`,children:`Contributors`}),` `,`under MIT License.`]})]})]});const Tt=(e,t)=>{let r=t.req.path,i=y(t),o=i!==`/*`,s=j();try{t.res.headers.get(`RSSHub-Cache-Status`)&&s.hitCache++}catch{}s.error++,s.errorPaths[r]||(s.errorPaths[r]=0),s.errorPaths[r]++,!s.errorRoutes[i]&&o&&(s.errorRoutes[i]=0),o&&s.errorRoutes[i]++,M(s),n.sentry.dsn&&T.withScope(t=>{t.setTag(`name`,r.split(`/`)[1]),T.captureException(e)});let c=(process.env.NODE_ENV||process.env.VERCEL_ENV)===`production`?e.message:e.stack||e.message;switch(e.constructor.name){case`HTTPError`:case`RequestError`:case`FetchError`:t.status(503);break;case`RequestInProgressError`:t.header(`Cache-Control`,`public, max-age=${n.requestTimeout/1e3}`),t.status(503);break;case`RejectError`:t.status(403);break;case`NotFoundError`:t.status(404),c+=`The route does not exist or has been deleted.`;break;default:t.status(503);break}let l=`${e.name}: ${c}`;return a.error(`Error in ${r}: ${l}`),L.error({path:i,method:t.req.method,status:t.res.status}),n.isPackage||t.req.query(`format`)===`json`?t.json({error:{message:e.message??e}}):t.html(x(wt,{requestPath:r,message:l,errorRoute:o?i:r,nodeVersion:process.version}))},Et=e=>Tt(new s,e),Dt=e=>{throw new c(`Authentication failed. Access denied.\n${e}`)};var Ot=async(e,t)=>{let r=new URL(e.req.url).pathname,i=e.req.query(`key`),a=e.req.query(`code`);if(r===`/`||r===`/robots.txt`||r===`/favicon.ico`||r===`/logo.png`)await t();else{if(n.accessKey&&!(n.accessKey===i||a===l(r+n.accessKey)))return Dt(r);await t()}};const kt=/\${([^{}]+)}/g,At=new Set([`hash`,`host`,`hostname`,`href`,`origin`,`password`,`pathname`,`port`,`protocol`,`search`,`searchParams`,`username`]),jt=(e,t)=>{for(let n of t)if(e.startsWith(n)&&(e.length===n.length||e[n.length]===`/`))return!0;return!1},Mt=e=>{let t=n.hotlink.includePaths,r=n.hotlink.excludePaths;return!(t&&!jt(e,t))&&!(r&&jt(e,r))},Nt=(e,t)=>e.replaceAll(kt,(e,n)=>{let r=!1;return n.endsWith(`_ue`)&&(n=n.slice(0,-3),r=!0),r?encodeURIComponent(t[n]):t[n]}),Pt=e=>{let t;try{t=new URL(e)}catch{a.error(`Failed to parse ${e}`)}return t},K=(e,t)=>{if(!e||!t)return t;let n=Pt(t);return n&&n.protocol!==`data:`?Nt(e,n):t},q=(e,t,n,r=`src`)=>{e(t).each(function(){let t=e(this).attr(r);if(t){let i=Pt(t);i&&i.protocol!==`data:`&&e(this).attr(r,Nt(n,i))}})},Ft=(e,t,n)=>{let r=E(e,void 0,!1);return t&&(q(r,`img, picture > source`,t),q(r,`video[poster]`,t,`poster`),q(r,`*[data-rsshub-image="href"]`,t,`href`)),n&&(q(r,`video, video > source, audio, audio > source`,n),t||q(r,`video[poster]`,n,`poster`)),r.html()},It=e=>{if(e)for(let t of e.matchAll(kt)){let e=t[1].endsWith(`_ue`)?t[1].slice(0,-3):t[1];if(!At.has(e))throw Error(`Invalid URL property: ${e}`)}};var Lt=async(e,t)=>{await t();let r,i;if(n.feature.allow_user_hotlink_template&&(i=e.req.query(`multimedia_hotlink_template`),r=e.req.query(`image_hotlink_template`)),n.hotlink.template&&(r=Mt(e.req.path)?n.hotlink.template:void 0,i=Mt(e.req.path)?n.hotlink.template:void 0),!r&&!i)return;It(r),It(i);let a=e.get(`data`);if(a){if(a.image&&=K(r,a.image),a.description&&=Ft(a.description,r,i),a.item)for(let e of a.item)e.description&&=Ft(e.description,r,i),e.enclosure_url&&e.enclosure_type&&(e.enclosure_type.startsWith(`image/`)?e.enclosure_url=K(r,e.enclosure_url):/^(video|audio)\//.test(e.enclosure_type)&&(e.enclosure_url=K(i,e.enclosure_url))),e.image&&=K(r,e.image),e.itunes_item_image&&=K(r,e.itunes_item_image);e.set(`data`,a)}};const Rt=new Set([`/`,`/robots.txt`,`/logo.png`,`/favicon.ico`]);var zt=async(e,t)=>{if(!d.status.available||Rt.has(e.req.path)){await t();return}let r=e.req.path,i=`:${e.req.query(`format`)||`rss`}`,a=e.req.query(`limit`)?`:${e.req.query(`limit`)}`:``,{h64ToString:o}=await je(),s=`rsshub:koa-redis-cache:`+o(r+i+a),c=`rsshub:path-requested:`+o(r+i+a);if(await d.globalCache.get(c)===`1`){let e=process.env.NODE_ENV===`test`?1:10,t=!1;for(;e>0;){if(await new Promise(e=>setTimeout(e,process.env.NODE_ENV===`test`?3e3:6e3)),await d.globalCache.get(c)!==`1`){t=!0;break}e--}if(!t)throw new u(`This path is currently fetching, please come back later!`)}let l=await d.globalCache.get(s);if(l){e.status(200),e.header(`RSSHub-Cache-Status`,`HIT`),e.set(`data`,JSON.parse(l)),await t();return}await d.globalCache.set(c,`1`,n.cache.requestTimeout),e.set(`cacheKey`,s),e.set(`cacheControlKey`,c);try{await t()}catch(e){throw await d.globalCache.set(c,`0`,n.cache.requestTimeout),e}let f=e.get(`data`);if(e.res.headers.get(`Cache-Control`)!==`no-cache`&&f){f.lastBuildDate=new Date().toUTCString(),e.set(`data`,f);let t=JSON.stringify(f);await d.globalCache.set(s,t,n.cache.routeExpire)}await d.globalCache.set(c,`0`,n.cache.requestTimeout)},Bt=async(e,t)=>{{let t=j();t.paths[e.req.path]||(t.paths[e.req.path]=0),t.paths[e.req.path]++,t.request++,M(t)}await t();{let t=j(),n=y(e),r=n!==`/*`;!t.routes[n]&&r&&(t.routes[n]=0),r&&t.routes[n]++,e.res.headers.get(`RSSHub-Cache-Status`)&&t.hitCache++,e.res.status===304&&t.etag++,M(t)}};const J={"Access-Control-Allow-Methods":`GET`,"Content-Type":`application/xml; charset=utf-8`,"Cache-Control":`public, max-age=${n.cache.routeExpire}`,"X-Content-Type-Options":`nosniff`};n.nodeName&&(J[`RSSHub-Node`]=n.nodeName);function Vt(e,t){return t!==null&&t.split(/,\s*/).includes(e)}var Ht=async(e,t)=>{for(let t in J)e.header(t,J[t]);e.header(`Access-Control-Allow-Origin`,n.allowOrigin||new URL(e.req.url).host),await t();let r=y(e);r!==`/*`&&e.header(`X-RSSHub-Route`,r);let i=e.get(`data`);if(!i||e.res.headers.get(`ETag`))return;let a=i.lastBuildDate;delete i.lastBuildDate;let o=Me(JSON.stringify(i));e.header(`ETag`,o),Vt(o,e.req.header(`If-None-Match`)??null)?(e.status(304),e.set(`no-content`,!0)):e.header(`Last-Modified`,a)},Y=function(e){return e.Outgoing=`-->`,e.Incoming=`<--`,e.Error=`xxx`,e}(Y||{});const Ut=e=>({7:`\u001B[35m${e}\u001B[0m`,5:`\u001B[31m${e}\u001B[0m`,4:`\u001B[33m${e}\u001B[0m`,3:`\u001B[36m${e}\u001B[0m`,2:`\u001B[32m${e}\u001B[0m`,1:`\u001B[32m${e}\u001B[0m`,0:`\u001B[33m${e}\u001B[0m`})[Math.trunc(e/100)];var Wt=async(e,t)=>{let{method:n,raw:r,routePath:i}=e.req,o=f(r);a.info(`${Y.Incoming} ${n} ${o}`);let s=Date.now();await t();let c=e.res.status;a.info(`${Y.Outgoing} ${n} ${o} ${Ut(c)} ${ee(s)}`),L.success(Date.now()-s,{path:i,method:n,status:c})};const Gt=Pe({html:!0}),X=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}},Z=async(e,r)=>(await t(`${n.openai.endpoint}/chat/completions`,{method:`POST`,body:{model:n.openai.model,max_tokens:n.openai.maxTokens,messages:[{role:`system`,content:e},{role:`user`,content:r}],temperature:n.openai.temperature},headers:{Authorization:`Bearer ${n.openai.apiKey}`}})).choices[0].message.content,Q=e=>{let t=``;return e.author&&(t=typeof e.author==`string`?e.author:e.author.map(e=>e.name).join(` `)),t};var Kt=async(e,r)=>{await r();let i=e.get(`data`);if(i){if((!i.item||i.item.length===0)&&!i.allowEmpty)throw Error(`this route is empty, please check the original site or <a href="https://github.com/DIYgod/RSSHub/issues/new/choose">create an issue</a>`);i.item=i.item||[],i.title&&=D.decodeXML(i.title+``),i.description&&=D.decodeXML(i.description+``),e.req.query(`sorted`)!==`false`&&(i.item=i.item.toSorted((e,t)=>new Date(t.pubDate||0)-+new Date(e.pubDate||0)));let r=e=>{if(e.title&&=D.decodeXML(e.title+``),e.pubDate&&=new Date(e.pubDate).toUTCString(),e.link){let t=i.link;t&&!/^https?:\/\//.test(t)&&(t=/^\/\//.test(t)?`http:`+t:`http://`+t),e.link=new URL(e.link,t).href}if(e.description){let t=E(e.description),r=e.link||i.link;r&&!/^https?:\/\//.test(r)&&(r=/^\/\//.test(r)?`http:`+r:`http://`+r),t(`script`).remove(),t(`img`).each((e,n)=>{let r=t(n);if(!r.attr(`src`)){let e=r.attr(`data-src`)||r.attr(`data-original`);if(e)r.attr(`src`,e);else for(let e in n.attribs){let t=n.attribs[e].trim();if([`.gif`,`.png`,`.jpg`,`.webp`].some(e=>t.includes(e))){r.attr(`src`,t);break}}}for(let e of[`onclick`,`onerror`,`onload`])r.removeAttr(e)}),t(`a, area`).each((e,n)=>{X(t,n,`href`,r)}),t(`img, video, audio, source, iframe, embed, track`).each((e,n)=>{X(t,n,`src`,r)}),t(`video[poster]`).each((e,n)=>{X(t,n,`poster`,r)}),t(`img, iframe`).each((e,n)=>{t(n).attr(`referrerpolicy`)||t(n).attr(`referrerpolicy`,`no-referrer`)}),e.description=t(`body`).html()+``+(n.suffix||``),e._extra?.links&&t(`.rsshub-quote`).length&&e._extra?.links?.map(e=>(e.content_html=t.html(t(`.rsshub-quote`)),e))}return e.category&&=(Array.isArray(e.category)||(e.category=[e.category]),e.category.filter(e=>typeof e==`string`)),e};i.item=await Promise.all(i.item.map(e=>r(e)));let a=n.feature.filter_regex_engine,o=t=>{let n=e.req.query(`filter_case_sensitive`)===`false`;switch(a){case`regexp`:return new RegExp(t,n?`i`:``);case`re2`:return k.compile(t,n?k.CASE_INSENSITIVE:0);default:throw Error(`Invalid Engine Value: ${a}, please check your config.`)}};if(e.req.query(`filter`)){let t=o(e.req.query(`filter`));i.item=i.item.filter(e=>{let n=e.title||``,r=e.description||n,i=Q(e),a=e.category||[];return t instanceof k?t.matcher(n).find()||t.matcher(r).find()||t.matcher(i).find()||a.some(e=>t.matcher(e).find()):n.match(t)||r.match(t)||i.match(t)||a.some(e=>e.match(t))})}if(!e.req.query(`filter`)&&(e.req.query(`filter_title`)||e.req.query(`filter_description`)||e.req.query(`filter_author`)||e.req.query(`filter_category`))&&(i.item=i.item.filter(t=>{let n=t.title||``,r=t.description||n,i=Q(t),a=t.category||[],s=!0;if(e.req.query(`filter_title`)){let t=o(e.req.query(`filter_title`));s=t instanceof k?t.matcher(n).find():!!t.test(n)}if(e.req.query(`filter_description`)){let t=o(e.req.query(`filter_description`));s&&=t instanceof k?t.matcher(r).find():!!t.test(r)}if(e.req.query(`filter_author`)){let t=o(e.req.query(`filter_author`));s&&=t instanceof k?t.matcher(i).find():!!t.test(i)}if(e.req.query(`filter_category`)){let t=o(e.req.query(`filter_category`));s&&=a.some(e=>t instanceof k?t.matcher(e).find():e.match(t))}return s})),(e.req.query(`filterout`)||e.req.query(`filterout_title`)||e.req.query(`filterout_description`)||e.req.query(`filterout_author`)||e.req.query(`filterout_category`))&&(i.item=i.item.filter(t=>{let n=t.title,r=t.description||n,i=Q(t),a=t.category||[],s=!0;if(e.req.query(`filterout`)||e.req.query(`filterout_title`)){let t=o(e.req.query(`filterout_title`)||e.req.query(`filterout`));s=t instanceof k?!t.matcher(n).find():!t.test(n)}if(e.req.query(`filterout`)||e.req.query(`filterout_description`)){let t=o(e.req.query(`filterout_description`)||e.req.query(`filterout`));s&&=t instanceof k?!t.matcher(r).find():!t.test(r)}if(e.req.query(`filterout_author`)){let t=o(e.req.query(`filterout_author`));s&&=t instanceof k?!t.matcher(i).find():!t.test(i)}if(e.req.query(`filterout_category`)){let t=o(e.req.query(`filterout_category`));s&&=!a.some(e=>t instanceof k?t.matcher(e).find():e.match(t))}return s})),e.req.query(`filter_time`)){let t=Date.now();i.item=i.item.filter(({pubDate:n})=>{let r=!0;try{r=!n||t-new Date(n).getTime()<=Number.parseInt(e.req.query(`filter_time`))*1e3}catch{}return r})}if(e.req.query(`limit`)&&(i.item=i.item.slice(0,Number.parseInt(e.req.query(`limit`)))),e.req.query(`tgiv`)&&i.item.map(t=>(t.link&&=`https://t.me/iv?url=${encodeURIComponent(t.link)}&rhash=${e.req.query(`tgiv`)}`,t)),e.req.query(`mode`)?.toLowerCase()===`fulltext`){let e=i.item.map(async e=>{let{link:n,author:r,description:i}=e,a=await d.tryGet(`mercury-cache-${n}`,async()=>{if(n)try{let e=E(await t(n));return await Ne.parse(n,{html:e.html()})}catch{}});e.author=r||a?.author,e.description=a&&a.content.length>40?D.decodeXML(a.content):i});await Promise.all(e)}if(e.req.query(`chatgpt`)&&n.openai.apiKey&&(i.item=await Promise.all(i.item.map(async e=>{try{if(n.openai.inputOption===`description`&&e.description){let t=await d.tryGet(`openai:description:${e.link}`,async()=>{let t=O(e.description),r=await Z(n.openai.promptDescription,t);return Gt.render(r)});t!==``&&(e.description=t+`<hr/><br/>`+e.description)}else if(n.openai.inputOption===`title`&&e.title){let t=await d.tryGet(`openai:title:${e.link}`,async()=>{let t=O(e.title);return await Z(n.openai.promptTitle,t)});t!==``&&(e.title=t+``)}else if(n.openai.inputOption===`both`&&e.title&&e.description){let t=await d.tryGet(`openai:title:${e.link}`,async()=>{let t=O(e.title);return await Z(n.openai.promptTitle,t)});t!==``&&(e.title=t+``);let r=await d.tryGet(`openai:description:${e.link}`,async()=>{let t=O(e.description),r=await Z(n.openai.promptDescription,t);return Gt.render(r)});r!==``&&(e.description=r+`<hr/><br/>`+e.description)}}catch{}return e}))),e.req.query(`scihub`)&&i.item.map(e=>(e.link=e.doi?`${n.scihub.host}${e.doi}`:`${n.scihub.host}${e.link}`,e)),e.req.query(`opencc`))for(let t of i.item)t.title=Ie(t.title??t.link,e.req.query(`opencc`)),t.description=Ie(t.description??t.title??t.link,e.req.query(`opencc`));if(e.req.query(`brief`))if(/[1-9]\d{2,}/.test(e.req.query(`brief`))){let t=Number.parseInt(e.req.query(`brief`));for(let e of i.item){let n;e.description&&=(n=Fe(e.description,{allowedTags:[],allowedAttributes:{}}),n.length>t?`<p>${n.slice(0,t)}…</p>`:`<p>${n}</p>`)}}else throw Error(`Invalid parameter brief. Please check the doc https://docs.rsshub.app/guide/parameters#shu-chu-jian-xun`);e.set(`data`,i)}};n.sentry.dsn&&(T.init({dsn:n.sentry.dsn}),T.getCurrentScope().setTag(`node_name`,n.nodeName),a.info(`Sentry inited.`));var qt=async(e,t)=>{let r=Date.now();await t(),n.sentry.dsn&&Date.now()-r>=n.sentry.routeTimeout&&T.withScope(t=>{t.setTag(`name`,te(e.req.path)),T.captureException(Error(`Route Timeout`))})},Jt=async(e,t)=>{let r=d.status.available&&Math.trunc(n.cache.routeExpire/60)||1;await t();let i=e.get(`apiData`);if(i)return e.json(i);let a=e.get(`data`),o=e.req.query(`format`)||`rss`;if(n.debugInfo){if(o===`debug.json`)return e.json(e.get(`json`)||{message:`plugin does not set debug json`});if(/(\d+)\.debug\.html$/.test(o)){let t=Number.parseInt(o.match(/(\d+)\.debug\.html$/)?.[1]||`0`);return e.html(a?.item?.[t]?.description||`data.item[${t}].description not found`)}}if(a&&(a.title=m(a.title)||``,a.description&&=m(a.description)||``,a.author&&=m(a.author)||``,a.item))for(let e of a.item){if(e.title){e.title=m(e.title)||``;for(let t=0,r=0;r<e.title.length;r++)if(t+=Buffer.from(e.title[r]).length===1?1:2,t>n.titleLengthLimit){e.title=`${e.title.slice(0,r)}...`;break}}if(e.description&&=e.description.replaceAll(/[\u0000-\u0009\u000B\u000C\u000E-\u001F\u007F\u200B\uFFFF]/g,``),typeof e.author==`string`)e.author=m(e.author)||``;else if(typeof e.author==`object`&&e.author!==null){for(let t of e.author)t.name=m(t.name)||``;o!==`json`&&(e.author=e.author.map(e=>e.name).join(`, `))}if(e.itunes_duration&&(typeof e.itunes_duration==`string`&&!e.itunes_duration.includes(`:`)||typeof e.itunes_duration==`number`&&!Number.isNaN(e.itunes_duration))&&(e.itunes_duration=+e.itunes_duration,e.itunes_duration=Math.floor(e.itunes_duration/3600)+`:`+(Math.floor(e.itunes_duration%3600/60)/100).toFixed(2).slice(-2)+`:`+(e.itunes_duration%3600%60/100).toFixed(2).slice(-2)),o!==`rss`){try{e.pubDate&&=p(e.pubDate)||``}catch{e.pubDate=``}try{e.updated&&=p(e.updated)||``}catch{e.updated=``}}}let s=new Date,c={lastBuildDate:s.toUTCString(),updated:s.toISOString(),ttl:r,atomlink:e.req.url,...a};if(n.isPackage)return e.json(c);if(e.get(`redirect`))return e.redirect(e.get(`redirect`),301);if(e.get(`no-content`))return e.body(null);switch(o){case`ums`:case`rss3`:return e.json(ie(c));case`json`:return e.header(`Content-Type`,`application/feed+json; charset=UTF-8`),e.body(re(c));case`atom`:return e.render(x(ne,{data:c}));default:return e.render(x(ae,{data:c}))}},Yt=async(e,t)=>{if(n.debugInfo){let{method:n,raw:r}=e.req,i=f(r),a=nt.startSpan(`${n} ${i}`,{kind:1,attributes:{}});a.addEvent(`invoking handleRequest`),await t(),a.end()}else await t()};process.on(`uncaughtException`,e=>{a.error(`uncaughtException: `+e)});const $=new me;$.use(_e()),$.use(he()),$.use(ge(({children:e})=>x(b,{children:e}),{docType:`<?xml version="1.0" encoding="UTF-8"?>`,stream:{}})),$.use(Wt),$.use(Yt),$.use(qt),$.use(Ot),$.use(Bt),$.use(Jt),$.use(Ht),$.use(Lt),$.use(Kt),$.use(zt),$.route(`/`,lt),$.route(`/api`,Ct),$.notFound(Et),$.onError(Tt);var Xt=$;export{Xt as default};