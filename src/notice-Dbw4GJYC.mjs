import"./esm-shims-BKVRry6h.mjs";import"./config-uQhBoCds.mjs";import"./logger-DQf7gybc.mjs";import"./ofetch-7N8fmlQ6.mjs";import"./helpers-C6Jountz.mjs";import{t as e}from"./cache-BXZZTZVV.mjs";import{t}from"./got-DcbI0XpN.mjs";import*as n from"node:url";import r from"node:querystring";const i=`http://jw.scut.edu.cn`,a=i+`/dist/`;i+``,i+``,i+``;const o=e=>`${i}/zhinan/cms/article/view.do?type=posts&id=${e}`,s=e=>`${i}/dist/#/detail/index?id=${e}&type=notice`,c={all:{title:`全部`,tag:`0`},course:{title:`选课`,tag:`1`},exam:{title:`考试`,tag:`2`},practice:{title:`实践`,tag:`3`},communication:{title:`交流`,tag:`4`},teacher:{title:`教师`,tag:`5`},info:{title:`信息`,tag:`6`}},l=e=>{let t=e.getTimezoneOffset()/60;return new Date(e.getTime()-3600*1e3*(8+t))},u=e=>{let t=new Date(e);return t.setHours(8),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),l(t)},d=e=>!!e.link,f=e=>e.replaceAll(`src="/`,`src="${n.resolve(i,`.`)}`).replaceAll(`href="/`,`href="${n.resolve(i,`.`)}`),p=e=>{if(!e.success)throw Error(`article api error`)},m=e=>`<p>链接：<a href="${o(e)}">电脑版</a>&nbsp;|&nbsp;<a href="${s(e)}">手机版</a></p>`,h=e=>f(e.content)+m(e.id),g={path:`/jwc/notice/:category?`,categories:[`university`],example:`/scut/jwc/notice/all`,parameters:{category:"通知分类，默认为 `all`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`教务处通知公告`,maintainers:[`imkero`],handler:_,description:`| 全部 | 选课   | 考试 | 实践     | 交流          | 教师    | 信息 |
| ---- | ------ | ---- | -------- | ------------- | ------- | ---- |
| all  | course | exam | practice | communication | teacher | info |`};async function _(n){let i=c[n.req.param(`category`)||`all`],s=await t({method:`post`,url:`http://jw.scut.edu.cn/zhinan/jw/api/v2/findInformNotice.do?${r.stringify({pageNo:1,pageSize:20,tag:i.tag})}`,headers:{Referer:a}});p(s.data);let l=s.data.data.list,f=await Promise.all(l.map(async n=>{let i=o(n.id),s=await e.get(i);if(s)return JSON.parse(s);let c=await t({method:`post`,url:`http://jw.scut.edu.cn/zhinan/jw/api/v2/getArticleInfo.do?${r.stringify({id:n.id,categoryType:``})}`,headers:{Referer:a}});p(c.data);let l=c.data.data;l.id=n.id;let f=null;d(l)||(f=h(l));let m={title:l.name,link:i,description:f,pubDate:u(l.createDate).toUTCString()};return e.set(i,JSON.stringify(m)),m}));return{title:`华南理工大学教务处通知公告 - `+i.title,link:`http://jw.scut.edu.cn/zhinan/cms/toPosts.do`,item:f}}export{g as route};