import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-1ATZGjxb.js";import"./logger-B19BYg4C.js";import"./ofetch-B4O0sZDE.js";import"./helpers-LVq640iW.js";import{cache_default as n}from"./cache-CjzVN0X7.js";import{art as r}from"./render-DE4LRFBD.js";import{got_default as i}from"./got-CW2W8CRN.js";import{ViewType as a}from"./types-Bi82qguM.js";import o from"node:path";import{load as s}from"cheerio";t();const c={"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`},l={path:`/:userid`,categories:[`social-media`],view:a.Audios,example:`/changba/skp6hhF59n48R-UpqO3izw`,parameters:{userid:`用户ID, 可在对应分享页面的 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`changba.com/s/:userid`]}],name:`用户`,maintainers:[`kt286`,`xizeyoupan`,`pseudoyu`],handler:u};async function u(t){let a=t.req.param(`userid`),l=`https://changba.com/wap/index.php?s=${a}`,u=await i({method:`get`,url:l,headers:c}),d=u.data,f=s(d),p=f(`.user-work .work-info`).toArray(),m=f(`div.user-main-info > span.txt-info > a.uname`).text(),h=f(`div.user-main-info > .poster > img`).attr(`data-src`),g=await Promise.all(p.map(t=>{let a=s(t),l=a(`a`).attr(`href`);return n.tryGet(l,async()=>{let t=await i({method:`get`,url:l,headers:c}),n=/workid: '\d+'/,s;try{s=t.data.match(n)[0]}catch{return null}if(s=s.split(`'`)[1],!s)return null;let u=`https://upscuw.changba.com/${s}.mp3`,d=r(o.join(e,`templates/work_description-7637ee4a.art`),{desc:a(`div.des`).text(),mp3url:u}),f=a(`div.work-cover`).attr(`style`).replace(`)`,``).split(`url(`)[1];return{title:a(`.work-title`).text(),description:d,link:l,author:m,itunes_item_image:f,enclosure_url:u,enclosure_type:`audio/mpeg`}})}));return g=g.filter(Boolean),{title:m+` - 唱吧`,link:l,description:f(`meta[name="description"]`).attr(`content`)||m+` - 唱吧`,item:g,image:h,itunes_author:m,itunes_category:`唱吧`}}export{l as route};