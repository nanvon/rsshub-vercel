import{n as e,t}from"./esm-shims-BC3isTv8.js";import{t as n}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./proxy-CczVputb.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./timezone-BPfwRbwD.js";import{t as s}from"./invalid-parameter-CLGd_tte.js";import{n as c}from"./puppeteer-e0F06Yyi.js";import l from"node:path";import u from"dayjs";import{createDecipheriv as d}from"node:crypto";e();const f=n.cache.contentExpire,p=async(e,t,n,r,i=`aweme`)=>{let a={url:`https://trendinsight.oceanengine.com/api/open/index/get_multi_keyword_hot_trend`,method:`POST`,data:JSON.stringify({keyword_list:[t],start_date:n,end_date:r,app_name:i})};return(await e.evaluate(e=>{function t(){return new Promise(t=>{let n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.setRequestHeader(`accept`,`application/json, text/plain, */*`),n.setRequestHeader(`content-type`,`application/json;charset=UTF-8`),n.setRequestHeader(`tea-uid`,`7054893410171930123`),n.addEventListener(`readystatechange`,()=>{if(n.readyState===4&&n.status===200)t(n.responseText);else return}),n.send(e.data)})}return Promise.resolve(t()).then(e=>e)},a))[0]},m=e=>{let t=Buffer.from(e,`base64`).toString(`hex`),n=d(`aes-128-cfb`,`anN2bXA2NjYsamlh`,`amlheW91LHFpYW53`),r=n.update(t,`hex`,`utf8`)+n.final(`utf8`);return JSON.parse(r)},h=e=>[`https://tophub.today/search?e=tophub&q=${e}`,`https://www.baidu.com/s?wd=${e}`,`https://www.google.com/search?q=${e}`,`https://m.zhihu.com/search?type=content&q=${e}`,`https://s.weibo.com/weibo/${e}`,`https://www.douyin.com/search/${e}`,`https://so.toutiao.com/search?keyword=${e}`],g=[`今日热榜`,`百度`,`谷歌`,`知乎`,`微博`,`抖音`,`头条`],_=(e,n,r)=>i(l.join(t,`templates/content-1e5ec464.art`),{keyword:e,queryListText:r,queries:n.map(e=>({links:h(encodeURIComponent(e)).map((e,t)=>`<a href="${e}" rel="noopener noreferrer" target="_blank">${g[t]}</a>`),key:e}))}),v={path:`/index/:keyword/:channel?`,name:`Unknown`,maintainers:[`Jkker`],handler:y};async function y(e){let t=u(),n=t.subtract(6,`month`).format(`YYYYMMDD`),i=t.format(`YYYYMMDD`),l=e.req.param(`keyword`);if(!l)throw new s(`Invalid keyword`);if(e.req.param(`channel`)&&![`douyin`,`toutiao`].includes(e.req.param(`channel`)))throw new s("Invalid channel。 Only support `douyin` or `toutiao`");let d=e.req.param(`channel`)===`toutiao`?`toutiao`:`aweme`,h=e.req.param(`channel`)===`toutiao`?`头条`:`抖音`,g=`https://trendinsight.oceanengine.com/arithmetic-index/analysis?keyword=${l}&appName=${d}`,v=await r.tryGet(g,async()=>{let e=await c(),t=await e.newPage();await t.setRequestInterception(!0),t.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),await t.goto(`https://trendinsight.oceanengine.com/arithmetic-index`);let r=await p(t,l,n,i,d);await e.close();let s=JSON.parse(r).data,u=m(s).hot_list[0],f=Number.parseInt(u.average.search_average);return u.search_top_point_list.map(({date:e,query_list:t})=>{let n=Number.parseInt(u.search_hot_list.find(t=>t.datetime===e).index),r=Math.round((n-f)/f*100),i=r>0?`📈`:`📉`,s=t.filter(e=>e!==l),c=s.join(`, `),d=_(l,[l,...s],c);return{title:`${i} ${l} ${r}% | ${c}`,author:`巨量算数 - ${h}算数指数`,description:d,link:g,pubDate:o(a(e),8),guid:`巨量算数 - ${h}算数指数 | ${l} - ${e}`}})},f,!1);return{title:`${l} - ${h}指数波峰`,link:g,description:`巨量算数 - ${h}算数指数 | 关键词: ${l}`,language:`zh-cn`,item:v}}export{v as route};