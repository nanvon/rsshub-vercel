import{n as e,t}from"./esm-shims-D4LgnpSl.mjs";import{t as n}from"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import{t as r}from"./ofetch-CvLG4YCQ.mjs";import{t as i}from"./cache-ZTWfXd2T.mjs";import{t as a}from"./render-CBhnapAf.mjs";import o from"node:path";import{load as s}from"cheerio";e();const c=`https://app.theinitium.com/`,l={path:`/app/:category?`,categories:[`new-media`],example:`/theinitium/app`,parameters:{category:`Category, see below, latest_sc by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`app.theinitium.com/t/latest/:category`],target:`/app/:category`}],handler:m,description:`抓取[The Initium App](https://app.theinitium.com/)的文章列表

::: warning
此路由暂不支持登陆认证
:::

Category 栏目：

| ----- | 简体中文     | 繁體中文      |
| ----- | ----------------- | ---------------- |
| 最新   | latest_sc | latest_tc |
| 日报   | daily_brief_sc | daily_brief_tc |
| 速递   | whats_new_sc | whats_new_tc |
| 专题   | report_sc | report_tc |
| 评论   | opinion_sc | opinion_tc |
| 国际   | international_sc | international_tc |
| 大陆   | mainland_sc | mainland_tc |
| 香港   | hongkong_sc | hongkong_tc |
| 台湾   | taiwan_sc | taiwan_tc |
| 播客   | article_audio_sc | article_audio_tc |`},u=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}};async function d(e){return await r(e,{headers:{"User-Agent":`PugpigBolt v4.1.8 (iPhone, iOS 18.2.1) on phone (model iPhone15,2)`}})}async function f(e){let n=s(await d(e.href));n(`a, area`).each((e,t)=>{u(n,t,`href`,c)}),n(`img, video, audio, source, iframe, embed, track`).each((e,t)=>{u(n,t,`src`,c),n(t).removeAttr(`srcset`)}),n(`video[poster]`).each((e,t)=>{u(n,t,`poster`,c)});let r=n(`.pp-article__body`);return r.find(`.block-related-articles`).remove(),r.find(`.copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),r.find(`figure.wp-block-pullquote`).children().unwrap(),r.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),r.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),r.find(`p.has-small-font-size`).wrapInner(`<small></small>`),a(o.join(t,`templates/description-4a91cdc4.art`),{standfirst:n(`.pp-header-group__standfirst`).html(),coverImage:n(`.pp-media__image`).attr(`src`),coverCaption:n(`.pp-media__caption`).html(),article:r.html()})}async function p(e){let n=s(await r(e.href)),i=n(`.ghost-content`);return i.find(`.kg-card, .gh-post-upgrade-cta`).remove(),a(o.join(t,`templates/description-4a91cdc4.art`),{standfirst:n(`p.caption1`).html(),coverImage:n(`.post-hero .object-cover`).attr(`src`)?.replace(`/size/w30`,``),coverCaption:n(`.post-hero figcaption`).html(),article:i.html()})}async function m(e){let t=e.req.param(`category`)??`latest_sc`,r=(await i.tryGet(new URL(`timelines.json`,c).href,async()=>await d(new URL(`timelines.json`,c).href),n.cache.routeExpire,!1)).timelines.find(e=>e.id===t),a=(await d(new URL(r.feed,c).href)).stories.filter(e=>e.type===`article`),o=await Promise.all(a.map(e=>i.tryGet(e.shareurl,async()=>{let t=new URL(e.shareurl);e.link=t.href,e.description=e.summary,e.pubDate=e.published,e.category=[],e.section&&(e.category=[...e.category,e.section]),e.taxonomy&&(e.taxonomy.collection_tag&&(e.category=[...e.category,...e.taxonomy.collection_tag]),e.taxonomy.sections&&(e.category=[...e.category,...e.taxonomy.sections])),e.category=[...new Set(e.category)];try{switch(t.hostname){case`app.theinitium.com`:e.description=await f(t)??e.description;break;case`theinitium.com`:e.description=await p(t)??e.description;break;default:break}}catch(e){e?.response?.status}return e}))),s=`zh-hans`,l=`端传媒`;return r.timeline_sets[0]===`chinese-traditional`&&(s=`zh-hant`,l=`端傳媒`),{title:`${l} - ${r.title}`,link:`https://app.theinitium.com/t/latest/${t}/`,language:s,item:o}}export{l as route};