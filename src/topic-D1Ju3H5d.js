import"./esm-shims-BmHUa0Yk.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-DCfHHxuQ.js";import{cache_default as t}from"./cache-Dfid4xgQ.js";import"./render-CSnicFA3.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{X_UA as r,appDetail as i,getRootUrl as a,imagePost as o,topicPost as s,videoPost as c}from"./utils-DJW_nkMU.js";const l={feed:{zh_CN:`最新`,zh_TW:`最新`},official:{zh_CN:`官方`,zh_TW:`官方`},elite:{zh_CN:`精华`,zh_TW:`精華`},video:{zh_CN:`影片`,zh_TW:`影片`}},u={path:`/topic/:id/:type?/:sort?/:lang?`,categories:[`game`],example:`/taptap/topic/142793/official`,parameters:{id:`游戏 ID，游戏主页 URL 中获取`,type:"论坛版块，默认显示所有帖子，论坛版块 URL 中 `type` 参数，见下表，默认为 `feed`",sort:"排序，见下表，默认为 `created`",lang:"语言，`zh-CN`或`zh-TW`，默认为`zh-CN`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`taptap.cn/app/:id/topic`,`taptap.cn/app/:id`],target:`/topic/:id`}],name:`游戏论坛`,maintainers:[`hoilc`,`TonyRL`],handler:d,description:`| 全部 | 精华  | 官方     | 影片  |
| ---- | ----- | -------- | ----- |
| feed | elite | official | video |

| 发布时间 | 回复时间  | 默认排序 |
| -------- | --------- | ------- |
| created  | commented | default |`};async function d(u){let d=u.req.param(`lang`)??`zh_CN`,f=u.req.param(`id`),p=await i(f,d),m=u.req.param(`type`)??`feed`,h=u.req.param(`sort`)??`created`,g=p.group.id,_=p.app.icon.original_url||p.app.icon.url,v=p.app.title,y=`${a(!1)}/webapiv2/feed/v7/by-group?group_id=${g}&type=${m}&sort=${h}&${r(d)}`,b=await e(y),x=b.data.list,S=await Promise.all(x.map(({moment:e})=>{let r=e.sharing.url;return t.tryGet(r,async()=>{let t=e.author.user.name,i=e.topic.id_str,a=e.topic.title||e.topic.summary.split(` `)[0],l=e.topic.summary||``;return e.topic.pin_video?(l+=c(e.topic.pin_video),e.topic.footer_images?.images&&(l+=o(e.topic.footer_images.images))):l=await s(f,i,d),{title:a,description:l,author:t,link:r,pubDate:n(e.created_time,`X`)}})})),C={title:`${v} - ${l[m][d]} - TapTap 论坛`,link:`${a(!1)}/app/${f}/topic?type=${m}&sort=${h}`,image:_,item:S.filter(e=>e!==``)};return u.set(`json`,{...C,appId:f,groupId:g,topicsList:b}),C}export{u as route};