import"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as e}from"./ofetch-CRUPiVpr.js";import{t}from"./cache-CpEhLexq.js";import{t as n}from"./parse-date-CHEO0z5G.js";import{t as r}from"./not-found-BWgqqdKp.js";import{t as i}from"./types-Bn7An2Wc.js";import a from"dayjs";import{load as o}from"cheerio";import{JSDOM as s}from"jsdom";import{JSONPath as c}from"jsonpath-plus";const l=e=>`https://www.threads.com/@${e}`,u=e=>`https://www.threads.com/t/${e}`,d=`Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1`,f=async t=>{let n=o(await e(l(t),{headers:{"User-Agent":d,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}}))(`script:contains("LSD"):first`).text().match(/"LSD",\[],{"token":"([\w@-]+)"},/)?.[1];if(!n)throw new r(`LSD token not found`);return{lsd:n}},p=n=>t.tryGet(`threads:userId:${n}`,async()=>{let t=new s(await e(l(n),{headers:{"User-Agent":d,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}}));for(let e of t.window.document.querySelectorAll(`script[data-sjs]`))try{let t=c({path:`$..user_id`,json:JSON.parse(e.textContent||``)});if(t?.[0])return t[0]}catch{}throw new r(`User ID not found`)}).then(e=>{if(e){if(typeof e==`string`)return e;if(typeof e==`number`)return e.toString()}throw TypeError(`Invalid user ID type`)}),m=e=>e.image_versions2||e.carousel_media||e.video_versions,h=e=>{let t=``;if(e.carousel_media)for(let n of e.carousel_media){let e=n.image_versions2?.candidates[0],r=n.video_versions?.[0];t+=r?`<video controls autoplay loop poster="${e.url}"><source src="${r.url}"/></video>`:`<img src="${e.url}"/>`}else{let n=e.image_versions2?.candidates?.[0],r=e.video_versions?.[0];n&&(t+=r?`<video controls autoplay loop poster="${n.url}"><source src="${r.url}"/></video>`:`<img src="${n.url}"/>`)}return t},g=(e,t)=>{let n=``,r=``,i=e.post.text_post_app_info?.share_info?.quoted_post,o=e.post.text_post_app_info?.share_info?.reposted_post,s=e.post.text_post_app_info?.reply_to_author,c=i??o;return t.showAuthorInTitle&&(n+=`@${e.post.user?.username}: `),t.showAuthorInDesc&&(r+=`<p>`,t.showAuthorAvatarInDesc&&(r+=`<img src="${e.post.user?.profile_pic_url}" width="48px" height="48px"> `),r+=`<strong>@${e.post.user?.username}</strong>`,c?r+=t.showEmojiForQuotesAndReply?` üîÅ`:` quoted`:s&&(r+=t.showEmojiForQuotesAndReply?` ‚Ü©Ô∏è`:` replied`),r+=`:</p>`),e.post.caption?.text&&(n+=e.post.caption?.text,r+=`<p>${e.post.caption?.text}</p>`),m(e.post)&&(r+=`<p>${h(e.post)}</p>`),c&&(t.showQuotedInTitle&&(n+=t.showEmojiForQuotesAndReply?` üîÅ `:` QT: `,n+=`@${c.user?.username}: `,n+=`"${c.caption?.text}"`),r+=`<blockquote>`,r+=`<p>${c.caption?.text}</p>`,m(c)&&(r+=`<p>${h(c)}</p>`),r+=`‚Äî `,t.showQuotedAuthorAvatarInDesc&&(r+=`<img src="${c.user?.profile_pic_url}" width="24px" height="24px"> `),r+=`@${c.user?.username} ‚Äî `,r+=`<a href="${u(c.code)}">${a(c.taken_at,`X`).toString()}</a>`,r+=`</blockquote>`),{title:n,description:r}},_={path:`/:user/:routeParams?`,categories:[`social-media`],view:i.SocialMedia,example:`/threads/zuck`,parameters:{user:`Username`,routeParams:{description:'Extra parameters, see the table below\nSpecify options (in the format of query string) in parameter `routeParams` to control some extra features for threads\n\n| Key                            | Description                                                                                                                  | Accepts                | Defaults to |\n| ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------- | ---------------------- | ----------- |\n| `showAuthorInTitle`            | Show author name in title                                                                                                    | `0`/`1`/`true`/`false` | `true`      |\n| `showAuthorInDesc`             | Show author name in description (RSS body)                                                                                   | `0`/`1`/`true`/`false` | `true`      |\n| `showQuotedAuthorAvatarInDesc` | Show avatar of quoted author in description (RSS body) (Not recommended if your RSS reader extracts images from description) | `0`/`1`/`true`/`false` | `false`     |\n| `showAuthorAvatarInDesc`       | Show avatar of author in description (RSS body) (Not recommended if your RSS reader extracts images from description)        | `0`/`1`/`true`/`false` | `falseP`    |\n| `showEmojiForQuotesAndReply`   | Use "üîÅ" instead of "QT", "‚Ü©Ô∏è" instead of "Re"                                                                               | `0`/`1`/`true`/`false` | `true`      |\n| `showQuotedInTitle`            | Show quoted tweet in title                                                                                                   | `0`/`1`/`true`/`false` | `true`      |\n| `replies`                      | Show replies                                                                                                                 | `0`/`1`/`true`/`false` | `true`      |'}},name:`User timeline`,maintainers:[`ninboy`,`pseudoyu`],handler:v};async function v(t){let{user:r,routeParams:i}=t.req.param(),{lsd:a}=await f(r),o=await p(r),d=new URLSearchParams(i),m={params:i,lsd:a},h={showAuthorInTitle:d.get(`showAuthorInTitle`)??!0,showAuthorInDesc:d.get(`showAuthorInDesc`)??!0,showAuthorAvatarInDesc:d.get(`showAuthorAvatarInDesc`)??!1,showQuotedInTitle:d.get(`showQuotedInTitle`)??!0,showQuotedAuthorAvatarInDesc:d.get(`showQuotedAuthorAvatarInDesc`)??!1,showEmojiForQuotesAndReply:d.get(`showEmojiForQuotesAndReply`)??!0,replies:d.get(`replies`)??!1},_=new s(await e(l(r),{headers:{"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1`,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}})),v=null;for(let e of _.window.document.querySelectorAll(`script[data-sjs]`))try{let t=c({path:`$..thread_items[0]`,json:JSON.parse(e.textContent||``)});if(t?.length>0){v=t;break}}catch{}if(!v)throw Error(`Failed to fetch thread data`);m.profileId=o,m.response={response:v};let y=v[0]?.post?.user||{username:r,profile_pic_url:``},b=v.filter(e=>r===e.post.user?.username).map(e=>({author:r,title:g(e,h).title,description:g(e,h).description,pubDate:n(e.post.taken_at,`X`),link:u(e.post.code)}));return m.items=b,t.set(`json`,m),{title:`${r} (@${r}) on Threads`,link:l(r),image:y?.profile_pic_url,item:b}}export{_ as route};