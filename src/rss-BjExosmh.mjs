import{n as e,t}from"./esm-shims-DhF_MXa4.mjs";import"./config-PItPnVIx.mjs";import"./logger-BoKmWr7Z.mjs";import"./ofetch-DVhBwO41.mjs";import"./helpers-vRt84cId.mjs";import{t as n}from"./cache-KwJARS5Z.mjs";import{t as r}from"./render-ZYpwNl2L.mjs";import{t as i}from"./parse-date-9Tu6hSFW.mjs";import{t as a}from"./got-D_XeVuz-.mjs";import{t as o}from"./invalid-parameter-BazIyKVP.mjs";import{t as s}from"./rss-parser-D9yoVJTX.mjs";import c from"node:path";import{load as l}from"cheerio";e();const u=new Set([`tw`,`hk`]),d={path:`/:region?`,categories:[`new-media`],example:`/eprice/tw`,parameters:{region:`地区，预设为 tw`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新消息`,maintainers:[`TonyRL`],handler:f,description:`地区：

| hk   | tw   |
| ---- | ---- |
| 香港 | 台湾 |`};async function f(e){let d=e.req.param(`region`)??`tw`;if(!u.has(d))throw new o(`Invalid region`);let f=await s.parseURL(`https://www.eprice.com.${d}/news/rss.xml`);for(let e of f.items)e.link=e.link.replace(/^http:\/\//i,`https://`);let p=await Promise.all(f.items.map(e=>n.tryGet(e.link,async()=>{let n=l((await a(e.link,{headers:{Referer:`https://www.eprice.com.${d}`}})).data);return n(`noscript`).remove(),n(`div[id^=dablewidget]`).remove(),n(`div[class^=parallax-ads]`).remove(),n(`.adsbygoogle, .join-eprice-fb, .teads`).remove(),n(`div.ad-336x280-g, div.ad-728x90-g`).remove(),n(`div.clear, div.news-vote, div.signature`).remove(),n(`ul.inner, ul.navigator, ul.infobar`).remove(),n(`iframe[src^="https://www.facebook.com/plugins/like.php"]`).remove(),e.category=e.categories,n(`a`).each((e,i)=>{i=n(i),i.attr(`href`)&&i.attr(`href`).endsWith(`.jpg`)&&(i.after(r(c.join(t,`templates/image-7c03cac4.art`),{alt:i.attr(`title`),src:i.attr(`href`)})),i.remove())}),n(`img`).each((e,t)=>{t=n(t),t.attr(`data-original`)&&t.attr(`src`,t.attr(`data-original`))}),delete e.categories,delete e.content,delete e.contentSnippet,delete e.creator,delete e.enclosure,delete e.isoDate,e.description=n(`div.user-comment-block`).html()||n(`div.content`).html()||n(`li.inner`).html()||n(`div.section-content`).html()||n(`.article__content`).html(),e.pubDate=i(e.pubDate),e}))),m={title:f.title,link:f.link,description:f.description,item:p,image:f.image.url,language:f.language};return e.set(`json`,m),m}export{d as route};