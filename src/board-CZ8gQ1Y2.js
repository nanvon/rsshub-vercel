import"./esm-shims-rNwigI-Q.js";import{config as e}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as t}from"./ofetch-CeMUzp5K.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import"./parse-date-DHsdom8D.js";import{generateNonce as r,getPost as i,phoneBaseUrl as a,sign as o,webBaseUrl as s}from"./utils-Dxs4Seaj.js";const c={path:`/bbs/board/:boardId`,categories:[`bbs`],example:`/dxy/bbs/board/46`,parameters:{specialId:`板块 ID，可在对应板块页 URL 中找到`},name:`板块`,maintainers:[`TonyRL`],radar:[{source:[`www.dxy.cn/bbs/newweb/pc/category/:boardIdId`],target:`/bbs/board/:boardIdId`},{source:[`3g.dxy.cn/bbs/board/:boardIdId`],target:`/bbs/board/:boardIdId`}],handler:l};async function l(c){let{boardId:l}=c.req.param(),{limit:u=`20`}=c.req.query(),d=await n.tryGet(`dxy:board:detail:${l}`,async()=>{let e={boardId:l,timestamp:Date.now(),noncestr:r(8,`number`)},n=await t(`${a}/bbsapi/bbs/board/detail`,{query:{...e,sign:o(e)}});if(n.code!==`success`)throw Error(n.message);return n.data}),f=(await n.tryGet(`dxy:board:list:${l}`,async()=>{let e={boardId:l,postType:`0`,orderType:`1`,pageNum:`1`,pageSize:u,timestamp:Date.now(),noncestr:r(8,`number`)},n=await t(`${a}/bbsapi/bbs/board/post/list`,{query:{...e,sign:o(e)}});if(n.code!==`success`)throw Error(n.message);return n.data},e.cache.routeExpire,!1)).result.map(e=>({title:e.subject,author:e.postUser.nickname,category:[d.title],link:`${s}/bbs/newweb/pc/post/${e.postId}`,postId:e.postId})),p=await Promise.all(f.map(e=>i(e,n.tryGet)));return{title:d.title,description:`${d.postCount} 內容 ${d.followCount} 关注`,link:`${s}/bbs/newweb/pc/category/${l}`,image:d.boardAvatar,item:p}}export{c as route};