import{n as e,t}from"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-VsB2Peor.js";import"./helpers-Cqaav28H.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./got-BVCqvF6m.js";import i from"node:path";import a from"dayjs";import o from"dayjs/plugin/customParseFormat.js";import s from"node:crypto";import{load as c}from"cheerio";import l from"city-timezones";import u from"dayjs/plugin/utc.js";import d from"dayjs/plugin/timezone.js";e(),a.extend(o),a.extend(u),a.extend(d);var f={expandOdd:e=>{e.prototype.odd=function(){let t=[];return this.each((e,n)=>{e%2==1&&t.push(n)}),e(t)}},expandEven:e=>{e.prototype.even=function(){let t=[];return this.each((e,n)=>{e%2==0&&t.push(n)}),e(t)}},expandReverse:e=>{e.prototype.reverse=function(){let t=[];return this.each((e,n)=>{t.push(n)}),t.reverse(),e(t)}},generateGuid:e=>{let t=s.createHash(`sha512`);return t.update(e),t.digest(`hex`).toUpperCase()},parseDatetime:(e,t,n,r,i)=>{let o=`YYYY/MM/DD`,s=`YYYY/MM/DD HH:mm`,c=`MM/DD/YYYY`,u=`MM/DD/YYYY HH:mm`,d;switch(i){case`ja`:d=a(e,o,!0).isValid()?o:a(e,s,!0).isValid()?s:void 0;break;case`en`:d=a(e,c,!0).isValid()?c:a(e,u,!0).isValid()?u:void 0;break}if(t){let e=[[`郵便局`],[`都`,`道`,`府`,`県`]];if(e[0].some(e=>t.includes(e))||e[1].some(e=>n.includes(e)))r=`Asia/Tokyo`;else{let e=t.replace(` EMS`,``).replace(` INT`,``);try{try{r=l.lookupViaCity(e)[0].timezone}catch{r=l.lookupViaCity(n)[0].timezone}}catch{}}}return d?[a.tz(e,d,r).valueOf(),r]:[new Date(e).getTime(),r]}};let p=`日本郵便`;async function m(e){let a=e.req.param(`reqCode`),o=`reqCodeNo1=`+a,s=`ja`;e.req.param(`locale`)===`en`&&(s=`en`,p=`Japanpost`);let l=`&locale=`+s,u=`https://trackings.post.japanpost.jp/services/srv/search/direct?`+o+l,d=c((await r({method:`get`,url:u})).data);f.expandEven(d),f.expandOdd(d);let m=d(`.tableType01`).eq(1).find(`tr`).slice(2),h=d(`.tableType03`).eq(0).find(`tr`).slice(1),g;if(h.length&&(g=h.toArray().map(e=>{let t=d(e).find(`td`);return{officeType:t.eq(0).text().trim(),officeName:t.eq(1).html().trim(),officeTel:t.eq(2).html().trim()}})),!m.length){let e=d(`.tableType01`).eq(0).find(`tr`).eq(2).find(`td`).eq(1).text().trim();throw Error(e)}let _=m.even(),v=m.odd(),y=d(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(1).text().trim(),b=d(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(2).text().trim(),x=s===`ja`?`付加サービス：`:`Additional services: `,S,C;return{title:`${p} ${a} ${y}`,link:u,description:`${p} ${a} ${y}`,language:s,icon:`https://www.post.japanpost.jp/favicon.ico`,logo:`https://www.post.japanpost.jp/favicon.ico`,item:_.toArray().map((e,r)=>{let o=d(e).find(`td`),c=o.eq(1).text().trim(),l=o.eq(4).text().trim(),p=o.eq(3).text().trim(),m=v.eq(r).find(`td`).eq(0).text().trim(),h=`${c} ${p} ${l}`,_=o.eq(2).text().trim(),y=n(i.join(t,`templates/track_item_desc-8ae6c583.art`),{packageStatus:c,packageTrackRecord:_,packageOfficeZipCode:m,packageOffice:p,packageRegion:l,index:r,officeItemList:g,serviceText:x,packageService:b}),w=o.eq(0).text().trim(),T=f.generateGuid(a+h+y+w),E;return[E,C]=f.parseDatetime(w,p,l,C,s),S&&E<=S&&(E=S+1e3),S=E,{title:h,description:y,pubDate:new Date(E),link:u,guid:T.slice(0,32)}})}}const h={name:`Track & Trace Service`,path:`/track/:reqCode/:locale?`,example:`/japanpost/track/EJ123456789JP/en`,url:`trackings.post.japanpost.jp/services/srv/search/`,handler:m,categories:[`other`],maintainers:[`tuzi3040`],parameters:{reqCode:`Package Number`,locale:"Language, default to japanese `ja`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},description:`| Japanese | English |
| -------- | ------- |
| ja       | en      |`,zh:{name:`邮件追踪查询`,description:`| 日语 | 英语 |
| ---- | ---- |
| ja   | en   |`},ja:{name:`郵便追跡サービス`,description:`| 日本語 | 英語 |
| ---- | ---- |
| ja   | en   |`}};export{h as route};