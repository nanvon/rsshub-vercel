import{__dirname as e,init_esm_shims as t}from"./esm-shims-DE2PJqdr.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as n}from"./ofetch-CJF2SF6b.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:category{.+}?`,example:`/wa`,radar:[{source:[`abc.net.au/:category*`],target:`/:category`}],parameters:{category:"Category, can be found in the URL, can also be filled in with the `documentId` in the source code of the page, `news/justin` as **Just In** by default"},name:`Channel & Topic`,categories:[`traditional-media`],description:"\n::: tip\n  All Topics in [Topic Library](https://abc.net.au/news/topics) are supported, you can fill in the field after `topic` in its URL, or fill in the `documentId`.\n\n  For example, the URL for [Computer Science](https://www.abc.net.au/news/topic/computer-science) is `https://www.abc.net.au/news/topic/computer-science`, the `category` is `news/topic/computer-science`, and the `documentId` of the Topic is `2302`, so the route is [/abc/news/topic/computer-science](https://rsshub.app/abc/news/topic/computer-science) and [/abc/2302](https://rsshub.app/abc/2302).\n\n  The supported channels are all listed in the table below. For other channels, please find the `documentId` in the source code of the channel page and fill it in as above.\n:::",maintainers:[`nczitzk`,`pseudoyu`],handler:l};async function l(t){let{category:c=`news/justin`}=t.req.param(),l=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):30,u=`https://www.abc.net.au`,d=new URL(`news-web/api/loader/channelrefetch`,u).href,f=``,p;if(Number.isNaN(c))f=new URL(c,u).href;else{p=c;let e=new URL(`news/feed/${p}/rss.xml`,u).href;f=(await n(e)).match(/<link>([\w-./:?]+)<\/link>/)[1]}let m=await n(f),h=s(m);p=p??h(`div[data-uri^="coremedia://collection/"]`).first().prop(`data-uri`).split(/\//).pop();let g=(await n(d,{query:{name:`PaginationArticles`,documentId:p,size:l}})).collection.slice(0,l).map(t=>{let n={title:t.title.children??t.title,link:t.link.startsWith(`https://`)?t.link:new URL(t.link,u).href,description:i(o.join(e,`templates/description-bd10ae5e.art`),{image:t.image?{src:t.image.imgSrc.split(/\?/)[0],alt:t.image.alt}:void 0}),author:t.newsBylineProps?.authors?.map(e=>e.name).join(`/`)??void 0,guid:`abc-${t.id}`,pubDate:a(t.dates.firstPublished),updated:t.dates.lastUpdated?a(t.dates.lastUpdated):void 0};return t.mediaIndicator&&(n.enclosure_type=`audio/mpeg`,n.itunes_item_image=t.image?.imgSrc.split(/\?/)[0]??void 0,n.itunes_duration=t.mediaIndicator.duration),n});g=await Promise.all(g.map(t=>r.tryGet(t.link,async()=>{try{let r=await n(t.link),c=s(r);c(`aside, header, [data-print="inline-media"], [data-component="EmbedBlock"]`).remove(),c(`#body *, div[data-component="FeatureMedia"]`).children().each(function(){let t=c(this);t.prop(`tagName`).toLowerCase()===`figure`?t.replaceWith(i(o.join(e,`templates/description-bd10ae5e.art`),{image:{src:t.find(`img`).prop(`src`).split(/\?/)[0],alt:t.find(`figcaption`).text().trim()}})):t.removeAttr(`id class role data-component data-uri`)}),t.title=c(`meta[property="og:title"]`).prop(`content`),t.description=``;let l=String.raw`"(?:MIME|content)?Type":"([\w]+/[\w]+)".*?"(?:fileS|s)?ize":(\d+),.*?"url":"([\w-.:/?]+)"`,u=r.match(new RegExp(l,`g`));if(u){let n=u.map(e=>e.match(new RegExp(l))).toSorted((e,t)=>Number.parseInt(e[2],10)-Number.parseInt(t[2],10)).pop();t.enclosure_url=n[3],t.enclosure_length=n[2],t.enclosure_type=n[1],t.description=i(o.join(e,`templates/description-bd10ae5e.art`),{enclosure:{src:t.enclosure_url,type:t.enclosure_type}})}t.description=i(o.join(e,`templates/description-bd10ae5e.art`),{description:(c(`div[data-component="FeatureMedia"]`).html()||``)+(c(`#body div[data-component="LayoutContainer"] div`).first().html()||``)})+t.description,t.category=c(`meta[property="article:tag"]`).toArray().flatMap(e=>c(e).prop(`content`).split(/ï¼Œ/).map(e=>e.trim())),t.guid=`abc-${c(`meta[name="ContentId"]`).prop(`content`)}`,t.pubDate=a(c(`meta[property="article:published_time"]`).prop(`content`)),t.updated=a(c(`meta[property="article:modified_time"]`).prop(`content`))}catch{}return t})));let _=new URL(h(`link[rel="apple-touch-icon"]`).prop(`href`)||``,u).href;return{item:g,title:h(`title`).first().text(),link:f,description:h(`meta[property="og:description"]`).prop(`content`),language:h(`html`).prop(`lang`),image:h(`meta[property="og:image"]`).prop(`content`).split(`?`)[0],icon:_,logo:_,subtitle:h(`meta[property="og:title"]`).prop(`content`),author:h(`meta[name="generator"]`).prop(`content`),allowEmpty:!0}}export{c as route};