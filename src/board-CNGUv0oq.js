import"./esm-shims-CaZMYoY8.js";import{t as e}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t}from"./ofetch-VsB2Peor.js";import{t as n}from"./cache-CpEhLexq.js";import"./parse-date-CHEO0z5G.js";import{a as r,i,n as a,r as o,t as s}from"./utils-DR4oyE4c.js";const c={path:`/bbs/board/:boardId`,categories:[`bbs`],example:`/dxy/bbs/board/46`,parameters:{specialId:`板块 ID，可在对应板块页 URL 中找到`},name:`板块`,maintainers:[`TonyRL`],radar:[{source:[`www.dxy.cn/bbs/newweb/pc/category/:boardIdId`],target:`/bbs/board/:boardIdId`},{source:[`3g.dxy.cn/bbs/board/:boardIdId`],target:`/bbs/board/:boardIdId`}],handler:l};async function l(c){let{boardId:l}=c.req.param(),{limit:u=`20`}=c.req.query(),d=await n.tryGet(`dxy:board:detail:${l}`,async()=>{let e={boardId:l,timestamp:Date.now(),noncestr:s(8,`number`)},n=await t(`${o}/bbsapi/bbs/board/detail`,{query:{...e,sign:i(e)}});if(n.code!==`success`)throw Error(n.message);return n.data}),f=(await n.tryGet(`dxy:board:list:${l}`,async()=>{let e={boardId:l,postType:`0`,orderType:`1`,pageNum:`1`,pageSize:u,timestamp:Date.now(),noncestr:s(8,`number`)},n=await t(`${o}/bbsapi/bbs/board/post/list`,{query:{...e,sign:i(e)}});if(n.code!==`success`)throw Error(n.message);return n.data},e.cache.routeExpire,!1)).result.map(e=>({title:e.subject,author:e.postUser.nickname,category:[d.title],link:`${r}/bbs/newweb/pc/post/${e.postId}`,postId:e.postId})),p=await Promise.all(f.map(e=>a(e,n.tryGet)));return{title:d.title,description:`${d.postCount} 內容 ${d.followCount} 关注`,link:`${r}/bbs/newweb/pc/category/${l}`,image:d.boardAvatar,item:p}}export{c as route};