import"./esm-shims-2LyWUseo.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-BLnIkXRv.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{md5 as n}from"./md5-15Cn4YyR.js";import r from"node:crypto";import i from"sanitize-html";import a from"crypto-js";const o=a.enc.Utf8.parse(`eRtYuIoPaSdFgHqW`),s=a.enc.Utf8.parse(`Nmc09JkLzX8765Vb`),c=`https://pubscholar.cn`,l=e=>r.createHash(`sha1`).update(e).digest(`hex`),u=()=>r.randomUUID(),d=e=>{if(!e)return null;let t=``;for(;t.length<e;){let e=Math.random().toString(36).slice(2).toUpperCase();t+=e}return t.slice(0,e)},f=()=>{let e=d(6),t=Date.now().toString(),n=l([`6m6pingbinwaktg227gngifoocrfbo95`,t,e].toSorted().join(``));return{nonce:e,timestamp:t,signature:n}},p=e=>a.AES.encrypt(a.enc.Utf8.parse(e),o,{iv:s,mode:a.mode.CBC,padding:a.pad.Pkcs7}).ciphertext.toString(),m={path:`/explore/:category?/:keyword?`,name:`Explore`,maintainers:[`TonyRL`],example:`/pubscholar/explore`,parameters:{category:"Category, see the table below, `articles` by default",keyword:`Search Keyword`},handler:h,description:`| Articles / 论文 | Patents / 专利 | Reports / 领域快报 | Information / 动态快讯 | Datasets / 科学数据 | Books / 图书 |
| --------------- | -------------- | ------------------ | ---------------------- | ------------------- | ------------ |
| articles        | patents        | bulletins          | reports                | sciencedata         | books        |`};async function h(r){let{category:a=`articles`,keyword:o}=r.req.param(),s=u(),l=(await e(`${c}/hky/open/resources/api/v1/${a}`,{method:`POST`,headers:{...f(),Cookie:`XSRF-TOKEN=${s}`,"X-XSRF-TOKEN":s},body:{page:1,size:10,order_field:`date`,order_direction:`desc`,user_id:n(Date.now().toString()),lang:`zh`,query:o,strategy:null,orderField:`default`}})).content.map(e=>({title:(e.is_free||e.links.some(e=>e.is_open_access)?`「Open Access」`:``)+i(e.title,{allowedTags:[],allowedAttributes:{}}),description:e.abstracts+`<br>${e.links.map(e=>`<a href="${e.url}">${e.is_open_access?`「Open Access」`:``}${e.name}</a>`).join(`<br>`)}`,author:e.author.join(`; `),pubDate:t(e.date),category:e.keywords.map(e=>i(e,{allowedTags:[],allowedAttributes:{}})),link:`${c}/${a}/${p(e.id)}`}));return{title:`PubScholar 公益学术平台`,link:`${c}/explore`,item:l}}export{m as route};