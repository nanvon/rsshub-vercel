import{n as e,t}from"./esm-shims-mGm6WwCc.js";import{t as n}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./got-CgQXMNWI.js";import s from"node:path";e();const c={path:`/music/djradio/:id/:info?`,categories:[`multimedia`],example:`/163/music/djradio/347317067`,parameters:{id:`节目 id, 可在电台节目页 URL 中找到`,info:`默认在正文尾部显示节目相关信息，任意值为不显示`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},name:`电台节目`,maintainers:[`magic-akari`],handler:u},l=(e,t,i)=>r.tryGet(`163:music:djradio:${e}:${t}:${i}`,async()=>await o.post(`https://music.163.com/api/dj/program/byradio`,{headers:{Referer:`https://music.163.com/`},form:{radioId:e,limit:t,offset:i}}),n.cache.routeExpire,!1);async function u(e){let n=e.req.param(`id`),r=!e.req.param(`info`),o=await l(n,1,0),{radio:c,dj:u}=(o.data.programs||[])[0]||{radio:{},dj:{}},d=o.data.count||0,f=Array.from({length:Math.ceil(d/500)},(e,t)=>t),p=await Promise.all(f.map(async e=>((await l(n,500,e*500)).data.programs||[]).map(e=>{let n=(e.description||``).split(`
`).map(e=>e),o=Math.trunc(e.duration/1e3),c=`${(o/60).toFixed(0).padStart(2,`0`)}:${(o%60).toFixed(0).padStart(2,`0`)}`,l=i(s.join(t,`templates/djradio-content-def0dea8.art`),{pg:e,description:n,itunes_duration:c,info:r});return{title:e.name,link:`https://music.163.com/program/`+e.id,pubDate:a(e.createTime),published:a(e.createTime),author:e.dj.nickname,description:l,content:{html:l},itunes_item_image:e.coverUrl,enclosure_url:`https://music.163.com/song/media/outer/url?id=${e.mainTrackId}.mp3`,enclosure_type:`audio/mpeg`,itunes_duration:o}})));return{title:c.name,link:`https://music.163.com/djradio?id=${n}`,subtitle:c.desc,description:c.desc,author:u.nickname,updated:c.lastProgramCreateTime,icon:c.picUrl,image:c.picUrl,itunes_author:u.nickname,itunes_category:c.category,item:p.flat()}}export{c as route};