import{n as e,t}from"./esm-shims-D4LgnpSl.mjs";import{t as n}from"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import"./ofetch-CvLG4YCQ.mjs";import"./helpers-mo8InLYm.mjs";import{t as r}from"./cache-ZTWfXd2T.mjs";import{t as i}from"./render-CBhnapAf.mjs";import{t as a}from"./parse-date-bKmkZ9gg.mjs";import{t as o}from"./got-AYh7EWi-.mjs";import{t as s}from"./config-not-found-Zb14cUk-.mjs";import c from"node:path";e();const l=`https://zodgame.xyz`,u={path:`/forum/:fid?`,categories:[`bbs`],example:`/zodgame/forum/13`,parameters:{fid:`forum id, can be found in URL`},features:{requireConfig:[{name:`ZODGAME_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},name:`forum`,maintainers:[`FeCCC`],handler:d};async function d(e){let u=e.req.param(`fid`),d=`${l}/api/mobile/index.php?version=4&module=forumdisplay&fid=${u}`,f=n.zodgame.cookie;if(f===void 0)throw new s(`Zodgame RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let p=(await o({method:`get`,url:d,headers:{Cookie:f}})).data.Variables,m=p.forum_threadlist.map(e=>{if(!p.threadtypes.types[e.typeid])return;let t=p.threadtypes.types[e.typeid];return{tid:e.tid,title:`[${t}] ${e.subject}`,author:e.author,link:`${l}/forum.php?mod=viewthread&tid=${e.tid}&extra=page%3D1`,category:t,pubDate:a(e.dbdateline*1e3)}}).filter(e=>e!==void 0),h=await Promise.all(m.map(e=>r.tryGet(e.tid,async()=>{let n=(await o({method:`get`,url:`${l}/api/mobile/index.php?version=4&module=viewthread&tid=${e.tid}`,headers:{Cookie:f}})).data.Variables,r=``;return n.thread.freemessage?(r+=n.thread.freemessage,r+=i(c.join(t,`templates/forum-c3ab5e98.art`),{content:n.postlist[0].message})):r+=n.postlist[0].message,{title:e.title,author:e.author,link:e.link,description:r,category:e.category,pubDate:e.pubDate,guid:e.tid,upvotes:Number.parseInt(n.thread.recommend_add,10),downvotes:Number.parseInt(n.thread.recommend_sub,10),comments:Number.parseInt(n.thread.replies,10)}})));return{title:`${p.forum.name} - ZodGame论坛`,link:`${l}/forum.php?mod=forumdisplay&fid=${u}`,item:h}}export{u as route};