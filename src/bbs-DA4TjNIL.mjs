import"./esm-shims-DhF_MXa4.mjs";import{t as e}from"./config-PItPnVIx.mjs";import"./logger-BoKmWr7Z.mjs";import{t}from"./ofetch-DVhBwO41.mjs";import{t as n}from"./cache-KwJARS5Z.mjs";import{t as r}from"./parse-date-9Tu6hSFW.mjs";import{t as i}from"./timezone-CQaZZkB1.mjs";import{t as a}from"./config-not-found-B5bqcMj-.mjs";import{load as o}from"cheerio";const s={path:`/bbs/:types?`,name:`清水河畔`,maintainers:[`huyyi`],categories:[`university`],url:`bbs.uestc.edu.cn`,example:`/uestc/bbs/newthread`,parameters:{types:"选择内容类型(多选`,`分割），可选值：[newreply,newthread,digest,life,hotlist]。默认为所有。"},features:{requireConfig:[{name:`UESTC_BBS_COOKIE`,optional:!1,description:`河畔的cookie`},{name:`UESTC_BBS_AUTH_KEY`,optional:!1,description:`河畔Header中的authorization字段`}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},description:`
::: tip
仅支持自建，您需要设置以下配置才能正常使用：
-   河畔cookie: \`UESTC_BBS_COOKIE\`
-   Header中的授权字段: \`UESTC_BBS_AUTH_KEY\`
:::
`,radar:[{source:[`bbs.uestc.edu.cn/*`],target:`/bbs/newthread`}],handler:async s=>{let{bbsCookie:c,bbsAuthStr:l}=e.uestc;if(!c||!l)throw new a(`未配置 Cookie 或 Authorization。请检查配置。`);let{types:u=`newreply,newthread,digest,life,hotlist`}=s.req.param(),d=await t(`https://bbs.uestc.edu.cn/star/api/v1/index?top_list=${u}`,{headers:{Cookie:c,Referer:`https://bbs.uestc.edu.cn/new`,authorization:l}}),f=Object.entries(d.data.top_list).flatMap(([e,t])=>t.map(t=>({...t,label:e})));return{title:`清水河畔`,link:`https://bbs.uestc.edu.cn/new`,item:await Promise.all(f.map(e=>n.tryGet(`https://bbs.uestc.edu.cn/forum.php?mod=viewthread&tid=${e.thread_id}`,async()=>(e.description=o(await t(`https://bbs.uestc.edu.cn/forum.php?mod=viewthread&tid=${e.thread_id}`,{headers:{Cookie:c,Referer:`https://bbs.uestc.edu.cn`,authorization:l}}))(`div#postlist`).html(),{title:e.subject,link:`https://bbs.uestc.edu.cn/thread/${e.thread_id}`,author:e.author,category:e.label,img:e.icon,pubDate:i(r(e.dateline),8),description:e.description}))))}}};export{s as route};