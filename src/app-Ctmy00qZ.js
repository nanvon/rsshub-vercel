import{n as e,t}from"./esm-shims-CMsyBHYK.js";import{t as n}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./got-BlqYKpVp.js";import o from"node:path";import{load as s}from"cheerio";e();const c=`https://app.theinitium.com/`,l={path:`/app/:category?`,categories:[`new-media`],example:`/theinitium/app`,parameters:{category:`Category, see below, latest_sc by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`app.theinitium.com/t/latest/:category`],target:`/app/:category`}],handler:m,description:`抓取[The Initium App](https://app.theinitium.com/)的文章列表

::: warning
此路由暂不支持登陆认证
:::

Category 栏目：

| ----- | 简体中文     | 繁體中文      |
| ----- | ----------------- | ---------------- |
| 最新   | latest_sc | latest_tc |
| 日报   | daily_brief_sc | daily_brief_tc |
| 速递   | whats_new_sc | whats_new_tc |
| 专题   | report_sc | report_tc |
| 评论   | opinion_sc | opinion_tc |
| 国际   | international_sc | international_tc |
| 大陆   | mainland_sc | mainland_tc |
| 香港   | hongkong_sc | hongkong_tc |
| 台湾   | taiwan_sc | taiwan_tc |
| 播客   | article_audio_sc | article_audio_tc |`},u=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}};async function d(e){return await a({method:`get`,url:e,headers:{"User-Agent":`PugpigBolt v4.1.8 (iPhone, iOS 18.2.1) on phone (model iPhone15,2)`}})}async function f(e){let n=s((await d(e.href)).data);n(`a, area`).each((e,t)=>{u(n,t,`href`,c)}),n(`img, video, audio, source, iframe, embed, track`).each((e,t)=>{u(n,t,`src`,c),n(t).removeAttr(`srcset`)}),n(`video[poster]`).each((e,t)=>{u(n,t,`poster`,c)});let r=n(`.pp-article__body`);return r.find(`.block-related-articles`).remove(),r.find(`.copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),r.find(`figure.wp-block-pullquote`).children().unwrap(),r.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),r.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),r.find(`p.has-small-font-size`).wrapInner(`<small></small>`),i(o.join(t,`templates/description-4a91cdc4.art`),{standfirst:n(`.pp-header-group__standfirst`).html(),coverImage:n(`.pp-media__image`).attr(`src`),coverCaption:n(`.pp-media__caption`).html(),article:r.html()})}async function p(e){let n=s((await a(e.href)).data),r=n(`.entry-content`);return r.find(`.block-related-articles`).remove(),r.find(`.cta-subscription`).remove(),r.find(`.entry-copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),r.find(`figure.wp-block-pullquote`).children().unwrap(),r.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),r.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),r.find(`p.has-small-font-size`).wrapInner(`<small></small>`),i(o.join(t,`templates/description-4a91cdc4.art`),{standfirst:n(`span.caption1`).html(),coverImage:n(`.wp-post-image`).attr(`src`),coverCaption:n(`.image-caption`).html(),article:r.html()})}async function m(e){let t=e.req.param(`category`)??`latest_sc`,i=(await r.tryGet(new URL(`timelines.json`,c).href,async()=>await d(new URL(`timelines.json`,c).href),n.cache.routeExpire,!1)).data.timelines.find(e=>e.id===t),a=(await d(new URL(i.feed,c).href)).data.stories.filter(e=>e.type===`article`),o=await Promise.all(a.map(e=>r.tryGet(e.shareurl,async()=>{let t=new URL(e.shareurl);switch(e.link=t.href,e.description=e.summary,e.pubDate=e.published,e.category=[],e.section&&(e.category=[...e.category,e.section]),e.taxonomy&&(e.taxonomy.collection_tag&&(e.category=[...e.category,...e.taxonomy.collection_tag]),e.taxonomy.sections&&(e.category=[...e.category,...e.taxonomy.sections])),e.category=[...new Set(e.category)],t.hostname){case`app.theinitium.com`:e.description=await f(t);break;case`theinitium.com`:e.description=await p(t);break;default:break}return e}))),s=`zh-hans`,l=`端传媒`;return i.timeline_sets[0]===`chinese-traditional`&&(s=`zh-hant`,l=`端傳媒`),{title:`${l} - ${i.title}`,link:`https://app.theinitium.com/t/latest/${t}/`,language:s,item:o}}export{l as route};