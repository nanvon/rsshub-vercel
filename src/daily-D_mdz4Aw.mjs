import{n as e,t}from"./esm-shims-L08rKynx.mjs";import"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import"./ofetch-BMqiDsx_.mjs";import"./helpers-mo8InLYm.mjs";import{t as n}from"./cache-ZTWfXd2T.mjs";import{t as r}from"./render-CBhnapAf.mjs";import{t as i}from"./got-2jXbf1Li.mjs";import a from"node:path";import o from"dayjs";import{load as s}from"cheerio";e();const c={path:`/stats/daily/:country`,categories:[`other`],example:`/iknowwhatyoudownload/stats/daily/CN`,url:`iknowwhatyoudownload.com`,name:`Daily Torrents Statistics`,maintainers:[`p3psi-boo`],parameters:{country:`the country of the stats. ISO 3166-1 alpha-2 code.`},handler:l};async function l(e){let{country:c}=e.req.param(),l=`https://iknowwhatyoudownload.com/en/stat/${c}/daily/q?statDate=`,u=Array.from({length:7},(e,t)=>o().subtract(t,`day`)),d=(await Promise.all(u.map(e=>{let o=e.format(`YYYY-MM-DD`),u=`${l}${o}`;return n.tryGet(u,async()=>{let n=await i({method:`get`,url:u});if(!n)return{};let l=s(n.data),d=[];l(`.usePercent`).each((e,t)=>{d.push({percent:l(t).text(),desc:l(t).parent().find(`span`).last().text()})});let f=[],p=n.data.match(/data:\s*\[([\d",\s]+)\]/),m=n.data.match(/labels:\s*\[(.*?)\]/);if(p?.[1]&&m?.[1]){let e=p[1].split(`,`).map(e=>e.trim().replaceAll(`"`,``)),t=m[1].split(`,`).map(e=>e.replaceAll(`"`,``).trim()).filter(e=>e!==``);for(let n in t){let r=t[n],i=e[n],[a,o]=r.split(` `);f.push({key:a,count:i,percent:o})}}let h=l(`.tab-pane`).toArray().map(e=>({title:l(e).attr(`id`)?.toUpperCase(),content:l(e).find(`ul`).toString()})),g=r(a.join(t,`templates/daily-c7388d5f.art`),{numStats:d,tableData:f,topList:h});return{title:`Daily Torrents Statistics in ${c} for ${o}`,link:u,description:g,pubDate:e.toDate()}})}))).filter(e=>Object.keys(e).length>0);return{title:`Daily Torrents Statistics in ${c} - iknownwhatyoudownload`,link:`https://iknowwhatyoudownload.com`,item:d}}export{c as route};