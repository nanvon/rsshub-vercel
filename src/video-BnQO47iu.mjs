import{n as e,t}from"./esm-shims-L08rKynx.mjs";import"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import{t as n}from"./ofetch-BMqiDsx_.mjs";import{t as r}from"./cache-ZTWfXd2T.mjs";import{t as i}from"./render-CBhnapAf.mjs";import{n as a}from"./parse-date-bKmkZ9gg.mjs";import{t as o}from"./timezone-CE0MDOJ-.mjs";import{t as s}from"./types-BD1MU_-b.mjs";import c from"node:path";import{load as l}from"cheerio";e();const u=async e=>{let s=Number.parseInt(e.req.query(`limit`)??`18`,10),u=`https://www.dgtle.com`,d=new URL(`video`,u).href,f=new URL(`video/list/1`,u).href,p=l(await n(d)),m=p(`html`).attr(`lang`)??`zh-CN`,h=await n(f),g=[];g=h.data.list.slice(0,s).map(e=>{let n=e.title,r=e.cover?.split(/\?/)?.[0],a=i(c.join(t,`templates/description-36fefaf3.art`),{images:r?[{src:r,alt:n}]:void 0,intro:e.description}),o=e.url,s=[{name:e.author.username,url:void 0,avatar:e.author.avatar_path?.split(/\?/)?.[0]}],l=`dgtle-${e.id}`;return{title:n,description:a,link:o,author:s,guid:l,id:l,content:{html:a,text:a},image:r,banner:r,language:m,enclosure_length:e.duration}}),g=await Promise.all(g.map(e=>e.link?r.tryGet(e.link,async()=>{let r=l(await n(e.link)),s=r(`h1.video-title`).text(),d=r(`div.video-play video source`).first(),f=d.attr(`src`),p=r(`div.video-play`).attr(`data-url`),h=i(c.join(t,`templates/description-36fefaf3.art`),{videos:f?[{src:f,type:`video/mp4`,poster:p}]:void 0,intro:r(`h3.video-summary`).text()}),g=r(`p.video-time`).text()?.split(/\s/)?.[0],_=r(`.title`).attr(`href`),v=r(`.category`).toArray(),y=[...new Set(v.map(e=>r(e).text()).filter(Boolean))],b=r(`.author`).toArray().map(e=>{let t=r(e);return{name:t.text(),url:t.attr(`href`),avatar:t.find(`img`).attr(`src`)}}),x=r(`.id`).text(),S=g,C={title:s,description:h,pubDate:g?o(a(g),8):e.pubDate,link:_?new URL(_,u).href:e.link,category:y,author:b,doi:r(`meta[name="citation_doi"]`).attr(`content`),guid:x,id:x,content:{html:h,text:h},image:p,banner:p,updated:S?o(a(S),8):e.updated,language:m};if(f){let t=d.attr(`type`)||`video/mp4`;C={...C,enclosure_url:f,enclosure_type:t,enclosure_title:s,enclosure_length:e.enclosure_length,itunes_duration:e.enclosure_length,itunes_item_image:p}}return{...e,...C}}):e));let _=p(`meta[name="keywords"]`).attr(`content`)?.split(/,/)[0]??void 0;return{title:p(`title`).text().trim().split(/\s/)[0],description:p(`meta[name="description"]`).attr(`content`),link:d,item:g,allowEmpty:!0,author:_,language:m,itunes_author:_,itunes_category:`Technology`,id:d}},d={path:`/video`,name:`视频`,url:`www.dgtle.com`,maintainers:[`nczitzk`],handler:u,example:`/dgtle/video`,parameters:void 0,description:void 0,categories:[`new-media`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.dgtle.com/video`],target:`/video`}],view:s.Articles};export{u as handler,d as route};