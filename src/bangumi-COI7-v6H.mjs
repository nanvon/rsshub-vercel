import"./esm-shims-D4LgnpSl.mjs";import"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import"./ofetch-CvLG4YCQ.mjs";import"./helpers-mo8InLYm.mjs";import{t as e}from"./cache-ZTWfXd2T.mjs";import{t}from"./parse-date-bKmkZ9gg.mjs";import{r as n}from"./common-utils-CrvTTrJV.mjs";import{t as r}from"./got-AYh7EWi-.mjs";const i={path:`/*`,categories:[`anime`],radar:[{source:[`bangumi.moe/`]}],name:`Latest`,example:`/bangumi.moe`,maintainers:[`nczitzk`],handler:a,url:`bangumi.moe/`};async function a(i){let a=n(i)===`/`,o=`https://bangumi.moe`,s,c=[];if(a)s=await r({method:`get`,url:`${o}/api/torrent/latest`});else{let t=`${o}/api/tag/search`,a=`${o}/api/torrent/search`,l=n(i).split(`/`).slice(2);c=await Promise.all(l.map(n=>e.tryGet(n,async()=>{let e=await r({method:`post`,url:t,json:{name:decodeURIComponent(n),keywords:!0,multi:!0}});return e.data.found?e.data.tag.map(e=>e._id)[0]:``}))),s=await r({method:`post`,url:a,json:{tag_id:c}})}let l=s.data.torrents?.slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):30).map(e=>({title:e.title,link:`${o}/torrent/${e._id}`,description:e.introduction,pubDate:t(e.publish_time),enclosure_url:e.magnet,enclosure_type:`application/x-bittorrent`,category:e.tag_ids}))??[];return l=await Promise.all(l.map(t=>e.tryGet(t.link,async()=>{let e=await r({method:`post`,url:`${o}/api/tag/fetch`,json:{_ids:t.category}});t.category=[];for(let n of e.data)for(let e of n.synonyms)t.category.push(e);return t}))),{title:`萌番组 Bangumi Moe`,link:a||l.length===0?o:`${o}/search/${c.join(`+`)}`,item:l,allowEmpty:!0}}export{i as route};