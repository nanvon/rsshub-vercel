import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./got-dCh-Ojgc.js";import o from"node:path";import{load as s}from"cheerio";e();const c=`https://ieeexplore.ieee.org`,l={name:`IEEE Journal Articles`,maintainers:[`HenryQW`],categories:[`journal`],path:`/journal/:punumber/:earlyAccess?`,parameters:{punumber:"Publication Number, look for `punumber` in the URL",earlyAccess:`Optional, set any value to get early access articles`},example:`/ieee/journal/6287639/preprint`,handler:u};async function u(e){let a=e.req.param(`punumber`),l=!!e.req.param(`earlyAccess`),{displayTitle:u,currentIssue:m,preprintIssue:h,coverImagePath:g}=await d(a),{issueNumber:_,volume:v}=l?h:m,y=(await f(a,_)).records.map(e=>p(v)(e)),b=await Promise.all(y.map(e=>r.tryGet(e.link,async()=>{let r=(s(await n(`https://ieeexplore.ieee.org${e.link}`))(`script[type="text/javascript"]:contains("xplGlobal.document.metadata")`).text()||``).match(/xplGlobal\.document\.metadata\s*=\s*(\{[\s\S]*?\})\s*;/);return e.abstract=r?JSON.parse(r[1]).abstract??` `:` `,e.description=i(o.join(t,`templates/description-e509e615.art`),{item:e}),e})));return{title:u,link:`${c}/xpl/tocresult.jsp?isnumber=${_}`,item:b,image:`${c}${g}`}}async function d(e){return(await a(`${c}/rest/publication/home/metadata?pubid=${e}`)).data}async function f(e,t){return(await a.post(`${c}/rest/search/pub/${e}/issue/${t}/toc`,{json:{punumber:e,isnumber:t,rowsPerPage:`100`}})).data}function p(e){return t=>({abstract:t.abstract||``,authors:t.authors?t.authors.map(e=>e.preferredName).join(`; `):``,description:``,doi:t.doi,link:t.htmlLink,title:t.articleTitle||``,volume:e})}export{l as route};