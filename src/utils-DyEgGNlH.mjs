import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import{t as n}from"./ofetch-BRplXtiZ.mjs";import{t as r}from"./config-D7dgKYF5.mjs";import{t as i}from"./cache-Bv3_kFbE.mjs";import{t as a}from"./parse-date-_GmTZfjS.mjs";import{t as o}from"./render-CSqLtqb8.mjs";import s from"node:path";import{load as c}from"cheerio";e();const l=()=>i.tryGet(`aeon:buildId`,async()=>{let e=c(await n(`https://aeon.co`));return JSON.parse(e(`script#__NEXT_DATA__`).text()).buildId},r.cache.routeExpire,!1),u=async e=>await Promise.all(e.map(e=>i.tryGet(e.link,async()=>{let r=(await n(`https://aeon.co/_next/data/${await l()}/${e.type}s/${e.slug}.json?id=${e.slug}`)).pageProps.article,i=r.type.toLowerCase();if(e.pubDate=a(r.publishedAt),i===`video`)e.description=o(s.join(t,`templates/video-0418ceff.art`),{article:r});else{if(r.audio?.id){let t=await n(`https://api.aeonmedia.co/graphql`,{method:`POST`,body:{query:`query getAudio($audioId: ID!) {
                                    audio(id: $audioId) {
                                        id
                                        streamUrl
                                    }
                                }`,variables:{audioId:r.audio.id},operationName:`getAudio`}});delete e.image,e.enclosure_url=t.data.audio.streamUrl,e.enclosure_type=`audio/mpeg`}let i=c(r.body,null,!1),a=r.image;i(`p.pullquote`).remove();let l=r.authors.map(e=>`<p>`+e.name+e.authorBio.replaceAll(/^<p>/g,` `)).join(``);e.description=o(s.join(t,`templates/essay-deb2bd55.art`),{banner:a,authorsBio:l,content:i.html()})}return e})));export{u as n,l as t};