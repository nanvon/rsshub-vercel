import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BlqYKpVp.js";import o from"node:path";import{load as s}from"cheerio";e();const c=`https://nzmz.xyz`,l=async(e,t,n,r,i)=>{let o=s(await e(t,async()=>{let{data:e}=await a(t);return e}));return o(r).eq(Number.parseInt(n,10)).find(i).toArray().map(e=>(e=o(e),{link:new URL(e.prop(`href`),c).href}))},u=(e,t)=>e(`newzmz#${t.match(/details-(.*?)\.html/)[1]}`,async()=>{let{data:e}=await a(t),n=s(e),r=n(`div.chsname`).text(),o=n(`div.engname`).text(),c=n(`div.aliasname`).text().replace(/又名：/,``).split(`/`).map(e=>e.trim()).filter(Boolean);return{link:n(`a.addgz`).prop(`href`),pubDate:i(n(`span.duration`).first().text().match(/(\d{4}-\d{2}-\d{2})/)[1]),description:{image:n(`div.details-bg img`).prop(`src`),nameZh:r,nameEn:o,alias:c,update:n(`span.upday`).text(),links:n(`div.ep-infos a[title]`).toArray().map(e=>(e=n(e),{title:e.prop(`title`),link:e.prop(`href`)}))},author:n(`ul.sws-list`).first().find(`h5.title`).toArray().map(e=>n(e).text()).join(` / `),category:[r,o,...c]}}),d=async(e,n,i,c,l)=>{let{data:u}=await a(e.link),d=s(u);return d(i).toArray().map(i=>{i=d(i);let a=i.find(c).toArray().map(e=>d(e).text()),s=i.find(l).toArray().map(e=>(e=d(e),{title:e.find(`p.link-name`).text(),link:e.find(`a[title]`).prop(`href`)})),u=i.find(`span.up`).text().replaceAll(/[\s-]+/g,``),f=`${e.description.nameZh||e.description.nameEn}|${u}`;return{guid:`newzmz#${e.link.match(/view\/(.*?)\.html/)[1]}-${u}`,title:f,link:e.link,description:r(o.join(t,`templates/description-f7b4d948.art`),{...e.description,categories:a,downLinks:s}),author:e.author,category:[...e.category,...a].filter(Boolean),pubDate:e.pubDate,enclosure_url:s.findLast(e=>e.title===n)?.link??s[0].link,enclosure_type:`application/x-bittorrent`}})},f={path:`/:id?/:downLinkType?`,categories:[`multimedia`],example:`/newzmz/qEzRyY3v`,parameters:{id:`剧集 id，可在剧集下载页 URL 中找到`,downLinkType:`下载链接类型，默认为磁力链`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`newzmz.com/`],target:``}],name:`指定剧集`,maintainers:[`nczitzk`],handler:p,url:`newzmz.com/`,description:"::: tip\n  [雪国列车 (剧版)](https://nzmz.xyz/details-qEzRyY3v.html) 的下载页 URL 为 `https://v.ys99.xyz/view/qEzRyY3v.html`，即剧集 id 为 `qEzRyY3v`\n:::"};async function p(e){let{id:t=`1`,downLinkType:r=`磁力链`}=e.req.param(),i=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,o=!Number.isNaN(t),f=new URL(o?`index.html`:`details-${t}.html`,c).href,p=s(await n.tryGet(f,async()=>{let{data:e}=await a(f);return e})),m=o?await l(n.tryGet,f,t,`div.rowMod`,`ul.slides li a`):[{link:f}];m=await Promise.all(m.slice(0,i).map(e=>u(n.tryGet,e.link))),m=await Promise.all(m.filter(e=>e.link!==`#`).map(e=>d(e,r,`div.team-con-area`,`div.item-label a`,`ul.team-icons li`))),m=m.flat();let h=o?p(`div.rowMod`).eq(Number.parseInt(t,10)).find(`h2.row-header-title`).text():``,g=`${p(`title`).text()}${h?` - ${h}`:``}`,_=p(`link[rel="shortcut icon"]`).prop(`href`);return{item:o?m:m.slice(0,i),title:g,link:f,description:p(`meta[name="description"]`).prop(`content`),language:`zh-cn`,image:p(`img.logo-img`).prop(`src`),icon:_,logo:_,subtitle:p(`meta[name="keywords"]`).prop(`content`),author:g,allowEmpty:!0}}export{f as route};