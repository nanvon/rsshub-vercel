import{ofetch_default as e}from"./ofetch-am9EnuPq.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{X_UA as n,appDetail as r,getRootUrl as i}from"./utils-BqvTMAoj.js";const a=(e,t)=>e?t===`helpful`||t===`recent`?`type=${t}`:`type=helpful`:t===`new`||t===`hot`?`sort=${t}`:`sort=hot`,o=async r=>{let o=r.id,s=r.order??`hot`,c=r.lang??`zh_CN`,l=`${i(!1)}/webapiv2/review/v2/list-by-app?app_id=${o}&limit=10`;return l+=`&${a(!1,s)}`,l+=`&${n(c)}`,(await e(l)).data.list.map(e=>{let n=e.moment.author.user.name,r=e.moment.review.score;return{title:`${n} - ${r}星`,author:n,description:e.moment.review.contents.text+(e.moment.review.contents.images?e.moment.review.contents.images.map(e=>`<img src="${e.original_url}">`).join(``):``),link:`${i(!1)}/review/${e.moment.review.id}`,pubDate:t(e.moment.publish_time,`X`)}})},s=async r=>{let o=r.id,s=r.order??`helpful`,c=r.lang??`en_US`,l=`${i(!0)}/webapiv2/feeds/v3/by-app?app_id=${o}&limit=10`;return l+=`&${a(!0,s)}`,l+=`&${n(c)}`,(await e(l)).data.list.map(e=>{let n=e.post.user.name,r=e.post.list_fields.app_ratings[o].score;return{title:`${n} - ${`★`.repeat(r)}`,author:n,description:e.post.list_fields.summary||e.post.list_fields.title,link:`${i(!0)}/post/${e.post.id_str}`,pubDate:t(e.post.published_time,`X`)}})};async function c(e){let t=e.req.path.replace(`/taptap`,``).startsWith(`/intl/`),n=e.req.param(`id`),c=e.req.param(`order`)??`default`,l=e.req.param(`lang`)??(t?`en_US`:`zh_CN`),u=await r(n,l,t),d=u.app.icon.original_url,f=u.app.title,p=t?await s({id:n,order:c,lang:l}):await o({id:n,order:c,lang:l});return{title:`TapTap 评价 ${f}`,link:`${i(t)}/app/${n}/review?${a(t,c)}`,image:d,item:p}}export{c as handler};