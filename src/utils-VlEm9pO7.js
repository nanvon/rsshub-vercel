import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{parseDate as i,parseRelativeDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BOnMlRH6.js";import s from"node:path";import{load as c}from"cheerio";t();const l=e=>({title:e.name,link:e.link,description:e.name,pubDate:i(e.pubTimeLong),media:{content:{url:e.pic}}});var u={ProcessItem:(t,u)=>{let d=u.req.query(`old`)===`yes`;if(t.link)return l(t);let f=`https://m.thepaper.cn/${t.cornerLabelDesc&&t.cornerLabelDesc===`短剧`?`series`:`detail`}/${t.contId}`;return n.tryGet(`${f}${d?`:old`:``}`,async()=>{let n=await o(f),u=JSON.parse(c(n.data)(`#__NEXT_DATA__`).html()).props.pageProps.detailData,p=u.contentDetail||u.liveDetail||u.specialDetail?.specialInfo;if(!p)return l(t);let m=p.content||p.summary||p.desc||``;p.videos&&(m+=p.summary),d&&(p.videos&&(m=r(s.join(e,`templates/video_detail-6e02b70e.art`),{videos:p.videos})+m),p.images&&(m=r(s.join(e,`templates/image_detail-7a807b2d.art`),{images:p.images})+m));let h=i(t.pubTimeLong||p.publishTime);Number.isNaN(h)&&(h=a(p.pubTime));let g={title:p.name||p.shareName,link:f,description:m,category:[...p.tagList?.map(e=>e.tag)??[],p?.nodeInfo?.name??[]],pubDate:h,author:p.author||``,media:{content:{url:t.pic||p.videos?.coverUrl||p.bigPic},thumbnails:{url:t.sharePic||p.sharePic}}};return p.voiceInfo?.isHaveVoice&&(g.enclosure_type=`audio/mpeg`,g.enclosure_url=p.voiceInfo.voiceSrc,g.itunes_item_image=t.pic||p.videos?.coverUrl),g})},ChannelIdToName:(e,t)=>t.props.appProps.menu.channelList.find(t=>t.nodeId.toString()===e.toString()).name,ListIdToName:(e,t)=>t.props.appProps.menu.channelList.flatMap(e=>e.childNodeList||[]).find(t=>t.nodeId.toString()===e.toString())?.name,ExtractLogo:e=>`https://m.thepaper.cn`+c(e.data)(`img.imageCover`).attr(`src`)};export{u as utils_default};