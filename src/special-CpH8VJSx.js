import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-BrnquCU2.js";import{cache_default as t}from"./cache-DNP0KCHb.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import{rofetch as r}from"./ofetch-Of9UBhau.js";import{generateNonce as i,getPost as a,phoneBaseUrl as o,sign as s,webBaseUrl as c}from"./utils-oow95-gq.js";const l={path:`/bbs/special/:specialId`,categories:[`bbs`],example:`/dxy/bbs/special/72`,parameters:{specialId:`专题 ID，可在对应专题页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`专题`,maintainers:[`TonyRL`],handler:u};async function u(l){let u=l.req.param(`specialId`),{limit:d=`10`}=l.req.query(),f=await t.tryGet(`dxy:special:detail:${u}`,async()=>{let e={specialId:u,requestType:`h5`,timestamp:Date.now(),noncestr:i(8,`number`)},t=await r(`${o}/newh5/bbs/special/detail`,{query:{...e,sign:s(e)}});if(t.code!==`success`)throw Error(t.message);return t.data}),p=await t.tryGet(`dxy:special:recommend-list-v3:${u}`,async()=>{let e={specialId:u,requestType:`h5`,pageNum:`1`,pageSize:d,timestamp:Date.now(),noncestr:i(8,`number`)},t=await r(`${o}/newh5/bbs/special/post/recommend-list-v3`,{query:{...e,sign:s(e)}});if(t.code!==`success`)throw Error(t.message);return t.data},e.cache.routeExpire,!1),m=p.result.map(e=>{let{postInfo:t,dataTime:r,entityId:i}=e;return{title:t.subject,description:t.simpleBody,pubDate:n(r,`x`),author:t.postUser.nickname,category:[t.postSpecial.specialName],link:`${c}/bbs/newweb/pc/post/${i}`,postId:i}}),h=await Promise.all(m.map(e=>a(e,t.tryGet)));return{title:f.name,description:`${f.content} ${f.postCount} 內容 ${f.followCount} 关注`,link:`${o}/bbs/special?specialId=${u}`,image:f.specialAvatar,item:h}}export{l as route};