import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-BpwDbAkH.js";import{logger_default as t}from"./logger-B3QfaIfn.js";import{proxy_default as n}from"./proxy-CnCu3_dc.js";import{Xe as r,ofetch_default as i}from"./ofetch-TsvCL7Kz.js";import{getPath as a,getRouteNameFromPath as o,time as s}from"./helpers-LVq640iW.js";import{request_in_progress_default as c}from"./request-in-progress-DfkBXhue.js";import{cache_default as l}from"./cache-CzcusEyX.js";import{atom_default as u,json_default as d,rss3_default as f,rss_default as ee}from"./render-DE4LRFBD.js";import"./parse-date-DHsdom8D.js";import{collapseWhitespace as p,convertDateToISO8601 as te}from"./common-utils-C27Jp3s6.js";import{md5 as ne}from"./md5-15Cn4YyR.js";import{reject_default as re}from"./reject-C94MPz0p.js";import{not_found_default as ie}from"./not-found-o393tAVF.js";import ae,{FormData as oe,Headers as se,Request as ce,Response as le}from"undici";import m from"node:http";import h from"node:https";import ue from"node:path";import{RateLimiterMemory as de,RateLimiterQueue as fe}from"rate-limiter-flexible";import{Hono as pe}from"hono";import{compress as me}from"hono/compress";import{resourceFromAttributes as he}from"@opentelemetry/resources";import{PrometheusExporter as ge,PrometheusSerializer as _e}from"@opentelemetry/exporter-prometheus";import{ATTR_SERVICE_NAME as ve}from"@opentelemetry/semantic-conventions";import{MeterProvider as ye}from"@opentelemetry/sdk-metrics";import{BasicTracerProvider as be,BatchSpanProcessor as xe}from"@opentelemetry/sdk-trace-base";import{OTLPTraceExporter as Se}from"@opentelemetry/exporter-trace-otlp-http";import{trace as Ce}from"@opentelemetry/api";import we from"xxhash-wasm";import{Fragment as g,jsx as _,jsxs as v}from"hono/jsx/jsx-runtime";import*as y from"@sentry/node";import{routePath as b}from"hono/route";import Te from"etag";import{load as x}from"cheerio";import*as S from"entities";import{simplecc as Ee}from"simplecc-wasm";import{RE2JS as C}from"re2js";import De from"markdown-it";import{convert as w}from"html-to-text";import Oe from"sanitize-html";import ke from"@postlight/parser";import{jsxRenderer as Ae}from"hono/jsx-renderer";import{trimTrailingSlash as je}from"hono/trailing-slash";import{execSync as Me}from"node:child_process";import{directoryImport as Ne}from"directory-import";import{serveStatic as Pe}from"@hono/node-server/serve-static";import{OpenAPIHono as Fe,createRoute as T,z as E}from"@hono/zod-openapi";import{parse as D}from"tldts";import{Scalar as Ie}from"@scalar/hono-api-reference";const Le=new de({points:10,duration:1,execEvenly:!0}),Re=new fe(Le,{maxQueueSize:4800}),ze=e=>{process.env.NODE_ENV===`dev`&&r(t=>{for(let[n,r]of e.entries())t.requestHeaders[n]=r;return t})},Be=async(r,i)=>{let a=new ce(r,i),o={};if(t.debug(`Outgoing request: ${a.method} ${a.url}`),a.headers.get(`user-agent`)||a.headers.set(`user-agent`,e.ua),a.headers.get(`accept`)||a.headers.set(`accept`,`*/*`),!a.headers.get(`referer`))try{let e=new URL(a.url);a.headers.set(`referer`,e.origin)}catch{}let s=!1;if(a.headers.get(`x-prefer-proxy`)&&(s=!0,a.headers.delete(`x-prefer-proxy`)),e.enableRemoteDebugging&&ze(a.headers),!i?.dispatcher&&(n.proxyObj.strategy!==`on_retry`||s)){let e=new RegExp(n.proxyObj.url_regex),r;try{r=new URL(a.url)}catch{}if(e.test(a.url)&&a.url.startsWith(`http`)&&!(r&&r.host===n.proxyUrlHandler?.host)){let e=n.getCurrentProxy();if(e){let r=n.getDispatcherForProxy(e);r&&(o.dispatcher=r,t.debug(`Proxying request via ${e.uri}: ${a.url}`))}}}await Re.removeTokens(1);let c=n.multiProxy?.allProxies.length||1,l=async e=>{try{return await ae.fetch(a,o)}catch(r){if(o.dispatcher&&n.multiProxy&&e<c-1){let i=n.getCurrentProxy();if(i){t.warn(`Request failed with proxy ${i.uri}, trying next proxy: ${r}`),n.markProxyFailed(i.uri);let s=n.getCurrentProxy();if(s&&s.uri!==i.uri){let r=n.getDispatcherForProxy(s);return r&&(o.dispatcher=r),t.debug(`Retrying request with proxy ${s.uri}: ${a.url}`),l(e+1)}else return t.warn(`No more proxies available, trying without proxy`),delete o.dispatcher,l(e+1)}}throw r}};return l(0)};var Ve=Be;const He=r=>function(...i){let a,o={},s;if(typeof i[0]==`string`||i[0]instanceof URL)a=new URL(i[0]),typeof i[1]==`object`?(o=i[1],s=i[2]):typeof i[1]==`function`&&(o={},s=i[1]);else{o=i[0];try{a=new URL(o.href||`${o.protocol||`http:`}//${o.hostname||o.host}${o.path}${o.search||(o.query?`?${o.query}`:``)}`)}catch{a=null}typeof i[1]==`function`&&(s=i[1])}if(!a)return Reflect.apply(r,this,i);t.debug(`Outgoing request: ${o.method||`GET`} ${a}`),o.headers=o.headers||{};let c=new Set(Object.keys(o.headers).map(e=>e.toLowerCase()));if(c.has(`user-agent`)||(o.headers[`user-agent`]=e.ua),c.has(`accept`)||(o.headers.accept=`*/*`),c.has(`referer`)||(o.headers.referer=a.origin),!o.agent&&n.agent){let t=new RegExp(n.proxyObj.url_regex);t.test(a.toString())&&a.protocol.startsWith(`http`)&&a.host!==n.proxyUrlHandler?.host&&a.host!==`localhost`&&!a.host.startsWith(`127.`)&&!(e.puppeteerWSEndpoint?.includes(a.host)??!1)&&(o.agent=n.agent)}return Reflect.apply(r,this,[a,o,s])};var O=He;Object.defineProperties(globalThis,{fetch:{value:Ve},Headers:{value:se},FormData:{value:oe},Request:{value:ce},Response:{value:le}}),m.get=O(m.get),m.request=O(m.request),h.get=O(h.get),h.request=O(h.request);const k=`rsshub`,Ue=new ge({}),We=new ye({resource:he({[ve]:`rsshub`}),readers:[Ue]}),Ge=new _e,A=We.getMeter(`rsshub`),Ke=A.createCounter(`${k}_request_total`),qe=A.createCounter(`${k}_request_error_total`),Je=A.createHistogram(`${k}_request_duration_seconds_bucket`,{advice:{explicitBucketBoundaries:e.otel.seconds_bucket?.split(`,`).map(Number)}}),Ye=A.createHistogram(`${k}_request_duration_milliseconds_bucket`,{advice:{explicitBucketBoundaries:e.otel.milliseconds_bucket?.split(`,`).map(Number)}}),Xe={success:(e,t)=>{Ke.add(1,t),Ye.record(e,{unit:`millisecond`,...t}),Je.record(e/1e3,{unit:`second`,...t})},error:e=>{qe.add(1,e)}},Ze=()=>new Promise((e,t)=>{Ue.collect().then(t=>{e(Ge.serialize(t.resourceMetrics))}).finally(()=>{t(``)})}),Qe=new Se({}),$e=new be({resource:he({[ve]:`rsshub`}),spanProcessors:[new xe(Qe,{maxQueueSize:4096,scheduledDelayMillis:3e4})]});Ce.setGlobalTracerProvider($e);const et=$e.getTracer(`rsshub`);et.startSpan(`main`);var j=function(e){return e.Outgoing=`-->`,e.Incoming=`<--`,e.Error=`xxx`,e}(j||{});const tt=e=>{let t={7:`\u001B[35m${e}\u001B[0m`,5:`\u001B[31m${e}\u001B[0m`,4:`\u001B[33m${e}\u001B[0m`,3:`\u001B[36m${e}\u001B[0m`,2:`\u001B[32m${e}\u001B[0m`,1:`\u001B[32m${e}\u001B[0m`,0:`\u001B[33m${e}\u001B[0m`},n=Math.trunc(e/100);return t[n]},nt=async(e,n)=>{let{method:r,raw:i,routePath:o}=e.req,c=a(i);t.info(`${j.Incoming} ${r} ${c}`);let l=Date.now();await n();let u=e.res.status;t.info(`${j.Outgoing} ${r} ${c} ${tt(u)} ${s(l)}`),Xe.success(Date.now()-l,{path:o,method:r,status:u})};var rt=nt;const it=new Set([`/`,`/robots.txt`,`/logo.png`,`/favicon.ico`]),at=async(t,n)=>{if(!l.status.available||it.has(t.req.path)){await n();return}let r=t.req.path,i=t.req.query(`limit`)?`:${t.req.query(`limit`)}`:``,{h64ToString:a}=await we(),o=`rsshub:koa-redis-cache:`+a(r+i),s=`rsshub:path-requested:`+a(r+i),u=await l.globalCache.get(s);if(u===`1`){let e=process.env.NODE_ENV===`test`?1:10,t=!1;for(;e>0;){if(await new Promise(e=>setTimeout(e,process.env.NODE_ENV===`test`?3e3:6e3)),await l.globalCache.get(s)!==`1`){t=!0;break}e--}if(!t)throw new c(`This path is currently fetching, please come back later!`)}let d=await l.globalCache.get(o);if(d){t.status(200),t.header(`RSSHub-Cache-Status`,`HIT`),t.set(`data`,JSON.parse(d)),await n();return}await l.globalCache.set(s,`1`,e.cache.requestTimeout);try{await n()}catch(t){throw await l.globalCache.set(s,`0`,e.cache.requestTimeout),t}let f=t.get(`data`);if(t.res.headers.get(`Cache-Control`)!==`no-cache`&&f){f.lastBuildDate=new Date().toUTCString(),t.set(`data`,f);let n=JSON.stringify(f);await l.globalCache.set(o,n,e.cache.routeExpire)}await l.globalCache.set(s,`0`,e.cache.requestTimeout)};var ot=at;const st=async(t,n)=>{let r=l.status.available&&Math.trunc(e.cache.routeExpire/60)||1;await n();let i=t.get(`apiData`);if(i)return t.json(i);let a=t.get(`data`),o=t.req.query(`format`)||`rss`;if(e.debugInfo){if(o===`debug.json`)return t.json(t.get(`json`)||{message:`plugin does not set debug json`});if(/(\d+)\.debug\.html$/.test(o)){let e=Number.parseInt(o.match(/(\d+)\.debug\.html$/)?.[1]||`0`);return t.html(a?.item?.[e]?.description||`data.item[${e}].description not found`)}}if(a&&(a.title=p(a.title)||``,a.description&&(a.description=p(a.description)||``),a.author&&(a.author=p(a.author)||``),a.item))for(let t of a.item){if(t.title){t.title=p(t.title)||``;for(let n=0,r=0;r<t.title.length;r++)if(n+=Buffer.from(t.title[r]).length===1?1:2,n>e.titleLengthLimit){t.title=`${t.title.slice(0,r)}...`;break}}if(t.description&&(t.description=t.description.replaceAll(/[\u0000-\u0009\u000B\u000C\u000E-\u001F\u007F\u200B\uFFFF]/g,``)),typeof t.author==`string`)t.author=p(t.author)||``;else if(typeof t.author==`object`&&t.author!==null){for(let e of t.author)e.name=p(e.name)||``;o!==`json`&&(t.author=t.author.map(e=>e.name).join(`, `))}if(t.itunes_duration&&(typeof t.itunes_duration==`string`&&!t.itunes_duration.includes(`:`)||typeof t.itunes_duration==`number`&&!Number.isNaN(t.itunes_duration))&&(t.itunes_duration=+t.itunes_duration,t.itunes_duration=Math.floor(t.itunes_duration/3600)+`:`+(Math.floor(t.itunes_duration%3600/60)/100).toFixed(2).slice(-2)+`:`+(t.itunes_duration%3600%60/100).toFixed(2).slice(-2)),o!==`rss`){try{t.pubDate&&(t.pubDate=te(t.pubDate)||``)}catch{t.pubDate=``}try{t.updated&&(t.updated=te(t.updated)||``)}catch{t.updated=``}}}let s=new Date,c={lastBuildDate:s.toUTCString(),updated:s.toISOString(),ttl:r,atomlink:t.req.url,...a};if(e.isPackage)return t.json(c);if(t.get(`redirect`))return t.redirect(t.get(`redirect`),301);if(t.get(`no-content`))return t.body(null);switch(o){case`ums`:case`rss3`:return t.json(f(c));case`json`:return t.header(`Content-Type`,`application/feed+json; charset=UTF-8`),t.body(d(c));case`atom`:return t.render(_(u,{data:c}));default:return t.render(_(ee,{data:c}))}};var ct=st;e.sentry.dsn&&(y.init({dsn:e.sentry.dsn}),y.getCurrentScope().setTag(`node_name`,e.nodeName),t.info(`Sentry inited.`));const lt=async(t,n)=>{let r=Date.now();await n(),e.sentry.dsn&&Date.now()-r>=e.sentry.routeTimeout&&y.withScope(e=>{e.setTag(`name`,o(t.req.path)),y.captureException(Error(`Route Timeout`))})};var ut=lt;const dt=e=>{throw new re(`Authentication failed. Access denied.\n${e}`)},ft=async(t,n)=>{let r=new URL(t.req.url).pathname,i=t.req.query(`key`),a=t.req.query(`code`);if(r===`/`||r===`/robots.txt`||r===`/favicon.ico`||r===`/logo.png`)await n();else{if(e.accessKey&&!(e.accessKey===i||a===ne(r+e.accessKey)))return dt(r);await n()}};var pt=ft;const mt={hitCache:0,request:0,etag:0,error:0,routes:{},paths:{},errorRoutes:{},errorPaths:{}},M=()=>mt,N=e=>Object.assign(mt,e),ht=async(e,t)=>{{let t=M();t.paths[e.req.path]||(t.paths[e.req.path]=0),t.paths[e.req.path]++,t.request++,N(t)}await t();{let t=M(),n=b(e),r=n!==`/*`;!t.routes[n]&&r&&(t.routes[n]=0),r&&t.routes[n]++,e.res.headers.get(`RSSHub-Cache-Status`)&&t.hitCache++,e.res.status===304&&t.etag++,N(t)}};var gt=ht;const P={"Access-Control-Allow-Methods":`GET`,"Content-Type":`application/xml; charset=utf-8`,"Cache-Control":`public, max-age=${e.cache.routeExpire}`,"X-Content-Type-Options":`nosniff`};e.nodeName&&(P[`RSSHub-Node`]=e.nodeName);function _t(e,t){return t!==null&&t.split(/,\s*/).includes(e)}const vt=async(t,n)=>{for(let e in P)t.header(e,P[e]);t.header(`Access-Control-Allow-Origin`,e.allowOrigin||new URL(t.req.url).host),await n();let r=b(t);r!==`/*`&&t.header(`X-RSSHub-Route`,r);let i=t.get(`data`);if(!i||t.res.headers.get(`ETag`))return;let a=i.lastBuildDate;delete i.lastBuildDate;let o=Te(JSON.stringify(i));t.header(`ETag`,o);let s=t.req.header(`If-None-Match`)??null;_t(o,s)?(t.status(304),t.set(`no-content`,!0)):t.header(`Last-Modified`,a)};var yt=vt;const F=/\${([^{}]+)}/g,bt=new Set([`hash`,`host`,`hostname`,`href`,`origin`,`password`,`pathname`,`port`,`protocol`,`search`,`searchParams`,`username`]),I=(e,t)=>{for(let n of t)if(e.startsWith(n)&&(e.length===n.length||e[n.length]===`/`))return!0;return!1},L=t=>{let n=e.hotlink.includePaths,r=e.hotlink.excludePaths;return!(n&&!I(t,n))&&!(r&&I(t,r))},xt=(e,t)=>e.replaceAll(F,(e,n)=>{let r=!1;return n.endsWith(`_ue`)&&(n=n.slice(0,-3),r=!0),r?encodeURIComponent(t[n]):t[n]}),St=e=>{let n;try{n=new URL(e)}catch{t.error(`Failed to parse ${e}`)}return n},R=(e,t)=>{if(!e||!t)return t;let n=St(t);return n&&n.protocol!==`data:`?xt(e,n):t},z=(e,t,n,r=`src`)=>{e(t).each(function(){let t=e(this).attr(r);if(t){let i=St(t);i&&i.protocol!==`data:`&&e(this).attr(r,xt(n,i))}})},Ct=(e,t,n)=>{let r=x(e,void 0,!1);return t&&(z(r,`img, picture > source`,t),z(r,`video[poster]`,t,`poster`),z(r,`*[data-rsshub-image="href"]`,t,`href`)),n&&(z(r,`video, video > source, audio, audio > source`,n),t||z(r,`video[poster]`,n,`poster`)),r.html()},wt=e=>{if(e)for(let t of e.matchAll(F)){let e=t[1].endsWith(`_ue`)?t[1].slice(0,-3):t[1];if(!bt.has(e))throw Error(`Invalid URL property: ${e}`)}},Tt=async(t,n)=>{await n();let r,i;if(e.feature.allow_user_hotlink_template&&(i=t.req.query(`multimedia_hotlink_template`),r=t.req.query(`image_hotlink_template`)),e.hotlink.template&&(r=L(t.req.path)?e.hotlink.template:void 0,i=L(t.req.path)?e.hotlink.template:void 0),!r&&!i)return;wt(r),wt(i);let a=t.get(`data`);if(a){if(a.image&&(a.image=R(r,a.image)),a.description&&(a.description=Ct(a.description,r,i)),a.item)for(let e of a.item)e.description&&(e.description=Ct(e.description,r,i)),e.enclosure_url&&e.enclosure_type&&(e.enclosure_type.startsWith(`image/`)?e.enclosure_url=R(r,e.enclosure_url):/^(video|audio)\//.test(e.enclosure_type)&&(e.enclosure_url=R(i,e.enclosure_url))),e.image&&(e.image=R(r,e.image)),e.itunes_item_image&&(e.itunes_item_image=R(r,e.itunes_item_image));t.set(`data`,a)}};var Et=Tt;const Dt=De({html:!0}),B=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}},V=async(t,n)=>{let r=`${e.openai.endpoint}/chat/completions`,a=await i(r,{method:`POST`,body:{model:e.openai.model,max_tokens:e.openai.maxTokens,messages:[{role:`system`,content:t},{role:`user`,content:n}],temperature:e.openai.temperature},headers:{Authorization:`Bearer ${e.openai.apiKey}`}});return a.choices[0].message.content},H=e=>{let t=``;return e.author&&(t=typeof e.author==`string`?e.author:e.author.map(e=>e.name).join(` `)),t},Ot=async(t,n)=>{await n();let r=t.get(`data`);if(r){if((!r.item||r.item.length===0)&&!r.allowEmpty)throw Error(`this route is empty, please check the original site or <a href="https://github.com/DIYgod/RSSHub/issues/new/choose">create an issue</a>`);r.item=r.item||[],r.title&&(r.title=S.decodeXML(r.title+``)),r.description&&(r.description=S.decodeXML(r.description+``)),t.req.query(`sorted`)!==`false`&&(r.item=r.item.sort((e,t)=>new Date(t.pubDate||0)-+new Date(e.pubDate||0)));let n=t=>{if(t.title&&(t.title=S.decodeXML(t.title+``)),t.pubDate&&(t.pubDate=new Date(t.pubDate).toUTCString()),t.link){let e=r.link;e&&!/^https?:\/\//.test(e)&&(e=/^\/\//.test(e)?`http:`+e:`http://`+e),t.link=new URL(t.link,e).href}if(t.description){let n=x(t.description),i=t.link||r.link;i&&!/^https?:\/\//.test(i)&&(i=/^\/\//.test(i)?`http:`+i:`http://`+i),n(`script`).remove(),n(`img`).each((e,t)=>{let r=n(t);if(!r.attr(`src`)){let e=r.attr(`data-src`)||r.attr(`data-original`);if(e)r.attr(`src`,e);else for(let e in t.attribs){let n=t.attribs[e].trim();if([`.gif`,`.png`,`.jpg`,`.webp`].some(e=>n.includes(e))){r.attr(`src`,n);break}}}for(let e of[`onclick`,`onerror`,`onload`])r.removeAttr(e)}),n(`a, area`).each((e,t)=>{B(n,t,`href`,i)}),n(`img, video, audio, source, iframe, embed, track`).each((e,t)=>{B(n,t,`src`,i)}),n(`video[poster]`).each((e,t)=>{B(n,t,`poster`,i)}),n(`img, iframe`).each((e,t)=>{n(t).attr(`referrerpolicy`,`no-referrer`)}),t.description=n(`body`).html()+``+(e.suffix||``),t._extra?.links&&n(`.rsshub-quote`).length&&t._extra?.links?.map(e=>(e.content_html=n.html(n(`.rsshub-quote`)),e))}return t.category&&(Array.isArray(t.category)||(t.category=[t.category]),t.category=t.category.filter(e=>typeof e==`string`)),t};r.item=await Promise.all(r.item.map(e=>n(e)));let a=e.feature.filter_regex_engine,o=e=>{let n=t.req.query(`filter_case_sensitive`)===`false`;switch(a){case`regexp`:return new RegExp(e,n?`i`:``);case`re2`:return C.compile(e,n?C.CASE_INSENSITIVE:0);default:throw Error(`Invalid Engine Value: ${a}, please check your config.`)}};if(t.req.query(`filter`)){let e=o(t.req.query(`filter`));r.item=r.item.filter(t=>{let n=t.title||``,r=t.description||n,i=H(t),a=t.category||[],o=e instanceof C?e.matcher(n).find()||e.matcher(r).find()||e.matcher(i).find()||a.some(t=>e.matcher(t).find()):n.match(e)||r.match(e)||i.match(e)||a.some(t=>t.match(e));return o})}if(!t.req.query(`filter`)&&(t.req.query(`filter_title`)||t.req.query(`filter_description`)||t.req.query(`filter_author`)||t.req.query(`filter_category`))&&(r.item=r.item.filter(e=>{let n=e.title||``,r=e.description||n,i=H(e),a=e.category||[],s=!0;if(t.req.query(`filter_title`)){let e=o(t.req.query(`filter_title`));s=e instanceof C?e.matcher(n).find():!!e.test(n)}if(t.req.query(`filter_description`)){let e=o(t.req.query(`filter_description`));s=s&&(e instanceof C?e.matcher(r).find():!!e.test(r))}if(t.req.query(`filter_author`)){let e=o(t.req.query(`filter_author`));s=s&&(e instanceof C?e.matcher(i).find():!!e.test(i))}if(t.req.query(`filter_category`)){let e=o(t.req.query(`filter_category`));s=s&&a.some(t=>e instanceof C?e.matcher(t).find():t.match(e))}return s})),(t.req.query(`filterout`)||t.req.query(`filterout_title`)||t.req.query(`filterout_description`)||t.req.query(`filterout_author`)||t.req.query(`filterout_category`))&&(r.item=r.item.filter(e=>{let n=e.title,r=e.description||n,i=H(e),a=e.category||[],s=!0;if(t.req.query(`filterout`)||t.req.query(`filterout_title`)){let e=o(t.req.query(`filterout_title`)||t.req.query(`filterout`));s=e instanceof C?!e.matcher(n).find():!e.test(n)}if(t.req.query(`filterout`)||t.req.query(`filterout_description`)){let e=o(t.req.query(`filterout_description`)||t.req.query(`filterout`));s=s&&(e instanceof C?!e.matcher(r).find():!e.test(r))}if(t.req.query(`filterout_author`)){let e=o(t.req.query(`filterout_author`));s=s&&(e instanceof C?!e.matcher(i).find():!e.test(i))}if(t.req.query(`filterout_category`)){let e=o(t.req.query(`filterout_category`));s=s&&!a.some(t=>e instanceof C?e.matcher(t).find():t.match(e))}return s})),t.req.query(`filter_time`)){let e=Date.now();r.item=r.item.filter(({pubDate:n})=>{let r=!0;try{r=!n||e-new Date(n).getTime()<=Number.parseInt(t.req.query(`filter_time`))*1e3}catch{}return r})}if(t.req.query(`limit`)&&(r.item=r.item.slice(0,Number.parseInt(t.req.query(`limit`)))),t.req.query(`tgiv`)&&r.item.map(e=>{if(e.link){let n=encodeURIComponent(e.link);return e.link=`https://t.me/iv?url=${n}&rhash=${t.req.query(`tgiv`)}`,e}else return e}),t.req.query(`mode`)?.toLowerCase()===`fulltext`){let e=r.item.map(async e=>{let{link:t,author:n,description:r}=e,a=await l.tryGet(`mercury-cache-${t}`,async()=>{if(t)try{let e=await i(t),n=x(e),r=await ke.parse(t,{html:n.html()});return r}catch{}});e.author=n||a?.author,e.description=a&&a.content.length>40?S.decodeXML(a.content):r});await Promise.all(e)}if(t.req.query(`chatgpt`)&&e.openai.apiKey&&(r.item=await Promise.all(r.item.map(async t=>{try{if(e.openai.inputOption===`description`&&t.description){let n=await l.tryGet(`openai:description:${t.link}`,async()=>{let n=w(t.description),r=await V(e.openai.promptDescription,n);return Dt.render(r)});n!==``&&(t.description=n+`<hr/><br/>`+t.description)}else if(e.openai.inputOption===`title`&&t.title){let n=await l.tryGet(`openai:title:${t.link}`,async()=>{let n=w(t.title);return await V(e.openai.promptTitle,n)});n!==``&&(t.title=n+``)}else if(e.openai.inputOption===`both`&&t.title&&t.description){let n=await l.tryGet(`openai:title:${t.link}`,async()=>{let n=w(t.title);return await V(e.openai.promptTitle,n)});n!==``&&(t.title=n+``);let r=await l.tryGet(`openai:description:${t.link}`,async()=>{let n=w(t.description),r=await V(e.openai.promptDescription,n);return Dt.render(r)});r!==``&&(t.description=r+`<hr/><br/>`+t.description)}}catch{}return t}))),t.req.query(`scihub`)&&r.item.map(t=>(t.link=t.doi?`${e.scihub.host}${t.doi}`:`${e.scihub.host}${t.link}`,t)),t.req.query(`opencc`))for(let e of r.item)e.title=Ee(e.title??e.link,t.req.query(`opencc`)),e.description=Ee(e.description??e.title??e.link,t.req.query(`opencc`));if(t.req.query(`brief`)){let e=/[1-9]\d{2,}/;if(e.test(t.req.query(`brief`))){let e=Number.parseInt(t.req.query(`brief`));for(let t of r.item){let n;t.description&&(n=Oe(t.description,{allowedTags:[],allowedAttributes:{}}),t.description=n.length>e?`<p>${n.slice(0,e)}…</p>`:`<p>${n}</p>`)}}else throw Error(`Invalid parameter brief. Please check the doc https://docs.rsshub.app/guide/parameters#shu-chu-jian-xun`)}t.set(`data`,r)}};var kt=Ot;const At=async(t,n)=>{if(e.debugInfo){let{method:e,raw:r}=t.req,i=a(r),o=et.startSpan(`${e} ${i}`,{kind:1,attributes:{}});o.addEvent(`invoking handleRequest`),await n(),o.end()}else await n()};var jt=At;const Mt=e=>v(`html`,{children:[v(`head`,{children:[_(`title`,{children:`Welcome to RSSHub!`}),_(`script`,{src:`https://cdn.tailwindcss.com`}),_(`style`,{children:`
                details::-webkit-scrollbar {
                    width: 0.25rem;
                }
                details::-webkit-scrollbar-thumb {
                    border-radius: 0.125rem;
                    background-color: #e4e4e7;
                }
                details::-webkit-scrollbar-thumb:hover {
                    background-color: #a1a1aa;
                }

                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 400;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-400-normal.woff2) format(woff2);
                }
                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 500;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-500-normal.woff2) format(woff2);
                }
                @font-face {
                    font-family: SN Pro;
                    font-style: normal;
                    font-display: swap;
                    font-weight: 700;
                    src: url(https://cdn.jsdelivr.net/fontsource/fonts/sn-pro@latest/latin-700-normal.woff2) format(woff2);
                }
                body {
                    font-family: SN Pro, sans-serif;
                }
                `})]}),_(`body`,{className:`antialiased min-h-screen text-zinc-700 flex flex-col`,children:e.children})]});let U=process.env.HEROKU_SLUG_COMMIT?.slice(0,8)||process.env.VERCEL_GIT_COMMIT_SHA?.slice(0,8),W;if(!U)try{U=Me(`git rev-parse HEAD`).toString().trim().slice(0,8),W=new Date(Me(`git log -1 --format=%cd`).toString().trim())}catch{U=`unknown`}const Nt=({requestPath:e,message:t,errorRoute:n,nodeVersion:r})=>v(Mt,{children:[_(`div`,{className:`pointer-events-none absolute w-full min-h-screen`,style:{backgroundImage:`url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAzMiAzMicgd2lkdGg9JzMyJyBoZWlnaHQ9JzMyJyBmaWxsPSdub25lJyBzdHJva2U9J3JnYigxNSAyMyA0MiAvIDAuMDQpJz48cGF0aCBkPSdNMCAuNUgzMS41VjMyJy8+PC9zdmc+')`,maskImage:`linear-gradient(transparent, black, transparent)`}}),v(`div`,{className:`w-full grow shrink-0 py-8 flex items-center justify-center flex-col space-y-4`,children:[_(`img`,{className:`grayscale`,src:`/logo.png`,alt:`RSSHub`,width:`100`,loading:`lazy`}),_(`h1`,{className:`text-4xl font-bold`,children:`Looks like something went wrong`}),v(`div`,{className:`text-left w-[800px] space-y-6 !mt-10`,children:[v(`div`,{className:`space-y-2`,children:[_(`p`,{className:`mb-2 font-bold`,children:`Helpful Information`}),v(`p`,{className:`message`,children:[`Error Message:`,_(`br`,{}),_(`code`,{className:`mt-2 block max-h-28 overflow-auto bg-zinc-100 align-bottom w-fit details whitespace-pre-line`,children:t})]}),v(`p`,{className:`message`,children:[`Route: `,_(`code`,{className:`ml-2 bg-zinc-100`,children:n})]}),v(`p`,{className:`message`,children:[`Full Route: `,_(`code`,{className:`ml-2 bg-zinc-100`,children:e})]}),v(`p`,{className:`message`,children:[`Node Version: `,_(`code`,{className:`ml-2 bg-zinc-100`,children:r})]}),v(`p`,{className:`message`,children:[`Git Hash: `,_(`code`,{className:`ml-2 bg-zinc-100`,children:U})]}),v(`p`,{className:`message`,children:[`Git Date: `,_(`code`,{className:`ml-2 bg-zinc-100`,children:W?.toUTCString()})]})]}),v(`div`,{children:[_(`p`,{className:`mb-2 font-bold`,children:`Report`}),v(`p`,{children:[`After carefully reading the`,` `,_(`a`,{className:`text-[#F5712C]`,href:`https://docs.rsshub.app/`,target:`_blank`,children:`document`}),`, if you think this is a bug of RSSHub, please`,` `,_(`a`,{className:`text-[#F5712C]`,href:`https://github.com/DIYgod/RSSHub/issues/new?assignees=&labels=RSS+bug&template=bug_report_en.yml`,target:`_blank`,children:`submit an issue`}),` `,`on GitHub.`]}),v(`p`,{children:[`在仔细阅读`,_(`a`,{className:`text-[#F5712C]`,href:`https://docs.rsshub.app/zh/`,target:`_blank`,children:`文档`}),`后，如果你认为这是 RSSHub 的 bug，请在 GitHub`,` `,_(`a`,{className:`text-[#F5712C]`,href:`https://github.com/DIYgod/RSSHub/issues/new?assignees=&labels=RSS+bug&template=bug_report_zh.yml`,target:`_blank`,children:`提交 issue`}),`。`]})]}),v(`div`,{children:[_(`p`,{className:`mb-2 font-bold`,children:`Community`}),v(`p`,{children:[`You can also join our`,` `,_(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/rsshub`,children:`Telegram group`}),`, or follow our`,` `,_(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:`Telegram channel`}),` `,`and`,` `,_(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:`Twitter`}),` `,`to get community support and news.`]}),v(`p`,{children:[`你也可以加入我们的`,` `,_(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/rsshub`,children:`Telegram 群组`}),`，或关注我们的`,` `,_(`a`,{className:`text-[#F5712C]`,target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:`Telegram 频道`}),`和`,` `,_(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:`Twitter`}),` `,`获取社区支持和新闻。`]})]})]})]}),v(`div`,{className:`mt-4 pb-8 text-center w-full text-sm font-medium space-y-2`,children:[v(`p`,{className:`space-x-4`,children:[_(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/github/_/fff`,alt:`github`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://t.me/rsshub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram group`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram channel`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:_(`img`,{className:`inline`,src:`https://icons.ly/x`,alt:`X`,width:`20`,height:`20`})})]}),v(`p`,{className:`!mt-6`,children:[`Please consider`,` `,_(`a`,{target:`_blank`,href:`https://docs.rsshub.app/sponsor`,className:`text-[#F5712C]`,children:`sponsoring`}),` `,`to help keep this open source project alive.`]}),v(`p`,{children:[`Made with ❤️ by`,` `,_(`a`,{target:`_blank`,href:`https://diygod.cc`,className:`text-[#F5712C]`,children:`DIYgod`}),` `,`and`,` `,_(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub/graphs/contributors`,className:`text-[#F5712C]`,children:`Contributors`}),` `,`under MIT License.`]})]})]});var Pt=Nt;const Ft=(n,r)=>{let i=r.req.path,a=b(r),o=a!==`/*`,s=M();try{r.res.headers.get(`RSSHub-Cache-Status`)&&s.hitCache++}catch{}s.error++,s.errorPaths[i]||(s.errorPaths[i]=0),s.errorPaths[i]++,!s.errorRoutes[a]&&o&&(s.errorRoutes[a]=0),o&&s.errorRoutes[a]++,N(s),e.sentry.dsn&&y.withScope(e=>{e.setTag(`name`,i.split(`/`)[1]),y.captureException(n)});let c=(process.env.NODE_ENV||process.env.VERCEL_ENV)===`production`?n.message:n.stack||n.message;switch(n.constructor.name){case`HTTPError`:case`RequestError`:case`FetchError`:r.status(503);break;case`RequestInProgressError`:r.header(`Cache-Control`,`public, max-age=${e.requestTimeout/1e3}`),r.status(503);break;case`RejectError`:r.status(403);break;case`NotFoundError`:r.status(404),c+=`The route does not exist or has been deleted.`;break;default:r.status(503);break}let l=`${n.name}: ${c}`;return t.error(`Error in ${i}: ${l}`),Xe.error({path:a,method:r.req.method,status:r.res.status}),e.isPackage||r.req.query(`format`)===`json`?r.json({error:{message:n.message??n}}):r.html(_(Pt,{requestPath:i,message:l,errorRoute:o?a:i,nodeVersion:process.version}))},It=e=>Ft(new ie,e),Lt=Date.now(),Rt=({debugQuery:t})=>{let n=M(),r=!e.debugInfo||e.debugInfo===`false`?!1:e.debugInfo===`true`||e.debugInfo===t,{disallowRobot:i,nodeName:a,cache:o}=e,s=Date.now()-Lt,c={showDebug:r,disallowRobot:i,debug:[...a?[{name:`Node Name`,value:a}]:[],...U?[{name:`Git Hash`,value:_(`a`,{className:`underline`,href:`https://github.com/DIYgod/RSSHub/commit/${U}`,children:U})}]:[],...W?[{name:`Git Date`,value:W.toUTCString()}]:[],{name:`Cache Duration`,value:o.routeExpire+`s`},{name:`Request Amount`,value:n.request},{name:`Request Frequency`,value:(n.request/(s/1e3)*60).toFixed(3)+` times/minute`},{name:`Cache Hit Ratio`,value:n.request?(n.hitCache/n.request*100).toFixed(2)+`%`:0},{name:`ETag Matched Ratio`,value:n.request?(n.etag/n.request*100).toFixed(2)+`%`:0},{name:`Health`,value:n.request?((1-n.error/n.request)*100).toFixed(2)+`%`:0},{name:`Uptime`,value:(s/36e5).toFixed(2)+` hour(s)`},{name:`Hot Routes`,value:Object.keys(n.routes).sort((e,t)=>n.routes[t]-n.routes[e]).slice(0,30).map(e=>v(g,{children:[n.routes[e],` `,e,_(`br`,{})]}))},{name:`Hot Paths`,value:Object.keys(n.paths).sort((e,t)=>n.paths[t]-n.paths[e]).slice(0,30).map(e=>v(g,{children:[n.paths[e],` `,e,_(`br`,{})]}))},{name:`Hot Error Routes`,value:Object.keys(n.errorRoutes).sort((e,t)=>n.errorRoutes[t]-n.errorRoutes[e]).slice(0,30).map(e=>v(g,{children:[n.errorRoutes[e],` `,e,_(`br`,{})]}))},{name:`Hot Error Paths`,value:Object.keys(n.errorPaths).sort((e,t)=>n.errorPaths[t]-n.errorPaths[e]).slice(0,30).map(e=>v(g,{children:[n.errorPaths[e],` `,e,_(`br`,{})]}))}]};return v(Mt,{children:[_(`div`,{className:`pointer-events-none absolute w-full min-h-screen`,style:{backgroundImage:`url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAzMiAzMicgd2lkdGg9JzMyJyBoZWlnaHQ9JzMyJyBmaWxsPSdub25lJyBzdHJva2U9J3JnYigxNSAyMyA0MiAvIDAuMDQpJz48cGF0aCBkPSdNMCAuNUgzMS41VjMyJy8+PC9zdmc+')`,maskImage:`linear-gradient(transparent, black, transparent)`}}),v(`div`,{className:`w-full grow shrink-0 py-8 flex items-center justify-center flex-col space-y-4`,children:[_(`img`,{src:`./logo.png`,alt:`RSSHub`,width:`100`,loading:`lazy`}),v(`h1`,{className:`text-4xl font-bold`,children:[`Welcome to `,_(`span`,{className:`text-[#F5712C]`,children:`RSSHub`}),`!`]}),_(`p`,{className:`text-xl font-medium text-zinc-600`,children:`The world's largest RSS Network.`}),_(`p`,{className:`text-zinc-500`,children:`If you see this page, the RSSHub is successfully installed and working.`}),v(`div`,{className:`font-bold space-x-4 text-sm`,children:[_(`a`,{target:`_blank`,href:`https://docs.rsshub.app`,children:_(`button`,{className:`text-white bg-[#F5712C] hover:bg-[#DD4A15] py-2 px-4 rounded-full transition-colors`,children:`Home`})}),_(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:_(`button`,{className:`bg-zinc-200 hover:bg-zinc-300 py-2 px-4 rounded-full transition-colors`,children:`GitHub`})})]}),c.showDebug?v(`details`,{className:`text-xs w-96 !mt-8 max-h-[400px] overflow-auto`,children:[_(`summary`,{className:`text-sm cursor-pointer`,children:`Debug Info`}),c.debug.map(e=>v(`div`,{class:`debug-item my-3 pl-8`,children:[v(`span`,{class:`debug-key w-32 text-right inline-block mr-2`,children:[e.name,`: `]}),_(`span`,{class:`debug-value inline-block break-all align-top`,children:e.value})]}))]}):null]}),v(`div`,{className:`text-center pt-4 pb-8 w-full text-sm font-medium space-y-2`,children:[v(`p`,{className:`space-x-4`,children:[_(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/github/_/fff`,alt:`github`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://t.me/rsshub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram group`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://t.me/awesomeRSSHub`,children:_(`img`,{className:`inline`,src:`https://icons.ly/telegram`,alt:`telegram channel`,width:`20`,height:`20`})}),_(`a`,{target:`_blank`,href:`https://x.com/intent/follow?screen_name=_RSSHub`,className:`text-[#F5712C]`,children:_(`img`,{className:`inline`,src:`https://icons.ly/x`,alt:`X`,width:`20`,height:`20`})})]}),v(`p`,{className:`!mt-6`,children:[`Please consider`,` `,_(`a`,{target:`_blank`,href:`https://docs.rsshub.app/sponsor`,className:`text-[#F5712C]`,children:`sponsoring`}),` `,`to help keep this open source project alive.`]}),v(`p`,{children:[`Made with ❤️ by`,` `,_(`a`,{target:`_blank`,href:`https://diygod.cc`,className:`text-[#F5712C]`,children:`DIYgod`}),` `,`and`,` `,_(`a`,{target:`_blank`,href:`https://github.com/DIYgod/RSSHub/graphs/contributors`,className:`text-[#F5712C]`,children:`Contributors`}),` `,`under MIT License.`]})]})]})};var zt=Rt;const Bt=e=>(e.header(`Cache-Control`,`no-cache`),e.html(_(zt,{debugQuery:e.req.query(`debug`)})));var Vt=Bt;const Ht=e=>(e.header(`Cache-Control`,`no-cache`),e.text(`ok`));var Ut=Ht;const Wt=t=>e.disallowRobot?t.text(`User-agent: *
Disallow: /`):(t.status(404),t.text(``));var Gt=Wt;const Kt=e=>Ze().then(t=>e.text(t)).catch(t=>{e.status(500),e.json({error:t})});var qt=Kt;const Jt=import.meta.dirname;function Yt(e){return Object.values(e).every(e=>!e.features?.nsfw)}function Xt(e){let t={};for(let[n,r]of Object.entries(e))(r.routes===null||r.routes===void 0||Yt(r.routes))&&(t[n]=r);return t}let G={},K={};switch(process.env.NODE_ENV||process.env.VERCEL_ENV){case`production`:K=(await import(`./routes-DvnNAFSd.js`)).default;break;case`test`:K=await import(`./routes-BtD-BkPo.js`),K.default&&(K=K.default);break;default:G=Ne({targetDirectoryPath:ue.join(Jt,`./routes`),importPattern:/\.ts$/})}if(e.feature.disable_nsfw&&(K=Xt(K)),Object.keys(G).length)for(let e in G){let t=G[e],n=e.split(/[/\\]/)[1];if(`namespace`in t)K[n]=Object.assign({routes:{}},K[n],t.namespace);else if(`route`in t)if(K[n]||(K[n]={name:n,routes:{},apiRoutes:{}}),Array.isArray(t.route.path))for(let r of t.route.path)K[n].routes[r]={...t.route,location:e.split(/[/\\]/).slice(2).join(`/`)};else K[n].routes[t.route.path]={...t.route,location:e.split(/[/\\]/).slice(2).join(`/`)};else if(`apiRoute`in t)if(K[n]||(K[n]={name:n,routes:{},apiRoutes:{}}),Array.isArray(t.apiRoute.path))for(let r of t.apiRoute.path)K[n].apiRoutes[r]={...t.apiRoute,location:e.split(/[/\\]/).slice(2).join(`/`)};else K[n].apiRoutes[t.apiRoute.path]={...t.apiRoute,location:e.split(/[/\\]/).slice(2).join(`/`)}}const q=new pe,Zt=e=>Object.entries(e).sort(([e],[t])=>{let n=e.split(`/`),r=t.split(`/`),i=n.length,a=r.length,o=Math.min(i,a);for(let e=0;e<o;e++){let t=n[e],i=r[e];if(t.startsWith(`:`)!==i.startsWith(`:`))return t.startsWith(`:`)?1:-1}return 0});for(let e in K){let n=q.basePath(`/${e}`),r=K[e];if(!r||!r.routes)continue;let i=Zt(r.routes);for(let[r,a]of i){let i=async n=>{if(t.debug(`Matched route: ${b(n)}`),!n.get(`data`)){if(typeof a.handler!=`function`){if(process.env.NODE_ENV===`test`){let{route:t}=await import(`./routes/${e}/${a.location}`);a.handler=t.handler}else if(a.module){let{route:e}=await a.module();a.handler=e.handler}}n.set(`data`,await a.handler(n))}};n.get(r,i)}}for(let e in K){let t=q.basePath(`/api/${e}`),n=K[e];if(!n||!n.apiRoutes)continue;let r=Object.entries(n.apiRoutes);for(let[n,i]of r){let r=async t=>{if(!t.get(`apiData`)){if(typeof i.handler!=`function`){if(process.env.NODE_ENV===`test`){let{apiRoute:t}=await import(`./routes/${e}/${i.location}`);i.handler=t.handler}else if(i.module){let{apiRoute:e}=await i.module();i.handler=e.handler}}let n=await i.handler(t);t.set(`apiData`,n)}};t.get(n,r)}}q.get(`/`,Vt),q.get(`/healthz`,Ut),q.get(`/robots.txt`,Gt),e.debugInfo&&q.get(`/metrics`,qt),q.use(`/*`,Pe({root:ue.join(Jt,`assets`),rewriteRequestPath:e=>e===`/favicon.ico`?`/favicon.png`:e}));var Qt=q;const $t=T({method:`get`,path:`/namespace`,tags:[`Namespace`],responses:{200:{description:`Information about all namespaces`}}}),en=e=>e.json(K),tn=E.object({namespace:E.string().openapi({param:{name:`namespace`,in:`path`},example:`github`})}),nn=T({method:`get`,path:`/namespace/{namespace}`,tags:[`Namespace`],request:{params:tn},responses:{200:{description:`Information about a namespace`}}}),rn=e=>{let{namespace:t}=e.req.valid(`param`);return e.json(K[t])},J={};for(let e in K)for(let t in K[e].routes){let n=`/${e}${t}`,r=K[e].routes[t];if(r.radar?.length)for(let t of r.radar){let i=D(new URL(`https://`+t.source[0]).hostname),a=i.subdomain||`.`,o=i.domain;o&&(J[o]||(J[o]={_name:K[e].name}),J[o][a]||(J[o][a]=[]),J[o][a].push({title:t.title||r.name,docs:`https://docs.rsshub.app/routes/${r.categories?.[0]||`other`}`,source:t.source.map(e=>{let t=new URL(`https://`+e);return t.pathname+t.search+t.hash}),target:t.target?`/${e}${t.target}`:n}))}}const an=T({method:`get`,path:`/radar/rules`,tags:[`Radar`],responses:{200:{description:`All Radar rules`}}}),on=e=>e.json(J),Y={};for(let e in K)for(let t in K[e].routes){let n=`/${e}${t}`,r=K[e].routes[t];if(r.radar?.length)for(let t of r.radar){let i=D(new URL(`https://`+t.source[0]).hostname),a=i.subdomain||`.`,o=i.domain;o&&(Y[o]||(Y[o]={_name:K[e].name}),Y[o][a]||(Y[o][a]=[]),Y[o][a].push({title:t.title||r.name,docs:`https://docs.rsshub.app/routes/${r.categories?.[0]||`other`}`,source:t.source.map(e=>{let t=new URL(`https://`+e);return t.pathname+t.search+t.hash}),target:t.target?`/${e}${t.target}`:n}))}}const sn=E.object({domain:E.string().openapi({param:{name:`domain`,in:`path`},example:`github.com`})}),cn=T({method:`get`,path:`/radar/rules/{domain}`,tags:[`Radar`],request:{params:sn},responses:{200:{description:`Radar rules for a domain name (does not support subdomains)`}}}),ln=e=>{let{domain:t}=e.req.valid(`param`);return e.json(Y[t])},X={};for(let e in K)for(let t in K[e].routes)if(K[e].routes[t].categories?.length)for(let n of K[e].routes[t].categories)X[n]||(X[n]={}),X[n][e]||(X[n][e]={...K[e],routes:{}}),X[n][e].routes[t]=K[e].routes[t];const un=E.object({category:E.string().openapi({param:{name:`category`,in:`path`},example:`popular`})}),dn=E.object({categories:E.string().transform(e=>e.split(`,`)).optional(),lang:E.string().optional()}),fn=T({method:`get`,path:`/category/{category}`,tags:[`Category`],request:{query:dn,params:un},responses:{200:{description:`Namespace list by categories and language`}}}),pn=e=>{let{categories:t,lang:n}=e.req.valid(`query`),{category:r}=e.req.valid(`param`),i=[r];t&&t.length>0&&(i=[...i,...t]);let a=Object.keys(X[r]||{}).filter(e=>i.every(t=>X[t]?.[e])),o=Object.fromEntries(a.map(e=>[e,X[r][e]]));return n&&(o=Object.fromEntries(Object.entries(o).filter(([,e])=>e.lang===n))),e.json(o)},mn=T({method:`get`,path:`/follow/config`,tags:[`Follow`],responses:{200:{description:`Follow config`}}}),hn=t=>t.json({ownerUserId:e.follow.ownerUserId,description:e.follow.description,price:e.follow.price,userLimit:e.follow.userLimit,cacheTime:e.cache.routeExpire,gitHash:U,gitDate:W?.getTime()}),Z=new Fe;Z.openapi($t,en),Z.openapi(nn,rn),Z.openapi(an,on),Z.openapi(cn,ln),Z.openapi(fn,pn),Z.openapi(mn,hn);const Q=Z.getOpenAPI31Document({openapi:`3.1.0`,info:{version:`0.0.1`,title:`RSSHub API`}});for(let e in Q.paths)Q.paths[`/api${e}`]=Q.paths[e],delete Q.paths[e];Z.get(`/openapi.json`,e=>e.json(Q)),Z.get(`/reference`,Ie({content:Q}));var gn=Z;process.on(`uncaughtException`,e=>{t.error(`uncaughtException: `+e)});const $=new pe;$.use(je()),$.use(me()),$.use(Ae(({children:e})=>_(g,{children:e}),{docType:`<?xml version="1.0" encoding="UTF-8"?>`,stream:{}})),$.use(rt),$.use(jt),$.use(ut),$.use(pt),$.use(gt),$.use(ct),$.use(yt),$.use(Et),$.use(kt),$.use(ot),$.route(`/`,Qt),$.route(`/api`,gn),$.notFound(It),$.onError(Ft);var _n=$;export{_n as default};