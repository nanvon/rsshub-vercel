import"./esm-shims-L08rKynx.mjs";import"./config-L8Ls2W7q.mjs";import{t as e}from"./logger-C50fTRi5.mjs";import{t}from"./ofetch-DXVwJZV0.mjs";import"./helpers-mo8InLYm.mjs";import{t as n}from"./cache-ZTWfXd2T.mjs";import{t as r}from"./parse-date-bKmkZ9gg.mjs";import{t as i}from"./md5-C60PKNTZ.mjs";import{t as a}from"./got-D6JCV29k.mjs";import{load as o}from"cheerio";const s=()=>n.tryGet(`51cto:token`,async()=>(await t(`https://api-media.51cto.com/api/token-get`)).data.data.token,3600,!1),c=(e,t={},n,r)=>{t.timestamp=n,t.token=r;let a=Object.keys(t).toSorted();return i(i(e)+i(a+i(r)+n))},l={path:`/index/recommend`,categories:[`programming`],example:`/51cto/index/recommend`,radar:[{source:[`51cto.com/`]}],name:`推荐`,maintainers:[`cnkmmk`,`ovo-tim`],handler:f,url:`51cto.com/`},u=/'(WTKkN|bOYDu|wyeCN)':\s*(\d+)/g;async function d(n,i=``){let a=null,s=await t(n.url,{headers:{cookie:i}}),c=o(s);if(a=new URL(n.url).host===`ost.51cto.com`?c(`.posts-content`).html():c(`article`).html(),!a&&i===``)try{let[e,t,r]=s.match(u).slice(0,3).map(e=>Number(e.split(`:`)[1]));return await d(n,`__tst_status=`+(e+t+r)+`#;`)}catch(t){e.error(t)}return{title:n.title,link:n.url,pubDate:r(n.pubdate,8),description:a||n.abstract}}async function f(e){let t=`index/index/recommend`,r=await s(),i=Date.now(),o={page:1,page_size:e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,limit_time:0,name_en:``},l=(await a(`https://api-media.51cto.com/${t}`,{searchParams:{...o,timestamp:i,token:r,sign:c(t,o,i,r)}})).data.data.data.list;return{title:`51CTO`,link:`https://www.51cto.com/`,description:`51cto - 推荐`,item:await Promise.all(l.map(e=>n.tryGet(e.url,async()=>await d(e))))}}export{l as route};