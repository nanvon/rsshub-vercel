import"./esm-shims-BC3isTv8.js";import{t as e}from"./config-DZMnNPig.js";import{t}from"./logger-asV68Lay.js";import"./proxy-CczVputb.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./invalid-parameter-CLGd_tte.js";import{n as o}from"./puppeteer-e0F06Yyi.js";import{n as s,t as c}from"./readable-social-B6qUgh2x.js";import{i as l,n as u,r as d,t as f}from"./utils-DmpfHzNl.js";const p={path:`/user/:uid/:routeParams?`,categories:[`social-media`],example:`/douyin/user/MS4wLjABAAAARcAHmmF9mAG3JEixq_CdP72APhBlGlLVbN-1eBcPqao`,parameters:{uid:`uid，可在用户页面 URL 中找到`,routeParams:`额外参数，query string 格式，请参阅上面的表格`},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`douyin.com/user/:uid`],target:`/user/:uid`}],name:`博主`,maintainers:[`Max-Tortoise`,`Rongronggg9`],handler:m};async function m(p){let m=p.req.param(`uid`);if(!m.startsWith(`MS4wLjABAAAA`))throw new a(`Invalid UID. UID should start with <b>MS4wLjABAAAA</b>.`);let h=Object.fromEntries(new URLSearchParams(p.req.param(`routeParams`))),g=c(void 0,s(h.embed),!1),_=c(void 0,s(h.iframe),!1),v=d(h.relay,!0,!0),y=`https://www.douyin.com/user/${m}`,b=await n.tryGet(`douyin:user:${m}`,async()=>{let e,n=await o(),r=await n.newPage();if(await r.setRequestInterception(!0),r.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),r.on(`response`,async t=>{t.request().url().includes(`/web/aweme/post`)&&!e&&(e=await t.json())}),t.http(`Requesting ${y}`),await r.goto(y,{waitUntil:`networkidle2`}),await n.close(),!e)throw Error(`Empty post data. The request may be filtered by WAF.`);return e},e.cache.routeExpire,!1);if(!b.aweme_list?.length)throw Error(`Empty post data. The request may be filtered by WAF.`);let x=b.aweme_list[0].author;return{title:x.nickname,image:f(x.avatar_thumb.url_list.at(-1)),link:y,item:b.aweme_list.map(e=>{let t=e.video?.bit_rate?.map(e=>d(e.play_addr.url_list.at(-1)));v&&(t=t.map(e=>u(e,v)));let n=e.video?.duration;n&&=n/1e3;let a;a=a||e.video?.cover?.url_list.at(-1)||e.video?.origin_cover?.url_list.at(-1),a&&=d(a);let o=e.desc?.replaceAll(`
`,`<br>`),s=r(g&&t?l.embed:l.cover,{img:a,videoList:t,duration:n});s=g&&t&&_?r(l.iframe,{content:s}):s;let c=r(l.desc,{desc:o,media:s});return{title:e.desc.split(`
`)[0],description:c,link:`https://www.douyin.com/video/${e.aweme_id}`,pubDate:i(e.create_time*1e3),category:e.video_tag.map(e=>e.tag_name)}})}}export{p as route};