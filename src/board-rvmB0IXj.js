import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-Bbb0mfHh.js";import{cache_default as t}from"./cache-DNP0KCHb.js";import"./parse-date-Bgabdhlb.js";import{rofetch as n}from"./ofetch-Dnmc-sKl.js";import{generateNonce as r,getPost as i,phoneBaseUrl as a,sign as o,webBaseUrl as s}from"./utils-DelUmbaa.js";const c={path:`/bbs/board/:boardId`,categories:[`bbs`],example:`/dxy/bbs/board/46`,parameters:{specialId:`板块 ID，可在对应板块页 URL 中找到`},name:`板块`,maintainers:[`TonyRL`],radar:[{source:[`www.dxy.cn/bbs/newweb/pc/category/:boardIdId`],target:`/bbs/board/:boardIdId`},{source:[`3g.dxy.cn/bbs/board/:boardIdId`],target:`/bbs/board/:boardIdId`}],handler:l};async function l(c){let{boardId:l}=c.req.param(),{limit:u=`20`}=c.req.query(),d=await t.tryGet(`dxy:board:detail:${l}`,async()=>{let e={boardId:l,timestamp:Date.now(),noncestr:r(8,`number`)},t=await n(`${a}/bbsapi/bbs/board/detail`,{query:{...e,sign:o(e)}});if(t.code!==`success`)throw Error(t.message);return t.data}),f=await t.tryGet(`dxy:board:list:${l}`,async()=>{let e={boardId:l,postType:`0`,orderType:`1`,pageNum:`1`,pageSize:u,timestamp:Date.now(),noncestr:r(8,`number`)},t=await n(`${a}/bbsapi/bbs/board/post/list`,{query:{...e,sign:o(e)}});if(t.code!==`success`)throw Error(t.message);return t.data},e.cache.routeExpire,!1),p=f.result.map(e=>({title:e.subject,author:e.postUser.nickname,category:[d.title],link:`${s}/bbs/newweb/pc/post/${e.postId}`,postId:e.postId})),m=await Promise.all(p.map(e=>i(e,t.tryGet)));return{title:d.title,description:`${d.postCount} 內容 ${d.followCount} 关注`,link:`${s}/bbs/newweb/pc/category/${l}`,image:d.boardAvatar,item:m}}export{c as route};