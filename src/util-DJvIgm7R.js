import{__dirname as e,init_esm_shims as t}from"./esm-shims-2LyWUseo.js";import{ofetch_default as n}from"./ofetch-BLnIkXRv.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import o from"node:path";import{load as s}from"cheerio";t();const c=`https://www.tmtpost.com`,l=`https://api.tmtpost.com`,u=new URL(`v1/posts/`,l).href,d={"app-version":`web1.0`},f=async(t,l,f,p)=>{let m=await n(f,{query:{limit:t,...l},headers:d}),h=await n(p),g=s(h),_=g(`html`).attr(`lang`)??`zh-CN`,v=[];v=m.data.slice(0,t).map(t=>{let n=t.title,r=i(o.join(e,`templates/description-ca64252b.art`),{intro:t.summary}),s=t.time_published,c=t.share_link,l=t.guid,u=t.thumb_image?.original?.url,d=t.updated??s;return{title:n,description:r,pubDate:s?a(s,`X`):void 0,link:c,guid:l,id:l,content:{html:r,text:t.content??r},image:u,banner:u,updated:d?a(d,`X`):void 0,language:_}}),v=(await Promise.all(v.map(t=>t.link?r.tryGet(t.link,async()=>{let r=new URL(t.guid,u).href,s=(await n(r,{query:{fields:[`authors`,`tags`,`featured_image`,`categories`,`stock_list`,`big_plate`,`concept_plate`,`plate`,`plate_list`,`share_link`].join(`;`)},headers:d})).data;if(!s)return t;let l=s.title,f=i(o.join(e,`templates/description-ca64252b.art`),{intro:s.summary,description:s.main}),p=s.time_published,m=s.share_link,h=[...new Set([...s.categories??[],...s.stock_list??[],...s.big_plate??[],...s.concept_plate??[],...s.plate??[],...s.plate_list??[],...s.tags??[]].map(e=>e.title??e.name??e.tag).filter(Boolean))],g=s.authors?.map(e=>({name:e.username,url:new URL(`user/${e.guid}`,c).href,avatar:e.avatar})),v=`tmtpost-${s.post_guid}`,y=s.images?.[0]?.url,b=s.time_updated,x={title:l,description:f,pubDate:p?a(p,`X`):void 0,link:m??t.link,category:h,author:g,guid:v,id:v,content:{html:f,text:f},image:y,banner:y,updated:b?a(b,`X`):void 0,language:_},S=s.audio;if(S){let e=`audio/${S.split(/\./).pop()}`,t=s.duration;x={...x,enclosure_url:S,enclosure_type:e,enclosure_title:l,enclosure_length:void 0,itunes_duration:t,itunes_item_image:y}}let C={};if(s.full_size_images??s.images){let e=s.full_size_images??s.images;for(let t of e){let e=t.url??t;if(!e)continue;let n=`image`,r=Object.values(C).filter(e=>e.medium===n).length+1,i=`${n}${r}`;C[i]={url:e,medium:n,title:l,thumbnail:t.thumbnail??e}}}return x={...x,media:C},{...t,...x}}):t))).filter(e=>!0);let y=g(`title`).text(),b=y.split(/-/).pop();return{title:y,description:g(`meta[property="og:description"]`).attr(`content`),link:p,item:v,allowEmpty:!0,image:g(`meta[property="og:image"]`).attr(`content`),author:y.split(/-/).pop(),language:_,itunes_author:b,itunes_category:`Technology`,id:p}};export{l as apiBaseUrl,c as baseUrl,f as processItems};