import{__dirname as e,init_esm_shims as t}from"./esm-shims-DE2PJqdr.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as n}from"./ofetch-CJF2SF6b.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{timezone as o}from"./timezone-CMz5pnRe.js";import{ViewType as s}from"./types-Bi82qguM.js";import c from"node:path";import{load as l}from"cheerio";t();const u=async t=>{let{id:s=`datalist`}=t.req.param(),u=Number.parseInt(t.req.query(`limit`)??`30`,10),d=new URL(s.endsWith(`/`)?s:`${s}/`,`http://www.fangchan.com`).href,f=new URL(`api/${s.endsWith(`/`)?s.replace(/\/$/,``):s}.json`,`http://news.fangchan.com`).href,p=await n(d),m=l(p),h=m(`html`).attr(`lang`)??`zh-CN`,g=await n(f,{query:{pagesize:u,page:1}}),_=[];_=g.data.slice(0,u).map(t=>{let n=t.title,r=i(c.join(e,`templates/description-ca64252b.art`),{intro:t.zhaiyao}),o=t.createtime,s=t.url,l=[...new Set([t.topcolumn,t.subcolumn,...t.keyword?.split(/,/)??[]].filter(Boolean))],u=t.pic,d=t.createtime;return{title:n,description:r,pubDate:o?a(o,`X`):void 0,link:s,id:l,content:{html:r,text:t.zhaiyao??r},image:u,banner:u,updated:d?a(d,`X`):void 0,language:h}}),_=(await Promise.all(_.map(e=>e.link?r.tryGet(e.link,async()=>{let t=await n(e.link),r=l(t),i=r(`div.summary-text h`).text(),s=(e.description??``)+(r(`div.top-info`).html()??``)+(r(`div.summary-text-p`).html()??``),c=r(`span.news-date`).text().match(/\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/)?.[1],u=r(`a.news-column, div.label span`).toArray(),d=[...new Set([...e.id,...u.map(e=>r(e).text()).filter(Boolean)].filter(Boolean))],f=r(`span.news-date`).text()?.split(/\d{4}-\d{2}-\d{2}/)?.[0]?.trim()?.split(/\s/)?.map(e=>({name:e})),p=c,m={title:i,description:s,pubDate:c?o(a(c),8):e.pubDate,id:d,author:f,content:{html:s,text:s},updated:p?o(a(p),8):e.updated,language:h},g=r(`ul.xgxw-ul li a`).toArray().map(e=>{let t=r(e);return{url:t.attr(`href`),type:`related`,content_html:t.text()}}).filter(e=>!0);return g&&(m={...m,_extra:{links:g}}),{...e,...m}}):e))).filter(e=>!0);let v=`中房网`;return{title:`${v} - ${m(`div.curmbs a`).text()}`,description:m(`meta[name="description"]`).attr(`content`),link:d,item:_,allowEmpty:!0,author:v,language:h}},d={path:`/list/:id?`,name:`列表`,url:`www.fangchan.com`,maintainers:[`nczitzk`],handler:u,example:`/fangchan/list/datalist`,parameters:{id:{description:"分类，默认为 `datalist`，即数据研究，可在对应分类页 URL 中找到",options:[{label:`数据研究`,value:`datalist`},{label:`行业测评`,value:`industrylist`},{label:`政策法规`,value:`policylist`}]}},description:":::tip\n若订阅 [列表](https://www.fangchan.com/)，网址为 `https://www.fangchan.com/`，请截取 `https://www.fangchan.com/` 到末尾 `.html` 的部分 `datalist` 作为 `id` 参数填入，此时目标路由为 [`/fangchan/datalist`](https://rsshub.app/fangchan/datalist)。\n:::\n\n| [数据研究](https://www.fangchan.com/datalist)         | [行业测评](https://www.fangchan.com/industrylist)             | [政策法规](https://www.fangchan.com/policylist)           |\n| ----------------------------------------------------- | ------------------------------------------------------------- | --------------------------------------------------------- |\n| [datalist](https://rsshub.app/fangchan/list/datalist) | [industrylist](https://rsshub.app/fangchan/list/industrylist) | [policylist](https://rsshub.app/fangchan/list/policylist) |\n",categories:[`new-media`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.fangchan.com/:id`],target:e=>{let t=e.id;return`/fangchan/list/${t?`/${t}`:``}`}},{title:`数据研究`,source:[`www.fangchan.com/datalist`],target:`/list/datalist`},{title:`行业测评`,source:[`www.fangchan.com/industrylist`],target:`/list/industrylist`},{title:`政策法规`,source:[`www.fangchan.com/policylist`],target:`/list/policylist`}],view:s.Articles};export{u as handler,d as route};