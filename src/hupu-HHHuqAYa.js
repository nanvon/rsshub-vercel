import"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as e}from"./cache-CpEhLexq.js";import{n as t,t as n}from"./parse-date-CHEO0z5G.js";import{t as r}from"./got-BlqYKpVp.js";import{t as i}from"./timezone-BPfwRbwD.js";import{load as a}from"cheerio";function o(e){return`url`in e&&`isNews`in e}const s={nba:{title:`NBA`,data:`newsData`},cba:{title:`CBA`,data:`newsData`},soccer:{title:`足球`,data:`news`},"":{title:`首页`,data:`res`}},c={path:[`/dept/:category?`,`/:category?`],name:`手机虎扑网`,url:`m.hupu.com`,maintainers:[`nczitzk`,`hyoban`],example:`/hupu/nba`,parameters:{category:{description:`分类，可选值：nba、cba、soccer，默认为空（首页）`,default:``,options:Object.entries(s).map(([e,t])=>({label:t.title,value:e}))}},description:`::: tip
电竞分类参见 [游戏热帖](https://bbs.hupu.com/all-gg) 的对应路由 [\`/hupu/all/all-gg\`](https://rsshub.app/hupu/all/all-gg)。
:::`,categories:[`bbs`],radar:[{source:[`m.hupu.com/:category`,`m.hupu.com/`],target:`/:category`}],handler:async c=>{let l=c.req.param(`category`)||``;if(!(l in s))throw Error(`Invalid category. Valid options are: `+Object.keys(s).filter(Boolean).join(`, `));let u=l,d=`https://m.hupu.com/${u}`,f=(await r({method:`get`,url:d})).data.match(/<script id="__NEXT_DATA__" type="application\/json">(.*?)<\/script>/);if(!f||!f[1])throw Error(`Failed to find __NEXT_DATA__ script tag in page: ${d}`);let p=f[1],m;try{m=JSON.parse(p)}catch(e){throw Error(`Failed to parse full JSON data: ${e instanceof Error?e.message:String(e)}`)}let{pageProps:h}=m.props,g=s[u].data;if(!(g in h))throw Error(`Expected '${g}' property not found in pageProps for category: ${u||`home`}`);let _=(()=>{let e=h[g];return Array.isArray(e)?e:[]})().map(e=>o(e)?{title:e.title,link:e.url.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid,category:e.label?[e.label]:void 0}:{title:e.title,pubDate:i(n(e.publishTime),8),link:e.link.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid});return _=await Promise.all(_.filter(e=>e.link&&!/subject/.test(e.link)).map(o=>e.tryGet(o.link,async()=>{try{let e=a((await r({method:`get`,url:o.link})).data),s=e(`.bbs-user-info-name, .bbs-user-wrapper-content-name-span`).text(),c=e(`.second-line-user-info span:not([class])`).text(),l=new Date().getFullYear(),u=new Date,d=/^(\d{2})-(\d{2}) (\d{2}):(\d{2})$/,f=/^(\d{1,2}):(\d{2})$/,p=c;d.test(c)?p=`${l}-${c}`:f.test(c)&&(p=`${l}-${String(u.getMonth()+1).padStart(2,`0`)}-${String(u.getDate()).padStart(2,`0`)} ${c}`);let m=[o.pubDate,i(n(p),8),i(t(c),8)].find(e=>e instanceof Date&&!Number.isNaN(e.getTime())),h=e(`.basketballTobbs_tag > a, .tag-player-team`).toArray().map(t=>e(t).text()).filter(Boolean);e(`.basketballTobbs_tag`).remove(),e(`.hupu-img`).each(function(){let t=e(this).attr(`data-gif`)||e(this).attr(`data-origin`)||e(this).attr(`src`);e(this).parent().html(`<img src="${t}">`)});let g=[],_=e(`#bbs-thread-content, .bbs-content-font`).html();_&&g.push(_);let v=e(`.header-video-wrapper`);if(v.length>0){let e=v.find(`video`);if(e.length>0){let t=e.prop(`outerHTML`);t&&g.push(t)}}let y=g.length>0?g.join(``):void 0;return{...o,author:s,category:h.length>0?h:o.category,description:y,pubDate:m}}catch{return o}}))),{title:`虎扑 - ${s[u].title}`,link:d,item:_}}};export{c as route};