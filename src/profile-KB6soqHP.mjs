import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import{t as n}from"./ofetch-BRplXtiZ.mjs";import{t as r}from"./config-D7dgKYF5.mjs";import"./logger-CkUWGGaS.mjs";import"./proxy-DbO2Yx6a.mjs";import{t as i}from"./not-found-C-Horq2w.mjs";import{t as a}from"./cache-Bv3_kFbE.mjs";import{t as o}from"./render-CSqLtqb8.mjs";import{t as s}from"./puppeteer-CDBgt5OZ.mjs";import c from"node:path";import{load as l}from"cheerio";e();const u={path:`/profile/:id/:type?/:functionalFlag?`,categories:[`social-media`],example:`/picuki/profile/linustech`,parameters:{id:`Tiktok user id (without @)`,type:{description:`Type of profile page`,options:[{value:`profile`,label:`Profile Page`},{value:`story`,label:`Story Page`}],default:`profile`},functionalFlag:{description:`Functional flag for video embedding`,options:[{value:`0`,label:`Off, only show video poster as an image`},{value:`1`,label:`On`}],default:`1`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.picuki.com/profile/:id`],target:`/profile/:id`},{source:[`www.picuki.com/story/:id`],target:`/profile/:id/story`}],name:`User Profile - Picuki`,maintainers:[`hoilc`,`Rongronggg9`,`devinmugen`,`NekoAria`],handler:d};async function d(e){let u=e.req.param(`id`),d=e.req.param(`type`)??`profile`,f=(e.req.param(`functionalFlag`)??`1`)!==`0`,p=`https://www.picuki.com`,m=`${p}/${d===`story`?`story`:`profile`}/${u}`,h=await a.tryGet(`picuki:${d}:${u}`,async()=>{let e;try{e=await n(m,{headers:{"User-Agent":r.trueUA}})}catch(t){if(t.status===403){let{page:t,destory:n}=await s(m,{onBeforeLoad:async e=>{let t=new Set([`document`,`script`,`xhr`,`fetch`]);await e.setRequestInterception(!0),e.on(`request`,e=>{t.has(e.resourceType())?e.continue():e.abort()})}});await t.waitForSelector(`.content`),e=await t.content(),await n()}else throw new i(t.message)}let t=l(e);if(t(`.posts-empty`).length)throw Error(t(`.posts-empty`).text().trim()||`No posts found`);if(t(`.error-p`).length)throw Error(t(`.error-p span`).text().trim()||`Profile not found`);let a=t(`.profile-info .username`).text().trim(),o=t(`.posts-video .posts__video-item`).toArray().map(e=>{let n=t(e),r=n.attr(`href`)?.split(`/`).pop(),i=n.find(`img`);return{title:i.attr(`alt`)||``,author:a,renderData:{poster:i.attr(`src`),source:n.find(`.popup-open`).data(`source`),id:r},link:`${p}/media/${r}`,guid:`https://www.tiktok.com/@${u}/video/${r}`}});return{title:t(`head title`).text(),description:t(`.posts-current`).text().trim(),image:t(`.profile-image`).attr(`src`),items:o}}),g=h.items.map(e=>({...e,description:o(c.join(t,`templates/user-3df0b995.art`),{poster:e.renderData.poster,source:e.renderData.source,useIframe:f,id:e.renderData.id})}));return{title:h.title,link:m,image:h.image,description:h.description,item:g}}export{u as route};