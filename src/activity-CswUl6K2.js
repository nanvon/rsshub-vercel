import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./got-CgQXMNWI.js";import i from"node:path";import{load as a}from"cheerio";e();const o={path:`/activity/:city/:category/:subcategory/:keyword?`,categories:[`shopping`],example:`/damai/activity/上海/音乐会/全部/柴可夫斯基`,parameters:{city:"城市，如果不需要限制，请填入`全部`",category:"分类，如果不需要限制，请填入`全部`",subcategory:"子分类，如果不需要限制，请填入`全部`",keyword:`搜索关键字，置空为不限制`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`票务更新`,maintainers:[`hoilc`,`Konano`],handler:s,description:`城市、分类名、子分类名，请参见[大麦网搜索页面](https://search.damai.cn/search.htm)`};async function s(e){let o=e.req.param(`city`)===`全部`?``:e.req.param(`city`),s=e.req.param(`category`)===`全部`?``:e.req.param(`category`),c=e.req.param(`subcategory`)===`全部`?``:e.req.param(`subcategory`),l=e.req.param(`keyword`)??``,u=(await r(`https://search.damai.cn/searchajax.html`,{searchParams:{keyword:l,cty:o,ctl:s,sctl:c,tsg:0,st:``,et:``,order:3,pageSize:30,currPage:1,tn:``}})).data.pageData.resultData||[];return{title:`大麦网票务 - ${o||`全国`} - ${s||`全部分类`}${c?` - `+c:``}${l?` - `+l:``}`,link:`https://search.damai.cn/search.htm`,allowEmpty:!0,item:u.map(e=>({title:e.nameNoHtml,author:e.actors?a(e.actors,null,!1).text():`大麦网`,description:n(i.join(t,`templates/activity-eedb4947.art`),{item:e}),link:`https://detail.damai.cn/item.htm?id=${e.projectid}`}))}}export{o as route};