import"./esm-shims-CMsyBHYK.js";import{t as e}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t}from"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import"./render-d6AVTUl2.js";import{t as r}from"./got-BlqYKpVp.js";import{t as i}from"./types-Bn7An2Wc.js";import{t as a}from"./utils-D_SGcJEp.js";import o from"node:crypto";import{KJUR as s,hextob64 as c}from"jsrsasign";async function l(n){if(!e.caixin.cookie||!/(\d+)\.html/.test(n))return;let r=n.match(/(\d+)\.html/)[1],i=o.randomUUID().replaceAll(`-`,``).toUpperCase(),a=`id=${r}&uid=${e.caixin.cookie.split(`;`).find(e=>e.includes(`SA_USER_UID`))?.split(`=`)[1]}&${i}=nonce`,l=new s.crypto.Signature({alg:`SHA256withRSA`});l.init(`-----BEGIN PRIVATE KEY-----MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCLci8q2u3NGFyFlMUwjCP91PsvGjHdRAq9fmqZLxvue+n+RhzNxnKKYOv35pLgFKWXsGq2TV+5Xrv6xZgNx36IUkqbmrO+eCa8NFmti04wvMfG3DCNdKA7Lue880daNiK3BOhlQlZPykUXt1NftMNS/z+e70W+Vpv1ZxCx5BipqZkdoceM3uin0vUQmqmHqjxi5qKUuov90dXLaMxypCA0TDsIDnX8RPvPtqKff1p2TMW2a0XYe7CPYhRggaQMpmo0TcFutgrM1Vywyr2TPxYR+H/tpuuWRET7tUIQykBYoO1WKfL2dX6cxarjAJfnYnod3sMzppHouyp8Pt7gHVG7AgMBAAECggEAEFshSy6IrADKgWSUyH/3jMNZfwnchW6Ar/9O847CAPQJ2yhQIpa/Qpnhs58Y5S2myqcHrUBgFPcWp3BbyGn43naAh8XahWHEcVjWl/N6BV9vM1UKYN0oGikDR3dljCBDbCIoPBBO3WcFOaXoIpaqPmbwCG1aSdwQyPUA0UzG08eDbuHK6L5jvbe3xv5kLpWTVddrocW+SakbZRAX1Ykp7IujOce235nM7GOfoq4b8jmK5CLg6VIZGQV20wnn9YxuFOndRSjneFberzfzBMhVLpPsQ16M2xDLpZaDTggZnq2L6nZygds8Hda++ga3WbD3TcgjJNYuENu1S88IowYhSQKBgQDFqRA+38mo6KsxVDCNWcuEk2hSq8NEUzRHJpS7/QjZmEIYpFzDXgSGwhZJ0WNsQtaxJeBbc7B/OOqh8TL1reLl5AdTimS1OLHWVf/MUsLVS7Y82hx/hpYWxZnRSq41oI3P8FO/53FiQMYo2wbwqF6uQjB1y8h58aqL3OYpTH/5xQKBgQC0mobALJ+bU4nCPzkVDZuD6RyNWPwS1aE3+925wDSN2rJ0iLIb4N5czWZmHb66VlAtfGbp2q+amsCV4r6UR19A/y8k9SFB0mdtxix6mjEfaGhVJm4B1mkvsn0OHMAanKkohUvCjROQc3sziyp2gqSEQ98G7//VMPx/3dhgyQpVfwKBgQCycsqu6N0n+D6t/0MCKiJaI7bYhCd7JN8aqVM4UN5PjG2Hz8PLwbK2cr0qkbaAA+vN7NMb3Vtn0FvMLnUCZqVlRTP0EQqQrYmoZuXUcpdhd8QkNgnqe/g+wND4qcKTucquA1uo8mtj9/Su5+bhGDC6hBk6D+uDZFHDiX/loyIavQKBgQCXF6AcLjjpDZ52b8Yloti0JtXIOuXILAlQeNoqiG5vLsOVUrcPM7VUFlLQo5no8kTpiOXgRyAaS9VKkAO4sW0zR0n9tUY5dvkokV6sw0rNZ9/BPQFTcDlXug99OvhMSzwJtlqHTNdNRg+QM6E2vF0+ejmf6DEz/mN/5e0cK5UFqQKBgCR2hVfbRtDz9Cm/P8chPqaWFkH5ulUxBpc704Igc6bVH5DrEoWo6akbeJixV2obAZO3sFyeJqBUqaCvqG17Xei6jn3Hc3WMz9nLrAJEI9BTCfwvuxCOyY0IxqAAYT28xYv42I4+ADT/PpCq2Dj5u43X0dapAjZBZDfVVis7q1Bw-----END PRIVATE KEY-----`),l.updateString(a);let u=c(l.sign()),d=await t(`https://gateway.caixin.com/api/newauth/checkAuthByIdJsonp`,{params:{type:1,page:n.includes(`weekly`)?0:1,rand:Math.random(),id:r},headers:{"X-Sign":encodeURIComponent(u),"X-Nonce":encodeURIComponent(i),Cookie:e.caixin.cookie}}),{content:f=``,pictureList:p}=JSON.parse(d.data.match(/resetContentInfo\((.*)\)/)[1]);return f+(p?p.map(e=>`<img src="${e.url}" id="picture_${e.id}" alt="${e.desc}"><dl><dt>${e.desc}</dt></dl>`).join(``):``)}const u={path:`/latest`,categories:[`traditional-media`],view:i.Articles,example:`/caixin/latest`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`caixin.com/`]}],name:`最新文章`,maintainers:[`tpnonthealps`],handler:d,url:`caixin.com/`,description:"说明：此 RSS feed 会自动抓取财新网的最新文章，但不包含 FM 及视频内容。订阅用户可根据文档设置环境变量后，在url传入`fulltext=`以解锁全文。"};async function d(e){let{data:t}=await r(`https://gateway.caixin.com/api/dataplatform/scroll/index`),i=t.data.articleList.map(e=>({title:e.title,link:e.url,pubDate:e.time,category:e.channelObject.name})).filter(e=>!e.link.startsWith(`https://fm.caixin.com/`)&&!e.link.startsWith(`https://video.caixin.com/`)&&!e.link.startsWith(`https://datanews.caixin.com/`));return{title:`财新网 - 最新文章`,link:`https://www.caixin.com/`,item:await Promise.all(i.map(t=>n.tryGet(`caixin:latest:${t.link}`,async()=>{let n=await a(t);if(e.req.query(`fulltext`)===`true`){let e=await l(t.link);t.description=e===``?n.description:e}else t.description=n.description;return t.guid=`caixin:latest:${t.link}`,{...n,...t}})))}}export{u as route};