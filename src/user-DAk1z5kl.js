import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./got-BlqYKpVp.js";import{t as a}from"./types-Bn7An2Wc.js";import o from"node:path";import{load as s}from"cheerio";e();const c={"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`},l={path:`/:userid`,categories:[`social-media`],view:a.Audios,example:`/changba/skp6hhF59n48R-UpqO3izw`,parameters:{userid:`用户ID, 可在对应分享页面的 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`changba.com/s/:userid`]}],name:`用户`,maintainers:[`kt286`,`xizeyoupan`,`pseudoyu`],handler:u};async function u(e){let a=`https://changba.com/wap/index.php?s=${e.req.param(`userid`)}`,l=(await i({method:`get`,url:a,headers:c})).data,u=s(l),d=u(`.user-work .work-info`).toArray(),f=u(`div.user-main-info > span.txt-info > a.uname`).text(),p=u(`div.user-main-info > .poster > img`).attr(`data-src`),m=await Promise.all(d.map(e=>{let a=s(e),l=a(`a`).attr(`href`);return n.tryGet(l,async()=>{let e=await i({method:`get`,url:l,headers:c}),n=/workid: '\d+'/,s;try{s=e.data.match(n)[0]}catch{return null}if(s=s.split(`'`)[1],!s)return null;let u=`https://upscuw.changba.com/${s}.mp3`,d=r(o.join(t,`templates/work_description-7637ee4a.art`),{desc:a(`div.des`).text(),mp3url:u}),p=a(`div.work-cover`).attr(`style`).replace(`)`,``).split(`url(`)[1];return{title:a(`.work-title`).text(),description:d,link:l,author:f,itunes_item_image:p,enclosure_url:u,enclosure_type:`audio/mpeg`}})}));return m=m.filter(Boolean),{title:f+` - 唱吧`,link:a,description:u(`meta[name="description"]`).attr(`content`)||f+` - 唱吧`,item:m,image:p,itunes_author:f,itunes_category:`唱吧`}}export{l as route};