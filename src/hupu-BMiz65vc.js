import"./esm-shims-BmHUa0Yk.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-DCfHHxuQ.js";import"./helpers-gUVC02jt.js";import{cache_default as e}from"./cache-Dfid4xgQ.js";import{parseDate as t,parseRelativeDate as n}from"./parse-date-DHsdom8D.js";import{got_default as r}from"./got-D5TEN1xL.js";import{timezone as i}from"./timezone-CMz5pnRe.js";import{load as a}from"cheerio";function o(e){return`url`in e&&`isNews`in e}const s={nba:{title:`NBA`,data:`newsData`},cba:{title:`CBA`,data:`newsData`},soccer:{title:`足球`,data:`news`},"":{title:`首页`,data:`res`}},c={path:[`/dept/:category?`,`/:category?`],name:`手机虎扑网`,url:`m.hupu.com`,maintainers:[`nczitzk`,`hyoban`],example:`/hupu/nba`,parameters:{category:{description:`分类，可选值：nba、cba、soccer，默认为空（首页）`,default:``,options:Object.entries(s).map(([e,t])=>({label:t.title,value:e}))}},description:`::: tip
电竞分类参见 [游戏热帖](https://bbs.hupu.com/all-gg) 的对应路由 [\`/hupu/all/all-gg\`](https://rsshub.app/hupu/all/all-gg)。
:::`,categories:[`bbs`],radar:[{source:[`m.hupu.com/:category`,`m.hupu.com/`],target:`/:category`}],handler:async c=>{let l=c.req.param(`category`)||``;if(!(l in s))throw Error(`Invalid category. Valid options are: `+Object.keys(s).filter(Boolean).join(`, `));let u=l,d=`https://m.hupu.com/${u}`,f=(await r({method:`get`,url:d})).data.match(/<script id="__NEXT_DATA__" type="application\/json">(.*?)<\/script>/);if(!f||!f[1])throw Error(`Failed to find __NEXT_DATA__ script tag in page: ${d}`);let p=f[1],m;try{m=JSON.parse(p)}catch(e){throw Error(`Failed to parse full JSON data: ${e instanceof Error?e.message:String(e)}`)}let{pageProps:h}=m.props,g=s[u].data;if(!(g in h))throw Error(`Expected '${g}' property not found in pageProps for category: ${u||`home`}`);let _=(()=>{let e=h[g];return Array.isArray(e)?e:[]})().map(e=>o(e)?{title:e.title,link:e.url.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid,category:e.label?[e.label]:void 0}:{title:e.title,pubDate:i(t(e.publishTime),8),link:e.link.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid});return _=await Promise.all(_.filter(e=>e.link&&!/subject/.test(e.link)).map(o=>e.tryGet(o.link,async()=>{try{let e=await r({method:`get`,url:o.link}),s=a(e.data),c=s(`.bbs-user-info-name, .bbs-user-wrapper-content-name-span`).text(),l=s(`.second-line-user-info span:not([class])`).text(),u=[o.pubDate,i(t(l),8),i(n(l),8),i(n(`Today ${l}`),8)].find(e=>e instanceof Date&&!Number.isNaN(e.getTime())),d=s(`.basketballTobbs_tag > a, .tag-player-team`).toArray().map(e=>s(e).text()).filter(Boolean);s(`.basketballTobbs_tag`).remove(),s(`.hupu-img`).each(function(){let e=s(this).attr(`data-gif`)||s(this).attr(`data-origin`)||s(this).attr(`src`);s(this).parent().html(`<img src="${e}">`)});let f=[],p=s(`#bbs-thread-content, .bbs-content-font`).html();p&&f.push(p);let m=s(`.header-video-wrapper`);if(m.length>0){let e=m.find(`video`);if(e.length>0){let t=e.prop(`outerHTML`);t&&f.push(t)}}let h=f.length>0?f.join(``):void 0;return{...o,author:c,category:d.length>0?d:o.category,description:h,pubDate:u}}catch{return o}}))),{title:`虎扑 - ${s[u].title}`,link:d,item:_}}};export{c as route};