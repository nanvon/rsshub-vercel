import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-dCh-Ojgc.js";import{t as o}from"./timezone-BPfwRbwD.js";import{t as s}from"./invalid-parameter-CLGd_tte.js";import{t as c}from"./valid-host-COjFWLEv.js";import l from"node:path";import{load as u}from"cheerio";e();const d={path:`/:id?/:category{.+}?`,name:`Unknown`,maintainers:[],handler:f};async function f(e){let{id:d=`news`,category:f=`china`}=e.req.param();if(!c(d))throw new s(`Invalid id`);let p=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):30,m=`http://${d}.m4.cn`,h=new URL(f?`/${f.replace(/\/$/,``)}/`:`/`,m).href,{data:g}=await a(h),_=u(g),v=_(`div.articleitem0 div.aheader0`).slice(0,p).toArray().map(e=>{e=_(e);let n=e.find(`a`).first();return{title:n.text(),link:n.prop(`href`),description:r(l.join(t,`templates/description-881baa33.art`),{images:[{src:e.parent().find(`div.aimg0 a img`).prop(`src`),alt:n.text()}]}),category:e.find(`a.aclass`).toArray().map(e=>_(e).text().replaceAll(`[]`,``).trim()),pubDate:o(i(e.find(`span.atime`).text()),8)}});v=await Promise.all(v.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link),s=u(n);return e.title=s(`h1`).first().text(),e.description=r(l.join(t,`templates/description-881baa33.art`),{intro:s(`div.aintro1, p.cont-summary`).text(),description:s(`div.content0, div.cont-detail`).html()}),e.category=s(`span.dd0 a, a[rel="category"]`).toArray().map(e=>s(e).text()).slice(1),e.pubDate=o(i(s(`span.atime1, span.post-time`).text()),8),e})));let y=_(`a.logo0_b img`).prop(`src`);return{item:v,title:_(`title`).text(),link:h,description:_(`meta[name="description"]`).prop(`content`),language:`zh`,image:y,subtitle:_(`meta[name="keywords"]`).prop(`content`),author:_(`meta[name="author"]`).prop(`content`),allowEmpty:!0}}export{d as route};