import{t as e}from"./ofetch-CfXAR0UO.js";import{t}from"./cache-CpEhLexq.js";import{t as n}from"./parse-date-CHEO0z5G.js";import{t as r}from"./timezone-BPfwRbwD.js";import{Fragment as i,jsx as a,jsxs as o}from"hono/jsx/jsx-runtime";import{load as s}from"cheerio";import{renderToString as c}from"hono/jsx/dom/server";import"rfc4648";function l({imageDataArray:e,articleBody:t}){return o(i,{children:[e.map(e=>e.type===`normalHTML`?a(`div`,{dangerouslySetInnerHTML:{__html:e.html}}):e.type===`data`&&o(`figure`,{children:[a(`img`,{src:e.src}),a(`figcaption`,{children:e.title})]})),t&&a(`div`,{dangerouslySetInnerHTML:{__html:t}})]})}var u=l;const d=`https://www.zaobao.com`,f=`https://www.zaobao.com.sg/favicon.ico`,p=async i=>{let o=await e.raw(d+i),l=s(o._data),f=l(`.card-listing .card .content-header a`);f.length===0&&(f=l(`[data-testid="article-list"] article div div a.article-link`));let p=new URL(o.url).origin;return{title:l(`meta[property="og:title"]`).attr(`content`),resultList:await Promise.all(f.toArray().map(i=>{let f=l(i),h=d+f.attr(`href`);return t.tryGet(h,async()=>{if(f.attr(`href`)?.includes(`https://`))return{title:o.url.startsWith(`https://www.zaobao.com.sg/`)?f.text().trim():f.attr(`title`)?.trim(),link:f.attr(`href`),pubDate:r(f.next().text().trim().includes(`:`)?n(f.next().text().trim(),`HH:mm`):n(f.next().text().trim(),`MM月DD日`),8)};let t=await e.raw(new URL(f.attr(`href`),p).href),i=s(t._data),l,d,g,_,v=i(`head script[type="application/ld+json"]`).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``),y=JSON.parse(v),b=t.url.startsWith(`https://www.zaobao.com.sg/`);if(b){let e=JSON.parse(JSON.parse(`"${i(`script:contains("__staticRouterHydrationData")`).text().match(/__staticRouterHydrationData = JSON.parse\("(.*)"\);/)?.[1]}"`)).loaderData[`0-0`].context.payload.article;l=e.headline,d=n(e.create_time,`X`),g=e.tags.map(e=>e.name),i=s(e.body_cn,null,!1),_=e.images}else l=y.headline,d=n(y.datePublished),g=y.keywords?.split(`,`);i(`.bff-google-ad, .bff-recommend-article`).remove(),i(`button.cursor-pointer`).remove(),i(`.bff-inline-image-expand-icon`).remove(),i(`img[alt="expend icon"]`).remove();let x;b?x=i:(i(`astro-island, .further-reading, .read-on-app-cover`).remove(),x=i(`.article-body`));let S=x.html(),C=c(a(u,{imageDataArray:m(b,_,i),articleBody:S}));return{title:l,description:C,pubDate:d,link:h,category:g}})}))}},m=(e,t,n)=>{if(e&&t)return t.map(e=>({type:`data`,html:``,src:e.url.replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`).split(`?`)[0],title:e.caption}));let r=n(`[data-testid="article-banner"] img`);return r.length?[{type:`data`,html:r.prop(`outerHTML`),src:r.attr(`src`).replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`).split(`?`)[0],title:r.attr(`title`)}]:[]};export{p as n,f as t};