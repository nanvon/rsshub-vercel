import{n as e,t}from"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-VsB2Peor.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BVCqvF6m.js";import o from"node:path";import{load as s}from"cheerio";e();const c={path:`/forestry/gjlckjdjt/:category?`,categories:[`government`],example:`/gov/forestry/gjlckjdjt`,parameters:{category:`分类，见下表，默认为全部`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`国家林草科技大讲堂`,maintainers:[`nczitzk`],handler:l,description:`| 分类     | id   |
| -------- | ---- |
| 经济林   | jjl  |
| 林木良种 | lmlz |
| 林下经济 | lxjj |
| 生态修复 | stxf |
| 用材林   | ycl  |
| 其他     | qt   |`};async function l(e){let{category:c=`gjlckjdjt`}=e.req.param(),l=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):30,u=`http://www.forestry.gov.cn`,d=new URL(`${c}.jhtml`,u).href,{data:f}=await a(d),p=s(f),m=p(`a.items`).slice(0,l).toArray().map(e=>{e=p(e);let n=e.find(`p.name`).text(),a=new URL(e.prop(`href`),u).href,s=a.match(/\/\d{8}\//);return{title:n,link:a,description:r(o.join(t,`templates/description-e2cc2c72.art`),{image:{src:e.find(`img`).prop(`src`),alt:n}}),pubDate:s?i(s[1]):void 0}});m=await Promise.all(m.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link),c=s(n);c(`p`).each((e,t)=>{t=c(t),t.find(`img, video, embed.edui-faked-video`).length===0&&/^\s*$/.test(t.text())&&t.remove()}),c(`video, embed.edui-faked-video`).each((n,i)=>{i=c(i);let a=i.prop(`src`);e.enclosure_url=e.enclosure_url??a,i.replaceWith(r(o.join(t,`templates/description-e2cc2c72.art`),{video:{src:a}}))});let l=e.link.match(/\/\d{8}\//);return e.title=c(`div.tit`).text(),e.description+=c(`div.zhengwen`).html(),e.pubDate=l?i(l[1]):void 0,e.enclosure_type=e.enclosure_url?`video/mp4`:void 0,e})));let h=new URL(`favicon.ico`,u).href;return{item:m,title:p(`title`).text(),link:d,language:p(`html`).prop(`lang`),image:new URL(`r/cms/www/default/zhuanti/2021djt/images/top.png`,u).href,icon:h,logo:h,subtitle:p(`div.weizhi`).contents().last().text(),author:`国家林业和草原局`,allowEmpty:!0}}export{c as route};