import"./esm-shims-2LyWUseo.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-BLnIkXRv.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{timezone as n}from"./timezone-CMz5pnRe.js";import{ViewType as r}from"./types-Bi82qguM.js";import{load as i}from"cheerio";function a(e){if(!/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let[t,n,r]=e.split(`-`).map(Number),i=new Date(t,n-1,r);return i.getFullYear()===t&&i.getMonth()===n-1&&i.getDate()===r}const o=async r=>{let{category:o=``}=r.req.param(),s=Number.parseInt(r.req.query(`limit`)??`50`,10),c=r.req.param(`query`)??``,l={stock:``,beginDate:``,endDate:``};if(c)for(let e of c.split(`&`)){let[t,n]=e.split(`=`);t&&(l[t]=n)}if(l.beginDate&&!a(l.beginDate))throw Error(`Invalid beginDate format. Expected YYYY-MM-DD`);if(l.endDate){if(!a(l.endDate))throw Error(`Invalid endDate format. Expected YYYY-MM-DD`)}else l.beginDate&&(l.endDate=l.beginDate);let u=`https://www.szse.cn`,d=new URL(`api/disc/announcement/annList`,u).href,f=new URL(`disclosure/listed/notice${o}`,u).href,p=await e(f),m=i(p),h=m(`html`).attr(`lang`)??`zh-CN`,g=(await e(d,{method:`POST`,body:{stock:l.stock?[l.stock]:[],seDate:[l.beginDate,l.endDate],channelCode:[`listedNotice_disc`],pageSize:s,pageNum:1}})).data.slice(0,s).map(e=>{let r=e.title,i=e.publishTime,a=`disclosure/listed/bulletinDetail/index.html?${e.id}`,o=[...new Set([...e.secCode,...e.secName,e.bigCategoryId,e.bigIndustryCode,e.smallCategoryId].filter(Boolean))],s=`szse-${e.id}`,c=e.publishTime,l={title:r,pubDate:i?n(t(i),8):void 0,link:new URL(a,u).href,category:o,guid:s,id:s,updated:c?n(t(c),8):void 0,language:h},d=new URL(`download${e.attachPath}`,`https://disc.static.szse.cn`).href;if(d){let t=`application/${e.attachFormat}`;l={...l,enclosure_url:d,enclosure_type:t,enclosure_title:r,enclosure_length:void 0}}return l}).filter(e=>!0);return{title:`深圳证券交易所 - 上市公司公告`,description:m(`meta[name="description"]`).attr(`content`),link:f,item:g,allowEmpty:!0,image:m(`a.navbar-brand img`).attr(`src`),author:m(`meta[name="author"]`).attr(`content`),language:h,id:f}},s={path:`/disclosure/listed/notice/:query?`,name:`上市公司公告`,url:`www.szse.cn`,maintainers:[`nczitzk`],handler:o,example:`/szse/disclosure/listed/notice`,parameters:{query:`Filter options. can filte by "stock","beginDate","endDate". example:"stock=000001&beginDate=2025-07-01&endDate=2025-08-30"`},description:void 0,categories:[`finance`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.szse.cn/disclosure/listed/notice/index.html`],target:`/disclosure/listed/notice`}],view:r.Articles};export{o as handler,s as route};