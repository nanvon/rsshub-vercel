import{n as e,t}from"./esm-shims-CMsyBHYK.js";import{t as n}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./got-BlqYKpVp.js";import o from"node:path";e();var s=e=>Promise.all([`https://api.bgm.tv/calendar`,`https://cdn.jsdelivr.net/npm/bangumi-data/dist/data.json`].map((t,r)=>e(t,async()=>{let{data:e}=await a(t);if(r===1){let t=[];for(let n of e.items){let e=n.sites.find(e=>e.site===`bangumi`);e&&(n.bgmId=e.id,t.push(n))}e.items=t}return e},n.cache.contentExpire,!1)));const c={path:`/calendar/today`,categories:[`anime`],example:`/bangumi.tv/calendar/today`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/calendar`]}],name:`放送列表`,maintainers:[`magic-akari`],handler:l,url:`bgm.tv/calendar`};async function l(){let[e,n]=await s(r.tryGet),a=n.siteMeta,c=new Date(Date.now());c.setUTCHours(c.getUTCHours()+9);let l=c.getUTCDay(),u=e.find(e=>e.weekday.id%7===l),d=new Set(u.items.map(e=>e.id.toString())),f={};for(let e of u.items)f[e.id]=(e.images||{}).large;let p=n.items.filter(e=>d.has(e.bgmId));for(let e of p)e.image=f[e.bgmId];return{title:`bangumi 每日放送`,link:`https://bgm.tv/calendar`,item:p.map(e=>{let n=new Date(Date.now());n.setSeconds(0);let r=new Date(e.begin||n);n.setHours(r.getHours()),n.setMinutes(r.getMinutes()),n.setSeconds(r.getSeconds());let s=`https://bangumi.tv/subject/${e.bgmId}`,c=`${s}#${new Intl.DateTimeFormat(`zh-CN`).format(n)}`,l=i(o.join(t,`templates/today-7f5f417a.art`),{bgm:e,siteMeta:a});return{id:c,guid:c,title:[e.title,Object.values(e.titleTranslate).map(e=>e.join(`｜`)).join(`｜`)].filter(Boolean).join(`｜`),updated:n.toISOString(),pubDate:n.toUTCString(),link:s,description:l,content:{html:l}}})}}export{c as route};