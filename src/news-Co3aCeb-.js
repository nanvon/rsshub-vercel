import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-rK3Yp7nj.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-Bnno2HfO.js";import{timezone as o}from"./timezone-CMz5pnRe.js";import s from"node:path";import{load as c}from"cheerio";import l from"sanitize-html";import u from"p-map";t();const d=(e,t)=>(e(t).find(`.fSpecCs`).each((t,n)=>{n.parent.name===`nobr`&&e(n).unwrap(),n.name=`b`,n.attribs={}}),t.html()),f=(e,t)=>n.tryGet(t,async()=>{let e=c((await a(t)).data),n=``;return e(`.content img`).each((e,t)=>{let r=t.attribs.src;r&&(n+=n?`<br><img src="${r}">`:`<img src="${r}">`)}),n}),p=(e,t)=>n.tryGet(t,async()=>{let e=c((await a(t)).data)(`script[type="text/javascript"]:not([src])`).html().match(/<[^>]*source[^>]+src[^>]+>/g);return e&&=e.map(e=>e.replaceAll(`'`,`"`).replaceAll(/src="([^"]+)"/g,`src="http://www.kcna.kp$1"`)),`<video controls preload="metadata">${e.join(`
`)}</video>`}),m={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/kcna/en`,parameters:{lang:`Language, refer to the table below`,category:`Category, refer to the table below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.kcna.kp/:lang`,`www.kcna.kp/:lang/category/articles/q/1ee9bdb7186944f765208f34ecfb5407.kcmsf`,`www.kcna.kp/:lang/category/articles.kcmsf`],target:`/:lang`}],name:`News`,maintainers:[`Rongronggg9`],handler:h,description:"| Language | 조선어 | English | 中国语 | Русский | Español | 日本語 |\n| -------- | ------ | ------- | ------ | ------- | ------- | ------ |\n| `:lang`  | `kp`   | `en`    | `cn`   | `ru`    | `es`    | `jp`   |\n\n| Category                                                         | `:category`                        |\n| ---------------------------------------------------------------- | ---------------------------------- |\n| WPK General Secretary **Kim Jong Un**'s Revolutionary Activities | `54c0ca4ca013a92cc9cf95bd4004c61a` |\n| Latest News (default)                                            | `1ee9bdb7186944f765208f34ecfb5407` |\n| Top News                                                         | `5394b80bdae203fadef02522cfb578c0` |\n| Home News                                                        | `b2b3bcc1b0a4406ab0c36e45d5db58db` |\n| Documents                                                        | `a8754921399857ebdbb97a98a1e741f5` |\n| World                                                            | `593143484cf15d48ce85c26139582395` |\n| Society-Life                                                     | `93102e5a735d03979bc58a3a7aefb75a` |\n| External                                                         | `0f98b4623a3ef82aeea78df45c423fd0` |\n| News Commentary                                                  | `12c03a49f7dbe829bceea8ac77088c21` |"};async function h(t){let{lang:m,category:h=`1ee9bdb7186944f765208f34ecfb5407`}=t.req.param(),g=`http://www.kcna.kp`,_=`${g}/${m}/category/articles/q/${h}.kcmsf`,v=c((await a(_)).data);return{title:l(v(`head > title`).text(),{allowedTags:[],allowedAttributes:{}}),link:_,item:await u(v(`.article-link li a`).toArray().map(e=>{e=v(e);let t=e.find(`.publish-time`),n=t.text().match(/\d+\.\d+\.\d+/);return t.remove(),{title:e.text(),link:g+e.attr(`href`),pubDate:o(i(n[0]),9)}}),l=>n.tryGet(l.link,async()=>{let n=c((await a(l.link)).data);l.title=n(`article-main-title`).text()||l.title;let u=n(`.publish-time`),m=u.text().match(/\d+\.\d+\.\d+/);u.remove(),l.pubDate=m?o(i(m[0]),9):l.pubDate;let h=d(n,n(`.article-content-body .content-wrapper`)),_=n(`.media-icon a`).toArray().map(e=>g+e.attribs.href),v,y;return await Promise.all(_.map(async e=>{e.includes(`/photo/`)?v=await f(t,e):e.includes(`/video/`)&&(y=await p(t,e))})),l.description=r(s.join(e,`templates/news-b7c0d7df.art`),{description:h,photo:v,video:y}),l}),{concurrency:3})}}export{m as route};