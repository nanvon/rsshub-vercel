import{n as e,t}from"./esm-shims-L08rKynx.mjs";import"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import"./ofetch-BMqiDsx_.mjs";import"./helpers-mo8InLYm.mjs";import{t as n}from"./cache-ZTWfXd2T.mjs";import{t as r}from"./render-CBhnapAf.mjs";import{t as i}from"./parse-date-bKmkZ9gg.mjs";import{t as a}from"./got-2jXbf1Li.mjs";import{n as o,t as s}from"./utils-C_J6r2qE.mjs";import c from"node:path";import{load as l}from"cheerio";e();const u=async e=>{let{id:u=`1103`}=e.req.param(),d=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):20,f=new URL(`subject/${u}`,o).href,p=new URL(`api/subject/${u}/article`,o).href,{data:m}=await a(p,{searchParams:s({Subject_Id:u})}),h=m.data.slice(0,d).map(e=>{let n=e.article_title,a=r(c.join(t,`templates/description-881baa33.art`),{intro:e.article_brief}),s=`cls-${e.article_id}`,l=e.article_img;return{title:n,description:a,pubDate:i(e.article_time,`X`),link:new URL(`detail/${e.article_id}`,o).href,category:e.subjects.map(e=>e.subject_name),author:e.article_author,guid:s,id:s,content:{html:a,text:e.article_brief},image:l,banner:l}});h=await Promise.all(h.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.link),o=l(n),s=JSON.parse(o(`script#__NEXT_DATA__`).text())?.props?.initialState?.detail?.articleDetail??void 0;if(!s)return e;let u=s.title,d=r(c.join(t,`templates/description-881baa33.art`),{images:s.images.map(e=>({src:e,alt:u})),intro:s.brief,description:s.content}),f=`cls-${s.id}`,p=s.images?.[0]??void 0;return e.title=u,e.description=d,e.pubDate=i(s.ctime,`X`),e.category=[...new Set(s.subject?.flatMap(e=>[e.name,...e.subjectCategory?.flatMap(e=>[e.columnName||[],e.name||[]])??[]]))].filter(Boolean),e.author=s.author?.name??e.author,e.guid=f,e.id=f,e.content={html:d,text:s.content},e.image=p,e.banner=p,e.enclosure_url=s.audioUrl,e.enclosure_type=e.enclosure_url?`audio/${e.enclosure_url.split(/\./).pop()}`:void 0,e.enclosure_title=u,e})));let{data:g}=await a(f),_=l(g),v=JSON.parse(_(`script#__NEXT_DATA__`).text())?.props?.initialProps?.pageProps?.subjectDetail??void 0,y=`财联社`,b=v?.img??void 0;return{title:`${y} - ${v?.name??_(`title`).text()}`,description:v?.description??void 0,link:f,item:h,allowEmpty:!0,image:b,author:y}},d={path:`/subject/:id?`,name:`话题`,url:`www.cls.cn`,maintainers:[`nczitzk`],handler:u,example:`/cls/subject/1103`,parameters:{category:`分类，默认为 1103，即A股盘面直播，可在对应话题页 URL 中找到`},description:"::: tip\n  若订阅 [有声早报](https://www.cls.cn/subject/1151)，网址为 `https://www.cls.cn/subject/1151`。截取 `https://www.cls.cn/subject/` 到末尾的部分 `1151` 作为参数填入，此时路由为 [`/cls/subject/1151`](https://rsshub.app/cls/subject/1151)。\n:::\n    ",categories:[`finance`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.cls.cn/subject/:id`],target:e=>{let t=e.id;return`/subject${t?`/${t}`:``}`}}]};export{u as handler,d as route};