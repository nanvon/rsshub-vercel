import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-CRUPiVpr.js";import"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{n as i}from"./parse-date-CHEO0z5G.js";import"./not-found-BWgqqdKp.js";import{r as a}from"./utils-C8xtAAUh.js";import o from"node:path";import{load as s}from"cheerio";e();const c={path:`/community/:handle`,categories:[`social-media`],example:`/youtube/community/@JFlaMusic`,parameters:{handle:`YouTube handles or channel id`},name:`Community Posts`,maintainers:[`TonyRL`],handler:l};async function l(e){let c=e.req.param(`handle`),l=c;a(c)&&(l=`channel/${c}`);let u=s(await n(`https://www.youtube.com/${l}/posts`)),d=JSON.parse(u(`script`).text().match(/ytInitialData = ({.*?});/)?.[1]??`{}`),f=d.metadata.channelMetadataRenderer,p=f.title,m=d.contents.twoColumnBrowseResultsRenderer.tabs.find(e=>e.tabRenderer.endpoint.commandMetadata.webCommandMetadata.url.endsWith(`/posts`)||e.tabRenderer.endpoint.commandMetadata.webCommandMetadata.url.endsWith(`/community`)).tabRenderer.content.sectionListRenderer.contents[0].itemSectionRenderer.contents;if(m[0].messageRenderer)throw Error(m[0].messageRenderer.text.runs[0].text);let h=m.filter(e=>e.backstagePostThreadRenderer).map(e=>{let n=e.backstagePostThreadRenderer.post.backstagePostRenderer||e.backstagePostThreadRenderer.post.sharedPostRenderer.originalPost.backstagePostRenderer,a=n.backstageAttachment?.postMultiImageRenderer?.images.map(e=>e.backstageImageRenderer.image.thumbnails.pop())??[n.backstageAttachment?.backstageImageRenderer?.image.thumbnails.pop()];return{title:n.contentText.runs?.[0].text??``,description:r(o.join(t,`templates/community-2ff132c4.art`),{runs:n.contentText.runs,media:a}),link:`https://www.youtube.com/post/${n.postId}`,author:n.authorText.runs[0].text,pubDate:i(n.publishedTimeText.runs[0].text.split(`(`)[0])}});return{title:`${p} - Community Posts- YouTube`,link:f.channelUrl,description:f.description,item:h}}export{c as route};