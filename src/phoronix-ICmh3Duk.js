import"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as e}from"./cache-CpEhLexq.js";import{t}from"./got-dCh-Ojgc.js";import{t as n}from"./rss-parser-CbA1uKIl.js";import r from"dayjs";import{load as i}from"cheerio";import a from"dayjs/plugin/utc.js";import o from"dayjs/plugin/timezone.js";r.extend(a),r.extend(o);const s=`phoronix:web-articles`,c=`https://www.phoronix.com`,l=`${c}/rss.php`,u=async()=>{let e=await n.parseURL(l);return{title:e.title,link:e.link,description:e.description,item:e.items,language:e.language,icon:`https://www.phoronix.com/android-chrome-192x192.png`,image:`https://www.phoronix.com/android-chrome-192x192.png`,logo:`https://www.phoronix.com/phxcms7-css/phoronix.png`,category:[`Linux Hardware Reviews`,`Linux hardware benchmarks`,`Linux Hardware`,`Linux benchmarking`,`Desktop Linux`,`GNU/Linux benchmarks`,`Open Source AMD`,`Linux How To`,`X.Org drivers`,`Ubuntu hardware`,`Phoronix Test Suite`]}},d=e=>{let t=i(e.body);return{title:t(`title`).text(),link:e.url,description:t(`meta[name="Description"]`).attr(`content`),item:[...new Set(t(`#main a`).toArray().map(e=>e.attribs.href))].filter(e=>e&&(e.startsWith(`/review/`)||e.startsWith(`/news/`))).map(e=>({link:`${c}${e}`})),language:`en-us`,icon:`https://www.phoronix.com/android-chrome-192x192.png`,image:`https://www.phoronix.com/android-chrome-192x192.png`,logo:`https://www.phoronix.com/phxcms7-css/phoronix.png`,category:t(`meta[name="keywords"]`).attr(`content`).split(`, `)}},f=n=>e.tryGet(`${s}:${n}`,async()=>{try{return d(await t(n))}catch(e){if((e.name===`HTTPError`||e.name===`FetchError`)&&e.response.statusCode===404)return`404`;throw e}}),p=async(n,r)=>{let i=new URL(`/scan.php`,c);i.searchParams.set(`page`,n),r&&(n===`category`?i.searchParams.set(`item`,r):i.searchParams.set(`q`,r));let a,o=await e.tryGet(`phoronix:redirect:${i.toString()}`,async()=>(a=await t(i.toString()),a.url));if(a){let t=d(a);return e.set(`${s}:${o}`,t),t}return await f(o)},m=async(e,t)=>{let n=await f(t?`${c}/${e}/${t}`:`${c}/${e}`);return n===`404`&&(n=await p(e,t)),n},h={path:`/:category?/:topic?`,categories:[`new-media`],example:`/phoronix/linux/KDE`,parameters:{category:`Category`,topic:"Topic. You may find available parameters from their navigator links. E.g. to subscribe to `https://www.phoronix.com/reviews/Operating+Systems`, fill in the path `/phoronix/reviews/Operating+Systems`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`phoronix.com/:category?/:topic?`]}],name:`News & Reviews`,maintainers:[`oppliate`,`Rongronggg9`],handler:g};async function g(n){let{category:a,topic:o}=n.req.param(),s;switch(a){case`category`:case`news_topic`:s=await p(a,o);break;case`rss`:s=await u();break;default:s=a?await m(a,o):await u();break}return s.item=await Promise.all(s.item.map(n=>e.tryGet(`phoronix:articles:${n.link}`,async()=>{let a=(await t(n.link)).body,o=i(a),s=o(`.content`),l=o(`.author > a`),u=l.slice(0,-2).toArray().map(e=>o(e).text()),d=[];n.link.includes(`/news/`)?d.push(`News`):n.link.includes(`/review/`)&&d.push(`Review`);let f=l.eq(-2);f.length&&d.push(f.text());let p;if(!n.pubDate){let e=f.length&&f[0].nextSibling?.nodeValue;e&&(e=e.replaceAll(/on|at|\./g,``).trim(),p=/\d{4}$/.test(e)?r.utc(`${e} 08:00 UTC`).tz(`America/Indiana/Indianapolis`,!0):r(e),p.isValid()||(p=e))}let m=o(`.pagination > a`).toArray().map(e=>`${c}${e.attribs.href}`).slice(0,-1);if(m.length){let n=await Promise.all(m.map(n=>e.tryGet(n,async()=>{let e=(await t(n)).data;return i(e)(`.content`).html()})));s.append(n)}let h=s.find(`img`),g=h.first();if(g.attr(`src`)?.startsWith(`/assets/categories/`)){let e=g.parent();e.text().trim()?g.remove():e.remove()}return h.each((e,t)=>{t.attribs.src=t.attribs.src.replace(/_med$/,``)}),{title:n.title||o(`article h1`).text(),pubDate:n.pubDate||p,author:u.join(`, `),link:n.link,summary:o(`meta[name="twitter:description"]`).attr(`content`),description:s.html(),image:o(`meta[name="twitter:image"]`).attr(`content`),category:n.category||d}}))),s}export{h as route};