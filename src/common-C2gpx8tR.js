import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-CfXAR0UO.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./types-Bn7An2Wc.js";import s from"node:path";import{load as c}from"cheerio";e();const l={path:`/:category/:topic?`,categories:[`traditional-media`],view:o.Articles,example:`/reuters/world/us`,parameters:{category:{description:`find it in the URL, or tables below`,options:[{value:`world`,label:`World`},{value:`business`,label:`Business`},{value:`legal`,label:`Legal`},{value:`markets`,label:`Markets`},{value:`breakingviews`,label:`Breakingviews`},{value:`technology`,label:`Technology`},{value:`graphics`,label:`Graphics`},{value:`authors`,label:`Authors`}],default:`world`},topic:"find it in the URL, or tables below, leave empty for `All`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`reuters.com/:category/:topic?`,`reuters.com/`]}],name:`Category/Topic/Author`,maintainers:[`LyleLee`,`HenryQW`,`proletarius101`,`black-desk`,`nczitzk`,`pseudoyu`],handler:u,description:`-   \`:category\`:

      | World | Business | Legal | Markets | Breakingviews | Technology | Graphics |
      | ----- | -------- | ----- | ------- | ------------- | ---------- | -------- |
      | world | business | legal | markets | breakingviews | technology | graphics |

  -   \`world/:topic\`:

      | All | Africa | Americas | Asia Pacific | China | Europe | India | Middle East | United Kingdom | United States | The Great Reboot | Reuters Next |
      | --- | ------ | -------- | ------------ | ----- | ------ | ----- | ----------- | -------------- | ------------- | ---------------- | ------------ |
      |     | africa | americas | asia-pacific | china | europe | india | middle-east | uk             | us            | the-great-reboot | reuters-next |

  -   \`business/:topic\`:

      | All | Aerospace & Defense | Autos & Transportation | Energy | Environment | Finance | Healthcare & Pharmaceuticals | Media & Telecom | Retail & Consumer | Sustainable Business | Charged | Future of Health | Future of Money | Take Five | Reuters Impact |
      | --- | ------------------- | ---------------------- | ------ | ----------- | ------- | ---------------------------- | --------------- | ----------------- | -------------------- | ------- | ---------------- | --------------- | --------- | -------------- |
      |     | aerospace-defense   | autos-transportation   | energy | environment | finance | healthcare-pharmaceuticals   | media-telecom   | retail-consumer   | sustainable-business | charged | future-of-health | future-of-money | take-five | reuters-impact |

  -   \`legal/:topic\`:

      | All | Government | Legal Industry | Litigation | Transactional |
      | --- | ---------- | -------------- | ---------- | ------------- |
      |     | government | legalindustry  | litigation | transactional |

  -   \`authors/:topic\`:

      | Default | Jonathan Landay | any other authors |
      | ------- | --------------- | ----------------- |
      | reuters | jonathan-landay | their name in URL |

  More could be found in the URL of the category/topic page.`};async function u(e){let o=new Set([`authors`,`tags`]),l=[`world`],u=e.req.param(`category`),d=e.req.param(`topic`)??(u===`authors`?`reuters`:``),f=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):20,p=e.req.query(`sophi`)===`true`&&d!==``&&l.includes(u),m=`/${u}/${d?`${d}/`:``}`,h={Accept:`application/json, text/plain, */*`,"Accept-Language":`en-US,en;q=0.9`,Referer:`https://www.reuters.com/`};try{let{title:l,description:d,rootUrl:g,response:_}=await(async()=>{if(o.has(u)){let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-topic-v1`,t=await n(e,{query:{query:JSON.stringify({offset:0,size:f,topic_url:m,website:`reuters`})},headers:h});return{title:`${t.result.topics[0].name} | Reuters`,description:t.result.topics[0].entity_id,rootUrl:e,response:t}}else{let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-section-alias-or-id-v1`,t=await n(e,{query:{query:JSON.stringify({offset:0,size:f,section_id:m,website:`reuters`,...p?{fetch_type:`sophi`,sophi_page:`*`,sophi_widget:`topic`}:{}})},headers:h});return{title:t.result.section.title,description:t.result.section.section_about,rootUrl:e,response:t}}})(),v=_.result.articles.map(e=>({title:e.title,link:new URL(e.canonical_url,g).href,guid:e.id,pubDate:a(e.published_time),updated:a(e.updated_time),author:e.authors.map(e=>e.name).join(`, `),category:e.kicker.names,description:e.description}));return v=v.filter((e,t)=>v.findIndex(t=>e.guid===t.guid)===t),v=(await Promise.allSettled(v.map(o=>e.req.query(`fulltext`)===`true`?r.tryGet(o.link,async()=>{let e=await n(o.link,{headers:h}),r=c(e.data);if(e.url.startsWith(`https://www.reuters.com/investigates/`)){let e=JSON.parse(r(`script[type="application/ld+json"]`).text());return r(`.special-report-article-container .container, #slide-dek, #slide-end, .share-in-article-container`).remove(),o.title=e.headline,o.pubDate=a(e.dateCreated),o.author=e.creator,o.category=e.keywords,o.description=r(`.special-report-article-container`).html(),o}let l=r(`script#fusion-metadata`).text().match(/Fusion.globalContent=({[\S\s]*?});/);if(l){let e=JSON.parse(l[1]);return o.title=e.result.title||o.title,o.description=i(s.join(t,`templates/description-073fbea1.art`),{result:e.result}),o.pubDate=a(e.result.display_time),o.author=e.result.authors.map(e=>e.name).join(`, `),o.category=e.result.taxonomy.keywords,o}return r(`.title`).remove(),r(`.article-metadata`).remove(),o.title=r(`meta[property="og:title"]`).attr(`content`),o.pubDate=a(e.data.match(/"datePublished":"(.*?)","dateModified/)[1]),o.author=e.data.match(/{"@type":"Person","name":"(.*?)"}/g).map(e=>e.match(/"name":"(.*?)"/)[1]).join(`, `),o.description=r(`article`).html(),o}):o))).filter(e=>e.status===`fulfilled`).map(e=>e.value),{title:l,description:d,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:`https://www.reuters.com${m}`,item:v}}catch{let e=await n(d?`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section${m}?outputType=json`:`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section/${u}/?outputType=json`,{headers:h});if(e.wireitems?.length){let t=e.wireitems.map(t=>{let n=t.templates.find(e=>e.template===`story_with_image`)?.story;return n?{title:n.hed,link:t.templates.find(e=>e.template===`story_with_image`)?.template_action?.url,guid:n.usn,pubDate:a(n.updated_at),updated:a(n.updated_at),description:n.lede,author:n.authors?.map(e=>e.name).join(`, `),category:[e.analytics?.topic_channel,e.analytics?.topic_sub_channel].filter(Boolean)}:null}).filter(Boolean);return{title:e.analytics?.title||`${e.wire_name} | Reuters`,description:e.analytics?.content_title,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:e.canonical_action?.url||`https://www.reuters.com${m}`,category:[e.analytics?.topic_channel,e.analytics?.topic_sub_channel].filter(Boolean),item:t.slice(0,f)}}}}export{l as route};