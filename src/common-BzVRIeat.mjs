import{n as e,t}from"./esm-shims-C3MSy80G.mjs";import{t as n}from"./ofetch-Byd8Ct7M.mjs";import{t as r}from"./cache-KwJARS5Z.mjs";import{t as i}from"./render-ZYpwNl2L.mjs";import{t as a}from"./parse-date-9Tu6hSFW.mjs";import o from"node:path";import{load as s}from"cheerio";e();const c=async e=>{let{category:c=``}=e.req.param(),l=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,u=`https://www.jiemian.com`,d=new URL(c?`${c}.html`:``,u).href,f=s(await n(d)),p={},m=f(`a`).toArray();for(let e of m){let t=f(e),n=t.prop(`href`),r=n?n.startsWith(`/`)?new URL(n,u).href:n:void 0;r&&/\/(article|video)\/\w+\.html/.test(r)&&(p[r]={title:t.text(),link:r})}p=await Promise.all(Object.values(p).slice(0,l).map(e=>r.tryGet(e.link,async()=>{let r=s(await n(e.link)),c=r(`div.article-img img`).first(),l=r(`#video-player`).first();return e.title=r(`div.article-header h1`).eq(0).text(),e.description=i(o.join(t,`templates/description-55895928.art`),{image:c?{src:c.prop(`src`),alt:c.next(`p`).text()||e.title}:void 0,video:l?{src:l.prop(`data-url`),poster:l.prop(`data-poster`),width:l.prop(`width`),height:l.prop(`height`)}:void 0,intro:r(`div.article-header p`).text(),description:r(`div.article-content`).html()}),e.author=r(`span.author`).first().find(`a`).toArray().map(e=>r(e).text()).join(`/`),e.category=r(`meta.meta-container a`).toArray().map(e=>r(e).text()),e.pubDate=a(r(`div.article-info span[data-article-publish-time]`).prop(`data-article-publish-time`),`X`),e.upvotes=r(`span.opt-praise__count`).text()?Number.parseInt(r(`span.opt-praise__count`).text(),10):0,e.comments=r(`span.opt-comment__count`).text()?Number.parseInt(r(`span.opt-comment__count`).text(),10):0,e})));let h=f(`title`).text(),g=h.split(/_/),_=f(`div.logo img`).prop(`src`),v=new URL(f(`link[rel="icon"]`).prop(`href`),u).href;return{item:p,title:h,link:d,description:f(`meta[name="description"]`).prop(`content`),language:f(`html`).prop(`lang`),image:_,icon:v,logo:v,subtitle:g[0],author:g.pop()}};export{c as t};