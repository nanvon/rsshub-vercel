import{__dirname as e,init_esm_shims as t}from"./esm-shims-B6VgfGYP.js";import{config as n}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./proxy-DMKMSIEA.js";import{ofetch_default as r}from"./ofetch-D4MiciTC.js";import{cache_default as i}from"./cache-Dfid4xgQ.js";import{art as a}from"./render-CSnicFA3.js";import{not_found_default as o}from"./not-found-o393tAVF.js";import{getPuppeteerPage as s}from"./puppeteer-DGJWMOFh.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/profile/:id/:type?/:functionalFlag?`,categories:[`social-media`],example:`/picuki/profile/linustech`,parameters:{id:`Tiktok user id (without @)`,type:{description:`Type of profile page`,options:[{value:`profile`,label:`Profile Page`},{value:`story`,label:`Story Page`}],default:`profile`},functionalFlag:{description:`Functional flag for video embedding`,options:[{value:`0`,label:`Off, only show video poster as an image`},{value:`1`,label:`On`}],default:`1`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.picuki.com/profile/:id`],target:`/profile/:id`},{source:[`www.picuki.com/story/:id`],target:`/profile/:id/story`}],name:`User Profile - Picuki`,maintainers:[`hoilc`,`Rongronggg9`,`devinmugen`,`NekoAria`],handler:d};async function d(t){let u=t.req.param(`id`),d=t.req.param(`type`)??`profile`,f=(t.req.param(`functionalFlag`)??`1`)!==`0`,p=`https://www.picuki.com`,m=`${p}/${d===`story`?`story`:`profile`}/${u}`,h=await i.tryGet(`picuki:${d}:${u}`,async()=>{let e;try{e=await r(m,{headers:{"User-Agent":n.trueUA}})}catch(t){if(t.status===403){let{page:t,destory:n}=await s(m,{onBeforeLoad:async e=>{let t=new Set([`document`,`script`,`xhr`,`fetch`]);await e.setRequestInterception(!0),e.on(`request`,e=>{t.has(e.resourceType())?e.continue():e.abort()})}});await t.waitForSelector(`.content`),e=await t.content(),await n()}else throw new o(t.message)}let t=l(e);if(t(`.posts-empty`).length)throw Error(t(`.posts-empty`).text().trim()||`No posts found`);if(t(`.error-p`).length)throw Error(t(`.error-p span`).text().trim()||`Profile not found`);let i=t(`.profile-info .username`).text().trim(),a=t(`.posts-video .posts__video-item`).toArray().map(e=>{let n=t(e),r=n.attr(`href`)?.split(`/`).pop(),a=n.find(`img`);return{title:a.attr(`alt`)||``,author:i,renderData:{poster:a.attr(`src`),source:n.find(`.popup-open`).data(`source`),id:r},link:`${p}/media/${r}`,guid:`https://www.tiktok.com/@${u}/video/${r}`}});return{title:t(`head title`).text(),description:t(`.posts-current`).text().trim(),image:t(`.profile-image`).attr(`src`),items:a}}),g=h.items.map(t=>({...t,description:a(c.join(e,`templates/user-3df0b995.art`),{poster:t.renderData.poster,source:t.renderData.source,useIframe:f,id:t.renderData.id})}));return{title:h.title,link:m,image:h.image,description:h.description,item:g}}export{u as route};