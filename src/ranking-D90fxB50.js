import"./esm-shims-BC3isTv8.js";import{t as e}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./proxy-CczVputb.js";import"./ofetch-CfXAR0UO.js";import{a as t}from"./helpers-Cqaav28H.js";import"./cache-CpEhLexq.js";import"./render-d6AVTUl2.js";import"./md5-CWsm3r0H.js";import{t as n}from"./got-dCh-Ojgc.js";import{t as r}from"./types-Bn7An2Wc.js";import"./puppeteer-e0F06Yyi.js";import{n as i,r as a}from"./utils-BH_8d4Ca.js";import{t as o}from"./cache-B6jdWWR2.js";const s=[`0`,`1`,`4`,`168`,`3`,`1`,`3`,`129`,`4`,`36`,`188`,`234`,`223`,`160`,`211`,`217`,`119`,`155`,`5`,`181`,`2`,`5`,`7`,`0`,`0`],c=[`全站`,`番剧`,`国产动画`,`国创相关`,`纪录片`,`动画`,`音乐`,`舞蹈`,`游戏`,`知识`,`科技`,`运动`,`汽车`,`生活`,`美食`,`动物圈`,`鬼畜`,`时尚`,`娱乐`,`影视`,`电影`,`电视剧`,`综艺`,`原创`,`新人`],l=[`all`,`bangumi`,`guochan`,`guochuang`,`documentary`,`douga`,`music`,`dance`,`game`,`knowledge`,`tech`,`sports`,`car`,`life`,`food`,`animal`,`kichiku`,`fashion`,`ent`,`cinephile`,`movie`,`tv`,`variety`,`origin`,`rookie`],u=[`x/rid`,`pgc/web`,`pgc/season`,`x/rid`,`pgc/season`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`pgc/season`,`pgc/season`,`pgc/season`,`x/type`,`x/type`],d={path:`/ranking/:rid_index?/:embed?/:redirect1?/:redirect2?`,name:`排行榜`,maintainers:[`DIYgod`,`hyoban`],categories:[`social-media`],view:r.Videos,example:`/bilibili/ranking/0`,parameters:{rid_index:{description:`排行榜分区 id 序号`,default:`0`,options:Array.from({length:s.length},(e,t)=>({value:String(t),label:c[t]})).filter((e,t)=>!u[t].startsWith(`pgc/`))},embed:`默认为开启内嵌视频, 任意值为关闭`,redirect1:`留空，用于兼容之前的路由`,redirect2:`留空，用于兼容之前的路由`},handler:m};function f(e){let t=s.indexOf(e);if(t===-1)throw Error(`Invalid rid`);return t}function p(e){if(e<0||e>=s.length)throw Error(`Invalid rid index`);let t=s[e],n=u[e],r=c[e],i=l[e],a=``;switch(n){case`x/rid`:a=`https://api.bilibili.com/x/web-interface/ranking?rid=${t}&type=all`;break;case`pgc/web`:a=`https://api.bilibili.com/pgc/web/rank/list?day=3&season_type=${t}`;break;case`pgc/season`:a=`https://api.bilibili.com/pgc/season/rank/web/list?day=3&season_type=${t}`;break;case`x/type`:a=`https://api.bilibili.com/x/web-interface/ranking?rid=0&type=${i}`;break;default:throw Error(`Invalid rid type`)}return{apiURL:a,referer:`https://www.bilibili.com/v/popular/rank/${i}`,ridChinese:r,ridType:n,link:`https://www.bilibili.com/v/popular/rank/${i}`}}async function m(r){let s=r.req.query(`format`)===`json`,c=r.req.param();if(c.redirect1||c.redirect2){let e=c.redirect2?`/`+c.redirect2:``;return r.set(`redirect`,`/bilibili/ranking/${f(c.rid_index)}${e}`),null}let l=r.req.param(`rid_index`)||`0`,u=!r.req.param(`embed`),{apiURL:d,referer:m,ridChinese:h,link:g,ridType:_}=p(Number(l));if(_.startsWith(`pgc/`))throw Error(`This type of ranking is not supported yet`);let v=await n({method:`get`,url:d,headers:{Referer:m}}),y=(v.data.data||v.data.result).list||[];return{title:`bilibili 排行榜-${h}`,link:g,item:await Promise.all(y.map(async n=>{let r=s&&!e.bilibili.excludeSubtitles&&n.bvid?await o.getVideoSubtitleAttachment(n.bvid):[];return{title:n.title,description:a.renderUGCDescription(u,n.pic,n.description||n.title,n.aid,void 0,n.bvid),pubDate:n.create&&new Date(n.create).toUTCString(),author:n.author,link:!n.create||new Date(n.create).getTime()/1e3>a.bvidTime&&n.bvid?`https://www.bilibili.com/video/${n.bvid}`:`https://www.bilibili.com/video/av${n.aid}`,image:n.pic,attachments:n.bvid?[{url:i(n.bvid),mime_type:`text/html`,duration_in_seconds:t(n.duration)},...r]:void 0}}))}}export{d as route};