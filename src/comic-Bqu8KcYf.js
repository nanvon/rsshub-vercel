import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{config as n}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as r}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as i}from"./cache-GwMhal7i.js";import{art as a}from"./render-DOz85fGU.js";import{ofetch_default as o}from"./ofetch-ZUQ1sEMc.js";import s from"node:path";import{load as c}from"cheerio";import l from"p-map";t();const u={path:`/comic/:id/:chapterCnt?`,categories:[`anime`],example:`/copymanga/comic/dianjuren/5`,parameters:{id:`漫画ID`,chapterCnt:"返回章节的数量，默认为 `10`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`漫画更新`,maintainers:[`btdwv`,`marvolo666`],handler:d};async function d(t){let u=t.req.param(`id`),d=Number(t.req.param(`chapterCnt`)||10),f=`www.mangacopy.com`,p=`https://${f}`,m=`https://${f}`,h=`${m}/api/v3/comic/${u}/group/default/chapters`,g=await i.tryGet(h,async()=>{let e=!1,t=[],n=0;do{e=!1;let r=await o(h,{headers:{platform:``},query:{limit:500,offset:n}}),{code:i,results:a}=r;if(i!==200)break;a.limit+a.offset<a.total&&(e=!0),n+=500,t=[...t,...a.list]}while(e);return t=t.map(({comic_path_word:e,uuid:t,name:n,size:i,datetime_created:a,ordered:o})=>({link:`${p}/comic/${e}/chapter/${t}`,guid:`https://copymanga.site/comic/${e}/chapter/${t}`,uuid:t,title:n,size:i,pubDate:r(a,`YYYY-MM-DD`),ordered:o})).sort((e,t)=>t.ordered-e.ordered),t},n.cache.routeExpire,!1),{bookTitle:_,bookIntro:v}=await i.tryGet(`${p}/comic/${u}`,async()=>{let e=await o(`${p}/comic/${u}`),t=c(e);return{bookTitle:t(`.comicParticulars-title-right > ul > li > h6`).text(),bookIntro:t(`.intro`).text()}}),y=async t=>{let{code:n,results:r}=await o(`${m}/api/v3/comic/${u}/chapter/${t.uuid}`,{headers:{webp:`1`}}),i=n===210?[]:r.chapter.contents.map(e=>({url:e.url.replace(`.c800x.`,`.c1500x.`)}));return{link:t.link,guid:t.guid,title:t.title,description:a(s.join(e,`templates/comic-da154ac8.art`),{size:t.size,contents:i}),pubDate:t.pubDate}},b=await l(g.slice(0,d),e=>i.tryGet(e.link,()=>y(e)),{concurrency:3}),x=[...b,...g.slice(d)];return{title:`拷贝漫画 - ${_}`,link:`${p}/comic/${u}`,description:v,item:x}}export{u as route};