import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-dCh-Ojgc.js";import o from"node:path";import{load as s}from"cheerio";e();const c=e=>{let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return`${String(t).padStart(2,`0`)}:${String(n).padStart(2,`0`)}:${String(r).padStart(2,`0`)}`},l={path:`/:channel?`,radar:[{source:[`www.transcriptforest.com/en/channel`],target:``}],name:`Unknown`,maintainers:[`nczitzk`],handler:u,url:`www.transcriptforest.com/en/channel`};async function u(e){let l=e.req.param(`channel`),u=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):10,d=`https://www.transcriptforest.com`,{data:f}=await a(d),p=JSON.parse(f.match(/({"props".*"scriptLoader":\[]})<\/script>/)?.[1]),m=p.buildId,h=p.defaultLocale,g=p.props.pageProps.listChannel,_=l?g.find(e=>e.channel_id===l||e.channel_name===l):void 0,v=new URL(`_next/data/${m}/en${_?`/channel/${_.channel_id}`:``}.json`,d).href,y=new URL(_?`${h}/channel/${_.channel_id}`:``,d).href,{data:b}=await a(v,{searchParams:{channelName:_?_.channel_id:``,offset:0}}),x=b.pageProps.listEpisode.data.slice(0,u).map(e=>({title:e.episode_name,link:new URL(`${h}/${e.channel_id}/${e.episode_id}`,d).href,detailUrl:new URL(`_next/data/${m}/${h}/${e.channel_id}/${e.episode_id}.json`,d).href,description:r(o.join(t,`templates/description-e0151c0f.art`),{texts:e.episode_description.split(/\n\n/).map(e=>({text:e}))}),author:e.channel_name,guid:e.id,pubDate:i(e.published_at),updated:i(e.updated_at),itunes_item_image:e.episode_cover.split(/\?/)[0],itunes_duration:e.episode_duration,enclosure_url:e.source_media,enclosure_type:`audio/mpeg`}));x=await Promise.all(x.map(e=>n.tryGet(e.link,async()=>{let{data:n}=await a(e.detailUrl),{data:i}=await a(n.pageProps.currentEpisode.ps4_url);return e.description=r(o.join(t,`templates/description-e0151c0f.art`),{audios:[{src:n.pageProps.currentEpisode.media,type:`audio/mpeg`}]})+e.description+r(o.join(t,`templates/description-e0151c0f.art`),{texts:i.map(e=>({startTime:c(e.startTime),endTime:c(e.endTime),text:e.readOnlyText}))}),delete e.detailUrl,e})));let{data:S}=await a(y),C=s(S),w=C(`title`).text(),T=C(`meta[property="og:image"]`).prop(`content`),E=new URL(C(`link[rel="apple-touch-icon"]`).prop(`href`),d).href,D=w.split(/\|/)[0].trim();return{item:x,title:w,link:y,description:C(`meta[name="description"]`).prop(`content`),language:C(`html`).prop(`lang`),image:T,icon:E,logo:E,author:D,itunes_author:D,allowEmpty:!0}}export{l as route};