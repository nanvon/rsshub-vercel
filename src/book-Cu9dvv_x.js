import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-dCh-Ojgc.js";import{t as o}from"./timezone-BPfwRbwD.js";import{t as s}from"./types-Bn7An2Wc.js";import c from"node:path";import{load as l}from"cheerio";import u from"iconv-lite";e();const d={path:`/book/:id?`,categories:[`reading`],view:s.Notifications,example:`/jjwxc/book/7013024`,parameters:{id:`作品 id，可在对应作品页中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`作品章节`,maintainers:[`nczitzk`],handler:f};async function f(e){let s=e.req.param(`id`),d=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):100,f=`https://www.jjwxc.net`,p=new URL(`onebook.php?novelid=${s}`,f).href,{data:m}=await a(p,{responseType:`buffer`}),h=l(u.decode(m,`gbk`)),g=h(`meta[name="Author"]`).prop(`content`),_=h(`meta[name="Keywords"]`).prop(`content`).split(/,/);_.pop();let v=_.pop(),y=h(`tr[itemprop="chapter"]`).toArray().map(e=>{e=h(e);let n=e.find(`td`).first().text().trim(),a=e.find(`span[itemprop="headline"]`).text().trim(),l=e.find(`td`).eq(2).text().trim(),u=new URL(`onebook.php?novelid=${s}&chapterid=${n}`,f).href,d=e.find(`td[itemprop="wordCount"]`).text(),p=e.find(`td.chapterclick`).text(),m=e.find(`td`).last().text().trim(),_=e.find(`span[itemprop="headline"] font`).last().text()===`[VIP]`,y=e.find(`td`).eq(1).last().text().trim()===`[锁]`;return{title:`${a} ${l}`,link:u,description:r(c.join(t,`templates/book-6ec795d5.art`),{chapterId:n,chapterName:a,chapterIntro:l,chapterUrl:u,chapterWords:d,chapterClicks:p,chapterUpdatedTime:m}),author:g,category:[_?`VIP`:void 0,...v?.split(/\s/)??[]].filter(Boolean),guid:`jjwxc-${s}#${n}`,pubDate:o(i(m),8),isVip:_,isLock:y}});y.reverse(),y=await Promise.all(y.slice(0,d).map(e=>e.isLock?Promise.resolve(e):n.tryGet(e.link,async()=>{if(!e.isVip){let{data:n}=await a(e.link,{responseType:`buffer`}),i=l(u.decode(n,`gbk`));i(`span.favorite_novel`).parent().remove(),e.description+=r(c.join(t,`templates/book-6ec795d5.art`),{description:i(`div.novelbody`).html()})}return delete e.isVip,e})));let b=h(`div.logo a img`),x=`https:${b.prop(`src`)}`,S=new URL(`favicon.ico`,f).href;return{item:y,title:`${b.prop(`alt`).replace(/logo/,``)} | ${g}${_[0]}`,link:p,description:h(`span[itemprop="description"]`).text(),language:`zh`,image:x,icon:S,logo:S,subtitle:h(`meta[name="Description"]`).prop(`content`),author:h(`meta[name="Author"]`).prop(`content`)}}export{d as route};