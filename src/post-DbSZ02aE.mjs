import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import"./ofetch-BRplXtiZ.mjs";import"./config-D7dgKYF5.mjs";import"./logger-CkUWGGaS.mjs";import"./helpers-Tm7Pw8Vq.mjs";import{t as n}from"./parse-date-_GmTZfjS.mjs";import{r}from"./common-utils-Cdz0xo5t.mjs";import{t as i}from"./render-CSqLtqb8.mjs";import{t as a}from"./got-BglkE51W.mjs";import o from"node:path";import{load as s}from"cheerio";e();const c={path:`*`,name:`Unknown`,maintainers:[],handler:l};async function l(e){let c=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,l=`https://aqara.com`,u=`wp-json/wp/v2`,d,f=l,p=new URL(`${u}/posts?_embed=true&per_page=${c}`,l).href,m=r(e).match(/^\/([^/]*)\/([^/]*)\/(.*)$/);if(m){let e=m[1],t=m[2]===`tag`?`tags`:m[2]===`category`?`categories`:m[2],n=decodeURI(m[3].split(`/`).pop()),r=new URL(`${e}/${u}/${t}?search=${n}`,l).href,{data:i}=await a(r),o=i.pop();(o?.id??void 0)&&(d=o.name??n,f=o.link??f,p=new URL(`${e}/${u}/posts?_embed=true&per_page=${c}&${t}=${o.id}`,l).href)}let{data:h}=await a(p),g=h.slice(0,c).map(e=>{let r=e._embedded[`wp:term`],a=s(e.content?.rendered??e.content);return a(`figure`).each(function(){let e=a(this).find(`img`),n=(e.prop(`data-actualsrc`)??e.prop(`data-original`)??e.prop(`src`)).replace(/(-\d+x\d+)/,``),r=e.prop(`data-rawwidth`)??e.prop(`width`),s=e.prop(`data-rawheight`)??e.prop(`height`);a(this).replaceWith(i(o.join(t,`templates/figure-954623e8.art`),{src:n,width:r,height:s}))}),{title:e.title?.rendered??e.title,link:e.link,description:a.html(),author:e._embedded.author.map(e=>e.name).join(`/`),category:r.flat().map(e=>e.name),guid:e.guid?.rendered??e.guid,pubDate:n(e.date_gmt),updated:n(e.modified_gmt)}}),{data:_}=await a(f),v=s(_),y=v(`link[rel="apple-touch-icon"]`).first().prop(`href`),b=v(`meta[property="og:site_name"]`).prop(`content`)??`Aqara`;return{item:g,title:`${b}${d?` - ${d}`:``}`,link:f,description:v(`meta[property="og:title"]`).prop(`content`),language:v(`meta[property="og:locale"]`).prop(`content`),image:v(`meta[name="msapplication-TileImage"]`).prop(`content`),icon:y,logo:y,subtitle:v(`meta[property="og:type"]`).prop(`content`),author:b}}export{c as route};