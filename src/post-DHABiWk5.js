import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{art as n}from"./render-DftO2d-b.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{got_default as i}from"./got-Di2lBekK.js";import{timezone as a}from"./timezone-CMz5pnRe.js";import o from"node:path";import{load as s}from"cheerio";t();async function c(e,t=0,n=7e6){let{data:r}=await i(`https://tieba.baidu.com/p/${e}?see_lz=${t}&pn=${n}&ajax=1`,{headers:{Referer:`https://tieba.baidu.com/`}}),a=s(r),o=Number.parseInt(a(`[max-page]`).attr(`max-page`));return o>n?c(e,o):r}const l={path:[`/tieba/post/:id`,`/tieba/post/lz/:id`],categories:[`bbs`],example:`/baidu/tieba/post/686961453`,parameters:{id:`帖子 ID`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`tieba.baidu.com/p/:id`]}],name:`帖子动态`,maintainers:[`u3u`],handler:u};async function u(t){let i=t.req.param(`id`),l=t.req.path.includes(`lz`)?1:0,u=s(await c(i,l)),d=u(`.core_title_txt`).attr(`title`),f=u(`.p_postlist > [data-field]:not(:has(.ad_bottom_view))`);return{title:l?`【只看楼主】${d}`:d,link:`https://tieba.baidu.com/p/${i}?see_lz=${l}`,description:`${d}的最新回复`,item:f.toArray().map(t=>{let s=u(t),{author:c,content:l}=s.data(`field`),f=s.find(`.post-tail-wrap > .tail-info`).toArray().map(e=>u(e).text()),[p,m,h,g]=[``,``,``,``];return f.length===0&&`date`in l?(h=`${l.post_no}楼`,g=l.date,p=s.find(`.j_d_post_content`).html()):f.length===2?([h,g]=f,p=l.content):f.length===3&&([m,h,g]=f,p=l.content),{title:`${c.user_name}回复了帖子《${d}》`,description:n(o.join(e,`templates/post-c443ff41.art`),{pubContent:p,author:c.user_name,num:h,from:m}),pubDate:a(r(g,`YYYY-MM-DD hh:mm`),8),link:`https://tieba.baidu.com/p/${i}?pid=${l.post_id}#${l.post_id}`}})}}export{l as route};