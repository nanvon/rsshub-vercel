import"./esm-shims-B6VgfGYP.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CHIwZNTj.js";import"./helpers-gUVC02jt.js";import{got_default as e}from"./got-BXZNsAGk.js";import{load as t}from"cheerio";const n={path:`/trophy/:id`,categories:[`game`],example:`/ps/trophy/DIYgod_`,parameters:{id:`User ID`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`PlayStation Network user trophy`,maintainers:[`DIYgod`],handler:r};async function r(n){let r=n.req.param(`id`),i=await e({method:`get`,url:`https://psnprofiles.com/${r}?order=last-trophy`}),a=t(i.data),o=a(`.zebra tr`).filter(e=>a(e).find(`.progress-bar span`).text()!==`0%`).toArray().map(e=>a(e).find(`.title`).attr(`href`)).slice(0,3),s=await Promise.all(o.map(async n=>{let r=`https://psnprofiles.com`+n+`?order=date&trophies=earned&lang=zh-cn`,i=await e({method:`get`,url:r}),a=t(i.data);return a(`.zebra tr.completed`).toArray().map(e=>(e=a(e),{title:e.find(`.title`).text()+` - `+a(`.page h3`).eq(0).text().trim().replace(` Trophies`,``),description:`<img src="${e.find(`.trophy source`).attr(`srcset`).split(` `)[1]}"><br>${e.find(`.title`).parent().contents().filter((e,t)=>t.nodeType===3).text().trim()}<br>等级：${{Platinum:`白金`,Gold:`金`,Silver:`银`,Bronze:`铜`}[e.find(`td`).eq(5).find(`img`).attr(`title`)]}<br>珍贵度：${e.find(`.hover-show .typo-top`).text()}`,link:`https://psnprofiles.com`+e.find(`.title`).attr(`href`),pubDate:new Date(+new Date(e.find(`.typo-top-date nobr`).contents().filter((e,t)=>t.nodeType===3).text()+` `+e.find(`.typo-bottom-date`).text())+480*60*1e3).toUTCString()}))})),c=[];for(let e of s)c=[...c,...e];return c=c.toSorted((e,t)=>new Date(t.pubDate)-new Date(e.pubDate)),{title:`${r} 的 PSN 奖杯`,link:`https://psnprofiles.com/${r}/log`,item:c}}export{n as route};