import"./esm-shims-rNwigI-Q.js";import{config as e}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as t}from"./ofetch-CeMUzp5K.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{generateNonce as i,getPost as a,phoneBaseUrl as o,sign as s,webBaseUrl as c}from"./utils-Cjwoe8Hg.js";const l={path:`/bbs/special/:specialId`,categories:[`bbs`],example:`/dxy/bbs/special/72`,parameters:{specialId:`专题 ID，可在对应专题页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`专题`,maintainers:[`TonyRL`],handler:u};async function u(l){let u=l.req.param(`specialId`),{limit:d=`10`}=l.req.query(),f=await n.tryGet(`dxy:special:detail:${u}`,async()=>{let e={specialId:u,requestType:`h5`,timestamp:Date.now(),noncestr:i(8,`number`)},n=await t(`${o}/newh5/bbs/special/detail`,{query:{...e,sign:s(e)}});if(n.code!==`success`)throw Error(n.message);return n.data}),p=(await n.tryGet(`dxy:special:recommend-list-v3:${u}`,async()=>{let e={specialId:u,requestType:`h5`,pageNum:`1`,pageSize:d,timestamp:Date.now(),noncestr:i(8,`number`)},n=await t(`${o}/newh5/bbs/special/post/recommend-list-v3`,{query:{...e,sign:s(e)}});if(n.code!==`success`)throw Error(n.message);return n.data},e.cache.routeExpire,!1)).result.map(e=>{let{postInfo:t,dataTime:n,entityId:i}=e;return{title:t.subject,description:t.simpleBody,pubDate:r(n,`x`),author:t.postUser.nickname,category:[t.postSpecial.specialName],link:`${c}/bbs/newweb/pc/post/${i}`,postId:i}}),m=await Promise.all(p.map(e=>a(e,n.tryGet)));return{title:f.name,description:`${f.content} ${f.postCount} 內容 ${f.followCount} 关注`,link:`${o}/bbs/special?specialId=${u}`,image:f.specialAvatar,item:m}}export{l as route};