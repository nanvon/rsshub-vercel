import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-BpwDbAkH.js";import"./logger-B3QfaIfn.js";import"./dist-CKN2M7CD.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-BWStd97H.js";import"./md5-4BNsOP-F.js";import"./ofetch-CYKAhM9L.js";import{got_default as n}from"./got-pWlL3EH4.js";import"./config-not-found-BVqhRP9D.js";import{_access_default as r,getMangaChapters as i,getMangaMetaByIds as a}from"./_feed-Dr7G1V5E.js";const o={reading:`reading`,"plan-to-read":`plan_to_read`,completed:`completed`,"on-hold":`on_hold`,"re-reading":`re_reading`,dropped:`dropped`},s={reading:`Reading`,"plan-to-read":`Plan to Read`,completed:`Completed`,"on-hold":`On Hold`,"re-reading":`Re-reading`,dropped:`Dropped`},c={path:`/user/follow/:type?`,name:`Logged User's Followed Mangas Feed`,maintainers:[`chrisis58`],example:`/mangadex/user/follow/reading`,description:`Fetches the feed of mangas that you follow on MangaDex whick are in the specified status.
CAUTION: With big amount of follows, it may take a long time to load or even fail.
It's recommended to use the \`/mangadex/mdlist/:listId?\` route instead for better performance, though it requires manual configuration.`,categories:[`anime`],parameters:{type:{description:`The type of follows to fetch`,default:`reading`,options:[{value:`reading`,label:`Reading`},{value:`plan-to-read`,label:`Plan to Read`},{value:`completed`,label:`Completed`},{value:`on-hold`,label:`On Hold`},{value:`re-reading`,label:`Re-reading`},{value:`dropped`,label:`Dropped`}]}},radar:[{source:[`mangadex.org/titles/follows`],target:`/user/follow/reading`}],features:{requireConfig:[{name:`MANGADEX_USERNAME`,description:`MangaDex Username, required when refresh-token is not set`,optional:!0},{name:`MANGADEX_PASSWORD`,description:`MangaDex Password, required when refresh-token is not set`,optional:!0},{name:`MANGADEX_CLIENT_ID`,description:`MangaDex Client ID`,optional:!1},{name:`MANGADEX_CLIENT_SECRET`,description:`MangaDex Client Secret`,optional:!1},{name:`MANGADEX_REFRESH_TOKEN`,description:`MangaDex Refresh Token, required when username and password are not set`,optional:!0}]},handler:l};async function l(c){let{type:l}=c.req.param(),d=l||`reading`,f=await r(),p=await t.tryGet(`mangadex:user-follow-${d}`,async()=>{let t=await n.get(`https://api.mangadex.org/manga/status`,{headers:{Authorization:`Bearer ${f}`,"User-Agent":e.trueUA}}),r=t?.data?.statuses;if(!r)throw Error(`Failed to retrieve user follows from MangaDex API.`);return r},e.cache.routeExpire,!1),m=u(p,o[d]),h=await a(m),g=await Promise.all(m.map(e=>i(e,void 0,10))),_=g.flatMap((e,t)=>{let n=h.get(m[t]);return e.map(e=>({title:n?.title??`Unknown`,link:e.link,pubDate:e.pubDate,description:e.title??``,image:n?.cover??``}))});return{title:`User Follows - ${s[d]} Mangas`,link:`https://mangadex.org/titles/follows?tab=${d}`,description:`Followed Mangas`,item:_}}const u=(e,t)=>Object.entries(e).filter(([,e])=>e===t).map(([e])=>e);export{c as route};