import{n as e,t}from"./esm-shims-C3MSy80G.mjs";import{t as n}from"./config-PItPnVIx.mjs";import{t as r}from"./render-ZYpwNl2L.mjs";import{t as i}from"./parse-date-9Tu6hSFW.mjs";import{t as a}from"./got-BYElsd7I.mjs";import o from"node:path";import{load as s}from"cheerio";e();const c=async(e,t,n,r)=>{let{data:i}=await a(`https://${e}.news.yahoo.com/_td-news/api/resource/NCPListService;api=archive;ncpParams=${encodeURIComponent(JSON.stringify({query:{count:t,start:0,providerid:r,tag:n}}))}`);return i},l=async(e,t)=>{let{data:n}=await a(`https://${e}.news.yahoo.com/_td-news/api/resource/StreamService;category=LISTID%3A${t};useNCP=true`);return n},u=(e,t)=>t(`yahoo:${e}:categoryMap`,async()=>{let{PageStore:n}=await f(e,t),{Col1:r}=n.pagesConfigRaw.base.section.regions,{categoryMap:i}=r.find(e=>e.name===`ArchiveFilterBar`).props;for(let[e,t]of Object.entries(i))i[e]={name:t,yctMap:r.find(e=>e.name===`StreamContainerArchive`).props.yctMap[e]};return i}),d=(e,t)=>t(`yahoo:${e}:providerList`,async()=>{let{ProviderListStore:n}=await f(e,t);return n.providerList.flatMap(t=>t.providers.map(n=>({title:`${t.title} - ${n.title}`,key:n.key,link:new URL(n.url,`https://${e}.news.yahoo.com`).href})))}),f=(e,t)=>t(`yahoo:${e}:stores`,async()=>{let{data:t}=await a(`https://${e}.news.yahoo.com/archive`),n=s(t);return JSON.parse(n(`script:contains("root.App.main")`).text().match(/root.App.main\s+=\s+({.+});/)?.[1]).context.dispatcher.stores}),p=(e,t)=>t.map(t=>({title:t.title,link:t.url.startsWith(`http`)?t.url:new URL(t.url,`https://${e}.news.yahoo.com`).href,description:t.summary,pubDate:i(t.published_at,`X`)})),m=(e,c)=>c(e.link,async()=>{let{data:c}=await a(e.link,{headers:{"User-Agent":n.trueUA}}),l=s(c),u=JSON.parse(l(`script[type="application/ld+json"]`).toArray().find(e=>l(e).text().includes(`"@type":"NewsArticle"`))?.children[0].data),d=u.author.name,f=l(`.atoms`);return f.find(`noscript, .text-gandalf, [id^="sda-inbody-"]`).remove(),f.find(`.caas-figure-with-pb, .caas-img-container`).each((e,t)=>{l(t).removeAttr(`style`)}),f.find(`img`).each((e,t)=>{let n=l(t),r=n.data(`src`);if(r){let e=r.match(/.*--\/.*--\/(.*)/);e?.[1]&&(r=e?.[1]),n.attr(`src`,r),n.removeAttr(`data-src`)}}),f.find(`.caas-iframe`).each((e,n)=>{let i=l(n);if(i.data(`type`)===`youtube`){let e=i.find(`blockquote`).data(`src`);i.replaceWith(r(o.join(t,`templates/youtube-c5469910.art`),{id:e.split(`/`).pop()?.split(`?`)?.[0]}))}}),e.description=f.html(),e.author=d,e.category=u.keywords,e.pubDate=i(u.datePublished),e.updated=i(u.dateModified),e});export{m as a,d as i,u as n,p as o,l as r,c as t};