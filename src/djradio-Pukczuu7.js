import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import{config as n}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CbgiXYAi.js";import"./helpers-gUVC02jt.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-Do9KqzqD.js";import s from"node:path";t();const c={path:`/music/djradio/:id/:info?`,categories:[`multimedia`],example:`/163/music/djradio/347317067`,parameters:{id:`节目 id, 可在电台节目页 URL 中找到`,info:`默认在正文尾部显示节目相关信息，任意值为不显示`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},name:`电台节目`,maintainers:[`magic-akari`],handler:u},l=(e,t,i)=>r.tryGet(`163:music:djradio:${e}:${t}:${i}`,async()=>await o.post(`https://music.163.com/api/dj/program/byradio`,{headers:{Referer:`https://music.163.com/`},form:{radioId:e,limit:t,offset:i}}),n.cache.routeExpire,!1);async function u(t){let n=t.req.param(`id`),r=!t.req.param(`info`),o=await l(n,1,0),{radio:c,dj:u}=(o.data.programs||[])[0]||{radio:{},dj:{}},d=o.data.count||0,f=Array.from({length:Math.ceil(d/500)},(e,t)=>t),p=await Promise.all(f.map(async t=>((await l(n,500,t*500)).data.programs||[]).map(t=>{let n=(t.description||``).split(`
`).map(e=>e),o=Math.trunc(t.duration/1e3),c=`${(o/60).toFixed(0).padStart(2,`0`)}:${(o%60).toFixed(0).padStart(2,`0`)}`,l=i(s.join(e,`templates/djradio-content-def0dea8.art`),{pg:t,description:n,itunes_duration:c,info:r});return{title:t.name,link:`https://music.163.com/program/`+t.id,pubDate:a(t.createTime),published:a(t.createTime),author:t.dj.nickname,description:l,content:{html:l},itunes_item_image:t.coverUrl,enclosure_url:`https://music.163.com/song/media/outer/url?id=${t.mainTrackId}.mp3`,enclosure_type:`audio/mpeg`,itunes_duration:o}})));return{title:c.name,link:`https://music.163.com/djradio?id=${n}`,subtitle:c.desc,description:c.desc,author:u.nickname,updated:c.lastProgramCreateTime,icon:c.picUrl,image:c.picUrl,itunes_author:u.nickname,itunes_category:c.category,item:p.flat()}}export{c as route};