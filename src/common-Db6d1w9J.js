import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import{ofetch_default as n}from"./ofetch-rK3Yp7nj.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-DftO2d-b.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import o from"node:path";import{load as s}from"cheerio";t();const c=async t=>{let{category:c=``}=t.req.param(),l=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,u=`https://www.jiemian.com`,d=new URL(c?`${c}.html`:``,u).href,f=s(await n(d)),p={},m=f(`a`).toArray();for(let e of m){let t=f(e),n=t.prop(`href`),r=n?n.startsWith(`/`)?new URL(n,u).href:n:void 0;r&&/\/(article|video)\/\w+\.html/.test(r)&&(p[r]={title:t.text(),link:r})}p=await Promise.all(Object.values(p).slice(0,l).map(t=>r.tryGet(t.link,async()=>{let r=s(await n(t.link)),c=r(`div.article-img img`).first(),l=r(`#video-player`).first();return t.title=r(`div.article-header h1`).eq(0).text(),t.description=i(o.join(e,`templates/description-55895928.art`),{image:c?{src:c.prop(`src`),alt:c.next(`p`).text()||t.title}:void 0,video:l?{src:l.prop(`data-url`),poster:l.prop(`data-poster`),width:l.prop(`width`),height:l.prop(`height`)}:void 0,intro:r(`div.article-header p`).text(),description:r(`div.article-content`).html()}),t.author=r(`span.author`).first().find(`a`).toArray().map(e=>r(e).text()).join(`/`),t.category=r(`meta.meta-container a`).toArray().map(e=>r(e).text()),t.pubDate=a(r(`div.article-info span[data-article-publish-time]`).prop(`data-article-publish-time`),`X`),t.upvotes=r(`span.opt-praise__count`).text()?Number.parseInt(r(`span.opt-praise__count`).text(),10):0,t.comments=r(`span.opt-comment__count`).text()?Number.parseInt(r(`span.opt-comment__count`).text(),10):0,t})));let h=f(`title`).text(),g=h.split(/_/),_=f(`div.logo img`).prop(`src`),v=new URL(f(`link[rel="icon"]`).prop(`href`),u).href;return{item:p,title:h,link:d,description:f(`meta[name="description"]`).prop(`content`),language:f(`html`).prop(`lang`),image:_,icon:v,logo:v,subtitle:g[0],author:g.pop()}};export{c as handler};