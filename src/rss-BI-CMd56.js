import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-Di2lBekK.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import{rss_parser_default as s}from"./rss-parser-PDXVbDgf.js";import c from"node:path";import{load as l}from"cheerio";t();const u=new Set([`tw`,`hk`]),d={path:`/:region?`,categories:[`new-media`],example:`/eprice/tw`,parameters:{region:`地区，预设为 tw`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新消息`,maintainers:[`TonyRL`],handler:f,description:`地区：

| hk   | tw   |
| ---- | ---- |
| 香港 | 台湾 |`};async function f(t){let d=t.req.param(`region`)??`tw`;if(!u.has(d))throw new o(`Invalid region`);let f=await s.parseURL(`https://www.eprice.com.${d}/news/rss.xml`);for(let e of f.items)e.link=e.link.replace(/^http:\/\//i,`https://`);let p=await Promise.all(f.items.map(t=>n.tryGet(t.link,async()=>{let n=l((await a(t.link,{headers:{Referer:`https://www.eprice.com.${d}`}})).data);return n(`noscript`).remove(),n(`div[id^=dablewidget]`).remove(),n(`div[class^=parallax-ads]`).remove(),n(`.adsbygoogle, .join-eprice-fb, .teads`).remove(),n(`div.ad-336x280-g, div.ad-728x90-g`).remove(),n(`div.clear, div.news-vote, div.signature`).remove(),n(`ul.inner, ul.navigator, ul.infobar`).remove(),n(`iframe[src^="https://www.facebook.com/plugins/like.php"]`).remove(),t.category=t.categories,n(`a`).each((t,i)=>{i=n(i),i.attr(`href`)&&i.attr(`href`).endsWith(`.jpg`)&&(i.after(r(c.join(e,`templates/image-7c03cac4.art`),{alt:i.attr(`title`),src:i.attr(`href`)})),i.remove())}),n(`img`).each((e,t)=>{t=n(t),t.attr(`data-original`)&&t.attr(`src`,t.attr(`data-original`))}),delete t.categories,delete t.content,delete t.contentSnippet,delete t.creator,delete t.enclosure,delete t.isoDate,t.description=n(`div.user-comment-block`).html()||n(`div.content`).html()||n(`li.inner`).html()||n(`div.section-content`).html()||n(`.article__content`).html(),t.pubDate=i(t.pubDate),t}))),m={title:f.title,link:f.link,description:f.description,item:p,image:f.image.url,language:f.language};return t.set(`json`,m),m}export{d as route};