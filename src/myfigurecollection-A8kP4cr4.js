import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./got-BlqYKpVp.js";import{t as a}from"./invalid-parameter-CLGd_tte.js";import{t as o}from"./valid-host-COjFWLEv.js";import s from"node:path";import{load as c}from"cheerio";e();const l={potd:`picture/browse/potd/`,potw:`picture/browse/potw/`,potm:`picture/browse/potm/`},u={path:`/:category?/:language?`,categories:[`shopping`],example:`/myfigurecollection/potd`,parameters:{category:`分类，默认为每日圖片`,language:"语言，见上表，默认为空，即 `en`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`zh.myfigurecollection.net/browse`,`zh.myfigurecollection.net/`]}],name:`圖片`,maintainers:[`nczitzk`],handler:d,url:`zh.myfigurecollection.net/browse`,description:`| 每日圖片 | 每週圖片 | 每月圖片 |
| -------- | -------- | -------- |
| potd     | potw     | potm     |`};async function d(e){let u=e.req.param(`language`)??``,d=e.req.param(`category`)??`figure`;if(u&&!o(u))throw new a(`Invalid language`);let f=`https://${u===`en`||u===``?``:`${u}.`}myfigurecollection.net`,p=`${f}/${Object.hasOwn(l,d)?l[d]:d}`,m=c((await i({method:`get`,url:p})).data),h=m(`.item-icon, .picture-icon`).slice(0,e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):25).toArray().map(e=>{e=m(e).find(`a`);let t=e.attr(`href`);return{link:t.startsWith(`http`)?t:`${f}${t}`}});return h=await Promise.all(h.map(e=>n.tryGet(e.link,async()=>{try{let n=c((await i({method:`get`,url:e.link})).data);e.title=n(`.headline`).text(),e.description=r(s.join(t,`templates/description-49fdbaa3.art`),{pictures:/myfigurecollection\.net\/picture\//.test(e.link)?[{src:n(`meta[property="og:image"]`).attr(`content`)}]:JSON.parse(decodeURIComponent(n(`meta[name="pictures"]`).attr(`content`))),fields:n(`.form-field`).toArray().map(e=>({key:n(e).find(`.form-label`).text(),value:n(e).find(`.form-input`).text()}))})}catch{e.title=`Item #${e.link.split(`/`).pop()}`}return e}))),{title:m(`title`).text().replace(/ \(.*\)/,``),link:p,item:h}}export{u as route};