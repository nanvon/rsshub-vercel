import"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-DqHh1IN2.js";import"./helpers-gUVC02jt.js";import{cache_default as e}from"./cache-Dfid4xgQ.js";import{got_default as t}from"./got-VGofQtEf.js";const n={path:`/topic/:id/:sort?`,categories:[`social-media`],example:`/douban/topic/48823`,parameters:{id:`话题id`,sort:`排序方式，hot或new，默认为new`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`话题`,maintainers:[`LogicJake`,`pseudoyu`,`haowenwu`],handler:r};async function r(n){let r=n.req.param(`id`),i=n.req.param(`sort`)||`new`,a=`https://www.douban.com/gallery/topic/${r}/?sort=${i}`,o=`https://m.douban.com/rexxar/api/v2/gallery/topic/${r}/items?sort=${i}&start=0&count=10&status_full_text=1`,s=(await t({method:`GET`,url:o,headers:{Referer:a}})).data.items,c=r,l=``;s[0].topic!==null&&(c=s[0].topic.name,l=s[0].topic.introduction);let u=await Promise.all(s.map(async n=>{let r=n.target.type,i,a,o,s,c;if(r===`status`){s=n.target.status.sharing_url.split(`&`)[0],i=n.target.status.author.name,c=i+`的广播`,a=n.target.status.create_time,o=n.target.status.text;let e=n.target.status.images;if(e){let t;for(t in e)o+=`<br><img src="${e[t].normal.url}" />`}}else if(r===`topic`){s=n.target.sharing_url,i=n.target.author.name,c=n.target.title,a=n.target.create_time,o=n.target.abstract;let e=n.target.photos;if(e){let t;for(t in e)o+=`<br><img src="${e[t].src}" />`}}else{s=n.target.sharing_url,i=n.target.author.name,c=i+`的日记`,a=n.target.create_time;let r=`https://www.douban.com/j/note/${n.target.id}/full`,l=await e.get(s);if(l)return JSON.parse(l);o=(await t.get(r)).data.html}let l={title:c,link:s,author:i,pubDate:new Date(a).toUTCString(),description:o};return r!==`status`&&e.set(s,JSON.stringify(l)),l}));return{title:`${c}-豆瓣话题`,description:l,link:a,item:u}}export{n as route};