import"./esm-shims-Dqvxr0BZ.js";import"./config-BL2l-VlN.js";import{logger_default as e}from"./logger-DWogN5HJ.js";import{ofetch_default as t}from"./ofetch-e4r9n7lx.js";import{cache_default as n}from"./cache-BjesfGXD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{rss_parser_default as i}from"./rss-parser-_khLPC8J.js";import{load as a}from"cheerio";const o={path:`/`,categories:[`finance`],example:`/decrypt`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`News`,maintainers:[`pseudoyu`],handler:s,radar:[{source:[`decrypt.co/`],target:`/`}],description:`Get latest news from Decrypt.`};async function s(t){let a=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,o=await i.parseURL(`https://decrypt.co/feed`),s=await Promise.all(o.items.filter(e=>e&&e.link&&!e.link.includes(`/videos`)).slice(0,a).map(t=>n.tryGet(`decrypt:article:${t.link}`,async()=>{if(!t.link)return{};try{let e=await c(t.link);return{title:t.title||`Untitled`,link:t.link.split(`?`)[0],pubDate:t.pubDate?r(t.pubDate):void 0,description:e?.fullText??(t.content||``),author:t.creator||`Decrypt`,category:e?.tags?[...new Set([...t.categories??[],...e.tags])]:t.categories||[],guid:t.guid||t.link,image:e?.featuredImage??t.enclosure?.url}}catch(n){return e.warn(`Couldn't fetch full content for ${t.link}: ${n.message}`),{title:t.title||`Untitled`,link:t.link.split(`?`)[0],pubDate:t.pubDate?r(t.pubDate):void 0,description:t.content||``,author:t.creator||`Decrypt`,category:t.categories||[],guid:t.guid||t.link,image:t.enclosure?.url}}})));return{title:o.title||`Decrypt`,link:o.link||`https://decrypt.co`,description:o.description||`Latest news from Decrypt`,item:s,language:o.language||`en`,image:o.image?.url}}async function c(n){try{let e=await t(n),r=a(e),i=JSON.parse(r(`script#__NEXT_DATA__`).text()).props.pageProps.post;return i.content.length?{fullText:`<img src="${i.featuredImage.src}" alt="${i.featuredImage.alt}">`+i.content,featuredImage:i.featuredImage.src,tags:i.tags.data.map(e=>e.name)}:null}catch(t){return e.error(`Error extracting full text from ${n}: ${t}`),null}}export{o as route};