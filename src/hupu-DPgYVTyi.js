import"./esm-shims-DE2PJqdr.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CJF2SF6b.js";import"./helpers-gUVC02jt.js";import{cache_default as e}from"./cache-Dfid4xgQ.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{got_default as n}from"./got-Baw2Nbdf.js";import{timezone as r}from"./timezone-CMz5pnRe.js";import{load as i}from"cheerio";function a(e){return`url`in e&&`isNews`in e}const o={nba:{title:`NBA`,data:`newsData`},cba:{title:`CBA`,data:`newsData`},soccer:{title:`足球`,data:`news`},"":{title:`首页`,data:`res`}},s={path:[`/dept/:category?`,`/:category?`],name:`手机虎扑网`,url:`m.hupu.com`,maintainers:[`nczitzk`,`hyoban`],example:`/hupu/nba`,parameters:{category:{description:`分类，可选值：nba、cba、soccer，默认为空（首页）`,default:``,options:Object.entries(o).map(([e,t])=>({label:t.title,value:e}))}},description:`::: tip
电竞分类参见 [游戏热帖](https://bbs.hupu.com/all-gg) 的对应路由 [\`/hupu/all/all-gg\`](https://rsshub.app/hupu/all/all-gg)。
:::`,categories:[`bbs`],radar:[{source:[`m.hupu.com/:category`,`m.hupu.com/`],target:`/:category`}],handler:async s=>{let c=s.req.param(`category`)||``;if(!(c in o))throw Error(`Invalid category. Valid options are: `+Object.keys(o).filter(Boolean).join(`, `));let l=c,u=`https://m.hupu.com/${l}`,d=(await n({method:`get`,url:u})).data.match(/<script id="__NEXT_DATA__" type="application\/json">(.*?)<\/script>/);if(!d||!d[1])throw Error(`Failed to find __NEXT_DATA__ script tag in page: ${u}`);let f=d[1],p;try{p=JSON.parse(f)}catch(e){throw Error(`Failed to parse full JSON data: ${e instanceof Error?e.message:String(e)}`)}let{pageProps:m}=p.props,h=o[l].data;if(!(h in m))throw Error(`Expected '${h}' property not found in pageProps for category: ${l||`home`}`);let g=(()=>{let e=m[h];return Array.isArray(e)?e:[]})().map(e=>a(e)?{title:e.title,link:e.url.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid,category:e.label?[e.label]:void 0}:{title:e.title,pubDate:r(t(e.publishTime),8),link:e.link.replace(/bbs\.hupu.com/,`m.hupu.com/bbs`),guid:e.tid});return g=await Promise.all(g.filter(e=>e.link&&!/subject/.test(e.link)).map(t=>e.tryGet(t.link,async()=>{try{let e=await n({method:`get`,url:t.link}),r=i(e.data),a=r(`.bbs-user-info-name, .bbs-user-wrapper-content-name-span`).text(),o=r(`.basketballTobbs_tag > a, .tag-player-team`).toArray().map(e=>r(e).text()).filter(Boolean);r(`.basketballTobbs_tag`).remove(),r(`.hupu-img`).each(function(){r(this).parent().html(`<img src="${r(this).attr(`data-origin`)}">`)});let s=r(`#bbs-thread-content, .bbs-content-font`).html();return{...t,author:a||void 0,category:o.length>0?o:t.category,description:s||void 0}}catch{return t}}))),{title:`虎扑 - ${o[l].title}`,link:u,item:g}}};export{s as route};