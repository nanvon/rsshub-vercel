import"./esm-shims-BmHUa0Yk.js";import{config as e}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-DCfHHxuQ.js";import"./helpers-gUVC02jt.js";import"./cache-Dfid4xgQ.js";import"./parse-date-DHsdom8D.js";import"./md5-15Cn4YyR.js";import{got_default as t}from"./got-D5TEN1xL.js";import{config_not_found_default as n}from"./config-not-found-mNOcOzCd.js";import{finishArticleItem as r}from"./wechat-mp-CaayfL8m.js";import{utils_default as i}from"./utils-D7R6lhQS.js";import{load as a}from"cheerio";const o={path:`/wechat/:wxid`,categories:[`social-media`],example:`/newrank/wechat/chijiread`,parameters:{wxid:`微信号，若微信号与新榜信息不一致，以新榜为准`},features:{requireConfig:[{name:`NEWRANK_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`微信公众号`,maintainers:[`lessmoe`,`pseudoyu`],handler:s};async function s(o){if(!e.newrank||!e.newrank.cookie)throw new n(`newrank RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let s=o.req.param(`wxid`),c=i.random_nonce(9),{data:l}=await t({method:`get`,url:`https://www.newrank.cn/new/readDetial?account=${s}`,headers:{Connection:`keep-alive`,Cookie:e.newrank.cookie}}),u=a(l)(`script`).toArray().find(e=>(e.attribs.src||``).startsWith(`/new/static/js/main.`)).attribs.src,{data:d}=await t({method:`get`,url:`https://www.newrank.cn${u}`}),f=d.match(/"N-Token":"([^"]+)/);if(!f)throw Error(`Cannot find n-token`);let p=f[1],m=await t({method:`post`,url:`https://gw.newrank.cn/api/wechat/xdnphb/detail/v1/rank/article/lists`,headers:{Connection:`keep-alive`,Cookie:e.newrank.cookie,"n-token":p},form:{account:s,nonce:c,xyz:i.decrypt_wechat_detail_xyz(s,c)}}),h=m.data.value.user.name,g=i.flatten(m.data.value.realTimeArticles),_=i.flatten(m.data.value.articles),v=[...g,..._].map(e=>({id:e.id,title:e.title,description:``,link:e.url,pubDate:e.publicTime}));return await Promise.all(v.map(e=>r(e))),{title:h+` - 微信公众号`,link:`https://www.newrank.cn/new/readDetial?account=${s}`,item:v}}export{o as route};