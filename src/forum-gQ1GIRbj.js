import{n as e,t}from"./esm-shims-mGm6WwCc.js";import{t as n}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./got-CgQXMNWI.js";import s from"node:path";import c from"crypto-js";e();const l=`https://api.wfdata.club`,u=`https://www.feng.com`,d=e=>{let t=new URL(e).pathname,n=c.enc.Utf8.parse(`url=`+t+`$time=`+Date.now()+`000000`),r=c.enc.Utf8.parse(`2b7e151628aed2a6`);return c.AES.encrypt(n,r,{iv:r,mode:c.mode.CBC,padding:c.pad.Pkcs7}).toString()},f=e=>{let t=`${l}/v1/topic/category`;return r.tryGet(t,async()=>(await o(t,{headers:{Referer:`${u}/forum/${e}`,"X-Request-Id":d(t)}})).data,n.cache.routeExpire,!1)},p=async e=>{let t=await f(e);return Object.values(t.data.dataList).find(t=>t.dataList.find(t=>t.topicId===e))},m=(e,t)=>{let i=`${l}/v1/topic/${e}/thread?topicId=${e}&type=${t}&pageCount=50&order=${t===`newest`?`replyTime`:`postTime`}&page=1`;return r.tryGet(i,async()=>(await o(i,{headers:{Referer:`${u}/forum/${e}`,"X-Request-Id":d(i)}})).data,n.cache.routeExpire,!1)},h=(e,t)=>{let n=`${l}/v1/thread/${e}`;return r.tryGet(n,async()=>(await o(n,{headers:{Referer:`${u}/forum/${t}`,"X-Request-Id":d(n)}})).data)},g={path:`/forum/:id/:type?`,categories:[`bbs`],example:`/feng/forum/1`,parameters:{id:`版块 ID，可在版块 URL 找到`,type:"排序，见下表，默认为 `all`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`feng.com/forum/photo/:id`,`feng.com/forum/:id`],target:`/forum/:id`}],name:`社区`,maintainers:[`TonyRL`],handler:_,description:`| 最新回复 | 最新发布 | 热门 | 精华    |
| -------- | -------- | ---- | ------- |
| newest   | all      | hot  | essence |`};async function _(e){let n=Number(e.req.param(`id`)),{type:r=`all`}=e.req.param(),o=(await p(n)).dataList.find(e=>e.topicId===n),c=(await m(n,r)).data.dataList.map(e=>({title:e.title,pubDate:a(e.dateline*1e3),author:e.userBaseInfo.userName,link:`${u}/post/${e.tid}`,tid:e.tid})),l=await Promise.all(c.map(async e=>{let r=await h(e.tid,n);if(r.status.code===0){let n=i(s.join(t,`templates/img-8d8353ed.art`),{images:r.data.thread.fengTalkImage.length?r.data.thread.fengTalkImage:void 0});e.description=r.data.thread.message+n}else e.description=i(s.join(t,`templates/deleted-48cd3c75.art`),{});return delete e.tid,e}));return{title:`${o.topicName} - 社区 - 威锋 - 千万果粉大本营`,description:o.topicDescription,link:`${u}/forum/${n}`,item:l}}export{g as route};