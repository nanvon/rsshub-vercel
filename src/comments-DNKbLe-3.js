import"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as e}from"./ofetch-CbgiXYAi.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import n from"markdown-it";const r=n({html:!0}),i=`https://youtrack.jetbrains.com`,a=`${i}/api`,o={path:`/youtrack/comments/:issueId`,categories:[`programming`],example:`/jetbrains/youtrack/comments/IJPL-174543`,parameters:{issueId:`Issue ID (e.g., IJPL-174543)`},radar:[{source:[`youtrack.jetbrains.com/issue/:issueId`],target:`/youtrack/comments/:issueId`}],name:`YouTrack Issue Comments`,maintainers:[`NekoAria`],handler:u};function s(e,n){let a=r.render(e.issue.description);return{title:`${e.author.name} created issue ${n}`,author:e.author.name,pubDate:t(e.timestamp),link:`${i}/issue/${n}#focus=Comments-${e.id}`,description:a,guid:`${n}-comment-${e.id}`}}function c(e,n){let a=e.added[0],o=a.author||e.author,s=a.usesMarkdown?r.render(a.text):a.text;return{title:`${o.name} commented on ${n}`,author:o.name,pubDate:t(a.created||e.timestamp),link:`${i}/issue/${n}#focus=Comments-${e.id}`,description:s,guid:`${n}-comment-${e.id}`}}function l(e,t){switch(e.category.id){case`IssueCreatedCategory`:return s(e,t);case`CommentsCategory`:return c(e,t);default:return null}}async function u(t){let n=t.req.param(`issueId`),r=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):100,o=await e(`${a}/issues/${n}`,{query:{fields:`summary`}}),s=(await e(`${a}/issues/${n}/activitiesPage`,{query:{categories:`IssueCreatedCategory,CommentsCategory`,fields:`activities(author(name),category(id),id,issue(description),timestamp,added(author(name),created,id,text,usesMarkdown))`}})).activities.map(e=>l(e,n)).filter(e=>e!==null).toSorted((e,t)=>new Date(t.pubDate).getTime()-new Date(e.pubDate).getTime()).slice(0,r);return{title:`YouTrack ${n} - ${o.summary}`,link:`${i}/issue/${n}`,description:`Comments and activities for YouTrack issue ${n}`,item:s}}export{o as route};