import{n as e,t}from"./esm-shims-C3MSy80G.mjs";import"./config-PItPnVIx.mjs";import"./logger-BoKmWr7Z.mjs";import{t as n}from"./ofetch-Byd8Ct7M.mjs";import{t as r}from"./cache-KwJARS5Z.mjs";import{t as i}from"./render-ZYpwNl2L.mjs";import{t as a}from"./parse-date-9Tu6hSFW.mjs";import{t as o}from"./types-zV-JXsJH.mjs";import s from"node:path";import{load as c}from"cheerio";e();const l=async e=>{let{language:o=`en-us`}=e.req.param(),l=Number.parseInt(e.req.query(`limit`)??`30`,10),u=`https://support.apple.com`,d=new URL(`${o}/100100`,u).href,f=c(await n(d)),p=f(`table.gb-table tbody tr`),m=p.find(`th`).toArray().map(e=>f(e).text()),h=[];return h=p.slice(1,l).toArray().map(e=>{let n=f(e),r=n.find(`td`).first(),c=r.contents().first().text(),l=i(s.join(t,`templates/security-releases-f17de8c3.art`),{headers:m,infos:n.find(`td`).toArray().map(e=>f(e).html()??``)}),d=n.find(`td`).last().text(),p=r.find(`a.gb-anchor`).attr(`href`),h=n.find(`meta[property="og:site_name"]`).attr(`content`),g=d;return{title:c,description:l,pubDate:d?a(d,[`DD MMM YYYY`,`YYYY 年 MM 月 DD 日`]):void 0,link:p?new URL(p,u).href:void 0,author:h,content:{html:l,text:l},updated:g?a(g,[`DD MMM YYYY`,`YYYY 年 MM 月 DD 日`]):void 0,language:o}}),h=await Promise.all(h.map(e=>e.link?r.tryGet(e.link,async()=>{let r=await n(e.link),l=c(r),u=e.title??l(`h1.gb-header`).text();l(`h1.gb-header`).remove();let d=e.description+i(s.join(t,`templates/security-releases-f17de8c3.art`),{description:l(`div#sections`).html()}),f=r.match(/publish_date:\s"(\d{8})",/,``)?.[1],p=l(`meta[property="og:site_name"]`).attr(`content`),m=l(`.time`).text()||f,h={title:u,description:d,pubDate:f?a(f,`MMDDYYYY`):e.pubDate,author:p,content:{html:d,text:d},updated:m?a(m,`MMDDYYYY`):e.updated,language:o};return{...e,...h}}):e)),{title:f(`title`).text(),description:f(`meta[property="og:description"]`).attr(`content`),link:d,item:h,allowEmpty:!0,author:f(`meta[property="og:site_name"]`).attr(`content`),language:o,id:d}},u={path:`/security-releases/:language?`,name:`Security releases`,url:`support.apple.com`,maintainers:[`nczitzk`],handler:l,example:`/apple/security-releases`,parameters:{language:{description:"Language, `en-us` by default"}},description:"::: tip\nTo subscribe to [Apple security releases](https://support.apple.com/en-us/100100), where the source URL is `https://support.apple.com/en-us/100100`, extract the certain parts from this URL to be used as parameters, resulting in the route as [`/apple/security-releases/en-us`](https://rsshub.app/apple/security-releases/en-us).\n:::\n",categories:[`program-update`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`support.apple.com/:language/100100`],target:e=>{let t=e.language;return`/apple/security-releases${t?`/${t}`:``}`}}],view:o.Articles,zh:{path:`/security-releases/:language?`,name:`安全性发布`,url:`support.apple.com`,maintainers:[`nczitzk`],handler:l,example:`/apple/security-releases`,parameters:{language:{description:"语言，默认为 `en-us`，可在对应页 URL 中找到"}},description:"::: tip\n若订阅 [Apple 安全性发布](https://support.apple.com/zh-cn/100100)，网址为 `https://support.apple.com/zh-cn/100100`，请截取 `https://support.apple.com/` 到末尾 `/100100` 的部分 `zh-cn` 作为 `language` 参数填入，此时目标路由为 [`/apple/security-releases/zh-cn`](https://rsshub.app/apple/security-releases/zh-cn)。\n:::\n"}};export{l as handler,u as route};