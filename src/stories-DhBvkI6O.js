import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./cache-Dfid4xgQ.js";import{not_found_default as e}from"./not-found-o393tAVF.js";import"./invalid-parameter-B0jPSaWz.js";import"./config-not-found-mNOcOzCd.js";import{getClient as t,getStory as n,unwrapMedia as r}from"./client-CTrWh2Ib.js";import{configureMiddlewares as i,handleMedia as a}from"./channel-media-CMozWoOq.js";import{getGeoLink as o,getMediaLink as s}from"./channel-CyS3lSof.js";import{Api as c}from"telegram";const l={path:`/stories/:username/:story?`,categories:[`social-media`],example:`/telegram/stories/telegram`,parameters:{username:`entity name`,story:`story`},features:{requireConfig:[{name:`TELEGRAM_SESSION`,optional:!1,description:`Telegram API Authentication`},{name:`TELEGRAM_API_ID`,optional:!0,description:`Telegram API ID`},{name:`TELEGRAM_API_HASH`,optional:!0,description:`Telegram API Hash`},{name:`TELEGRAM_MAX_CONCURRENT_DOWNLOADS`,optional:!0,description:`Telegram Max Concurrent Downloads`},{name:`TELEGRAM_PROXY_HOST`,optional:!0,description:`Telegram Proxy Host`},{name:`TELEGRAM_PROXY_PORT`,optional:!0,description:`Telegram Proxy Port`},{name:`TELEGRAM_PROXY_SECRET`,optional:!0,description:`Telegram Proxy Secret`}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[],name:`Stories`,maintainers:[`synchrone`],handler:d,description:``};function u(e){let t=``;for(let n of e??[])n instanceof c.MediaAreaChannelPost||((n instanceof c.MediaAreaGeoPoint||n instanceof c.MediaAreaVenue)&&n.geo instanceof c.GeoPoint?t+=o(n.geo):n instanceof c.MediaAreaSuggestedReaction&&(n.reaction instanceof c.ReactionEmoji?t+=n.reaction.emoticon:n.reaction instanceof c.ReactionCustomEmoji));return t}async function d(o){let l=await t(),{username:d,story:f}=o.req.param();if(!d)throw new e;let p=await l.getInputEntity(d);if(f){let e=await n(p,Number(f));return await i(o),await a(e.media,l,o)}let m=await l.invoke(new c.stories.GetPeerStories({peer:p})),h=[];for(let e of m.stories.stories){if(!(e instanceof c.StoryItem))continue;let t=`${new URL(o.req.url).origin}/telegram/stories/${d}/${e.id}`,n=new Date(e.date*1e3).toUTCString(),i=await r(e.media);if(!i)continue;let a=s(t,i)+u(e.mediaAreas);h.push({title:e.caption??n,description:a,pubDate:n,link:`https://t.me/${d}/s/${e.id}`,author:d})}return{title:`Stories of @${d}`,link:`https://t.me/${d}`,item:h,allowEmpty:o.req.param(`id`)===`allow_empty`,description:`Stories of @${d} on Telegram`}}export{d as default,l as route};