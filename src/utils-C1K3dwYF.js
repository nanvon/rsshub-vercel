import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import{config as n}from"./config-CVBRPN4O.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-Di2lBekK.js";import o from"node:path";import{load as s}from"cheerio";t();const c=async(e,t,n,r)=>{let{data:i}=await a(`https://${e}.news.yahoo.com/_td-news/api/resource/NCPListService;api=archive;ncpParams=${encodeURIComponent(JSON.stringify({query:{count:t,start:0,providerid:r,tag:n}}))}`);return i},l=async(e,t)=>{let{data:n}=await a(`https://${e}.news.yahoo.com/_td-news/api/resource/StreamService;category=LISTID%3A${t};useNCP=true`);return n},u=(e,t)=>t(`yahoo:${e}:categoryMap`,async()=>{let{PageStore:n}=await f(e,t),{Col1:r}=n.pagesConfigRaw.base.section.regions,{categoryMap:i}=r.find(e=>e.name===`ArchiveFilterBar`).props;for(let[e,t]of Object.entries(i))i[e]={name:t,yctMap:r.find(e=>e.name===`StreamContainerArchive`).props.yctMap[e]};return i}),d=(e,t)=>t(`yahoo:${e}:providerList`,async()=>{let{ProviderListStore:n}=await f(e,t);return n.providerList.flatMap(t=>t.providers.map(n=>({title:`${t.title} - ${n.title}`,key:n.key,link:new URL(n.url,`https://${e}.news.yahoo.com`).href})))}),f=(e,t)=>t(`yahoo:${e}:stores`,async()=>{let{data:t}=await a(`https://${e}.news.yahoo.com/archive`),n=s(t);return JSON.parse(n(`script:contains("root.App.main")`).text().match(/root.App.main\s+=\s+({.+});/)?.[1]).context.dispatcher.stores}),p=(e,t)=>t.map(t=>({title:t.title,link:t.url.startsWith(`http`)?t.url:new URL(t.url,`https://${e}.news.yahoo.com`).href,description:t.summary,pubDate:i(t.published_at,`X`)})),m=(t,c)=>c(t.link,async()=>{let{data:c}=await a(t.link,{headers:{"User-Agent":n.trueUA}}),l=s(c),u=JSON.parse(l(`script[type="application/ld+json"]`).toArray().find(e=>l(e).text().includes(`"@type":"NewsArticle"`))?.children[0].data),d=u.author.name,f=l(`.atoms`);return f.find(`noscript, .text-gandalf, [id^="sda-inbody-"]`).remove(),f.find(`.caas-figure-with-pb, .caas-img-container`).each((e,t)=>{l(t).removeAttr(`style`)}),f.find(`img`).each((e,t)=>{let n=l(t),r=n.data(`src`);if(r){let e=r.match(/.*--\/.*--\/(.*)/);e?.[1]&&(r=e?.[1]),n.attr(`src`,r),n.removeAttr(`data-src`)}}),f.find(`.caas-iframe`).each((t,n)=>{let i=l(n);if(i.data(`type`)===`youtube`){let t=i.find(`blockquote`).data(`src`);i.replaceWith(r(o.join(e,`templates/youtube-151badfe.art`),{id:t.split(`/`).pop()?.split(`?`)?.[0]}))}}),t.description=f.html(),t.author=d,t.category=u.keywords,t.pubDate=i(u.datePublished),t.updated=i(u.dateModified),t});export{c as getArchive,u as getCategories,l as getList,d as getProviderList,m as parseItem,p as parseList};