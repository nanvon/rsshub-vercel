import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-1ATZGjxb.js";import"./logger-B19BYg4C.js";import"./ofetch-B4O0sZDE.js";import"./helpers-LVq640iW.js";import{art as n}from"./render-DE4LRFBD.js";import{got_default as r}from"./got-CW2W8CRN.js";import i from"node:path";import{load as a}from"cheerio";t();const o={path:`/latest-magazine/:query?`,categories:[`reading`],example:`/magazinelib/latest-magazine/new+yorker`,parameters:{query:`query, search page querystring`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Latest Magazine`,maintainers:[`EthanWng97`],handler:s,description:"For instance, when doing search at [https://magazinelib.com](https://magazinelib.com) and you get url `https://magazinelib.com/?s=new+yorker`, the query is `new+yorker`"};async function s(t){let o=t.req.param(`query`),s=await r({method:`get`,url:`https://magazinelib.com/wp-json/wp/v2/posts/`,searchParams:{search:o,per_page:30,_embed:1}}),c=o;c===void 0?c=``:(c=c.replaceAll(/[^\dA-Za-z]+/g,` `).toUpperCase(),c=` - ${c}`);let l=s.data.map(t=>{let r={};r.date=t.date_gmt,r.link=t.link,r.featuredMediaLink=t._links[`wp:featuredmedia`][0].href,r.title=t.title.rendered;let o=a(t.content.rendered),s=o(`.vk-att`);s.find(`img[src="https://magazinelib.com/wp-includes/images/media/default.png"]`).remove(),r.content=s.html();let c=t._embedded[`wp:featuredmedia`][0].source_url;return r.description=r.content+n(i.join(e,`templates/magazine-description-5b741265.art`),{imgUrl:c}),r.categories=t._embedded[`wp:term`][0].map(e=>e.name),r});return{title:`MagazineLib - Latest Magazines${c}`,link:`{host}/?s=${o}`,description:`MagazineLib - Latest Magazines${c}`,item:l.map(e=>({title:e.title,link:e.link,category:e.categories,pubDate:new Date(e.pubDate).toUTCString(),description:e.description}))}}export{o as route};