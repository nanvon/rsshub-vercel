import{n as e,t}from"./esm-shims-BC3isTv8.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./parse-date-CHEO0z5G.js";import{t as i}from"./got-dCh-Ojgc.js";import a from"node:path";import{load as o}from"cheerio";import s from"crypto-js";e();const c=`huxiu.com`,l=`https://www.${c}`,u=`https://api-article.${c}`,d=`https://api-brief.${c}`,f=`https://api-account.${c}`,p=`https://moment-api.${c}`,m=`https://search-api.${c}`,h=e=>{let r=o(e);return r(`div.neirong-shouquan`).remove(),r(`em.vote__bar, div.vote__btn, div.vote__time`).remove(),r(`p img`).each((e,i)=>{i=r(i),(i.prop(`src`)??i.prop(`_src`))!==void 0&&i.parent().replaceWith(n(a.join(t,`templates/description-31b75578.art`),{image:{src:(i.prop(`src`)??i.prop(`_src`)).split(/\?/)[0],width:i.prop(`data-w`),height:i.prop(`data-h`)}}))}),r(`p, span`).each((e,t)=>{t=r(t),t.contents().length===1&&/^\s*$/.test(t.text())?t.remove():(t.removeClass(),t.removeAttr(`data-check-id label class`))}),r(`.text-big-title`).each((e,t)=>{t.tagName=`h3`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r(`.text-sm-title`).each((e,t)=>{t.tagName=`h4`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r.html()},g=async e=>{let t=new URL(`briefColumn/detail`,d).href,{data:{data:n}}=await i.post(t,{form:{platform:`www`,brief_column_id:e}}),r=new URL(`club/${n.club_id}.html`,l).href,{data:a}=await i(r),s=o(a),c=`${n.name}-${n.sub_name}`,u=new URL(s(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,f=s(`meta[name="author"]`).prop(`content`);return{title:`${c}-${f}`,link:r,description:n.summary,language:s(`html`).prop(`lang`),image:n.head_img,icon:u,logo:u,subtitle:c,author:f,itunes_author:f,itunes_category:`News`,allowEmpty:!0}},_=async e=>{let t=new URL(`club/${e}.html`,l).href,{data:n}=await i(t),r=o(n),a=r(`title`).text(),s=new URL(r(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,c=r(`meta[name="author"]`).prop(`content`);return{data:{title:a,link:t,description:r(`ul.content-item li.content`).text().trim(),language:r(`html`).prop(`lang`),image:r(`div.header img.img`).prop(`data-src`)?.split(/\?/)[0]??void 0,icon:s,logo:s,subtitle:a.split(/-/)[0],author:c,itunes_author:c,itunes_category:`News`,allowEmpty:!0},briefColumnId:n.match(/"brief_column_id":"(\d+)",/)[1]}},v=async e=>{let{data:t}=await i(e),n=o(t),r=new URL(n(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,a=n(`meta[name="author"]`).prop(`content`);return{title:n(`title`).text(),link:e,description:n(`div.tag-content`).text()||n(`span.author-intro`).text()||n(`p.collection__intro`).text()||n(`meta[name="description"]`).prop(`content`),language:n(`html`).prop(`lang`),icon:r,logo:r,subtitle:n(`title`).text().split(/-/)[0],author:a,itunes_author:a,itunes_category:`News`,allowEmpty:!0}},y=async e=>{let{data:o}=await i(e.link),s=S(o),c=s?.briefStoreModule?.brief_detail.brief??s?.articleDetail?.articleDetail??void 0;if(!c)return e;let{processed:l,processedItem:u={}}=w(c.audio_info);Object.keys(u).length!==0&&(u.itunes_item_image=c.pic_path??c.share_info?.share_img??void 0);let{processed:d,processedItem:f={}}=D(c.video_info);return e.title=c.title??e.title,e.description=n(a.join(t,`templates/description-31b75578.art`),{image:{src:c.pic_path},video:d,audio:l,preface:h(c.content_preface??c.preface),summary:c.ai_summary,description:h(c.content)}),e.author=c.user_info?.username??e.author,e.category=[c.video_article_tag,c.brief_column?.name??void 0,c.club_info?.name??void 0,...c.tags_info?.map(e=>e.name)??[],...c.relation_info?.channel?.map(e=>e.name)??[]].filter(Boolean),e.pubDate=r(c.dateline??c.publish_time,`X`),e.upvote=c.agreenum??e.upvote,e.comments=c.commentnum??c.total_comment_num??e.comments,e.upvote=Number.parseInt(e.upvote,10),e.comments=Number.parseInt(e.comments,10),{...u,...f,...e}},b=()=>{let e=``;for(let t=0;t<16;t++)e+=`abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ`.charAt(Math.floor(Math.random()*62));return e},x=()=>{let e=Math.round(Date.now()/1e3).toString(),t=b(),n=[`hUzaABtNfDE-6UiyaYhfsmjW-8dnoyVc`,e,t].toSorted();return{nonce:t,timestamp:e,signature:s.SHA1(n[0]+n[1]+n[2]).toString()}},S=e=>{let t=e.match(/window\.__INITIAL_STATE__=({.*?});\(function\(\)/);if(t)return JSON.parse(t[1])},C=[``,`low`],w=e=>{let t=e?C.find(t=>Object.hasOwn(e,`audio_${t===``?``:`${t}_`}path`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`audio_${t}path`,r=`audio_${t}size`,i={duration:e.format_length_new??e.format_length,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`audio/${e[n].split(/\./).pop()}`};return{processed:i,processedItem:{itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type}}},T=async(e,i,o)=>(e=e.map(e=>{let i=``,o=``;if(e.moment_id)i=`huxiu-moment-${e.moment_id}`,o=e.url||new URL(`moment/${e.moment_id}.html`,l).href;else if(e.brief_id||/huxiu\.com\/brief\//.test(e.url))e.brief_id=e.brief_id??e.aid,i=`huxiu-brief-${e.brief_id}`,o=new URL(`brief/${e.brief_id}.html`,l).href;else if(e.aid)i=`huxiu-article-${e.aid}`,o=new URL(`article/${e.aid}.html`,l).href;else return``;let{processed:s,processedItem:c={}}=w(e.audio_info);Object.keys(c).length!==0&&(c.itunes_item_image=e.pic_path??e.share_info?.share_img??void 0);let{processed:u,processedItem:d={}}=D(e.video_info),f=e.count_info?.agree??e.count_info?.favtimes??e.agree_num??0,p=e.count_info?.disagree??0,m=e.count_info?.total_comment_num??e.count_info?.commentnum??e.total_comment_num??e.commentnum??0;return{...c,...d,title:(e.title??e.summary??e.content)?.replaceAll(/<\/?(?:em|br)?>/g,``),link:o,description:n(a.join(t,`templates/description-31b75578.art`),{image:{src:e.origin_pic_path??e.pic_path??e.big_pic_path?.split(/\?/)[0]??void 0},audio:s,video:u,summary:e.summary??e.content??e.preface}),author:e.user_info?.username??e.brief_column?.name??e.author_info?.username??e.author,guid:i,pubDate:e.publish_time??e.dateline?r(e.publish_time??e.dateline,`X`):void 0,upvotes:Number.parseInt(f,10),downvotes:Number.parseInt(p,10),comments:Number.parseInt(m,10)}}).filter(Boolean).slice(0,i),await Promise.all(e.map(e=>o(e.guid,async()=>{if(new RegExp(c,`i`).test(new URL(e.link).hostname)){if(!e.guid.startsWith(`huxiu-moment`))return await y(e)}else return e;return e})))),E=[`fhd`,`fhd_medium`,`wifi`,`fhd_low`,`flow`,`hd`,`sd`],D=e=>{let t=e?E.find(t=>Object.hasOwn(e,`${t}_link`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`${t}_link`,r=`origin_${t}_size`,i={duration:e.duration??e.origin_duration,poster:e.cover??e.custom_cover_path??e.gif_path,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`video/${e[n].split(/\./).pop()}`};return{processed:i,processedItem:{itunes_item_image:i.poster,itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type}}};export{m as a,v as c,l as d,p as i,x as l,d as n,g as o,f as r,_ as s,u as t,T as u};