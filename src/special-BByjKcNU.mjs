import"./esm-shims-L08rKynx.mjs";import{t as e}from"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import{t}from"./ofetch-BMqiDsx_.mjs";import{t as n}from"./cache-ZTWfXd2T.mjs";import{t as r}from"./parse-date-bKmkZ9gg.mjs";import{a as i,i as a,n as o,r as s,t as c}from"./utils-BX7GraKm.mjs";const l={path:`/bbs/special/:specialId`,categories:[`bbs`],example:`/dxy/bbs/special/72`,parameters:{specialId:`专题 ID，可在对应专题页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`专题`,maintainers:[`TonyRL`],handler:u};async function u(l){let u=l.req.param(`specialId`),{limit:d=`10`}=l.req.query(),f=await n.tryGet(`dxy:special:detail:${u}`,async()=>{let e={specialId:u,requestType:`h5`,timestamp:Date.now(),noncestr:c(8,`number`)},n=await t(`${s}/newh5/bbs/special/detail`,{query:{...e,sign:a(e)}});if(n.code!==`success`)throw Error(n.message);return n.data}),p=(await n.tryGet(`dxy:special:recommend-list-v3:${u}`,async()=>{let e={specialId:u,requestType:`h5`,pageNum:`1`,pageSize:d,timestamp:Date.now(),noncestr:c(8,`number`)},n=await t(`${s}/newh5/bbs/special/post/recommend-list-v3`,{query:{...e,sign:a(e)}});if(n.code!==`success`)throw Error(n.message);return n.data},e.cache.routeExpire,!1)).result.map(e=>{let{postInfo:t,dataTime:n,entityId:a}=e;return{title:t.subject,description:t.simpleBody,pubDate:r(n,`x`),author:t.postUser.nickname,category:[t.postSpecial.specialName],link:`${i}/bbs/newweb/pc/post/${a}`,postId:a}}),m=await Promise.all(p.map(e=>o(e,n.tryGet)));return{title:f.name,description:`${f.content} ${f.postCount} 內容 ${f.followCount} 关注`,link:`${s}/bbs/special?specialId=${u}`,image:f.specialAvatar,item:m}}export{l as route};