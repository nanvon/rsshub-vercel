import"./esm-shims-Dqvxr0BZ.js";import"./config-1ATZGjxb.js";import"./logger-B19BYg4C.js";import{ofetch_default as e}from"./ofetch-B4O0sZDE.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{timezone as n}from"./timezone-CMz5pnRe.js";import{load as r}from"cheerio";const i={path:`/topic/:id`,categories:[`anime`],example:`/bangumi.tv/topic/367032`,parameters:{id:`话题 id, 在话题页面地址栏查看`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/group/topic/:id`]}],name:`小组话题的新回复`,maintainers:[`ylc395`],handler:a};async function a(i){let a=i.req.param(`id`),o=`https://bgm.tv/group/topic/${a}`,s=await e(o),c=r(s),l=c(`#pageHeader h1`).text(),u=c(`.row_reply`).toArray().map(e=>{let t=c(e);return{id:t.attr(`id`),author:t.find(`.userInfo .l`).text(),content:t.find(`.reply_content .message`).html(),date:t.children().first().find(`small`).children().remove().end().text().slice(3)}}),d=c(`.sub_reply_bg`).toArray().map(e=>{let t=c(e);return{id:t.attr(`id`),author:t.find(`.userName .l`).text(),content:t.find(`.cmt_sub_content`).html(),date:t.children().first().find(`small`).children().remove().end().text().slice(3)}}),f=[...u,...d].toSorted((e,t)=>e.id<t.id?1:-1),p={title:l,description:c(`.postTopic .topic_content`).html(),author:c(`.postTopic .inner strong a`).first().text(),pubDate:n(t(c(`.postTopic .re_info small`).text().trim().slice(5)),8),link:o};return{title:`${l}的最新回复`,link:o,item:[...f.map(e=>({title:`${e.author} 回复了小组话题《${l}》`,description:e.content,pubDate:n(t(e.date),8),author:e.author,link:`${o}#${e.id}`})),p]}}export{i as route};