import{__dirname as e,init_esm_shims as t}from"./esm-shims-2LyWUseo.js";import{config as n}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-BLnIkXRv.js";import"./helpers-gUVC02jt.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-DPq_2TLS.js";import{config_not_found_default as s}from"./config-not-found-mNOcOzCd.js";import c from"node:path";t();const l=`https://zodgame.xyz`,u={path:`/forum/:fid?`,categories:[`bbs`],example:`/zodgame/forum/13`,parameters:{fid:`forum id, can be found in URL`},features:{requireConfig:[{name:`ZODGAME_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`forum`,maintainers:[`FeCCC`],handler:d};async function d(t){let u=t.req.param(`fid`),d=`${l}/api/mobile/index.php?version=4&module=forumdisplay&fid=${u}`,f=n.zodgame.cookie;if(f===void 0)throw new s(`Zodgame RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let p=(await o({method:`get`,url:d,headers:{Cookie:f}})).data.Variables,m=p.forum_threadlist.map(e=>{if(!p.threadtypes.types[e.typeid])return;let t=p.threadtypes.types[e.typeid];return{tid:e.tid,title:`[${t}] ${e.subject}`,author:e.author,link:`${l}/forum.php?mod=viewthread&tid=${e.tid}&extra=page%3D1`,category:t,pubDate:a(e.dbdateline*1e3)}}).filter(e=>e!==void 0),h=await Promise.all(m.map(t=>r.tryGet(t.tid,async()=>{let n=(await o({method:`get`,url:`${l}/api/mobile/index.php?version=4&module=viewthread&tid=${t.tid}`,headers:{Cookie:f}})).data.Variables,r=``;return n.thread.freemessage?(r+=n.thread.freemessage,r+=i(c.join(e,`templates/forum-c3ab5e98.art`),{content:n.postlist[0].message})):r+=n.postlist[0].message,{title:t.title,author:t.author,link:t.link,description:r,category:t.category,pubDate:t.pubDate,guid:t.tid,upvotes:Number.parseInt(n.thread.recommend_add,10),downvotes:Number.parseInt(n.thread.recommend_sub,10),comments:Number.parseInt(n.thread.replies,10)}})));return{title:`${p.forum.name} - ZodGame论坛`,link:`${l}/forum.php?mod=forumdisplay&fid=${u}`,item:h}}export{u as route};