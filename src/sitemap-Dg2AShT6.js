import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-BrnquCU2.js";import"./helpers-DzX-lcQO.js";import"./ofetch-Of9UBhau.js";import{got_default as t}from"./got-Cw3q2eEq.js";import{ConfigNotFoundError as n}from"./config-not-found-2m672-Jl.js";import{load as r}from"cheerio";const i={path:`/transform/sitemap/:url/:routeParams?`,name:`Unknown`,maintainers:[`flrngel`],handler:a};async function a(i){if(!e.feature.allow_user_supply_unsafe_domain)throw new n(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);let a=i.req.param(`url`),o=await t({method:`get`,url:a}),s=new URLSearchParams(i.req.param(`routeParams`)),c=r(o.data,{xmlMode:!0}),l=s.get(`title`)||(c(`urlset url`).length&&c(`urlset url`).first().find(`loc`).text()?c(`urlset url`).first().find(`loc`).text():`Sitemap`),u=c(`urlset url`).toArray(),d=u&&u.length?u.map(e=>{try{let t=c(e).find(`loc`).text()||``,n=c(e).find(`loc`).text()||``,r=c(e).find(`loc`).text()||``,i=c(e).find(`lastmod`).text()||void 0;return{title:t,link:n,description:r,pubDate:i}}catch{return null}}).filter(Boolean):[];return{title:l,link:a,description:`Proxy ${a}`,item:d}}export{i as route};