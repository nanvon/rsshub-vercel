import{ofetch_default as e}from"./ofetch-D4MiciTC.js";import{cache_default as t}from"./cache-Dfid4xgQ.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{Fragment as r,jsx as i,jsxs as a}from"hono/jsx/jsx-runtime";import{load as o}from"cheerio";import{renderToString as s}from"hono/jsx/dom/server";import"rfc4648";function c({imageDataArray:e,articleBody:t}){return a(r,{children:[e.map(e=>e.type===`normalHTML`?i(`div`,{dangerouslySetInnerHTML:{__html:e.html}}):e.type===`data`&&a(`figure`,{children:[i(`img`,{src:e.src}),i(`figcaption`,{children:e.title})]})),t&&i(`div`,{dangerouslySetInnerHTML:{__html:t}})]})}var l=c;const u=`https://www.zaobao.com`,d=`https://www.zaobao.com.sg/favicon.ico`,f=async r=>{let a=await e.raw(u+r),c=o(a._data),d=c(`.card-listing .card .content-header a`);d.length===0&&(d=c(`[data-testid="article-list"] article div div a.article-link`));let f=new URL(a.url).origin,m=c(`meta[property="og:title"]`).attr(`content`),h=await Promise.all(d.toArray().map(r=>{let a=c(r),d=u+a.attr(`href`);return t.tryGet(d,async()=>{let t=await e.raw(f+a.attr(`href`)),r=o(t._data),c,u,m,h,g=r(`head script[type="application/ld+json"]`).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``),_=JSON.parse(g),v=t.url.startsWith(`https://www.zaobao.com.sg/`);if(v){let e=JSON.parse(JSON.parse(`"${r(`script:contains("__staticRouterHydrationData")`).text().match(/__staticRouterHydrationData = JSON.parse\("(.*)"\);/)?.[1]}"`)).loaderData[`0-0`].context.payload.article;c=e.headline,u=n(e.create_time,`X`),m=e.tags.map(e=>e.name),r=o(e.body_cn,null,!1),h=e.images}else c=_.headline,u=n(_.datePublished),m=_.keywords.split(`,`);r(`.bff-google-ad, .bff-recommend-article`).remove(),r(`button.cursor-pointer`).remove(),r(`.bff-inline-image-expand-icon`).remove(),r(`img[alt="expend icon"]`).remove();let y;v?y=r:(r(`astro-island, .further-reading, .read-on-app-cover`).remove(),y=r(`.article-body`));let b=y.html(),x=p(v,h,r),S=s(i(l,{imageDataArray:x,articleBody:b}));return{title:c,description:S,pubDate:u,link:d,category:m}})}));return{title:m,resultList:h}},p=(e,t,n)=>{if(e&&t)return t.map(e=>({type:`data`,html:``,src:e.url.replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`).split(`?`)[0],title:e.caption}));let r=n(`[data-testid="article-banner"] img`);return r.length?[{type:`data`,html:r.prop(`outerHTML`),src:r.attr(`src`).replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`).split(`?`)[0],title:r.attr(`title`)}]:[]};export{d as logo,f as parseList};