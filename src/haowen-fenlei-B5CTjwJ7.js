import"./esm-shims-rNwigI-Q.js";import{config as e}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{cache_default as t}from"./cache-Dfid4xgQ.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{got_default as r}from"./got-Di2lBekK.js";import{timezone as i}from"./timezone-CMz5pnRe.js";import{config_not_found_default as a}from"./config-not-found-B7nOMdXp.js";import{getHeaders as o}from"./utils-hGs8QcaN.js";import{load as s}from"cheerio";const c={path:`/haowen/fenlei/:name/:sort?`,categories:[`shopping`],example:`/smzdm/haowen/fenlei/shenghuodianqi`,parameters:{name:`分类名，可在 URL 中查看`,sort:`排序方式，默认为最新`},features:{requireConfig:[{name:`SMZDM_COOKIE`,description:`什么值得买登录后的 Cookie 值`}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`post.smzdm.com/fenlei/:name`],target:`/haowen/fenlei/:name`}],name:`好文分类`,maintainers:[`LogicJake`],handler:l,description:`| 最新 | 周排行 | 月排行 |
| ---- | ------ | ------ |
| 0    | 7      | 30     |`};async function l(c){if(!e.smzdm.cookie)throw new a(`什么值得买排行榜 is disabled due to the lack of SMZDM_COOKIE`);let l=c.req.param(`name`),u=c.req.param(`sort`)||`0`,d=u===`0`?`https://post.smzdm.com/fenlei/${l}/`:`https://post.smzdm.com/fenlei/${l}/hot_${u}/`,f=s((await r.get(d,{headers:o()})).data),p=f(`div.crumbs.nav-crumbs`).text().split(`>`).pop(),m=f(`div.list.post-list`).toArray().map(e=>(e=f(e),{title:e.find(`h2.item-name a`).text(),link:e.find(`h2.item-name a`).attr(`href`),description:e.find(`.item-info`).html(),author:e.find(`.nickname`).text(),pubDate:i(n(e.find(`span.time`).text(),[`HH:mm`,`MM-DD HH:mm`,`YYYY-MM-DD HH:mm`]),8)})),h=await Promise.all(m.map(e=>t.tryGet(e.link,async()=>{try{let t=s((await r(e.link,{headers:o()})).data);e.description=t(`article`).html(),e.pubDate=i(n(t(`meta[property="og:release_date"]`).attr(`content`)),8),e.author=t(`meta[property="og:author"]`).attr(`content`)}catch{}return e})));return{title:`${p}- 什么值得买好文分类`,link:d,item:h}}export{c as route};