import{__dirname as e,init_esm_shims as t}from"./esm-shims-BFmOnnpb.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-am9EnuPq.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-CmdBCkM8.js";import{invalid_parameter_default as o}from"./invalid-parameter-B0jPSaWz.js";import s from"node:path";import{load as c}from"cheerio";t();const l={jxrb:`嘉兴日报`,nhwb:`南湖晚报`},u={path:`/:category?/:id?`,name:`Unknown`,maintainers:[],handler:d};async function d(t){let u=t.req.param(`category`)??`jxrb`,d=t.req.param(`id`);if(!Object.keys(l).includes(u))throw new o(`Invalid category`);let f=`${`https://${u}.cnjxol.com`}/${u}Paper/pc/layout`,p=await a({method:`get`,url:f}),m=c(p.data),h=m(`a`).first().attr(`href`).match(/\d{6}\/\d{2}/)[0],g=[];if(d){let e=`${f}/${h}/node_${d}.html`,t=await a({method:`get`,url:e});m=c(t.data),g=m(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${m(e).attr(`href`)}`.replaceAll(`layout/../../../`,``))}else await Promise.all(m(`#list li a`).toArray().map(async e=>{let t=await a({method:`get`,url:`${f}/${m(e).attr(`href`)}`}),n=c(t.data);g.push(...n(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${n(e).attr(`href`)}`.replaceAll(`layout/../../../`,``)))}));return g=await Promise.all(g.map(t=>n.tryGet(t,async()=>{let n=await a({method:`get`,url:t}),o=c(n.data);return{link:t,title:o(`#Title`).text(),pubDate:i(o(`date`).text()),description:r(s.join(e,`templates/description-b24e1338.art`),{attachment:o(`.attachment`).html(),content:o(`founder-content`).html()})}}))),{title:`${l[u]}${d?` - ${m(`#layout`).text()}`:``}`,link:f,item:g}}export{u as route};