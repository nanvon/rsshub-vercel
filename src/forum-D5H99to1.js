import{__dirname as e,init_esm_shims as t}from"./esm-shims-2LyWUseo.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as n}from"./ofetch-BLnIkXRv.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{md5 as o}from"./md5-15Cn4YyR.js";import{timezone as s}from"./timezone-CMz5pnRe.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/:id?`,name:`分类`,url:`4ksj.com`,maintainers:[`nczitzk`],handler:f,example:`/4ksj/4k-uhd-1`,parameters:{id:`分类 id，默认为最新4K电影`},description:"::: tip\n  若订阅 [最新 4K 电影](https://www.4ksj.com/4k-uhd-1.html)，网址为 `https://www.4ksj.com/4k-uhd-1.html`。截取 `https://www.4ksj.com/` 到末尾 `.html` 的部分 `4k-uhd-1` 作为参数，此时路由为 [`/4ksj/4k-uhd-1`](https://rsshub.app/4ksj/4k-uhd-1)。\n\n  若订阅子分类 [Dolby Vision 动作 4K 电影](https://www.4ksj.com/4k-uhd-s7-display-3-dytypes-1-1.html)，网址为 `https://www.4ksj.com/4k-uhd-s7-display-3-dytypes-1-1.html`。截取 `https://www.4ksj.com/forum-` 到末尾 `.html` 的部分 `4kdianying-s7-dianyingbiaozhun-3-dytypes-9-1` 作为参数，此时路由为 [`/4ksj/4k-uhd-s7-display-3-dytypes-1-1`](https://rsshub.app/4ksj/4k-uhd-s7-display-3-dytypes-1-1)。\n:::",categories:[`multimedia`]};function d(e){let t=``;for(let n=0;n<=e.length-1;n++){let r=e.charAt(n).codePointAt();t+=r}return t}async function f(t){let{id:u=`4k-uhd-1`}=t.req.param(),f=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):25,p=`https://www.4ksj.com`,m=new URL(`${u}.html`,p).href,h=await n(m,{responseType:`arrayBuffer`}),g=new TextDecoder(`gbk`),_=l(g.decode(h)),v=_(`div.nexlogo img`).prop(`src`),y=_(`div.nex_cmo_piv a`).slice(0,f).toArray().map(e=>(e=_(e),{link:new URL(e.prop(`href`),p).href})),b=await(()=>r.tryGet(`4ksj:cookie`,async()=>{let e=await n(y[0].link),t=l(e)(`script`).attr(`src`),r=new URL(t,p).href,i=await n(r),a=i.match(/{var key="(.*?)"/)?.[1],s=i.match(/",value="(.*?)"/)?.[1],c=i.match(/\.get\("(.*?&key=)"/)?.[1];if(!a||!s||!c)throw Error(`Failed to get cookie`);return(await n.raw(`${p}${c}${a}&value=${o(d(s))}`)).headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `)}))();return y=await Promise.all(y.map(t=>r.tryGet(t.link,async()=>{let r=await n(t.link,{responseType:`arrayBuffer`,headers:{Cookie:b}}),o=l(g.decode(r));o(`div.nex_drama_intros em`).first().remove(),o(`strong font`).each((e,t)=>{t=o(t),t.parent().remove()});let u=o(`div.nex_drama_Top h5`).text(),d=o(`div.nex_drama_intros`).html(),f=o(`div.nex_drama_pic`).html().match(/background:url\((.*?)\)/)?.[1]??``,p=o(`li.nex_drama_Detail_li, li.nex_drama_Detail_lis dd`).toArray().map(e=>{e=o(e);let t=e.find(`em`).text().replaceAll(/：|\s/g,``),n=e.find(`span`).length===0?e.contents().last().text().trim():e.find(`span`).text().trim();return{[t]:n}}),m=Object.assign({},...p),h=o(`td.t_f ignore_js_op`).length===0?o(`td.t_f strong`).toArray().map(e=>{e=o(e);let n=e.contents().first().text(),r=e.next().prop(`href`)??e.nextUntil(`a`).next().prop(`href`);return t.enclosure_url=t.enclosure_url??r,t.enclosure_type=t.enclosure_type??`application/x-bittorrent`,t.enclosure_title=t.enclosure_title??n,{title:n,tags:e.contents().last().text().match(/【(.*?)】/g),link:r}}):o(`div.newfujian`).toArray().map(e=>(e=o(e),{title:e.find(`p.filename`).prop(`title`)||e.find(`p.filename`).text(),tags:e.find(`div.fileaq`).text().match(/【(.*?)】/g),link:e.find(`div.down_2 a`).prop(`href`)})),_=o(`table.boxtable em`).first(),v=_.find(`span[title]`).length===0?_.first().text().replace(/发表于\s/,``):_.find(`span[title]`).prop(`title`);return t.title=u,t.description=i(c.join(e,`templates/description-6a5b9b89.art`),{images:f?[{src:f,alt:u}]:void 0,title:u,keys:Object.keys(m),details:m,description:d,info:o(`div.nex_drama_sums`).html(),links:h}),t.pubDate=s(a(v,`YYYY-M-D HH:mm:ss`),8),t.category=Object.values(m).flatMap(e=>e.split(/\s/)).filter(Boolean),t.author=m.导演,t.content={html:d,text:o(`div.nex_drama_intros`).text()},t.image=f,t.banner=f,t.language=`zh`,t}))),{title:`4k世界 - ${_(`#fontsearch ul.cl li.a`).toArray().map(e=>_(e).text()).join(`+`)||`不限`}`,description:_(`meta[name="description"]`).prop(`content`),link:m,item:y,allowEmpty:!0,image:v,author:_(`meta[name="application-name"]`).prop(`content`),language:`zh`}}export{u as route};