import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import{art as n}from"./render-CSnicFA3.js";import{md5 as r}from"./md5-15Cn4YyR.js";import{got_default as i}from"./got-VGofQtEf.js";import a from"node:path";import{load as o}from"cheerio";t();const s=`https://www.iyingdi.com`,c=async(e,t)=>await Promise.all(t.map(t=>e.tryGet(t.link,async()=>{let e={post_id:t.postId,timestamp:``},{body:n}=await i({method:`post`,url:`https://api.iyingdi.com/web/post/info`,headers:{Host:`api.iyingdi.com`,"Login-Token":`nologin`,Origin:s,Platform:`pc`,Referer:`${s}/`},form:l(e)});return t.description=u(JSON.parse(n).post.content),t}))),l=(e,t)=>(e.key=t?`8a11ed3712b699e749185674f1dc20b4`:`b8d5b38577b8bb382b0c783b474b95f9`,e.timestamp=Math.floor(Date.now()/1e3),e.sign=r(new URLSearchParams(e).toString()),delete e.key,e),u=t=>{let r=o(t.replace(/(<p>|<div>)(.*?)?<strong>(标准|狂野)日报投稿.*?<\/strong>(.*?)?(<\/p>|<\/div>)(.|\n)*$/,``));return r(`.yingdi-car,.bbspost,.deck-set`).each((t,i)=>{let o=r(i).attr(`class`),c=r(i).attr(`data-id`),l=`${s}/web/tools/hearthstone/decks/setdetail?setid=${c}`,u=o===`yingdi-card bbspost`?`${s}/tz/post/${c}`:l,d=r(i).find(`.card-status .time`).text();r(i).find(`.card-info .title`).text((e,t)=>`${t} ${d}`),r(i).find(`.card-status`).remove(),r(i).find(`.card-info`).wrap(n(a.join(e,`templates/card-038fc8ce.art`),{url:u}))}),r(`.yingdi-image.gif`).each((e,t)=>{let n=r(t).attr(`data-original`);r(t).attr(`src`,n)}),r(`.yingdi-audio`).each((e,t)=>{r(t).find(`.audio-cover`).remove(),r(t).find(`.audio-area.hidden`).attr(`class`,`audio-area`)}),r(`.yingdi-video iframe`).each((t,i)=>{let o=r(i).attr(`src`).match(/bvid=(.*?)&/)[1];if(o){let t=`https://www.bilibili.com/video/${o}`;r(i).after(n(a.join(e,`templates/video-54339745.art`),{url:t}))}}),r(`.yingdi-card.user`).each((e,t)=>{r(t).prev(`p`).remove(),r(t).remove()}),r(`.action-button`).remove(),r(`.yingdi-ballot`).remove(),r(`hr`).remove(),r.html()};export{c as ProcessFeed,l as ProcessForm};