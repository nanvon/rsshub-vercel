import"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as e}from"./cache-CpEhLexq.js";import{t}from"./parse-date-CHEO0z5G.js";import{t as n}from"./got-BlqYKpVp.js";import{load as r}from"cheerio";const i={path:`/xwxy/:category?`,categories:[`university`],example:`/gdufs/xwxy/news`,parameters:{category:{description:"分类，默认为 `news`",options:[{label:`学院新闻`,value:`news`},{label:`通知`,value:`notices`},{label:`公告`,value:`announcements`},{label:`媒体聚焦`,value:`media`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`xwxy.gdufs.edu.cn/xwzx/xyxw`,`xwxy.gdufs.edu.cn/`],target:`/xwxy/news`},{source:[`xwxy.gdufs.edu.cn/xwzx/tzgg/tz`],target:`/xwxy/notices`},{source:[`xwxy.gdufs.edu.cn/xwzx/tzgg/gg`],target:`/xwxy/announcements`},{source:[`xwxy.gdufs.edu.cn/xwzx/mtjj`],target:`/xwxy/media`}],name:`新闻学院-新闻中心`,maintainers:[`gz4zzxc`],handler:async i=>{let a=i.req.param(`category`)??`news`,o={news:`/xwzx/xyxw.htm`,notices:`/xwzx/tzgg/tz.htm`,announcements:`/xwzx/tzgg/gg.htm`,media:`/xwzx/mtjj.htm`},s={news:`学院新闻`,notices:`通知`,announcements:`公告`,media:`媒体聚焦`},c=/\d{4}[-/.]\d{1,2}[-/.]\d{1,2}/,l=`https://xwxy.gdufs.edu.cn${o[a]??o.news}`,u=await n(l);if(!u.body)throw Error(`No response body`);let d=r(u.body),f=d(`li[id^="line_u14_"] a`).toArray().map(e=>{let n=d(e),r=n.attr(`href`)||``,i=n.closest(`li`),a=(i&&i.text()||n.text()).trim(),o=n.find(`i`).text().trim()||i&&i.find(`i`).text().trim()||i&&i.find(`time`).text().trim()||(a.match(c)?.[0]??``),s=o?t(o):void 0,u=n.find(`h5`).text().trim()||n.attr(`title`)?.trim()||n.text().trim()||a.replace(c,``).trim();return r?{title:u,link:r.startsWith(`http`)?r:new URL(r,l).href,pubDate:s}:null}).filter(e=>!!e&&!!e.title&&!!e.link),p=Number.parseInt(i.req.query(`limit`)??``)||10,m=f.slice(0,p),h=await Promise.all(m.map(i=>e.tryGet(i.link,async()=>{let e=!1;try{e=new URL(i.link).hostname.endsWith(`gdufs.edu.cn`)}catch{}if(!e)return{...i,description:``,author:``};let a=await n(i.link);if(!a.body)throw Error(`No article body`);let o=r(a.body),s=o(`.v_news_content`);s.find(`img, a`).each((e,t)=>{let n=o(t);for(let e of[`src`,`href`]){let t=n.attr(e);if(t&&!t.startsWith(`http`))try{n.attr(e,new URL(t,i.link).href)}catch{}}});let l=s.html()||``,u=o(`.show01 p i`).toArray().map(e=>o(e).text().trim()).filter(Boolean),d=u.filter(e=>!e.includes(`发布时间`)).filter(e=>!c.test(e)),f;if(!i.pubDate){let e=u.find(e=>c.test(e));if(e){let n=e.match(c)?.[0];if(n)try{f=t(n)}catch{}}}return{...i,description:l,author:d.join(`, `),pubDate:i.pubDate||f}})));return{title:`广外新传学院-${s[a]??s.news}`,link:l,description:`广东外语外贸大学新闻与传播学院官网-新闻中心`,item:h}},url:`xwxy.gdufs.edu.cn`};export{i as route};