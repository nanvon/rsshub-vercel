import{n as e,t}from"./esm-shims-DhF_MXa4.mjs";import"./config-PItPnVIx.mjs";import"./logger-BoKmWr7Z.mjs";import{t as n}from"./ofetch-DVhBwO41.mjs";import{t as r}from"./cache-KwJARS5Z.mjs";import{t as i}from"./render-ZYpwNl2L.mjs";import{t as a}from"./parse-date-9Tu6hSFW.mjs";import{r as o}from"./common-utils-Cj5w6--o.mjs";import{t as s}from"./timezone-CQaZZkB1.mjs";import c from"node:path";import{load as l}from"cheerio";e();const u={path:`/stats/*`,name:`国家统计局 通用`,url:`www.stats.gov.cn`,categories:[`government`],maintainers:[`bigfei`,`nczitzk`,`reply2future`],example:`/gov/stats/sj/zxfb`,handler:d,radar:[{title:`国家统计局 通用`,source:[`www.stats.gov.cn/*path`],target:`/gov/stats/*path`}],description:"::: tip\n路径处填写对应页面 URL 中 `http://www.stats.gov.cn/` 后的字段。下面是一个例子。\n\n若订阅 [数据 > 数据解读](http://www.stats.gov.cn/sj/sjjd/)\n则将对应页面 URL `http://www.stats.gov.cn/sj/sjjd/` 中 `http://www.stats.gov.cn/` 后的字段 `sj/sjjd` 作为路径填入。\n此时路由为 [`/gov/stats/sj/sjjd`](https://rsshub.app/gov/stats/sj/sjjd)\n\n若订阅 [新闻 > 时政要闻 > 中央精神](http://www.stats.gov.cn/xw/szyw/zyjs/)\n则将对应页面 URL `http://www.stats.gov.cn/xw/szyw/zyjs/` 中 `http://www.stats.gov.cn/`\n后的字段 `xw/szyw/zyjs` 作为路径填入。此时路由为 [`/gov/stats/xw/szyw/zyjs`](https://rsshub.app/gov/stats/xw/szyw/zyjs)\n:::"};async function d(e){let u=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):15,d=`http://www.stats.gov.cn`,{headers:f}=await n.raw(d),p=f?.getSetCookie().find(e=>e.startsWith(`wzws_sessionid=`))?.split(`;`)[0],m=o(e)===`/stats`?`/sj/zxfb/`:o(e).replace(/^\/stats(.*)/,`$1`),h=`${d}${m.endsWith(`/`)?m:m+`/`}`,g=l(await n(h,{headers:{Cookie:p,Referer:h}})),_=g(g(`a.pchide`).length===0?`a[title]`:`.list-content a.pchide`).slice(0,u).toArray().map(e=>(e=g(e),{title:e.attr(`title`),link:new URL(e.attr(`href`),h).href}));return _=await Promise.all(_.map(e=>r.tryGet(e.link,async()=>{let r=await n(e.link,{headers:{Cookie:p,Referer:d}}),o=l(r);if(/(news\.cn|www\.gov\.cn)/.test(e.link)){if(o(`.year`).text())e.pubDate=s(a(`${o(`.year`).text()}/${o(`.day`).text()} ${o(`.time`).text()}`,`YYYY/MM/DD HH:mm:ss`),8),e.author=o(`.source`).text().replace(/来源：/,``).trim();else{o(`.pages_print`).remove();let t=o(`.info, .pages-date`).text().split(`来源：`);e.pubDate=s(a(t[0].trim()),8),e.author=t.pop()}return e.title=e.title||o(`h1`).first().text()||o(`h2`).first().text(),e.description=o(`#detail, .xlcontent, .pages_content`).html(),e}return e.author=r.match(/来源：(.*?)</)?.[1]?.trim(),o(`.pchide`).remove(),e.title=e.title||o(`div.detail-title h1`).text(),e.pubDate=s(a(o(`div.detail-title-des h2 p, .info`).first().text().trim()),8),e.description=i(c.join(t,`templates/description-c9fe7148.art`),{description:o(`.TRS_Editor`).html()||o(`.TRS_UEDITOR`).html(),attachments:o(`a[oldsrc]`).toArray().map(t=>(t=g(t),{link:new URL(t.attr(`href`),e.link).href,name:t.text().trim()}))}),e}))),{title:g(`title`).text(),link:h,item:_}}export{u as route};