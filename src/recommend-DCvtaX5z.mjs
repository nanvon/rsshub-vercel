import{t as e}from"./ofetch-BRplXtiZ.mjs";import"./config-D7dgKYF5.mjs";import{t}from"./logger-CkUWGGaS.mjs";import{t as n}from"./md5-DQN6cWFb.mjs";import{t as r}from"./cache-Bv3_kFbE.mjs";import"./helpers-Tm7Pw8Vq.mjs";import{t as i}from"./parse-date-_GmTZfjS.mjs";import{t as a}from"./got-BglkE51W.mjs";import{load as o}from"cheerio";const s=()=>r.tryGet(`51cto:token`,async()=>(await e(`https://api-media.51cto.com/api/token-get`)).data.data.token,3600,!1),c=(e,t={},r,i)=>{t.timestamp=r,t.token=i;let a=Object.keys(t).toSorted();return n(n(e)+n(a+n(i)+r))},l={path:`/index/recommend`,categories:[`programming`],example:`/51cto/index/recommend`,radar:[{source:[`51cto.com/`]}],name:`推荐`,maintainers:[`cnkmmk`,`ovo-tim`],handler:f,url:`51cto.com/`},u=/'(WTKkN|bOYDu|wyeCN)':\s*(\d+)/g;async function d(n,r=``){let a=null,s=await e(n.url,{headers:{cookie:r}}),c=o(s);if(a=new URL(n.url).host===`ost.51cto.com`?c(`.posts-content`).html():c(`article`).html(),!a&&r===``)try{let[e,t,r]=s.match(u).slice(0,3).map(e=>Number(e.split(`:`)[1]));return await d(n,`__tst_status=`+(e+t+r)+`#;`)}catch(e){t.error(e)}return{title:n.title,link:n.url,pubDate:i(n.pubdate,8),description:a||n.abstract}}async function f(e){let t=`index/index/recommend`,n=await s(),i=Date.now(),o={page:1,page_size:e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,limit_time:0,name_en:``},l=(await a(`https://api-media.51cto.com/${t}`,{searchParams:{...o,timestamp:i,token:n,sign:c(t,o,i,n)}})).data.data.data.list;return{title:`51CTO`,link:`https://www.51cto.com/`,description:`51cto - 推荐`,item:await Promise.all(l.map(e=>r.tryGet(e.url,async()=>await d(e))))}}export{l as route};