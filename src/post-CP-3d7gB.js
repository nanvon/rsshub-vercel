import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-BpwDbAkH.js";import"./logger-B3QfaIfn.js";import"./dist-BYIKqG8W.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-BWStd97H.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-CSKgrsrO.js";import{got_default as a}from"./got-CtVGR9YK.js";import{baseUrl as o,fetchUserDate as s}from"./utils-BH-JtPlp.js";import c from"node:path";import l from"dayjs";t();const u={path:`/posts/:author`,categories:[`new-media`],example:`/zhiy/posts/long`,parameters:{author:`作者 ID，可在URL中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`zhiy.cc/:author`]}],name:`笔记`,maintainers:[`TonyRL`],handler:d};async function d(t){r.defaults.imports={dayjs:l,...r.defaults.imports};let u=t.req.param(`author`),d=await s(u),{author_id:f,author_name:p,author_signature:m,author_avatar_url:h}=d,{data:{result:g}}=await a(`${o}/api/app/share/garden/users/${f}/posts`,{searchParams:{page:1,limit:t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):100}}),_=g.map(e=>({title:e.title,pubDate:i(e.create_time,`X`),link:`${o}/b${e.share_md5}`,guid:`${o}/b${e.share_md5}:${e.link_amount}:${e.note_amount}`,postId:e.id,shareMD5:e.share_md5})),v=await Promise.all(_.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(`${o}/api/app/share/posts/${t.shareMD5}`),{data:{result:i}}=await a(`${o}/api/app/share/posts/${t.postId}/notes`,{searchParams:{page:1,limit:100}});return t.description=r(c.join(e,`templates/post-2ebad52a.art`),{postMeta:n,postDate:l(n.create_time,`X`).format(`YYYY-MM-DD HH:mm:ss`),posts:i}),t})));return{title:p,link:`${o}/${u}`,description:m,image:h,item:v}}export{u as route};