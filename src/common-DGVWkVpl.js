import{t as e}from"./cache-CpEhLexq.js";import{t}from"./parse-date-CHEO0z5G.js";import{t as n}from"./got-CgQXMNWI.js";import{t as r}from"./timezone-BPfwRbwD.js";import{load as i}from"cheerio";var a=e=>{let t;switch(e=e.slice(0,4).toLowerCase(),e){case`tzgg`:t=`通知公告`;break;case`ggtz`:t=`公告通知`;break;case`jwdt`:t=`教务动态`;break;case`xyxw`:t=`学院新闻`;break;case`jzxx`:t=`讲座信息`;break;case`xzzq`:t=`下载专区`;break;default:t=``}return t};async function o(e,a=``){try{let{data:o}=await n(e,{https:{rejectUnauthorized:!1}}),s=i(o),c=/\d{4}(?:\/\d{2}){2}/,l=`.newscontent`;a===`xky`&&(c=/\d{4}-\d{2}-\d{2}/,l=`.content .edit`);let u=(s(`.info`).first().html()?.match(c)||[])[0],d=r(t(u,`YYYY-MM-DD`,`zh-cn`),8),f=s(l).first();f.find(`table`).remove();let p=f.text().replaceAll(/\s+/g,``);return a===`gfxy`&&(p=p.replace(`点击下载文件:`,``)),{description:p,pubDate:d}}catch{return{description:``,pubDate:null}}}var s=o,c=e=>`index${e===`1`?``:`_${Number.parseInt(e)-1}`}.html`;async function l(t,{baseHost:r,baseCategory:o,baseType:l,baseTitle:u,baseDescription:d=``,baseDeparment:f=``,baseClass:p=`div.article_list ul li:has(a)`}){let{category:m=o,type:h=l,page:g=`1`}=t.req.param(),_=`${u} - ${a(m)}`,v=d?`${d} - ${a(m)}`:_,y=`${r}${h?`/${h}`:``}/${m}`,b=`${y}/${c(g)}`,{data:x}=await n(b),S=i(x),C=S(p).toArray().map(e=>{e=S(e);let t=e.find(`a`),n=t.attr(`href`);return{title:t.text(),link:n.startsWith(`./`)&&!n.endsWith(`.pdf`)?`${y}${n.replace(`./`,`/`)}`:n}});return{title:_,description:v,link:b,item:await Promise.all(C.map(t=>e.tryGet(t.link,async()=>{let e=await s(t.link,f);return t.pubDate=e.pubDate,t.description=e.description,t})))}}var u=l;export{u as t};