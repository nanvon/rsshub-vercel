import{n as e,t}from"./esm-shims-mGm6WwCc.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./parse-date-CHEO0z5G.js";import{t as i}from"./got-CgQXMNWI.js";import{t as a}from"./timezone-BPfwRbwD.js";import o from"node:path";import{load as s}from"cheerio";e();const c=`whu.edu.cn`,l=e=>{let t={};return e.replaceAll(/<meta name="(.*?)" content="(.*?)"/gi,(e,n,r)=>{t[n]=r}),t},u=(e,t)=>Object.hasOwn(e,t)?e[t]:void 0,d=async(e,c)=>{try{let{data:d}=await i(e.link),f=s(d);f(`p.vsbcontent_img`).each(function(){let e=f(this).find(`img`);f(this).replaceWith(n(o.join(t,`templates/description-9e3ccd8d.art`),{image:{src:new URL(e.prop(`orisrc`),c).href,width:e.prop(`width`)}}))}),f(`script[name="_videourl"]`).each(function(){let e=f(this);e.replaceWith(n(o.join(t,`templates/description-9e3ccd8d.art`),{video:{src:new URL(e.prop(`vurl`).split(`?`)[0],c).href,width:f(e).prop(`vwidth`),height:f(e).prop(`vheight`)}}))});let p=f(`div.v_news_content`).html();f(`form[name="_newscontent_fromname"] table`).remove();let m=f(`form[name="_newscontent_fromname"] ul li`).toArray().map(e=>(e=f(e).find(`a`),{title:e.text(),link:new URL(e.prop(`href`),c).href})),h=l(d);e.title=u(h,`ArticleTitle`)??e.title,e.description=n(o.join(t,`templates/description-9e3ccd8d.art`),{description:p,attachments:m}),e.author=u(h,`ContentSource`),e.category=u(h,`Keywords`)?.split(` `).filter(Boolean)??[],e.guid=u(h,`Url`)??e.link,e.pubDate=u(h,`PubDate`)?a(r(u(h,`PubDate`)),8):e.pubDate,m.length>0&&(e.enclosure_url=m[0].link,e.enclosure_type=`application/${m[0].title.split(`.`).pop()}`)}catch{}return e},f=async(e,t,n)=>await Promise.all(e.map(e=>e.link.includes(c)?t(e.link,async()=>await d(e,n)):e));export{l as i,u as n,f as r,c as t};