import{__dirname as e,init_esm_shims as t}from"./esm-shims-B6VgfGYP.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-D4MiciTC.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{got_default as i}from"./got-07RFwdy7.js";import a from"node:path";import o from"dayjs";import{load as s}from"cheerio";t();const c={path:`/stats/daily/:country`,categories:[`other`],example:`/iknowwhatyoudownload/stats/daily/CN`,url:`iknowwhatyoudownload.com`,name:`Daily Torrents Statistics`,maintainers:[`p3psi-boo`],parameters:{country:`the country of the stats. ISO 3166-1 alpha-2 code.`},handler:l};async function l(t){let{country:c}=t.req.param(),l=`https://iknowwhatyoudownload.com/en/stat/${c}/daily/q?statDate=`,u=Array.from({length:7},(e,t)=>o().subtract(t,`day`)),d=(await Promise.all(u.map(t=>{let o=t.format(`YYYY-MM-DD`),u=`${l}${o}`;return n.tryGet(u,async()=>{let n=await i({method:`get`,url:u});if(!n)return{};let l=s(n.data),d=[];l(`.usePercent`).each((e,t)=>{d.push({percent:l(t).text(),desc:l(t).parent().find(`span`).last().text()})});let f=[],p=n.data.match(/data:\s*\[([\d",\s]+)\]/),m=n.data.match(/labels:\s*\[(.*?)\]/);if(p?.[1]&&m?.[1]){let e=p[1].split(`,`).map(e=>e.trim().replaceAll(`"`,``)),t=m[1].split(`,`).map(e=>e.replaceAll(`"`,``).trim()).filter(e=>e!==``);for(let n in t){let r=t[n],i=e[n],[a,o]=r.split(` `);f.push({key:a,count:i,percent:o})}}let h=l(`.tab-pane`).toArray().map(e=>({title:l(e).attr(`id`)?.toUpperCase(),content:l(e).find(`ul`).toString()})),g=r(a.join(e,`templates/daily-c7388d5f.art`),{numStats:d,tableData:f,topList:h});return{title:`Daily Torrents Statistics in ${c} for ${o}`,link:u,description:g,pubDate:t.toDate()}})}))).filter(e=>Object.keys(e).length>0);return{title:`Daily Torrents Statistics in ${c} - iknownwhatyoudownload`,link:`https://iknowwhatyoudownload.com`,item:d}}export{c as route};