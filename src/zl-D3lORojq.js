import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as n}from"./ofetch-rK3Yp7nj.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-DftO2d-b.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{ViewType as o}from"./types-Bi82qguM.js";import s from"node:path";import{load as c}from"cheerio";t();const l=async t=>{let{category:o}=t.req.param(),l=Number.parseInt(t.req.query(`limit`)??`1`,10),u=`https://www.ali213.net`,d=new URL(`/news/zl/${o?o.endsWith(`/`)?o:`${o}/`:``}`,u).href,f=new URL(`ajax/newslist`,`https://mp.ali213.net`).href,p=await n(f,{query:{type:`new`}}),m=c(await n(d)),h=m(`html`).prop(`lang`)??`zh`,g=JSON.parse(p.replace(/^\((.*)\)$/,`$1`)).data.slice(0,l).map(t=>{let n=t.Title,r=i(s.join(e,`templates/description-881baa33.art`),{intro:t.GuideRead??``}),o=`ali213-zl-${t.ID}`,c=t.PicPath?`https:${t.PicPath}`:void 0,l=t.xiaobian;return{title:n,description:r,pubDate:a(t.addtime*1e3),link:t.url?`https:${t.url}`:void 0,author:l,guid:o,id:o,content:{html:r,text:t.GuideRead??``},image:c,banner:c,language:h}});g=(await Promise.all(g.map(t=>!t.link&&typeof t.link!=`string`?t:r.tryGet(t.link,async()=>{let r=c(await n(t.link)),a=r(`h1.newstit`).text(),o=r(`div#Content`).html()??``,l=[];r(`a.currpage`).parent().find(`a:not(.currpage)`).each((e,t)=>{let n=r(t).attr(`href`);n&&l.push(n)});let u=await Promise.all(l.map(async e=>c(await n(new URL(e,t.link).href))(`div#Content`).html()??``));o+=u.join(``),o=i(s.join(e,`templates/description-881baa33.art`),{description:o});let d=r(`div.extend_read a`).toArray().map(e=>{let t=r(e);return{url:t.prop(`href`),type:`related`,content_html:t.text()}}).filter(e=>!0);return{title:a,description:o,pubDate:t.pubDate,category:r(`.category`).toArray().map(e=>r(e).text()),author:t.author,doi:r(`meta[name="citation_doi"]`).prop(`content`)||void 0,guid:t.guid,id:t.guid,content:{html:o,text:o},image:t.image,banner:t.image,language:h,_extra:{links:d.length>0?d:void 0}}})))).filter(e=>!0);let _=m(`title`).text(),v=new URL(`news/images/dxhlogo.png`,u).href;return{title:_,description:m(`meta[name="description"]`).prop(`content`),link:d,item:g,allowEmpty:!0,image:v,author:_.split(/_/).pop(),language:h,id:d}},u={path:`/zl/:category?`,name:`大侠号`,url:`www.ali213.net`,maintainers:[`nczitzk`],handler:l,example:`/ali213/zl`,parameters:{category:`分类，默认为首页，可在对应分类页 URL 中找到`},description:"::: tip\n若订阅 [游戏](https://www.ali213.net/news/zl/game/)，网址为 `https://www.ali213.net/news/zl/game/`，请截取 `https://www.ali213.net/news/zl/` 到末尾 `/` 的部分 `game` 作为 `category` 参数填入，此时目标路由为 [`/ali213/zl/game`](https://rsshub.app/ali213/zl/game)。\n:::\n\n| 首页                                     | 游戏                                         | 动漫                                           | 影视                                           | 娱乐                                           |\n| ---------------------------------------- | -------------------------------------------- | ---------------------------------------------- | ---------------------------------------------- | ---------------------------------------------- |\n| [index](https://www.ali213.net/news/zl/) | [game](https://www.ali213.net/news/zl/game/) | [comic](https://www.ali213.net/news/zl/comic/) | [movie](https://www.ali213.net/news/zl/movie/) | [amuse](https://www.ali213.net/news/zl/amuse/) |\n",categories:[`game`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.ali213.net/news/zl/:category`],target:e=>{let t=e.category;return`/ali213/zl${t?`/${t}`:``}`}},{title:`首页`,source:[`www.ali213.net/news/zl/`],target:`/zl`},{title:`游戏`,source:[`www.ali213.net/news/zl/game/`],target:`/zl/game`},{title:`动漫`,source:[`www.ali213.net/news/zl/comic/`],target:`/zl/comic`},{title:`影视`,source:[`www.ali213.net/news/zl/movie/`],target:`/zl/movie`},{title:`娱乐`,source:[`www.ali213.net/news/zl/amuse/`],target:`/zl/amuse`}],view:o.Articles};export{l as handler,u as route};