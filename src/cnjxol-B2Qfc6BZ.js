import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BlqYKpVp.js";import{t as o}from"./invalid-parameter-CLGd_tte.js";import s from"node:path";import{load as c}from"cheerio";e();const l={jxrb:`嘉兴日报`,nhwb:`南湖晚报`},u={path:`/:category?/:id?`,name:`Unknown`,maintainers:[],handler:d};async function d(e){let u=e.req.param(`category`)??`jxrb`,d=e.req.param(`id`);if(!Object.keys(l).includes(u))throw new o(`Invalid category`);let f=`${`https://${u}.cnjxol.com`}/${u}Paper/pc/layout`,p=c((await a({method:`get`,url:f})).data),m=p(`a`).first().attr(`href`).match(/\d{6}\/\d{2}/)[0],h=[];return d?(p=c((await a({method:`get`,url:`${f}/${m}/node_${d}.html`})).data),h=p(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${p(e).attr(`href`)}`.replaceAll(`layout/../../../`,``))):await Promise.all(p(`#list li a`).toArray().map(async e=>{let t=c((await a({method:`get`,url:`${f}/${p(e).attr(`href`)}`})).data);h.push(...t(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${t(e).attr(`href`)}`.replaceAll(`layout/../../../`,``)))})),h=await Promise.all(h.map(e=>n.tryGet(e,async()=>{let n=c((await a({method:`get`,url:e})).data);return{link:e,title:n(`#Title`).text(),pubDate:i(n(`date`).text()),description:r(s.join(t,`templates/description-b24e1338.art`),{attachment:n(`.attachment`).html(),content:n(`founder-content`).html()})}}))),{title:`${l[u]}${d?` - ${p(`#layout`).text()}`:``}`,link:f,item:h}}export{u as route};