import"./esm-shims-BC3isTv8.js";import{t as e}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./proxy-CczVputb.js";import{t}from"./cache-CpEhLexq.js";import{t as n}from"./render-d6AVTUl2.js";import{t as r}from"./parse-date-CHEO0z5G.js";import{t as i}from"./invalid-parameter-CLGd_tte.js";import{n as a}from"./puppeteer-e0F06Yyi.js";import{n as o,t as s}from"./readable-social-Bhzd-zX8.js";import{i as c,n as l,r as u,t as d}from"./utils-Dn8B8Y6L.js";const f={path:`/hashtag/:cid/:routeParams?`,categories:[`social-media`],example:`/douyin/hashtag/1592824105719812`,parameters:{cid:`标签 ID，可在标签页面 URL 中找到`,routeParams:`额外参数，query string 格式，请参阅上面的表格`},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`douyin.com/hashtag/:cid`],target:`/hashtag/:cid`}],name:`标签`,maintainers:[`TonyRL`],handler:p};async function p(f){let p=f.req.param(`cid`);if(Number.isNaN(p))throw new i(`Invalid tag ID. Tag ID should be a number.`);let m=Object.fromEntries(new URLSearchParams(f.req.param(`routeParams`))),h=s(void 0,o(m.embed),!1),g=s(void 0,o(m.iframe),!1),_=u(m.relay,!0,!0),v=`https://www.douyin.com/hashtag/${p}`,y=await t.tryGet(`douyin:hashtag:${p}`,async()=>{let e=await a(),t=await e.newPage();await t.setRequestInterception(!0);let n=``;t.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),t.on(`response`,async e=>{e.request().url().includes(`/v1/web/challenge/aweme`)&&(n=await e.json())}),await t.goto(v,{waitUntil:`networkidle2`}),await t.waitForSelector(`#RENDER_DATA`);let r=await t.evaluate(()=>document.querySelector(`#RENDER_DATA`).textContent);await e.close();let i=JSON.parse(decodeURIComponent(r)),o=Object.keys(i).find(e=>i[e].topicDetail);return i[o].defaultData=n.aweme_list,i[o]},e.cache.routeExpire,!1),b=y.topicDetail,x=b.chaName,S=d(b.hashtagProfile),C=y.defaultData.map(e=>{let t=e.video&&e.video.bit_rate&&e.video.bit_rate.map(e=>u(e.play_addr.url_list[0]));_&&(t=t.map(e=>l(e,_)));let i=e.video&&e.video.duration;i&&=i/1e3;let a;a||=e.video&&e.video.origin_cover&&e.video.origin_cover.url_list.at(-1),a&&=u(a);let o=e.desc&&e.desc.replaceAll(`
`,`<br>`),s=n(h&&t?c.embed:c.cover,{img:a,videoList:t,duration:i});s=h&&t&&g?n(c.iframe,{content:s}):s;let d=n(c.desc,{desc:o,media:s});return{title:e.desc,description:d,link:`https://www.douyin.com/video/${e.aweme_id}`,pubDate:r(e.create_time,`X`),category:e.text_extra.map(e=>e.hashtag_name),author:e.author.nickname}});return{title:x,description:`${b.viewCount} 次播放`,image:S,link:v,item:C}}export{f as route};