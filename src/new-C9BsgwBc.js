import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BlqYKpVp.js";import o from"node:path";import{load as s}from"cheerio";import c from"iconv-lite";e();const l={path:`/new`,categories:[`blog`],example:`/xys/new`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`xys.org/`,`xys.org/new.html`]}],name:`新到资料`,maintainers:[`wenzhenl`],handler:u,url:`xys.org/`};async function u(e){let l=`http://www.xys.org`,u=`${l}/new.html`,d=await a({method:`get`,url:u,responseType:`buffer`}),f=s(c.decode(d.data,`gb2312`)),p=f(`li a`).slice(4,e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):30).toArray().map(e=>{e=f(e);let t=e.attr(`href`);/^https?:\/\//.test(t)||(t=l+`/`+t.replace(/^\//,``));let n=e.parent().text().trim().slice(0,8);return n=i(n,`YY.MM.DD`),{title:e.text(),link:t,pubDate:n}});return p=await Promise.all(p.filter(e=>!e.link.endsWith(`.zip`)).map(e=>n.tryGet(e.link,async()=>{if(e.link.match(/(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/?.*(?:watch|embed)?(?:.*v=|v\/|\/)([\w-]+)&?/g))e.description=r(o.join(t,`templates/desc-2f9d87ea.art`),{youTube:e.link.slice(32)});else{let t=await a({method:`get`,url:e.link,responseType:`buffer`});e.description=s(c.decode(t.data,`gb2312`)).text().replaceAll(`
`,`<br>
`)}return e}))),{title:`新语丝 - 新到资料`,link:u,item:p}}export{l as route};