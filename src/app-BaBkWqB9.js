import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-rK3Yp7nj.js";import"./helpers-qpI1t-yV.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{got_default as i}from"./got-CoH3ye0k.js";import a from"node:path";import{FetchError as o}from"ofetch";import s from"dayjs";import c from"dayjs/plugin/utc.js";import l from"dayjs/plugin/timezone.js";import u from"dayjs/plugin/advancedFormat.js";t();const d={path:`/app/:category{.+}?`,categories:[`traditional-media`],example:`/washingtonpost/app/national`,parameters:{category:`Category from the path of the URL of the corresponding site, see below`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`www.washingtonpost.com/:category`],target:`/app/:category`}],handler:p,description:`::: tip
For example, the category for https://www.washingtonpost.com/national/investigations would be /national/investigations.
:::`};function f(e){let t={};for(let n of e)t[n.id]=t[n.id]?Object.assign(t[n.id],n):n;return Object.values(t)}async function p(t){let d=t.req.param(`category`)??``,p={Accept:`*/*`,Connection:`keep-alive`,"User-Agent":`Classic/6.70.0`};s.extend(c),s.extend(l),s.extend(u),r.defaults.imports.dayjs=s;let m=`https://jsonapp1.washingtonpost.com/fusion_prod/v2/${d}`,h=await i.get(m,{headers:p}),g=h.data.tracking.page_title.includes(`Washington Post`)?h.data.tracking.page_title:`The Washington Post - ${h.data.tracking.page_title}`,_=`https://washingtonpost.com`+h.data.tracking.page_path,v=f(h.data.regions[0].items.filter(e=>e.items).flatMap(e=>e.items[0].items.filter(e=>e.is_from_feed===!0).map(e=>{let t={id:e.id,title:e.headline.text,link:e.link.url,pubDate:e.link.display_date,updated:e.link.last_modified};return e.blurbs?.items[0]?.text&&(t.description=e.blurbs?.items[0]?.text),t})));return{title:g,link:_,item:await Promise.all(v.map(t=>n.tryGet(t.link,async()=>{let n;try{n=await i(`https://rainbowapi-a.wpdigital.net/rainbow-data-service/rainbow/content-by-url.json?followLinks=false&url=${t.link}`,{headers:p})}catch(e){if(e instanceof o&&e.statusCode===415)return t;throw e}return t.title=n.data.title??t.title,t.author=n.data.items.filter(e=>e.type===`byline`)?.flatMap(e=>e.authors.map(e=>e.name))?.join(`, `)??``,t.description=r(a.join(e,`templates/description-8c76ddeb.art`),{content:n.data.items}),t})))}}export{d as route};