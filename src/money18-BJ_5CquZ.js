import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-CgQXMNWI.js";import{t as o}from"./timezone-BPfwRbwD.js";import s from"node:path";import c from"dayjs";import{load as l}from"cheerio";e();const u={exp:`新聞總覽`,fov:`全日焦點`,industry:`板塊新聞`,int:`國際金融`,recagent:`大行報告`,ntlgroup:`A股新聞`,pro:`地產新聞`,weainvest:`投資理財`,ipo:`新股IPO`,tech:`科技財情`},d={path:`/money18/:id?`,categories:[`traditional-media`],example:`/oncc/money18/exp`,parameters:{id:`栏目 id，可在对应栏目页 URL 中找到，默认为 exp，即新聞總覽`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Money18`,maintainers:[`nczitzk`],handler:f,description:`| 新聞總覽 | 全日焦點 | 板塊新聞 | 國際金融 | 大行報告 | A 股新聞 | 地產新聞 | 投資理財  | 新股 IPO | 科技財情 |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | --------- | -------- | -------- |
| exp      | fov      | industry | int      | recagent | ntlgroup | pro      | weainvest | ipo      | tech     |`};async function f(e){let d=e.req.param(`id`)??`exp`,f=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):30,p=`https://money18.on.cc`,m=`${p}/finnews/news_${d===`industry`?`industry.html`:`breaking.html?section=${d}`}`,h=`https://dyn.on.cc/api/asrh/v1/events/names/新股/articles?page=1&limit=${f}`,g=`${p}/cnt/utf8/content/articleList/sector_list_exp_1.js`,_=e=>`${p}/cnt/utf8/content/${e}/articleList/list_${d}_all.js`,v=d===`ipo`?h:d===`industry`?g:_(c().format(`YYYYMMDD`)),y=!1,b=[],x=0,S;for(;!y;)try{S=await a({method:`get`,url:v}),y=!0}catch(e){e.code===`ERR_NON_2XX_3XX_RESPONSE`&&(y=!1,v=_(c().subtract(++x,`day`).format(`YYYYMMDD`)))}return b=d===`ipo`?S.data.articles.map(e=>({title:e.title,author:e.authorname,link:`${p}/finnews/content/${d}/${e.articleId}.html`,description:r(s.join(t,`templates/money18-3f53584c.art`),{images:e.hasHdPhoto?[`https://hk.on.cc/hk/bkn${e.hdEnlargeThumbnail}`]:void 0,description:e.content}),pubDate:o(i(e.pubDate),8)})):d===`industry`?S.data.articles.slice(0,f).map(e=>({title:e.title,author:e.authorname,link:`${p}/finnews/content/${d}/${e.articleId}.html`,category:e.sector.map(e=>e.name),pubDate:o(i(e.pubDate),8)})):S.data.slice(0,f).map(e=>({title:e.title,author:e.authorname,link:`${p}/finnews/content/${d}/${e.articleId}.html`,pubDate:o(i(e.pubDate),8)})),d!==`ipo`&&(b=await Promise.all(b.map(e=>n.tryGet(e.link,async()=>{let n=l((await a({method:`get`,url:e.link})).data);return e.description=r(s.join(t,`templates/money18-3f53584c.art`),{images:n(`.photo img`).toArray().map(e=>n(e).attr(`src`)),description:n(`.content`).html()}),e})))),{title:`東網產經 - ${u[d]}`,link:m,item:b}}export{d as route};