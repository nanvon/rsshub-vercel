import"./config-L8Ls2W7q.mjs";import{t as e}from"./logger-C50fTRi5.mjs";import"./proxy-DJ6wHv7C.mjs";import{t}from"./parse-date-bKmkZ9gg.mjs";import{n}from"./puppeteer-sUKJn9oU.mjs";import{load as r}from"cheerio";const i={name:`Play Store Update`,path:`/play/:id/:lang?`,categories:[`program-update`],example:`/google/play/net.dinglisch.android.taskerm`,parameters:{id:`Package id, can be found in url`,lang:{description:`language`,options:[{value:`en-us`,label:`English`},{value:`zh-cn`,label:`简体中文`}],default:`en-us`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`play.google.com/store/apps/details?id=:id`]}],maintainers:[`surwall`],handler:o},a={aboutThisAppButton:{"en-us":`See more information on About this app`,"zh-cn":`查看“关于此应用”的更多相关信息`},whatsNew:{"en-us":`What’s new`,"zh-cn":`新变化`},updatedOn:{"en-us":`Updated on`,"zh-cn":`更新日期`},updatedOnFormat:{"en-us":[`MMM D, YYYY`,`en`],"zh-cn":[`YYYY年M月D日`]},version:{"en-us":`Version`,"zh-cn":`版本`},offeredBy:{"en-us":`Offered by`,"zh-cn":`提供方`}};async function o(i){let o=i.req.param(`id`),l=i.req.param(`lang`)??`en-us`,u=`https://play.google.com/store/apps/details?id=${o}&hl=${l}`,d,f=``;try{d=await n();let i=await d.newPage();i.setRequestInterception(!0),i.on(`request`,e=>{[`image`,`font`,`stylesheet`].includes(e.resourceType())?e.abort():e.continue()}),e.http(`Requesting ${u}`),await i.goto(u,{waitUntil:`domcontentloaded`});let o=`::-p-xpath(//button[@aria-label='${a.aboutThisAppButton[l]}'])`;await i.click(o);let p=`::-p-xpath(//div[text()="${a.version[l]}"]/following-sibling::*[1])`;await i.waitForSelector(p),f=await i.content();let m=r(f),h=m(`span[itemprop=name]`).first().text(),g=m(`img[itemprop=image]`).first().attr(`src`),_,v,y;if(m(`div`).each(function(){m(this).text().trim()===a.updatedOn[l]?_=m(this).next().text().trim():m(this).text().trim()===a.version[l]?v=m(this).next().text().trim():m(this).text().trim()===a.offeredBy[l]&&(y=m(this).next().text().trim())}),!_||!v||!y)throw Error(`Failed to parse the page`);let b=t(_,...a.updatedOnFormat[l]),x=m(`div[itemprop=description]`).html(),S=`
            <h2>${a.whatsNew[l]}</h2>
            <p>${x??`No release notes`}</p>
        `;return{title:h+` - Google Play`,link:u,image:g,item:[{title:s(v,b),description:S,link:u,pubDate:b,guid:c(v,b),author:y}]}}finally{await d?.close()}}function s(e,t){return/^\d/.test(e)?e:t.toISOString().slice(0,10)}function c(e,t){return t.getTime().toString()+`-`+e}export{i as route};