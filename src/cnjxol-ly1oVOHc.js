import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-rK3Yp7nj.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-Bnno2HfO.js";import{invalid_parameter_default as o}from"./invalid-parameter-CfUmvEUg.js";import s from"node:path";import{load as c}from"cheerio";t();const l={jxrb:`嘉兴日报`,nhwb:`南湖晚报`},u={path:`/:category?/:id?`,name:`Unknown`,maintainers:[],handler:d};async function d(t){let u=t.req.param(`category`)??`jxrb`,d=t.req.param(`id`);if(!Object.keys(l).includes(u))throw new o(`Invalid category`);let f=`${`https://${u}.cnjxol.com`}/${u}Paper/pc/layout`,p=c((await a({method:`get`,url:f})).data),m=p(`a`).first().attr(`href`).match(/\d{6}\/\d{2}/)[0],h=[];return d?(p=c((await a({method:`get`,url:`${f}/${m}/node_${d}.html`})).data),h=p(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${p(e).attr(`href`)}`.replaceAll(`layout/../../../`,``))):await Promise.all(p(`#list li a`).toArray().map(async e=>{let t=c((await a({method:`get`,url:`${f}/${p(e).attr(`href`)}`})).data);h.push(...t(`#articlelist .clearfix a`).toArray().map(e=>`${f}/${t(e).attr(`href`)}`.replaceAll(`layout/../../../`,``)))})),h=await Promise.all(h.map(t=>n.tryGet(t,async()=>{let n=c((await a({method:`get`,url:t})).data);return{link:t,title:n(`#Title`).text(),pubDate:i(n(`date`).text()),description:r(s.join(e,`templates/description-b24e1338.art`),{attachment:n(`.attachment`).html(),content:n(`founder-content`).html()})}}))),{title:`${l[u]}${d?` - ${p(`#layout`).text()}`:``}`,link:f,item:h}}export{u as route};