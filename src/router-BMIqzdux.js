import{__dirname as e,init_esm_shims as t}from"./esm-shims-DtWyl6zt.js";import"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-Bbb0mfHh.js";import"./helpers-DzX-lcQO.js";import{art as n}from"./render-sowsPyZZ.js";import"./ofetch-Dnmc-sKl.js";import{got_default as r}from"./got-CdHCxDMi.js";import i from"node:path";import a from"dayjs";import o from"dayjs/plugin/customParseFormat.js";import s from"node:crypto";import{load as c}from"cheerio";import l from"city-timezones";import u from"dayjs/plugin/utc.js";import d from"dayjs/plugin/timezone.js";t(),a.extend(o),a.extend(u),a.extend(d);const f={expandOdd:e=>{e.prototype.odd=function(){let t=[];return this.each((e,n)=>{e%2==1&&t.push(n)}),e(t)}},expandEven:e=>{e.prototype.even=function(){let t=[];return this.each((e,n)=>{e%2==0&&t.push(n)}),e(t)}},expandReverse:e=>{e.prototype.reverse=function(){let t=[];return this.each((e,n)=>{t.push(n)}),t.reverse(),e(t)}},generateGuid:e=>{let t=s.createHash(`sha512`);t.update(e);let n=t.digest(`hex`).toUpperCase();return n},parseDatetime:(e,t,n,r,i)=>{let o=`YYYY/MM/DD`,s=`YYYY/MM/DD HH:mm`,c=`MM/DD/YYYY`,u=`MM/DD/YYYY HH:mm`,d;switch(i){case`ja`:d=a(e,o,!0).isValid()?o:a(e,s,!0).isValid()?s:void 0;break;case`en`:d=a(e,c,!0).isValid()?c:a(e,u,!0).isValid()?u:void 0;break}if(t){let e=[[`郵便局`],[`都`,`道`,`府`,`県`]];if(e[0].some(e=>t.includes(e))||e[1].some(e=>n.includes(e)))r=`Asia/Tokyo`;else{let e=t.replace(` EMS`,``).replace(` INT`,``);try{try{r=l.lookupViaCity(e)[0].timezone}catch{r=l.lookupViaCity(n)[0].timezone}}catch{}}}return d?[a.tz(e,d,r).valueOf(),r]:[new Date(e).getTime(),r]}};let p=`日本郵便`;async function m(t){let a=t.req.param(`reqCode`),o=`reqCodeNo1=`+a,s=`ja`;t.req.param(`locale`)===`en`&&(s=`en`,p=`Japanpost`);let l=`&locale=`+s,u=`https://trackings.post.japanpost.jp/services/srv/search/direct?`+o+l,d=await r({method:`get`,url:u}),m=c(d.data);f.expandEven(m),f.expandOdd(m);let h=m(`.tableType01`).eq(1).find(`tr`).slice(2),g=m(`.tableType03`).eq(0).find(`tr`).slice(1),_;if(g.length&&(_=g.toArray().map(e=>{let t=m(e).find(`td`);return{officeType:t.eq(0).text().trim(),officeName:t.eq(1).html().trim(),officeTel:t.eq(2).html().trim()}})),!h.length){let e=m(`.tableType01`).eq(0).find(`tr`).eq(2).find(`td`).eq(1).text().trim();throw Error(e)}let v=h.even(),y=h.odd(),b=m(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(1).text().trim(),x=m(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(2).text().trim(),S=s===`ja`?`付加サービス：`:`Additional services: `,C,w;return{title:`${p} ${a} ${b}`,link:u,description:`${p} ${a} ${b}`,language:s,icon:`https://www.post.japanpost.jp/favicon.ico`,logo:`https://www.post.japanpost.jp/favicon.ico`,item:v.toArray().map((t,r)=>{let o=m(t).find(`td`),c=o.eq(1).text().trim(),l=o.eq(4).text().trim(),d=o.eq(3).text().trim(),p=y.eq(r).find(`td`).eq(0).text().trim(),h=`${c} ${d} ${l}`,g=o.eq(2).text().trim(),v=n(i.join(e,`templates/track_item_desc-8ae6c583.art`),{packageStatus:c,packageTrackRecord:g,packageOfficeZipCode:p,packageOffice:d,packageRegion:l,index:r,officeItemList:_,serviceText:S,packageService:x}),b=o.eq(0).text().trim(),T=f.generateGuid(a+h+v+b),E;return[E,w]=f.parseDatetime(b,d,l,w,s),C&&E<=C&&(E=C+1e3),C=E,{title:h,description:v,pubDate:new Date(E),link:u,guid:T.slice(0,32)}})}}const h={name:`Track & Trace Service`,path:`/track/:reqCode/:locale?`,example:`/japanpost/track/EJ123456789JP/en`,url:`trackings.post.japanpost.jp/services/srv/search/`,handler:m,categories:[`other`],maintainers:[`tuzi3040`],parameters:{reqCode:`Package Number`,locale:"Language, default to japanese `ja`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},description:`| Japanese | English |
| -------- | ------- |
| ja       | en      |`,zh:{name:`邮件追踪查询`,description:`| 日语 | 英语 |
| ---- | ---- |
| ja   | en   |`},ja:{name:`郵便追跡サービス`,description:`| 日本語 | 英語 |
| ---- | ---- |
| ja   | en   |`}};export{h as route};