import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import{ofetch_default as n}from"./ofetch-CeMUzp5K.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import a from"node:path";import{load as o}from"cheerio";t();const s=`https://image.gcores.com`,c={BOLD:{fontWeight:`bold`},CODE:{fontFamily:`monospace`,wordWrap:`break-word`},ITALIC:{fontStyle:`italic`},STRIKETHROUGH:{textDecoration:`line-through`},UNDERLINE:{textDecoration:`underline`}},l={"header-one":{element:`h1`},"header-two":{element:`h2`},"header-three":{element:`h3`},"header-four":{element:`h4`},"header-five":{element:`h5`},"header-six":{element:`h6`},"unordered-list-item":{element:`li`,parentElement:`ul`},"ordered-list-item":{element:`li`,parentElement:`ol`},blockquote:{element:`blockquote`},atomic:{element:void 0},"code-block":{element:`pre`},unstyled:{element:`p`}},u=(e,t)=>`<span style="${Object.entries(t).map(([e,t])=>`${e.replaceAll(/([A-Z])/g,`-$1`).toLowerCase()}: ${t}`).join(`; `)}">${e}</span>`,d=(t,n)=>{switch(t.type){case`EMBED`:return t.data.content.startsWith(`http`)?`<a href="${t.data.content}" target="_blank">${t.data.content}</a>`:t.data.content;case`IMAGE`:return r(a.join(e,`templates/description-57cbf0bd.art`),{images:t.data.path?[{src:new URL(t.data.path,s).href,alt:t.data.caption,width:t.data.width,height:t.data.height}]:void 0}).replaceAll(`
`,``);case`GALLERY`:return!t.data.images||!Array.isArray(t.data.images)?``:r(a.join(e,`templates/description-57cbf0bd.art`),{images:t.data.images.map(e=>({src:new URL(e.path,s).href,alt:e.caption??t.data.caption,width:e.width,height:e.height}))}).replaceAll(`
`,``);case`LINK`:return`<a href="${t.data.url}" target="_blank">${n}</a>`;case`WIDGET`:return`<a href="${t.data.url}" target="_blank">${t.data.title}</a>`;default:return``}},f=(e,t)=>{let n=l[e.type];if(!n)return``;let{text:r,inlineStyleRanges:i,entityRanges:a}=e,o=[];for(let e of i)o.push({...e,styles:[c[e.style]],entity:null});for(let e of a)o.push({...e,styles:[],entity:t[e.key]});o.sort((e,t)=>e.offset-t.offset);let s=new Map,f=[];for(let e of o){let t=`${e.offset}-${e.length}`,n=s.get(t);n||(n={offset:e.offset,length:e.length,styles:[],entities:[]},s.set(t,n),f.push(n)),e.styles.length>0&&n.styles.push(...e.styles),e.entity&&n.entities.push(e.entity)}let p=[],m=0;for(let e of f){p.push(r.substring(m,e.offset));let t=r.substring(e.offset,e.offset+e.length);if(e.styles.length>0){let n={};for(let t of e.styles)for(let[e,r]of Object.entries(t))n[e]=r;t=u(t,n)}if(e.entities.length>0)for(let n of e.entities)t=d(n,t);p.push(t),m=e.offset+e.length}return p.push(r.slice(m)),`${n.element?`<${n.element}>`:``}${p.join(``).replaceAll(`
`,`<br>`)}${n.element?`</${n.element}>`:``}`},p=e=>{let{blocks:t,entityMap:n}=e;if(!t||t.length===0)return``;let r=[],i,a=[];for(let e of t){let t=l[e.type];if(!t)continue;let o=f(e,n);t.parentElement?i===t.parentElement?a.push(o):(i&&r.push(`<${i}>${a.join(``)}</${i}>`),i=t.parentElement,a=[o]):(i&&(r.push(`<${i}>${a.join(``)}</${i}>`),i=void 0,a=[]),r.push(o))}return i&&r.push(`<${i}>${a.join(``)}</${i}>`),r.join(``)};t();const m=`https://www.gcores.com`,h=`https://image.gcores.com`,g=new Set([`radios`,`articles`,`news`,`videos`,`talks`]),_=async(t,s,c,l)=>{let u=await n(c,{query:s??{"page[limit]":t,sort:`-published-at`,include:`category,user,media`,"filter[list-all]":1}}),d=o(await n(l)),f=d(`html`).attr(`lang`)??`zh-CN`,_=u.included,v=[...u.data,..._].filter(e=>g.has(e.type)),y=[];y=v?.slice(0,t).map(t=>{let n=t.attributes,o=t.relationships,s=n.title,c=n[`published-at`],l=`${t.type}/${t.id}`,u=[o?.category?.data,o?.tag?.data,o?.topic?.data].filter(Boolean).map(e=>{let t=_.find(t=>t.type===e.type&&t.id===e.id)?.attributes;return t?.name??t?.title}).filter(Boolean),g=o?.user?.data,v=g?_.find(e=>e.type===g.type&&e.id===g.id):void 0,y=v?[{name:v.attributes?.nickname,url:v.id?new URL(`${g.type}/${v.id}`,m).href:void 0,avatar:v.thumb?new URL(v.thumb,h).href:void 0}]:void 0,b=`gcores-${t.id}`,x=n.cover??n.thumb?new URL(n.cover??n.thumb,h).href:void 0,S=c,C={title:s,pubDate:c?i(c):void 0,link:new URL(l,m).href,category:u,author:y,guid:b,id:b,image:x,banner:x,updated:S?i(S):void 0,language:f},w,T,E=_.find(e=>e.id===o.media?.data?.id)?.attributes;if(n[`speech-path`]?(w=new URL(`uploads/audio/${n[`speech-path`]}`,`https://alioss.gcores.com`).href,T=`audio/${w?.split(/\./).pop()}`):E&&(E.audio?(w=E.audio,T=`audio/${w?.split(/\./).pop()}`):E[`original-src`]&&(w=E[`original-src`],T=`video/${w?.split(/\?/).pop()?/^id=\d+$/.test(w?.split(/\?/).pop())?`taptap`:w?.split(/\./).pop():``}`)),w){let e=n.duration?Number(n.duration):0;C={...C,enclosure_url:w,enclosure_type:T,enclosure_title:s,enclosure_length:e,itunes_duration:e,itunes_item_image:x}}let D=r(a.join(e,`templates/description-57cbf0bd.art`),{images:n.cover?[{src:new URL(n.cover,h).href,alt:s}]:void 0,audios:T?.startsWith(`audio`)&&w?[{src:w,type:T}]:void 0,videos:T?.startsWith(`video`)&&w?[{src:w,type:T}]:void 0,intro:n.desc||n.excerpt,description:n.content?p(JSON.parse(n.content)):void 0});return C={...C,title:s??d(D).text(),description:D,content:{html:D,text:D}},C});let b=d(`title`).text();return{title:b,description:d(`meta[name="description"]`).attr(`content`),link:l,item:y,allowEmpty:!0,author:b.split(/\|/).pop()?.trim(),language:f,id:d(`meta[property="og:url"]`).attr(`content`)}};export{m as baseUrl,_ as processItems};