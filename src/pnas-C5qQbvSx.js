import{__dirname as e,init_esm_shims as t}from"./esm-shims-rNwigI-Q.js";import"./config-CVBRPN4O.js";import{logger_default as n}from"./logger-BvonkID1.js";import"./proxy-DMKMSIEA.js";import"./ofetch-CeMUzp5K.js";import"./helpers-qpI1t-yV.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-DftO2d-b.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-Di2lBekK.js";import{puppeteer_default as s}from"./puppeteer-BZKI4hv7.js";import{setCookies as c}from"./puppeteer-utils-C3-dJ3CX.js";import l from"node:path";import{load as u}from"cheerio";import{CookieJar as d}from"tough-cookie";t();const f={path:`/:topicPath{.+}?`,radar:[{source:[`pnas.org/*topicPath`],target:`/:topicPath`}],name:`Unknown`,maintainers:[],handler:p,url:`pnas.org/*topicPath`};async function p(t){let f=`https://www.pnas.org`,p=`${f}/${t.req.param(`topicPath`)??`latest`}`,m=await r.get(`pnas:cookieJar`),h=!m;m=h?new d:d.fromJSON(m);let{data:g}=await o(p,{cookieJar:m});h&&await r.set(`pnas:cookieJar`,m.toJSON());let _=u(g),v=_(`.card--row-reversed .card-content`).toArray().map(e=>{e=_(e);let t=e.find(`.article-title a`);return{title:t.text(),link:new URL(t.attr(`href`),f).href,pubDate:a(e.find(`.card__meta__date`).text())}}),y=await s(),b=await Promise.all(v.map(t=>r.tryGet(t.link,async()=>{let r=await y.newPage();await c(r,await m.getCookieString(t.link),`.pnas.org`),await r.setRequestInterception(!0),r.on(`request`,e=>{e.resourceType()===`document`?e.continue():e.abort()}),n.http(`Requesting ${t.link}`),await r.goto(t.link,{waitUntil:`domcontentloaded`,referer:p}),await r.waitForSelector(`.core-container`);let a=await r.evaluate(()=>document.documentElement.innerHTML);await r.close();let o=u(a),s=JSON.parse(o(`script`).text().match(/PNASdataLayer =(.*?);/)[1]);o(`.signup-alert-ad, .citations-truncation button`).remove();let{keywords:d,topic:f}=s.page.attributes;return t.category=[...d,f],t.author=s.page.pageInfo.author,t.doi=s.page.pageInfo.DOI,t.description=i(l.join(e,`templates/article-8214e5db.art`),{access:s.user.access===`yes`,abstracts:o(`#abstracts .core-container`).html(),articleBody:o(`[property=articleBody]`).html(),dataAvailability:o(`#data-availability`).html(),acknowledgments:o(`#acknowledgments`).html(),supplementaryMaterials:o(`#supplementary-materials`).html(),bibliography:o(`#bibliography`).html()}),t})));return await y.close(),{title:`${_(`.banner-widget__content h1`).text()} - PNAS`,description:_(`.banner-widget__content p`).text(),image:`https://www.pnas.org/favicon.ico`,language:`en-US`,link:p,item:b}}export{f as route};