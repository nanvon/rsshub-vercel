import{n as e,t}from"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-VsB2Peor.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-BVCqvF6m.js";import{t as o}from"./timezone-BPfwRbwD.js";import{t as s}from"./invalid-parameter-CLGd_tte.js";import{t as c}from"./config-not-found-CX6cWM57.js";import l from"node:path";import{load as u}from"cheerio";e();const d=(e,t)=>e.startsWith(`http`)?e:`${t}${e}`,f={path:`/:language?/:keyword?`,categories:[`traditional-media`],example:`/kyodonews`,parameters:{language:"语言: `china` = 简体中文 (默认), `tchina` = 繁體中文",keyword:`关键词`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新报道`,maintainers:[`Rongronggg9`],handler:p,description:"`keyword` 为关键词，由于共同网有许多关键词并不在主页列出，此处不一一列举，可从关键词页的 URL 的最后一级路径中提取。如 `日中关系` 的关键词页 URL 为 `https://china.kyodonews.net/news/japan-china_relationship`, 则将 `japan-china_relationship` 填入 `keyword`。特别地，当填入 `rss` 时，将从共同网官方 RSS 中抓取文章；略去时，将从首页抓取最新报道 (注意：首页更新可能比官方 RSS 稍慢)。"};async function p(e){let f=e.req.param(`language`)??`china`,p=e.req.param(`keyword`)===`RSS`?`rss`:e.req.param(`keyword`)??``;if(![`china`,`tchina`].includes(f))throw new c(`Invalid language`);let m=`https://${f}.kyodonews.net`,h=`${m}/${p?p===`rss`?`rss/news.xml`:`news/${p}`:``}`,g;try{g=await a(h)}catch(e){throw e.response&&e.response.statusCode===404?new s(`Invalid keyword`):e}let _=u(g.data,{xmlMode:p===`rss`}),v,y,b,x;return b=`${m}/apple-touch-icon-180x180.png`,p===`rss`?(v=_(`channel > title`).text(),y=_(`channel > description`).text(),x=_(`item`).toArray().map(e=>({link:_(e).find(`link`).text()}))):(v=_(`head > title`).text(),y=_(`meta[name="description"]`).attr(`content`),b=d(_(`head > link[rel="apple-touch-icon"]`).attr(`href`),m)||b,x=_(`div.sec-latest > ul > li`).toArray().map(e=>(e=_(e),{link:d(e.find(`a`).attr(`href`),m)}))),x=await Promise.all(x.map(e=>n.tryGet(e.link,async()=>{let n=u((await a(e.link)).data);e.title=n(`head > title`).text(),e.author=n(`meta[name="author"]`).attr(`content`);let s=n(`div.mainpic`);s.find(`div`).each((e,t)=>{t=n(t),t.css(`text-align`,`center`)}),s.find(`img`).each((e,t)=>{t=n(t),t.attr(`src`,t.attr(`data-src`)),t.removeAttr(`data-src`),t.wrap(`<div>`)});let c=s.html();c=c?c.trim():``;let d=n(`div.article-body`).html();d=d?d.trim().replace(/（完）(?=<\/p>\s*$)/m,``):``,e.description=r(l.join(t,`templates/article-a61942d2.art`),{mainPic:c,articleBody:d});let f=n(`script[type="application/ld+json"]`).html(),p=f&&f.match(/"datePublished":"([\d\s-:]*?)"/),m=f&&f.match(/"dateModified":"([\d\s-:]*?)"/);return p&&(e.pubDate=o(i(p[1]),9)),m&&(e.updated=o(i(m[1]),9)),e.category=n(`p.credit > a`).toArray().map(e=>n(e).text()),e}))),{title:v,description:y,link:h,item:x,image:b}}export{f as route};