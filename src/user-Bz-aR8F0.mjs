import{n as e,t}from"./esm-shims-D4LgnpSl.mjs";import{t as n}from"./config-L8Ls2W7q.mjs";import{t as r}from"./logger-C50fTRi5.mjs";import{t as i}from"./ofetch-CvLG4YCQ.mjs";import{n as a,t as o}from"./header-generator-CW7_KYce.mjs";import{t as s}from"./cache-ZTWfXd2T.mjs";import{t as c}from"./render-CBhnapAf.mjs";import{t as l}from"./parse-date-bKmkZ9gg.mjs";import{t as u}from"./reject-4jEsgsyN.mjs";import d from"node:path";e();function f(e,t){let n=[];for(let e=0;e<256;e++)n[e]=e;for(let e=0,r=0;e<256;e++){r=(r+n[e]+t.codePointAt(e%t.length))%256;let i=n[e];n[e]=n[r],n[r]=i}let r=[];for(let t=0,i=0,a=0;a<e.length;a++){t=(t+1)%256,i=(i+n[t])%256;let o=n[t];n[t]=n[i],n[i]=o;let s=(n[t]+n[i])%256;r.push(String.fromCodePoint(n[s]^e.codePointAt(a)))}return r.join(``)}function p(e,t){return(e<<(t%=32)|e>>>32-t)>>>0}function m(e){if(0<=e&&e<16)return 2043430169;if(16<=e&&e<64)return 2055708042;r.error(`invalid j for constant Tj`)}function h(e,t,n,i){return 0<=e&&e<16?(t^n^i)>>>0:16<=e&&e<64?(t&n|t&i|n&i)>>>0:(r.error(`invalid j for bool function FF`),0)}function g(e,t,n,i){return 0<=e&&e<16?(t^n^i)>>>0:16<=e&&e<64?(t&n|~t&i)>>>0:(r.error(`invalid j for bool function GG`),0)}function _(){this.reg[0]=1937774191,this.reg[1]=1226093241,this.reg[2]=388252375,this.reg[3]=3666478592,this.reg[4]=2842636476,this.reg[5]=372324522,this.reg[6]=3817729613,this.reg[7]=2969243214,this.chunk=[],this.size=0}function v(e){let t=encodeURIComponent(e).replaceAll(/%([0-9A-F]{2})/g,(e,t)=>String.fromCodePoint(`0x`+t)),n=Array.from({length:t.length});return Array.prototype.forEach.call(t,(e,t)=>{n[t]=e.codePointAt(0)}),n}function y(e){let t=typeof e==`string`?v(e):e;this.size+=t.length;let n=64-this.chunk.length;if(t.length<n)this.chunk=this.chunk.concat(t);else for(this.chunk=this.chunk.concat(t.slice(0,n));this.chunk.length>=64;)this._compress(this.chunk),this.chunk=n<t.length?t.slice(n,Math.min(n+64,t.length)):[],n+=64}function b(e,t){e&&(this.reset(),this.write(e)),this._fill();for(let e=0;e<this.chunk.length;e+=64)this._compress(this.chunk.slice(e,e+64));let n;if(t===`hex`){n=``;for(let e=0;e<8;e++)n+=se(this.reg[e].toString(16),8,`0`)}else{n=Array.from({length:32});for(let e=0;e<8;e++){let t=this.reg[e];n[4*e+3]=(255&t)>>>0,t>>>=8,n[4*e+2]=(255&t)>>>0,t>>>=8,n[4*e+1]=(255&t)>>>0,t>>>=8,n[4*e]=(255&t)>>>0}}return this.reset(),n}function x(e){let t=Array.from({length:132});for(let n=0;n<16;n++)t[n]=e[4*n]<<24,t[n]|=e[4*n+1]<<16,t[n]|=e[4*n+2]<<8,t[n]|=e[4*n+3],t[n]>>>=0;for(let e=16;e<68;e++){let n=t[e-16]^t[e-9]^p(t[e-3],15);n=n^p(n,15)^p(n,23),t[e]=(n^p(t[e-13],7)^t[e-6])>>>0}for(let e=0;e<64;e++)t[e+68]=(t[e]^t[e+4])>>>0;return t}function S(e){if(e<64){r.error(`compress error: not enough data`);return}else{let t=x(e),n=this.reg.slice(0);for(let e=0;e<64;e++){let r=p(n[0],12)+n[4]+p(m(e),e);r=(4294967295&r)>>>0,r=p(r,7);let i=(r^p(n[0],12))>>>0,a=h(e,n[0],n[1],n[2]);a=a+n[3]+i+t[e+68],a=(4294967295&a)>>>0;let o=g(e,n[4],n[5],n[6]);o=o+n[7]+r+t[e],o=(4294967295&o)>>>0,n[3]=n[2],n[2]=p(n[1],9),n[1]=n[0],n[0]=a,n[7]=n[6],n[6]=p(n[5],19),n[5]=n[4],n[4]=(o^p(o,9)^p(o,17))>>>0}for(let e=0;e<8;e++)this.reg[e]=(this.reg[e]^n[e])>>>0}}function C(){let e=8*this.size,t=this.chunk.push(128)%64;for(64-t<8&&(t-=64);t<56;t++)this.chunk.push(0);for(let t=0;t<4;t++){let n=Math.floor(e/4294967296);this.chunk.push(n>>>8*(3-t)&255)}for(let t=0;t<4;t++)this.chunk.push(e>>>8*(3-t)&255)}function w(){this.reg=[],this.chunk=[],this.size=0,this.reset()}w.prototype.reset=_,w.prototype.write=y,w.prototype.sum=b,w.prototype._compress=S,w.prototype._fill=C;function T(e,t){let n={s0:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`,s1:`Dkdpgh4ZKsQB80/Mfvw36XI1R25+WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=`,s2:`Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=`,s3:`ckdp1h4ZKsUB80/Mfvw36XIgR25+WQAlEi7NLboqYTOPuzmFjJnryx9HVGDaStCe`,s4:`Dkdpgh2ZmsQB80/MfvV36XI1R45-WUAlEixNLwoqYTOPuzKFjJnry79HbGcaStCe`},r={0:16515072,1:258048,2:4032,str:n[t]},i=``,a=0,o=E(a,e);for(let t=0;t<e.length/3*4;t++){Math.floor(t/4)!==a&&(a+=1,o=E(a,e));let n=t%4,s;switch(n){case 0:s=(o&r[0])>>18,i+=r.str.charAt(s);break;case 1:s=(o&r[1])>>12,i+=r.str.charAt(s);break;case 2:s=(o&r[2])>>6,i+=r.str.charAt(s);break;case 3:s=o&63,i+=r.str.charAt(s);break;default:break}}return i}function E(e,t){return e*=3,t.codePointAt(e)<<16|t.codePointAt(e+1)<<8|t.codePointAt(e+2)}function D(e,t){return[e&170|t[0]&85,e&85|t[0]&170,e>>8&170|t[1]&85,e>>8&85|t[1]&170]}function O(e,t,n,r=`cus`,i=[0,1,14]){let a=new w,o=Date.now(),s=a.sum(a.sum(e+r)),c=a.sum(a.sum(r)),l=a.sum(T(f(t,Reflect.apply(String.fromCharCode,null,[.00390625,1,14])),`s3`)),u=Date.now(),d={8:3,10:u,15:{aid:6383,pageId:6241,boe:!1,ddrt:7,paths:{include:[{},{},{},{},{},{},{}],exclude:[]},track:{mode:0,delay:300,paths:[]},dump:!0,rpU:``},16:o,18:44,19:[1,0,1,5]};d[20]=d[16]>>24&255,d[21]=d[16]>>16&255,d[22]=d[16]>>8&255,d[23]=d[16]&255,d[24]=d[16]/256/256/256/256>>0,d[25]=d[16]/256/256/256/256/256>>0,d[26]=i[0]>>24&255,d[27]=i[0]>>16&255,d[28]=i[0]>>8&255,d[29]=i[0]&255,d[30]=i[1]/256&255,d[31]=i[1]%256&255,d[32]=i[1]>>24&255,d[33]=i[1]>>16&255,d[34]=i[2]>>24&255,d[35]=i[2]>>16&255,d[36]=i[2]>>8&255,d[37]=i[2]&255,d[38]=s[21],d[39]=s[22],d[40]=c[21],d[41]=c[22],d[42]=l[23],d[43]=l[24],d[44]=d[10]>>24&255,d[45]=d[10]>>16&255,d[46]=d[10]>>8&255,d[47]=d[10]&255,d[48]=d[8],d[49]=d[10]/256/256/256/256>>0,d[50]=d[10]/256/256/256/256/256>>0,d[51]=d[15].pageId,d[52]=d[15].pageId>>24&255,d[53]=d[15].pageId>>16&255,d[54]=d[15].pageId>>8&255,d[55]=d[15].pageId&255,d[56]=d[15].aid,d[57]=d[15].aid&255,d[58]=d[15].aid>>8&255,d[59]=d[15].aid>>16&255,d[60]=d[15].aid>>24&255;let p=[];for(let e=0;e<n.length;e++)p.push(n.codePointAt(e));d[64]=p.length,d[65]=d[64]&255,d[66]=d[64]>>8&255,d[69]=0,d[70]=d[69]&255,d[71]=d[69]>>8&255,d[72]=d[18]^d[20]^d[26]^d[30]^d[38]^d[40]^d[42]^d[21]^d[27]^d[31]^d[35]^d[39]^d[41]^d[43]^d[22]^d[28]^d[32]^d[36]^d[23]^d[29]^d[33]^d[37]^d[44]^d[45]^d[46]^d[47]^d[48]^d[49]^d[50]^d[24]^d[25]^d[52]^d[53]^d[54]^d[55]^d[57]^d[58]^d[59]^d[60]^d[65]^d[66]^d[70]^d[71];let m=[d[18],d[20],d[52],d[26],d[30],d[34],d[58],d[38],d[40],d[53],d[42],d[21],d[27],d[54],d[55],d[31],d[35],d[57],d[39],d[41],d[43],d[22],d[28],d[32],d[60],d[36],d[23],d[29],d[33],d[37],d[44],d[45],d[59],d[46],d[47],d[48],d[49],d[50],d[24],d[25],d[65],d[66],d[70],d[71]];return m=m.concat(p).concat(d[72]),f(String.fromCharCode.apply(null,m),Reflect.apply(String.fromCharCode,null,[121]))}function k(){let e=[];return e=e.concat(D(Math.random()*1e4,[3,45])),e=e.concat(D(Math.random()*1e4,[1,0])),e=e.concat(D(Math.random()*1e4,[1,5])),String.fromCharCode.apply(null,e)}function A(e,t){return T(k()+O(e,t,`1536|747|1536|834|0|30|0|0|1536|834|1536|864|1525|747|24|24|Win32`),`s4`)+`=`}const j={path:`/user/token/:token`,categories:[`new-media`],example:`/toutiao/user/token/MS4wLjABAAAAEmbqJP2CmC8XXv1BpMvQ3sQHKAxFsq8wHxj8XVIQWja6tMcB-QEbFkzkRNgMl12M`,parameters:{token:`用户 token，可在用户主页 URL 找到`},features:{antiCrawler:!0},radar:[{source:[`www.toutiao.com/c/user/token/:token`]}],name:`头条主页`,maintainers:[`TonyRL`],handler:M};async function M(e){let{token:r}=e.req.param(),f=await s.tryGet(`toutiao:user:${r}`,async()=>{let e=`category=profile_all&token=${r}&max_behot_time=0&entrance_gid&aid=24&app_name=toutiao_web`,t=a(o.MODERN_WINDOWS_CHROME)[`user-agent`];return(await i(`https://www.toutiao.com/api/pc/list/feed?${e}&a_bogus=${A(e,t)}`,{headerGeneratorOptions:o.MODERN_WINDOWS_CHROME})).data},n.cache.routeExpire,!1);if(!f)throw new u(`无法获取用户信息`);let p=f.map(e=>{switch(e.cell_type){case 0:case 49:{let n=e.video.play_addr_list.toSorted((e,t)=>t.bitrate-e.bitrate)[0];return{title:e.title,description:c(d.join(t,`templates/video-15d12efd.art`),{poster:e.video.origin_cover.url_list[0],url:e.video.play_addr_list.toSorted((e,t)=>t.bitrate-e.bitrate)[0].play_url_list[0]}),link:`https://www.toutiao.com/video/${e.id}/`,pubDate:l(e.publish_time,`X`),author:e.user?.info.name??e.source,enclosure_url:n?.play_url_list[0],enclosure_type:n?.play_url_list[0]?`video/mp4`:void 0,user:{name:e.user?.info.name,avatar:e.user?.info.avatar_url,description:e.user?.info.desc}}}case 32:{let t=e.large_image_list?.pop();return{title:e.content?.split(`
`)[0],description:e.rich_content,link:`https://www.toutiao.com/w/${e.id}/`,pubDate:l(e.publish_time,`X`),author:e.user?.name,enclosure_url:t?.url,enclosure_type:t?.url?`image/${new URL(t.url).pathname.split(`.`).pop()}`:void 0,user:{name:e.user?.name,avatar:e.user?.avatar_url,description:e.user?.desc}}}case 60:default:return{title:e.title,description:e.abstract,link:`https://www.toutiao.com/article/${e.id}/`,pubDate:l(e.publish_time,`X`),author:e.user_info?.name,user:{name:e.user_info?.name,avatar:e.user_info?.avatar_url,description:e.user_info?.description}}}});return{title:`${p[0].user.name}的头条主页 - 今日头条(www.toutiao.com)`,description:p[0].user.description,link:`https://www.toutiao.com/c/user/token/${r}/`,image:p[0].user.avatar,item:p}}export{j as route};