import{t as e}from"./cache-CpEhLexq.js";import{t}from"./got-BVCqvF6m.js";import{i as n,n as r,t as i}from"./readable-social-HHY93e0I.js";import{load as a}from"cheerio";import o from"node:querystring";const s={formatTitle:e=>e.replaceAll(/<span class=["']url-icon["']><img\s[^>]*?alt=["']?([^>]+?)["']?\s[^>]*?\/?><\/span>/g,`$1`).replaceAll(/<span class=["']url-icon["']>(<img\s[^>]*>)<\/span>/g,``).replaceAll(/<img\s[^<]*>/g,`[å›¾ç‰‡]`).replaceAll(/<[^<]*>/g,``).replaceAll(`
`,` `).trim(),formatExtended:(e,t,a,c={},l=[])=>{let u=o.parse(e.req.param(`routeParams`));c={readable:i(c.readable,r(u.readable),!1),authorNameBold:i(c.authorNameBold,r(u.authorNameBold),!1),showAuthorInTitle:i(c.showAuthorInTitle,r(u.showAuthorInTitle),!1),showAuthorInDesc:i(c.showAuthorInDesc,r(u.showAuthorInDesc),!1),showAuthorAvatarInDesc:i(c.showAuthorAvatarInDesc,r(u.showAuthorAvatarInDesc),!1),showAtBeforeAuthor:i(c.showAtBeforeAuthor,null,!1),showEmojiForRetweet:i(c.showEmojiForRetweet,r(u.showEmojiForRetweet),!1),showRetweetTextInTitle:i(c.showRetweetTextInTitle,r(u.showRetweetTextInTitle),!0),addLinkForPics:i(c.addLinkForPics,r(u.addLinkForPics),!1),showTimestampInDescription:i(c.showTimestampInDescription,r(u.showTimestampInDescription),!1),widthOfPics:i(c.widthOfPics,n(u.widthOfPics),-1),heightOfPics:i(c.heightOfPics,n(u.heightOfPics),-1),sizeOfAuthorAvatar:i(c.sizeOfAuthorAvatar,n(u.sizeOfAuthorAvatar),48),showEmojiInDescription:i(c.showEmojiInDescription,n(u.showEmojiInDescription),!1),showLinkIconInDescription:i(c.showLinkIconInDescription,n(u.showLinkIconInDescription),!0),preferMobileLink:i(c.preferMobileLink,r(u.preferMobileLink),!1)};let{readable:d,authorNameBold:f,showAuthorInTitle:p,showAuthorInDesc:m,showAuthorAvatarInDesc:h,showAtBeforeAuthor:g,showEmojiForRetweet:_,showRetweetTextInTitle:v,addLinkForPics:y,showTimestampInDescription:b,widthOfPics:x,heightOfPics:S,sizeOfAuthorAvatar:C,showEmojiInDescription:w,showLinkIconInDescription:T,preferMobileLink:E}=c,D=``,O=t.longText&&t.longText.longTextContent||t.text||``;w||(O=O.replaceAll(/<span class=["']?url-icon["']?><img\s[^>]*?alt=["']?([^>]+?)["']?\s[^>]*?\/><\/span>/g,`$1`)),T||(O=O.replaceAll(/(<a\s[^>]*>)<span class=["']?url-icon["']?><img\s[^>]*><\/span>[^<>]*?<span class=["']?surl-text["']?>([^<>]*?)<\/span><\/a>/g,`$1$2</a>`));let k=O.match(/<span class=["']?surl-text["']?>#([^<>]*?)#<\/span>/g)?.map(e=>e?.match(/#([^#]+)#/)?.[1]);O=O.replaceAll(`å…¨æ–‡<br>`,`<br>`),O=O.replaceAll(/<a href="(.*?)">å…¨æ–‡<\/a>/g,``),O=O.replaceAll(/"https:\/\/weibo\.cn\/sinaurl.*?[&?]u=(http.*?)"/g,(e,t)=>`"${decodeURIComponent(t)}"`),O=O.replaceAll(/<a\s+href="https?:\/\/[^"]+\.(jpg|png|gif)"/g,e=>`${e} data-rsshub-image="href"`);let A=O.replaceAll(`
`,`<br>`);if(m){let e=`<a href="https://weibo.com/${t.user.id}" target="_blank">`;h&&(e+=`<img width="${C}" height="${C}" src="${t.user.profile_image_url}" ${d?`hspace="8" vspace="8" align="left"`:``} />`);let n=t.user.screen_name;g&&(n=`@`+n),e+=f?`<strong>${n}</strong></a>:&ensp;`:`${n}</a>:&ensp;`,A=e+A}if(t.pics&&!Array.isArray(t.pics)&&typeof t.pics==`object`&&(t.pics=Object.values(t.pics)),t.page_info&&t.page_info.type===`article`&&t.page_info.page_pic&&t.page_info.page_pic.url){let e={large:{url:t.page_info.page_pic.url}};t.pics?t.pics.push(e):t.pics=[e]}let j=t.pics?t.pics.filter(e=>e.type===`livephoto`).length:0,M=t.pics&&t.pics.filter(e=>e.type!==`livephoto`);if(M){d&&(A+=`<br clear="both" /><div style="clear: both"></div>`);let e=``;for(let t of M)e+=`<img width="0" height="0" hidden="true" src="${t.large.url}">`;l.push(e);for(let e of M){y&&(A+=`<a href="`+e.large.url+`">`);let t=``;if(A+=`<img `,A+=d?`vspace="8" hspace="4"`:``,e.large){let{geo:n,url:r}=e.large;if(n?.width||x>=0){let e=n?.width||x;A+=` width="${e}"`,t+=`width: ${e}px;`}if(n?.height||S>=0){let e=n?.height||S;A+=` height="${e}"`,t+=`height: ${e}px;`}A+=` style="${t}" src="${r}">`}y&&(A+=`</a>`),O+=`<img src="" />`}}if(t.retweeted_status){A+=d?`<br clear="both" /><div style="clear: both"></div><blockquote style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`:`<br><blockquote> - è½¬å‘ `,t.retweeted_status.user||(t.retweeted_status.user={profile_image_url:``,screen_name:`[åŸå¾®åšä¸å¯è®¿é—®]`,id:`sorry`});let n=Object.assign({},c);n.showAuthorInDesc=!0,n.showAuthorAvatarInDesc=!1,n.showAtBeforeAuthor=!0,D+=s.formatExtended(e,t.retweeted_status,void 0,n,l).description,A+=D,d&&(A+=`<br><small>åŸåšï¼š<a href="https://weibo.com/${t.retweeted_status.user.id}/${t.retweeted_status.bid}" target="_blank" rel="noopener noreferrer">https://weibo.com/${t.retweeted_status.user.id}/${t.retweeted_status.bid}</a></small>`),b&&(A+=`<br><small>`+new Date(t.retweeted_status.created_at).toLocaleString()+`</small>`),d&&(A+=`<br clear="both" /><div style="clear: both"></div>`),A+=`</blockquote>`}m&&h&&(A=l.join(``)+A);let N=``;p&&(N+=t.user.screen_name+`: `),(!t.retweeted_status||v)&&(N+=s.formatTitle(O)),t.retweeted_status&&(N+=_?`ğŸ” `:` - è½¬å‘ `,N+=s.formatTitle(D)),j>0&&(N+=` `,N+=Array.from({length:j+1}).join(`[Live Photo]`)),t.page_info&&t.page_info===`video`&&(N+=` [è§†é¢‘]`),a||=t.user?.id;let P=t.bid||t.id,F=a?`https://weibo.com/${a}/${P}`:`https://m.weibo.cn/status/${P}`,I=E?`https://m.weibo.cn/status/${P}`:F,L=[{name:t.user?.screen_name,url:`https://weibo.com/${a}`,avatar:t.user?.avatar_hd}],R=t.created_at;return{description:A,title:N,link:I,guid:F,author:L,pubDate:R,category:k}},getShowData:async(e,n)=>{let r=`https://m.weibo.cn/statuses/show?id=${n}`;return(await t.get(r,{headers:{Referer:`https://m.weibo.cn/u/${e}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}})).data.data},formatVideo:(e,t)=>{let n=t.page_info,r=t.pics&&t.pics.filter(e=>e.type===`livephoto`&&e.videoSrc),i=`<br clear="both" /><div style="clear: both"></div>`,a=!1;if(r)for(let e of r)i+=`<video controls="controls" poster="${e.large&&e.large.url||e.url}" src="${e.videoSrc}" style="width: 100%"></video>`,a=!0;if(n&&n.type===`video`){let e=n.page_pic,t=e?e.url:``,r=n.page_url,o=n.media_info||{},s=n.urls||{},c=s.mp4_720p_mp4||o.mp4_720p_mp4||``,l=s.mp4_hd_mp4||o.mp4_hd_url||o.stream_url_hd||``,u=s.hevc_mp4_hd||``,d=s.mp4_ld_mp4||o.mp4_sd_url||o.stream_url||``;(c||l||u||d)&&(i+=`<video controls="controls" poster="${t}" style="width: 100%">`,c&&(i+=`<source src="${c}">`),l&&(i+=`<source src="${l}">`),u&&(i+=`<source src="${u}">`),d&&(i+=`<source src="${d}">`),r&&(i+=`<p>è§†é¢‘æ— æ³•æ˜¾ç¤ºï¼Œè¯·å‰å¾€<a href="${r}" target="_blank" rel="noopener noreferrer">å¾®åšè§†é¢‘</a>è§‚çœ‹ã€‚</p>`),i+=`</video>`,a=!0)}return a&&(e+=i),e},formatArticle:async(n,r,i)=>{let o=i.page_info;if(o&&o.type===`article`&&o.page_url){let n=o.page_url.match(/id=(\d+)/);if(!n)return r;let i=n[1],s=`https://card.weibo.com/article/m/aj/detail?id=${i}`,c=(await e.tryGet(s,async()=>(await t.get(s,{headers:{Referer:`https://card.weibo.com/article/m/show/id/${i}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}})).data)).data;if(c&&c.title&&c.content){let e=c.title,t=c.content,n=c.summary,i=c.create_at,o=c.read_count,s=c.is_original,l=c.is_article_free,u=`<br clear="both" /><br clear="both" />`;u+=`<div style="clear: both"></div><div style="background: #fff;border:5px solid #80808030;margin:0;padding:3% 5%;overflow-wrap: break-word">`,u+=`<h1 style="font-size: 1.5rem;line-height: 1.25;color: #333;">${e}</h1>`;let d=`display: inline-block;margin-inline: 0.25rem;width: 2.25rem; height: 1.125rem; background: #eee; border-radius: 2px; box-sizing: border-box; text-align: center; line-height: 1.0625rem; font-size: 0.75rem; color: #aaa;`,f=`<p style="line-height: 1.66; color: #999;margin: 0 0 0.75rem;font-size: 0.75rem;padding: 0">`;l&&(f+=`<span style="${d}">è¯•è¯»</span> `),s&&(f+=`<span style="${d}">åŸåˆ›</span> `),f+=`<span style="margin-inline: 0.25rem;">å‘å¸ƒæ—¶é—´: ${i}</span> `,f+=`<span style="margin-inline: 0.25rem;">é˜…è¯»é‡: ${o}</span> `,f+=`</p>`,u+=f,n&&(u+=`<p style="color: #999;line-height: 1.5rem;padding: 0.0625rem 0 0.875rem;margin: 0">${n}</p>`),u+=`<div style="height: 0;border-bottom: 1px dashed #999;margin-bottom: 0.75rem;"></div>`;let p=a(t);p(`p`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`margin: 0;padding: 0;border: 0;`+n,t.attr(`style`,n)}),p(`.image`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`display: table;text-align: center;margin-left: auto;margin-right: auto;clear: both;min-width: 50px;`+n,t.attr(`style`,n)}),p(`img`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`display: block;max-width: 100%;margin-left: auto;margin-right: auto;min-width: 50px;`+n,t.attr(`style`,n)});let m=p.html();u+=`<div style="line-height: 1.59;text-align: justify;font-size: 1.0625rem;color: #333;">${m}</div>`,u+=`</div>`,r+=u}}return r},formatComments:async(n,r,i,a)=>{if(i&&i.comments_count&&i.id&&i.mid){let n=i.id,o=`https://m.weibo.cn/comments/hotflow?id=${n}&mid=${i.mid}&max_id_type=0`,s=await e.tryGet(o,async()=>(await t.get(o,{headers:{Referer:`https://m.weibo.cn/detail/${n}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}})).data);if(s.data&&s.data.data){let e=s.data.data;r+=`<br clear="both" /><div style="clear: both"></div><div style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`,r+=`<h3>çƒ­é—¨è¯„è®º</h3>`;for(let t of e){r+=`<p style="margin-bottom: 0.5em;margin-top: 0.5em">`;let e=t.user.screen_name;if(a===`1`&&t.blogger_icons&&(e+=t.blogger_icons[0].name),r+=`<a href="https://weibo.com/${t.user.id}" target="_blank">${e}</a>: ${t.text}`,`pic`in t&&(r+=`<br><img src="${t.pic.url}">`),t.comments){r+=`<blockquote style="border-left:0.2em solid #80808080; margin-left: 0.3em; padding-left: 0.5em; margin-bottom: 0.5em; margin-top: 0.25em">`;for(let e of t.comments){let t=e.text.match(/<a\s+href="https:\/\/weibo\.cn\/sinaurl\?u=([^"]+)"[^>]*><span class='url-icon'><img[^>]*><\/span><span class="surl-text">(æŸ¥çœ‹å›¾ç‰‡|è¯„è®ºé…å›¾|æŸ¥çœ‹åŠ¨å›¾)<\/span><\/a>/g);if(t)for(let n of t){let t=n.match(/href="https:\/\/weibo\.cn\/sinaurl\?u=([^"]+)"/);if(t){let r=`<img src="${decodeURIComponent(t[1])}" style="width: 1rem; height: 1rem;">`;e.text=e.text.replaceAll(n,r)}}r+=`<div style="font-size: 0.9em">`;let n=e.user.screen_name;a===`1`&&e.blogger_icons&&(n+=e.blogger_icons[0].name),r+=`<a href="https://weibo.com/${e.user.id}" target="_blank">${n}</a>: ${e.text}`,r+=`</div>`}r+=`</blockquote>`}r+=`</p>`}r+=`</div>`}}return r},sinaimgTvax:(()=>{let e=/(?<=\/\/)wx(?=[1-4]\.sinaimg\.cn\/)/gi,t=t=>t.replaceAll(e,`tvax`),n=(e,n)=>{for(let r of n)e[r]&&(e[r]=t(e[r]))},r=[`description`,`image`],i=[`description`];return e=>{if(e&&(n(e,r),e.item))for(let t of e.item)n(t,i);return e}})()};var c=s;export{c as t};