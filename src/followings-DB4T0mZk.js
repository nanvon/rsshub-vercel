import"./esm-shims-BGJi2y--.js";import{config as e}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./proxy-DMKMSIEA.js";import"./ofetch-DqHh1IN2.js";import"./helpers-gUVC02jt.js";import"./cache-Dfid4xgQ.js";import"./render-CSnicFA3.js";import"./md5-15Cn4YyR.js";import{got_default as t}from"./got-VGofQtEf.js";import{invalid_parameter_default as n}from"./invalid-parameter-CfUmvEUg.js";import{config_not_found_default as r}from"./config-not-found-B7nOMdXp.js";import"./puppeteer-BZKI4hv7.js";import"./utils-Dw4hXpqG.js";import{cache_default as i}from"./cache-CPhPyIf2.js";const a={path:`/user/followings/:uid/:loginUid`,categories:[`social-media`],example:`/bilibili/user/followings/2267573/3`,parameters:{uid:`用户 id, 可在 UP 主主页中找到`,loginUid:`用于登入的用户id,需要配置对应的 Cookie 值`},features:{requireConfig:[{name:`BILIBILI_COOKIE_*`,description:"BILIBILI_COOKIE_{uid}: 用于用户关注动态系列路由，对应 uid 的 b 站用户登录后的 Cookie 值，`{uid}` 替换为 uid，如 `BILIBILI_COOKIE_2267573`，获取方式：\n    1.  打开 [https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_new?uid=0&type=8](https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_new?uid=0&type=8)\n    2.  打开控制台，切换到 Network 面板，刷新\n    3.  点击 dynamic_new 请求，找到 Cookie\n    4.  视频和专栏，UP 主粉丝及关注只要求 `SESSDATA` 字段，动态需复制整段 Cookie"}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`space.bilibili.com/:uid`],target:`/user/followings/:uid`}],name:`UP 主关注用户`,maintainers:[`Qixingchen`],handler:o,description:`::: warning
  UP 主关注用户现在需要 b 站登录后的 Cookie 值，所以只能自建，详情见部署页面的配置模块。
:::`};async function o(a){let o=a.req.param(`loginUid`),s=e.bilibili.cookies[o];if(s===void 0)throw new r(`缺少对应 loginUid 的 Bilibili 用户登录后的 Cookie 值 <a href="https://docs.rsshub.app/zh/deploy/config#route-specific-configurations">bilibili 用户关注动态系列路由</a>`);let c=a.req.param(`uid`),l=await i.getUsernameFromUID(c),u=(await t({method:`get`,url:`https://api.bilibili.com/x/relation/stat?vmid=${c}`,headers:{Referer:`https://space.bilibili.com/${c}/`}})).data.data.following,d=await t({method:`get`,url:`https://api.bilibili.com/x/relation/followings?vmid=${c}`,headers:{Referer:`https://space.bilibili.com/${c}/`,Cookie:s}});if(d.data.code===-6)throw new r(`对应 loginUid 的 Bilibili 用户的 Cookie 已过期`);if(d.data.code===22115)throw new n(d.data.message);let f=d.data.data.list;return{title:`${l} 的 bilibili 关注`,link:`https://space.bilibili.com/${c}/#/fans/follow`,description:`${l} 的 bilibili 关注`,item:f.map(e=>({title:`${l} 新关注 ${e.uname}`,description:`${e.uname}<br>${e.sign}<br>总计${u}`,pubDate:new Date(e.mtime*1e3),link:`https://space.bilibili.com/${e.mid}`}))}}export{a as route};