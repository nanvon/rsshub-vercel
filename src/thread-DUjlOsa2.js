import"./esm-shims-BC3isTv8.js";import{t as e}from"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CfXAR0UO.js";import"./helpers-Cqaav28H.js";import{t}from"./parse-date-CHEO0z5G.js";import{t as n}from"./got-dCh-Ojgc.js";import{t as r}from"./timezone-BPfwRbwD.js";import{load as i}from"cheerio";import a from"query-string";const o={path:`/thread/:tid`,categories:[`bbs`],example:`/saraba1st/thread/751272`,parameters:{tid:`帖子 id`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`帖子`,maintainers:[`zengxs`],handler:s,description:"帖子网址如果为 `https://stage1st.com/2b/thread-751272-1-1.html` 那么帖子 id 就是 `751272`。"};async function s(o){let s=o.req.param(`tid`),c=e.saraba1st.cookie??``,l=e.saraba1st.host,u=i((await n(`${l}/2b/forum.php`,{searchParams:a.stringify({mod:`viewthread`,tid:s,ordertype:1}),headers:{Cookie:c}})).data),d=u(`#thread_subject`).text(),f=u(`#postlist > div[id^=post_]:not(:first-of-type)`),p=[];for(let e=0;e<Math.min(f.length,20);e++)p.push(e);let m=new URL(`/image/common/none.gif`,l);m.hostname=`static.${m.hostname.split(`.`).slice(-2).join(`.`)}`;let h=p.map(e=>{let n=u(f[e]),i=n.find(`td.plc .pi a > em`).text(),a=n.find(`td.plc .pi a`).attr(`href`),o=u(n.find(`td.t_f`)),s=o.find(`img`);for(let e of s)if(e.attribs.src===m.href){e.attribs.src=e.attribs.file;let t=u(e);t.removeAttr(`zoomfile`),t.removeAttr(`file`),t.removeAttr(`onmouseover`),t.removeAttr(`onclick`)}return o.find(`div.aimg_tip`).remove(),{title:`${d} #${i}`,link:new URL(a,`${l}/2b/`).href,description:o.html(),author:n.find(`.authi .xw1`).text(),pubDate:r(t(n.find(`.authi em`).text()),8)}});return{title:`Stage1 论坛 - ${d}`,link:`${l}/2b/thread-${s}-1-1.html`,item:h}}export{o as route};