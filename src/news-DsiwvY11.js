import{n as e,t}from"./esm-shims-BC3isTv8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-CfXAR0UO.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./timezone-BPfwRbwD.js";import{t as s}from"./types-Bn7An2Wc.js";import{t as c}from"./invalid-parameter-CLGd_tte.js";import l from"node:path";import{load as u}from"cheerio";e();const d={newslist:`newsList`,r18list:`newsPornList`},f=async e=>{let{type:s=`newslist`,category:f=`all`}=e.req.param();if(!d.hasOwnProperty(s))throw new c(`Invalid type: ${s}`);let p=Number.parseInt(e.req.query(`limit`)??`30`,10),m=`https://news.gamebase.com.tw`,h=new URL(`news${f===`all`?``:`/newslist?type=${f}`}`,m).href,g=new URL(`api/news/getNewsList`,`https://api.gamebase.com.tw`).href,_=await n(g,{method:`post`,body:{GB_type:d[s],category:f,page:1}}),v=u(await n(h)),y=v(`html`).attr(`lang`)??`zh-TW`,b=await Promise.all(_.return_msg?.list?.slice(0,p).map(e=>r.tryGet(`gamebase-news-${e.news_no}`,async()=>{let r=e.news_title,s=e.post_time,c=e.news_no?`news/detail/${e.news_no}`:void 0,u=[e.system],d=e.nickname,f=`gamebase-news-${e.news_no}`,p=e.news_img,h=e.updated??s,g=e.news_meta?.meta_des;g||=((await n(e.link)).match(/(\\u003C.*?)","/)?.[1]??``).replaceAll(String.raw`\"`,`"`).replaceAll(/\\u([\da-f]{4})/gi,(e,t)=>String.fromCodePoint(Number.parseInt(t,16)));let _=i(l.join(t,`templates/description-881baa33.art`),{images:p&&!g?[{src:p,alt:r}]:void 0,intro:e.news_short_desc,description:g});return{title:r,description:_,pubDate:s?o(a(s),8):void 0,link:c?new URL(c,m).href:void 0,category:u,author:d,guid:f,id:f,content:{html:_,text:_},image:p,banner:p,updated:h?o(a(h),8):void 0,language:y}}))??[]);return{title:v(`title`).text(),description:v(`meta[property="og:description"]`).attr(`content`),link:h,item:b,allowEmpty:!0,image:v(`meta[property="og:image"]`).attr(`content`),author:v(`meta[property="og:title"]`).attr(`content`)?.split(/\|/).pop()?.trim(),language:y,id:v(`meta[property="og:url"]`).attr(`content`)}},p={path:`/news/:type?/:category?`,name:`新聞`,url:`news.gamebase.com.tw`,maintainers:[`nczitzk`],handler:f,example:`/gamebase/news`,parameters:{type:`類型，見下表，預設為 newslist`,category:"分類，預設為 `all`，即全部，可在對應分類頁 URL 中找到"},description:"::: tip\n若訂閱 [手機遊戲新聞](https://news.gamebase.com.tw/news/newslist?type=mobile)，網址為 `https://news.gamebase.com.tw/news/newslist?type=mobile`，請截取 `https://news.gamebase.com.tw/news/` 到末尾的部分 `newslist` 作為 `type` 參數填入，`mobile` 作為 `category` 參數填入，此時目標路由為 [`/gamebase/news/newslist/mobile`](https://rsshub.app/gamebase/news/newslist/mobile)。\n:::\n\n| newslist | r18list |\n| -------- | ------- |\n",categories:[`game`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`news.gamebase.com.tw/news`,`news.gamebase.com.tw/news/:type`],target:(e,t)=>{let n=e.type,r=new URL(t).searchParams.get(`type`)??void 0;return`/gamebase/news${n?`/${n}${r?`/${r}`:``}`:``}`}}],view:s.Articles,zh:{path:`/news/:type?/:category?`,name:`新闻`,url:`news.gamebase.com.tw`,maintainers:[`nczitzk`],handler:f,example:`/gamebase/news`,parameters:{type:`类型，见下表，默认为 newslist`,category:"分类，默认为 `all`，即全部，可在对应分类页 URL 中找到"},description:"::: tip\n若订阅 [手机游戏新闻](https://news.gamebase.com.tw/news/newslist?type=mobile)，网址为 `https://news.gamebase.com.tw/news/newslist?type=mobile`，请截取 `https://news.gamebase.com.tw/news/` 到末尾的部分 `newslist` 作为 `type` 参数填入，`mobile` 作为 `category` 参数填入，此时目标路由为 [`/gamebase/news/newslist/mobile`](https://rsshub.app/gamebase/news/newslist/mobile)。\n:::\n\n| newslist | r18list |\n| -------- | ------- |\n"}};export{f as handler,p as route};