import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-CgQXMNWI.js";import"./timezone-BPfwRbwD.js";import{i as o,n as s,r as c,t as l}from"./util-DcUBnYMT.js";import u from"node:path";import{load as d}from"cheerio";e();const f={path:`/news/:category{.+}?`,categories:[`university`],example:`/whu/news`,parameters:{category:`新闻栏目，可选`},name:`新闻网`,maintainers:[],handler:m,description:"\ncategory 参数可选，范围如下:\n\n| 新闻栏目 | 武大资讯 | 学术动态 | 珞珈影像 | 武大视频 |\n| -------- | -------- | -------- | -------- | -------- |\n| 参数     |  0 或 `wdzx/wdyw`  | 1 或 `kydt` | 2 或 `stkj/ljyx` | 3 或 `stkj/wdsp` |\n\n此外 route 后可以加上 `?limit=n` 的查询参数，表示只获取前 n 条新闻；如果不指定默认为 10。\n"},p=e=>{let t=[`wdzx/wdyw`,`kydt`,`stkj/ljyx`,`stkj/wdsp`];return[`0`,`1`,`2`,`3`].includes(e)?t[e]:t.includes(e)?e:`wdzx/wdyw`};async function m(e){let{category:f}=e.req.param(),m=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):10;f=p(f);let h=`https://news.${l}`,g=new URL(`${f}.htm`,h).href,{data:_}=await a(g),v=d(_),y=v(`ul.wdzxList li a[title], ul.xsdtList li a, div.topPic a[title], ul.nypicList li a[title], div.topVid a[title], ul.nyvidList li a[title]`).slice(0,m).toArray().map(e=>{e=v(e);let n=e.find(`div.img img`);return{title:e.prop(`title`)??e.find(`h4.eclips`).text(),link:new URL(e.prop(`href`),h).href,pubDate:i(e.find(`time`).text(),[`YYYY.MM.DD`,`DDYYYY.MM`]),description:r(u.join(t,`templates/description-9e3ccd8d.art`),{description:e.find(`div.txt p`).html(),image:n.prop(`src`)?{src:new URL(n.prop(`src`),h).href,alt:n.prop(`alt`)}:void 0})}});y=await c(y,n.tryGet,h);let b=o(_),x=s(b,`SiteName`),S=s(b,`ColumnName`),C=new URL(v(`link[rel="shortcut icon"]`).prop(`href`),h).href;return{item:y,title:`${x} - ${S}`,link:g,description:s(b,`description`),language:v(`html`).prop(`lang`),image:new URL(v(`div.logo img`).prop(`src`),h).href,icon:C,logo:C,subtitle:S,author:x,allowEmpty:!0}}export{f as route};