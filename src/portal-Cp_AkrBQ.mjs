import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import"./ofetch-BRplXtiZ.mjs";import"./config-D7dgKYF5.mjs";import"./logger-CkUWGGaS.mjs";import{t as n}from"./cache-Bv3_kFbE.mjs";import"./helpers-Tm7Pw8Vq.mjs";import{t as r}from"./parse-date-_GmTZfjS.mjs";import{t as i}from"./render-CSqLtqb8.mjs";import{t as a}from"./got-BglkE51W.mjs";import{t as o}from"./timezone-BAp4uBjD.mjs";import s from"node:path";import{load as c}from"cheerio";e();const l=`https://weixin.shmtu.edu.cn/dynamic/shmtuHttps`,u=`https://portal.shmtu.edu.cn/api`,d=async e=>{let t=await a.post(l,{form:{interfaceUrl:e},https:{rejectUnauthorized:!1}});return JSON.parse(t.data)},f=(e,n)=>Promise.all(e.map(e=>n.tryGet(e.link,async()=>{let n=await d(e.link),r=n.field_file,a=n.field_image;return e.description=i(s.join(t,`templates/portal-9c9e2508.art`),{body:n.body.und[0].safe_value,images:a.length!==0&&Object.keys(a).length!==0?a.und:null,files:r.length!==0&&Object.keys(r).length!==0?r.und:null}),e.link=n.path,e}))),p={path:`/portal/:type`,categories:[`university`],example:`/shmtu/portal/bmtzgg`,parameters:{type:`类型名称`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`portal.shmtu.edu.cn/:type`]}],name:`数字平台`,maintainers:[`imbytecat`],handler:m,description:`| 部门通知公告 | 学术与大型活动公告 | 部门动态 |
| ------------ | ------------------ | -------- |
| bmtzgg       | xsydxhdgg          | bmdt     |`};async function m(e){let t=e.req.param(`type`),i;switch(t){case`bmtzgg`:i=`部门通知公告`;break;case`xsydxhdgg`:i=`学术与大型活动公告`;break;case`bmdt`:i=`部门动态`;break;default:i=`未知`;break}let s=await a.post(l,{form:{interfaceUrl:`${u}/${t}.json?page=0`},https:{rejectUnauthorized:!1}}),d=await f(JSON.parse(s.data).map(e=>({title:c(e.title).text(),link:`${u}/node/${e.nid}.json`,pubDate:o(r(e.created),8),category:e.field_department[0],author:e.field_department[0]})),n);return{title:`上海海事大学 ${i}`,link:`https://portal.shmtu.edu.cn/bumentongzhigonggao`,description:`上海海事大学 数字平台`,item:d}}export{p as route};