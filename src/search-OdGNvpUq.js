import{n as e,t}from"./esm-shims-CMsyBHYK.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-CRUPiVpr.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import"./md5-CWsm3r0H.js";import"./got-BlqYKpVp.js";import"./config-not-found-CX6cWM57.js";import{a,i as o,n as s,o as c,r as l}from"./utils-BPM4Nady.js";import u from"node:path";e();const d={path:`/search/:option?/:category?/:keyword?/:time?/:order?`,categories:[`anime`],example:`/18comic/search/photos/all/NTR`,parameters:{option:"选项，可选 `video` 和 `photos`，默认为 `photos`",category:"分类，同上表，默认为 `all` 即全部",keyword:`关键字，同上表，默认为空`,time:"时间范围，同上表，默认为 `a` 即全部",order:"排列顺序，同上表，默认为 `mr` 即最新"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},radar:[{source:[`jmcomic.group/`],target:`/:category?/:time?/:order?/:keyword?`}],name:`搜索`,maintainers:[],handler:f,url:`jmcomic.group/`,description:`::: tip
  关键字必须超过两个字，这是来自网站的限制。
:::`};async function f(e){let d=e.req.param(`option`)??`photos`,f=e.req.param(`category`)??`all`,p=e.req.param(`keyword`)??``,m=e.req.param(`time`)??`a`,{domain:h=l}=e.req.query(),g=a(h),_=e.req.param(`order`)??`mr`,v=`${g}/search/${d}${f===`all`?``:`/${f}`}${p?`?search_query=${p}`:`?`}${m===`a`?``:`&t=${m}`}${_===`mr`?``:`&o=${_}`}`,y=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):20,b=o();_=m===`a`?_:`${_}_${m}`,b=`${b}/search?search_query=${p}&o=${_}`;let x=await c(b),S=x.content;f!==`all`&&(S=x.content.filter(e=>e.category.title===s(f))),S=S.slice(0,y);let C=await Promise.all(S.map(e=>n.tryGet(`18comic:search:${e.id}`,async()=>{let n={};return n.title=e.name,n.link=`${g}/album/${e.id}`,n.guid=`18comic:/album/${e.id}`,n.updated=i(e.update_at),b=`${o()}/album?id=${e.id}`,x=await c(b),n.pubDate=new Date(x.addtime*1e3),n.category=x.tags.map(e=>e),n.author=x.author.map(e=>e).join(`, `),n.description=r(u.join(t,`templates/description-afe7e434.art`),{introduction:x.description,images:[`https://cdn-msp3.${h}/media/albums/${e.id}_3x4.jpg`],cover:`https://cdn-msp3.${h}/media/albums/${e.id}_3x4.jpg`,category:n.category}),n})));return{title:`Search Results For '${p}' - 禁漫天堂`,link:v.replace(/\?$/,``),item:C,allowEmpty:!0}}export{d as route};