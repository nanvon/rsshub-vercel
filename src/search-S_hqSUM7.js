import{__dirname as e,init_esm_shims as t}from"./esm-shims-2LyWUseo.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-BLnIkXRv.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import"./md5-15Cn4YyR.js";import"./got-DPq_2TLS.js";import"./config-not-found-mNOcOzCd.js";import{apiMapCategory as a,defaultDomain as o,getApiUrl as s,getRootUrl as c,processApiItems as l}from"./utils-CbQOVm5M.js";import u from"node:path";t();const d={path:`/search/:option?/:category?/:keyword?/:time?/:order?`,categories:[`anime`],example:`/18comic/search/photos/all/NTR`,parameters:{option:"选项，可选 `video` 和 `photos`，默认为 `photos`",category:"分类，同上表，默认为 `all` 即全部",keyword:`关键字，同上表，默认为空`,time:"时间范围，同上表，默认为 `a` 即全部",order:"排列顺序，同上表，默认为 `mr` 即最新"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`jmcomic.group/`],target:`/:category?/:time?/:order?/:keyword?`}],name:`搜索`,maintainers:[],handler:f,url:`jmcomic.group/`,description:`::: tip
  关键字必须超过两个字，这是来自网站的限制。
:::`};async function f(t){let d=t.req.param(`option`)??`photos`,f=t.req.param(`category`)??`all`,p=t.req.param(`keyword`)??``,m=t.req.param(`time`)??`a`,{domain:h=o}=t.req.query(),g=c(h),_=t.req.param(`order`)??`mr`,v=`${g}/search/${d}${f===`all`?``:`/${f}`}${p?`?search_query=${p}`:`?`}${m===`a`?``:`&t=${m}`}${_===`mr`?``:`&o=${_}`}`,y=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,b=s();_=m===`a`?_:`${_}_${m}`,b=`${b}/search?search_query=${p}&o=${_}`;let x=await l(b),S=x.content;f!==`all`&&(S=x.content.filter(e=>e.category.title===a(f))),S=S.slice(0,y);let C=await Promise.all(S.map(t=>n.tryGet(`18comic:search:${t.id}`,async()=>{let n={};return n.title=t.name,n.link=`${g}/album/${t.id}`,n.guid=`18comic:/album/${t.id}`,n.updated=i(t.update_at),b=`${s()}/album?id=${t.id}`,x=await l(b),n.pubDate=new Date(x.addtime*1e3),n.category=x.tags.map(e=>e),n.author=x.author.map(e=>e).join(`, `),n.description=r(u.join(e,`templates/description-afe7e434.art`),{introduction:x.description,images:[`https://cdn-msp3.${h}/media/albums/${t.id}_3x4.jpg`],cover:`https://cdn-msp3.${h}/media/albums/${t.id}_3x4.jpg`,category:n.category}),n})));return{title:`Search Results For '${p}' - 禁漫天堂`,link:v.replace(/\?$/,``),item:C,allowEmpty:!0}}export{d as route};