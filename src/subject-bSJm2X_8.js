import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-BASlBuka.js";import{t as r}from"./render-d6AVTUl2.js";import{n as i,t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./invalid-parameter-CLGd_tte.js";import{n as s}from"./readable-social-D1ub39Fn.js";import c from"node:path";import{load as l}from"cheerio";var u=async(e,t)=>{let r=`https://bgm.tv/subject/${e}/comments`,o=l(await n(r)),s=o(`.nameSingle`).find(`a`).text(),c=o(`.item`).toArray().map(e=>{let t=o(e),n=t.find(`.starlight`),r=null;n.length>0&&(r=n.attr(`class`).match(/stars(\d)/)[1]);let s=t.find(`small.grey`).text().slice(2),c=s.includes(`ago`)?i(s):a(s);return{user:t.find(`.l`).text(),rate:r||`无`,content:t.find(`p`).text(),date:c}}).filter(e=>e.content.length>=t);return{title:`${s}的 Bangumi 吐槽箱`,link:r,item:c.map(e=>({title:`${e.user}的吐槽`,description:`【评分：${e.rate}】  ${e.content}`,guid:`${r}#${e.user}`,pubDate:e.date,link:r}))}};const d=(e,t)=>t?e.name||e.name_cn:e.name_cn||e.name;var f=e=>{let t={blog:{en:`reviews`,cn:`评论`},topic:{en:`board`,cn:`讨论`}};return async(r,i)=>{let o=await n(`https://api.bgm.tv/subject/${r}?responseGroup=large`);return{title:`${d(o,i)}的 Bangumi ${t[e].cn}`,link:`https://bgm.tv/subject/${o.id}/${t[e].en}`,item:o[e].map(e=>({title:`${e.user.nickname}：${e.title}`,description:e.summary||``,link:e.url.replace(`http:`,`https:`),pubDate:a(e.timestamp,`X`),author:e.user.nickname}))}}};e();var p=async(e,i)=>{let o=await n(`https://api.bgm.tv/subject/${e}?responseGroup=large`),s=o.eps.filter(e=>e.status===`Air`);return{title:d(o,i),link:`https://bgm.tv/subject/${e}`,description:o.summary,item:s.map(e=>({title:`ep.${e.sort} ${d(e,i)}`,description:r(c.join(t,`templates/ep-e0bc570f.art`),{e,epsInfo:o}),pubDate:a(e.airdate),link:e.url.replace(`http:`,`https:`)}))}};const m={path:`/subject/:id/:type?/:showOriginalName?`,categories:[`anime`],example:`/bangumi.tv/subject/328609/ep/true`,parameters:{id:`条目 id, 在条目页面的地址栏查看`,type:"条目类型，可选值为 `ep`, `comments`, `blogs`, `topics`，默认为 `ep`",showOriginalName:`显示番剧标题原名，可选值 0/1/false/true，默认为 false`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/subject/:id`],target:`/tv/subject/:id`}],name:`条目的通用路由格式`,maintainers:[`JimenezLi`],handler:h,description:`::: warning
  此通用路由仅用于对路由参数的描述，具体信息请查看下方与条目相关的路由
:::`};async function h(e){let t=e.req.param(`id`),n=e.req.param(`type`)||`ep`,r=s(e.req.param(`showOriginalName`)),i;switch(n){case`ep`:i=await p(t,r);break;case`comments`:i=await u(t,Number(e.req.query(`minLength`))||0);break;case`blogs`:i=await f(`blog`)(t,r);break;case`topics`:i=await f(`topic`)(t,r);break;default:throw new o(`暂不支持对${n}的订阅`)}return i}export{m as route};