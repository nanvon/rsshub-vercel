import{__dirname as e,init_esm_shims as t}from"./esm-shims-2LyWUseo.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-BLnIkXRv.js";import"./helpers-gUVC02jt.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-CSnicFA3.js";import{got_default as i}from"./got-DPq_2TLS.js";import a from"node:path";import{load as o}from"cheerio";t();const s=({subtitle:t,quotation:n,pics:i,article:o})=>r(a.join(e,`templates/description-3b70807f.art`),{subtitle:t,quotation:n,pics:i,article:o}),c=async e=>{let t=await i({method:`get`,url:e}),n=o(t.data);return{pageLength:n(`.right1 .bmname`).children().length,$:n}},l=(e,t)=>{let n=e(`.zi .zi-top .banci strong`).text();return e(`.zi-meat ul>li`).toArray().map(r=>{let i=e(r).find(`a`).attr(`href`),a=e(r).find(`a div`).text();return{link:`${t}/${i}`,title:`[${n}] ${a}`}})},u=(e,t=1)=>async()=>{let n=`${e}/node_${t+1}.htm`,r=await i({method:`get`,url:n}),a=o(r.data);return l(a,e)},d=async(e,t)=>await Promise.all(e.map(e=>t.tryGet(e.link,async()=>{let{data:t}=await i(e.link),n=o(t),r=n(`.right-meat .yinti`).text(),a=n(`.right-meat .futi`).text(),c=n(`.right-meat .tuwen .article #ozoom`).html(),l=n(`.right-meat .tuwen .picture`).toArray().map(e=>{let t={};return n(e).find(`tr`).toArray().map(e=>{let r=n(e).find(`img`).attr(`src`);return r?t.src=r:t.des=n(e).find(`td`).text(),null}),t});return e.author=n(`.right-meat .author`).text(),e.description=s({subtitle:a,quotation:r,article:c,pics:l}),e}))),f={path:`/digitalpaper`,categories:[`traditional-media`],example:`/stdaily/digitalpaper`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`科技日报`,maintainers:[`lyqluis`],handler:p};async function p(){let e=`http://digitalpaper.stdaily.com/http_www.kjrb.com/kjrb/html/${new Date().toLocaleDateString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`}).replace(`/`,`-`)}`,t=[],r=[],{pageLength:i,$:a}=await c(`${e}/node_2.htm`);r.push(...l(a,e));for(let n=2;n<=i;n++)t.push(u(e,n));return r.push(...(await Promise.all(t.map(e=>e()))).flat()),{title:`科技日报`,link:`http://digitalpaper.stdaily.com`,item:await d(r,n)}}export{f as route};