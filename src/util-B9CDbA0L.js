import{n as e,t}from"./esm-shims-mGm6WwCc.js";import{t as n}from"./ofetch-BASlBuka.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import o from"node:path";import{load as s}from"cheerio";e();const c=`https://www.tmtpost.com`,l=`https://api.tmtpost.com`,u=new URL(`v1/posts/`,l).href,d={"app-version":`web1.0`},f=async(e,l,f,p)=>{let m=await n(f,{query:{limit:e,...l},headers:d}),h=s(await n(p)),g=h(`html`).attr(`lang`)??`zh-CN`,_=[];_=m.data.slice(0,e).map(e=>{let n=e.title,r=i(o.join(t,`templates/description-ca64252b.art`),{intro:e.summary}),s=e.time_published,c=e.share_link,l=e.guid,u=e.thumb_image?.original?.url,d=e.updated??s;return{title:n,description:r,pubDate:s?a(s,`X`):void 0,link:c,guid:l,id:l,content:{html:r,text:e.content??r},image:u,banner:u,updated:d?a(d,`X`):void 0,language:g}}),_=(await Promise.all(_.map(e=>e.link?r.tryGet(e.link,async()=>{let r=new URL(e.guid,u).href,s=(await n(r,{query:{fields:[`authors`,`tags`,`featured_image`,`categories`,`stock_list`,`big_plate`,`concept_plate`,`plate`,`plate_list`,`share_link`].join(`;`)},headers:d})).data;if(!s)return e;let l=s.title,f=i(o.join(t,`templates/description-ca64252b.art`),{intro:s.summary,description:s.main}),p=s.time_published,m=s.share_link,h=[...new Set([...s.categories??[],...s.stock_list??[],...s.big_plate??[],...s.concept_plate??[],...s.plate??[],...s.plate_list??[],...s.tags??[]].map(e=>e.title??e.name??e.tag).filter(Boolean))],_=s.authors?.map(e=>({name:e.username,url:new URL(`user/${e.guid}`,c).href,avatar:e.avatar})),v=`tmtpost-${s.post_guid}`,y=s.images?.[0]?.url,b=s.time_updated,x={title:l,description:f,pubDate:p?a(p,`X`):void 0,link:m??e.link,category:h,author:_,guid:v,id:v,content:{html:f,text:f},image:y,banner:y,updated:b?a(b,`X`):void 0,language:g},S=s.audio;if(S){let e=`audio/${S.split(/\./).pop()}`,t=s.duration;x={...x,enclosure_url:S,enclosure_type:e,enclosure_title:l,enclosure_length:void 0,itunes_duration:t,itunes_item_image:y}}let C={};if(s.full_size_images??s.images){let e=s.full_size_images??s.images;for(let t of e){let e=t.url??t;if(!e)continue;let n=`image`,r=`${n}${Object.values(C).filter(e=>e.medium===n).length+1}`;C[r]={url:e,medium:n,title:l,thumbnail:t.thumbnail??e}}}return x={...x,media:C},{...e,...x}}):e))).filter(e=>!0);let v=h(`title`).text(),y=v.split(/-/).pop();return{title:v,description:h(`meta[property="og:description"]`).attr(`content`),link:p,item:_,allowEmpty:!0,image:h(`meta[property="og:image"]`).attr(`content`),author:v.split(/-/).pop(),language:g,itunes_author:y,itunes_category:`Technology`,id:p}};export{c as n,f as r,l as t};