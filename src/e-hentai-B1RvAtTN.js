import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-CgQXMNWI.js";import o from"node:path";import{load as s}from"cheerio";e();const c={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],features:{nsfw:!0},handler:l};async function l(e){let c=e.req.param(`id`)??``,l=e.req.param(`what`)??``,u=/t|y/i.test(e.req.param(`needTorrents`)??`true`),d=/t|y/i.test(e.req.param(`needImages`)??`true`),f=`https://e-hentai.org/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,p=s((await a({method:`get`,url:f})).data);p(`.itd`).parent().remove();let m=p(`table.gltc tbody tr`).slice(1,e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=p(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:i(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>p(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return m=await Promise.all(m.map(async e=>{if(e.enclosure_url){let t=``,r=await n.get(e.enclosure_url);if(!r){let i=s((await a({method:`get`,url:e.enclosure_url})).data);i(`h1, input[name="torrent_info"]`).remove(),t=i(`form`).parent().html(),r=i(`table tbody tr td a`).toArray().map(e=>(e=i(e),{link:e.attr(`href`),title:e.text()})),n.set(e.enclosure_url,r)}e.description+=t,e.enclosure_url=r[0].link,e.enclosure_type=`application/x-bittorrent`}if(d){let i=await n.get(e.link);if(!i){let t=s((await a({method:`get`,url:e.link})).data);i=await Promise.all(t(`.gdtm a`).toArray().map(e=>n.tryGet(t(e).attr(`href`),async()=>s((await a({method:`get`,url:t(e).attr(`href`)})).data)(`#img`).attr(`src`)))),n.set(e.link,i)}e.description+=r(o.join(t,`templates/images-c6c5dab2.art`),{images:i})}return e})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:f,item:m}}export{c as route};