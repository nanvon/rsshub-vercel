import{__dirname as e,init_esm_shims as t}from"./esm-shims-BFmOnnpb.js";import{ofetch_default as n}from"./ofetch-am9EnuPq.js";import{cache_default as r}from"./cache-Dfid4xgQ.js";import{art as i}from"./render-CSnicFA3.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import o from"node:path";import{load as s}from"cheerio";t();const c=async t=>{let{category:c=``}=t.req.param(),l=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,u=`https://www.jiemian.com`,d=new URL(c?`${c}.html`:``,u).href,f=await n(d),p=s(f),m={},h=p(`a`).toArray();for(let e of h){let t=p(e),n=t.prop(`href`),r=n?n.startsWith(`/`)?new URL(n,u).href:n:void 0;r&&/\/(article|video)\/\w+\.html/.test(r)&&(m[r]={title:t.text(),link:r})}m=await Promise.all(Object.values(m).slice(0,l).map(t=>r.tryGet(t.link,async()=>{let r=await n(t.link),c=s(r),l=c(`div.article-img img`).first(),u=c(`#video-player`).first();return t.title=c(`div.article-header h1`).eq(0).text(),t.description=i(o.join(e,`templates/description-55895928.art`),{image:l?{src:l.prop(`src`),alt:l.next(`p`).text()||t.title}:void 0,video:u?{src:u.prop(`data-url`),poster:u.prop(`data-poster`),width:u.prop(`width`),height:u.prop(`height`)}:void 0,intro:c(`div.article-header p`).text(),description:c(`div.article-content`).html()}),t.author=c(`span.author`).first().find(`a`).toArray().map(e=>c(e).text()).join(`/`),t.category=c(`meta.meta-container a`).toArray().map(e=>c(e).text()),t.pubDate=a(c(`div.article-info span[data-article-publish-time]`).prop(`data-article-publish-time`),`X`),t.upvotes=c(`span.opt-praise__count`).text()?Number.parseInt(c(`span.opt-praise__count`).text(),10):0,t.comments=c(`span.opt-comment__count`).text()?Number.parseInt(c(`span.opt-comment__count`).text(),10):0,t})));let g=p(`title`).text(),_=g.split(/_/),v=p(`div.logo img`).prop(`src`),y=new URL(p(`link[rel="icon"]`).prop(`href`),u).href;return{item:m,title:g,link:d,description:p(`meta[name="description"]`).prop(`content`),language:p(`html`).prop(`lang`),image:v,icon:y,logo:y,subtitle:_[0],author:_.pop()}};export{c as handler};