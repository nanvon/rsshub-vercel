import{__dirname as e,init_esm_shims as t}from"./esm-shims-DE2PJqdr.js";import{config as n}from"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import{ofetch_default as r}from"./ofetch-CJF2SF6b.js";import{cache_default as i}from"./cache-Dfid4xgQ.js";import{art as a}from"./render-CSnicFA3.js";import{parseDate as o}from"./parse-date-DHsdom8D.js";import s from"node:path";import{load as c}from"cheerio";import l from"p-map";t();const u={path:`/comic/:id/:chapterCnt?`,categories:[`anime`],example:`/copymanga/comic/dianjuren/5`,parameters:{id:`漫画ID`,chapterCnt:"返回章节的数量，默认为 `10`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`漫画更新`,maintainers:[`btdwv`,`marvolo666`],handler:d};async function d(t){let u=t.req.param(`id`),d=Number(t.req.param(`chapterCnt`)||10),f=`www.mangacopy.com`,p=`https://${f}`,m=`https://${f}`,h=`${m}/api/v3/comic/${u}/group/default/chapters`,g=await i.tryGet(h,async()=>{let e=!1,t=[],n=0;do{e=!1;let{code:i,results:a}=await r(h,{headers:{platform:``},query:{limit:500,offset:n}});if(i!==200)break;a.limit+a.offset<a.total&&(e=!0),n+=500,t=[...t,...a.list]}while(e);return t=t.map(({comic_path_word:e,uuid:t,name:n,size:r,datetime_created:i,ordered:a})=>({link:`${p}/comic/${e}/chapter/${t}`,guid:`https://copymanga.site/comic/${e}/chapter/${t}`,uuid:t,title:n,size:r,pubDate:o(i,`YYYY-MM-DD`),ordered:a})).toSorted((e,t)=>t.ordered-e.ordered),t},n.cache.routeExpire,!1),{bookTitle:_,bookIntro:v}=await i.tryGet(`${p}/comic/${u}`,async()=>{let e=await r(`${p}/comic/${u}`),t=c(e);return{bookTitle:t(`.comicParticulars-title-right > ul > li > h6`).text(),bookIntro:t(`.intro`).text()}}),y=async t=>{let{code:n,results:i}=await r(`${m}/api/v3/comic/${u}/chapter/${t.uuid}`,{headers:{webp:`1`}}),o=n===210?[]:i.chapter.contents.map(e=>({url:e.url.replace(`.c800x.`,`.c1500x.`)}));return{link:t.link,guid:t.guid,title:t.title,description:a(s.join(e,`templates/comic-da154ac8.art`),{size:t.size,contents:o}),pubDate:t.pubDate}},b=[...await l(g.slice(0,d),e=>i.tryGet(e.link,()=>y(e)),{concurrency:3}),...g.slice(d)];return{title:`拷贝漫画 - ${_}`,link:`${p}/comic/${u}`,description:v,item:b}}export{u as route};