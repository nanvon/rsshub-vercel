import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as e}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as t}from"./got-CB83B8oA.js";import{fetchArticle as n}from"./wechat-mp-BhyqE9dN.js";import{load as r}from"cheerio";const i=`https://swrh.whu.edu.cn`,a={path:`/swrh/:type`,categories:[`university`],example:`/whu/swrh/2`,radar:[{source:[`swrh.whu.edu.cn/:type`],target:`/swrh/:type`}],parameters:{type:`公告类型，详见表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`水利水电学院公告`,maintainers:[`FanofZY`],handler:o,description:`| 公告类型 | 学院新闻 | 学术科研 | 通知公告 |
| -------- | -------- | -------- | -------- |
| 参数     | 0        | 1        | 2        |`};async function o(a){let o=Number.parseInt(a.req.param(`type`)),s;switch(o){case 0:s=`${i}/index/xyxw.htm`;break;case 1:s=`${i}/index/xsky.htm`;break;case 2:s=`${i}/xxgk/tzgg.htm`;break;default:throw Error(`Unknown type: ${o}`)}let c=await t(s),l=r(c.data),u=o===0?l(`div.my_box_nei`).toArray().map(e=>(e=l(e),{title:e.find(`a b.am-text-truncate`).text().trim(),pubDate:e.find(`a i`).text().trim(),link:new URL(e.find(`a`).attr(`href`),i).href})):l(`div.list_txt.am-fr ul.am-list li`).toArray().map(e=>(e=l(e),{title:e.find(`a span`).text().trim(),pubDate:e.find(`a i`).text().trim(),link:new URL(e.find(`a`).attr(`href`),i).href})),d=await Promise.all(u.map(i=>e.tryGet(i.link,async()=>(i.description=i.link.includes(`weixin`)?await n(i.link).then(e=>e.description):await(async()=>{try{let e=await t(i.link),n=r(e.data);return n(`.v_news_content`).length?n(`.v_news_content`).html().trim():n(`.prompt`).length?n(`.prompt`).html():i.title}catch{return i.title}})(),i))));return d=d.filter(e=>e!==null),{title:l(`title`).first().text(),link:s,item:d}}export{a as route};