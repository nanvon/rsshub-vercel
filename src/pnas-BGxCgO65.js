import{n as e,t}from"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import{t as n}from"./logger-asV68Lay.js";import"./proxy-CczVputb.js";import"./ofetch-VsB2Peor.js";import"./helpers-Cqaav28H.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import{t as o}from"./got-BVCqvF6m.js";import{n as s}from"./puppeteer-e0F06Yyi.js";import{n as c}from"./puppeteer-utils-FrZTcQtT.js";import l from"node:path";import{load as u}from"cheerio";import{CookieJar as d}from"tough-cookie";e();const f={path:`/:topicPath{.+}?`,radar:[{source:[`pnas.org/*topicPath`],target:`/:topicPath`}],name:`Unknown`,maintainers:[],handler:p,url:`pnas.org/*topicPath`};async function p(e){let f=`https://www.pnas.org`,p=`${f}/${e.req.param(`topicPath`)??`latest`}`,m=await r.get(`pnas:cookieJar`),h=!m;m=h?new d:d.fromJSON(m);let{data:g}=await o(p,{cookieJar:m});h&&await r.set(`pnas:cookieJar`,m.toJSON());let _=u(g),v=_(`.card--row-reversed .card-content`).toArray().map(e=>{e=_(e);let t=e.find(`.article-title a`);return{title:t.text(),link:new URL(t.attr(`href`),f).href,pubDate:a(e.find(`.card__meta__date`).text())}}),y=await s(),b=await Promise.all(v.map(e=>r.tryGet(e.link,async()=>{let r=await y.newPage();await c(r,await m.getCookieString(e.link),`.pnas.org`),await r.setRequestInterception(!0),r.on(`request`,e=>{e.resourceType()===`document`?e.continue():e.abort()}),n.http(`Requesting ${e.link}`),await r.goto(e.link,{waitUntil:`domcontentloaded`,referer:p}),await r.waitForSelector(`.core-container`);let a=await r.evaluate(()=>document.documentElement.innerHTML);await r.close();let o=u(a),s=JSON.parse(o(`script`).text().match(/PNASdataLayer =(.*?);/)[1]);o(`.signup-alert-ad, .citations-truncation button`).remove();let{keywords:d,topic:f}=s.page.attributes;return e.category=[...d,f],e.author=s.page.pageInfo.author,e.doi=s.page.pageInfo.DOI,e.description=i(l.join(t,`templates/article-8214e5db.art`),{access:s.user.access===`yes`,abstracts:o(`#abstracts .core-container`).html(),articleBody:o(`[property=articleBody]`).html(),dataAvailability:o(`#data-availability`).html(),acknowledgments:o(`#acknowledgments`).html(),supplementaryMaterials:o(`#supplementary-materials`).html(),bibliography:o(`#bibliography`).html()}),e})));return await y.close(),{title:`${_(`.banner-widget__content h1`).text()} - PNAS`,description:_(`.banner-widget__content p`).text(),image:`https://www.pnas.org/favicon.ico`,language:`en-US`,link:p,item:b}}export{f as route};