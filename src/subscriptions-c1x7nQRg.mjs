import{n as e,t}from"./esm-shims-BKVRry6h.mjs";import{t as n}from"./ofetch-BRplXtiZ.mjs";import{t as r}from"./config-D7dgKYF5.mjs";import"./logger-CkUWGGaS.mjs";import{t as i}from"./cache-Bv3_kFbE.mjs";import{t as a}from"./parse-date-_GmTZfjS.mjs";import{t as o}from"./render-CSqLtqb8.mjs";import{t as s}from"./config-not-found-DGyG6Tbz.mjs";import c from"node:path";import l from"markdown-it";e();const u=l({html:!0}),d={path:`/subscriptions`,categories:[`anime`],example:`/iwara/subscriptions`,parameters:{},features:{requireConfig:[{name:`IWARA_USERNAME`,description:``},{name:`IWARA_PASSWORD`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,nsfw:!0},radar:[{source:[`www.iwara.tv/subscriptions/videos`,`www.iwara.tv/subscriptions/images`]}],name:`User Subscriptions`,maintainers:[`FeCCC`],handler:f,url:`www.iwara.tv/`,description:`::: warning
  This route requires username and password, therefore it's only available when self-hosting, refer to the [Deploy Guide](https://docs.rsshub.app/deploy/config#route-specific-configurations) for route-specific configurations.
:::`};async function f(){if(!r.iwara||!r.iwara.username||!r.iwara.password)throw new s(`Iwara subscription RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let e=`https://www.iwara.tv`,l=r.iwara.username,d=r.iwara.password,f=await i.tryGet(`iwara:token`,async()=>({authorization:`Bearer `+(await n(`https://api.iwara.tv/user/login`,{method:`post`,headers:{referer:`https://www.iwara.tv/`,"user-agent":r.trueUA},body:{email:l,password:d}})).token}),720*60*60,!1),p=await i.tryGet(`iwara:authToken`,async()=>({authorization:`Bearer `+(await n(`https://api.iwara.tv/user/token`,{method:`post`,headers:{...f,referer:`https://www.iwara.tv/`,"user-agent":r.trueUA}})).accessToken}),3600,!1),m=await n(`https://api.iwara.tv/videos?rating=all&page=0&limit=24&subscribed=true`,{headers:p}),h=await n(`https://api.iwara.tv/images?rating=all&page=0&limit=24&subscribed=true`,{headers:{...p,"user-agent":r.trueUA}}),g=m.results.map(t=>{let n=t.file?`https://i.iwara.tv/image/original/${t.file.id}/thumbnail-${t.thumbnail.toString().padStart(2,`0`)}.jpg`:``;return{title:t.title,author:t.user.name,link:`${e}/video/${t.id}`,category:[`Video`,...t.tags?t.tags.map(e=>e.id):[]],imageUrl:n,pubDate:a(t.createdAt),private:t.private}}),_=h.results.map(t=>{let n=t.thumbnail?`https://i.iwara.tv/image/original/${t.thumbnail.id}/${t.thumbnail.name}`:``;return{title:t.title,author:t.user.name,link:`${e}/image/${t.id}`,category:[`Image`,...t.tags?t.tags.map(e=>e.id):[]],imageUrl:n,pubDate:a(t.createdAt)}}),v=[...g,..._];return{title:`Iwara Subscription`,link:e,item:await Promise.all(v.map(e=>i.tryGet(e.link,async()=>{let i=o(c.join(t,`templates/subscriptions-a44731e7.art`),{images:[e.imageUrl]});if(e.private===!0)return i+=`private`,{title:e.title,author:e.author,link:e.link,category:e.category,pubDate:e.pubDate,description:i};let a=await n(e.link.replace(`www.iwara.tv`,`api.iwara.tv`),{headers:{...p,"user-agent":r.trueUA}});i=o(c.join(t,`templates/subscriptions-a44731e7.art`),{images:a.files?a.files.filter(e=>e.type===`image`)?.map(e=>`https://i.iwara.tv/image/original/${e.id}/${e.name}`):[e.imageUrl]});let s=a.body?u.render(a.body):``;return i+=s,{title:e.title,author:e.author,link:e.link,category:e.category,pubDate:e.pubDate,description:i}})))}}export{d as route};