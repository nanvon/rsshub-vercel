import{n as e,t}from"./esm-shims-L08rKynx.mjs";import{t as n}from"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import"./ofetch-BMqiDsx_.mjs";import"./helpers-mo8InLYm.mjs";import{t as r}from"./cache-ZTWfXd2T.mjs";import{t as i}from"./render-CBhnapAf.mjs";import{t as a}from"./parse-date-bKmkZ9gg.mjs";import{t as o}from"./got-2jXbf1Li.mjs";import{t as s}from"./timezone-CE0MDOJ-.mjs";import c from"node:path";import{FetchError as l}from"ofetch";import{load as u}from"cheerio";e();const d=`3d5_f6A(S$G_FD=2S(Dr6%7BW_h37@rE`,f={path:`/:category?`,categories:[`traditional-media`],example:`/lorientlejour/977-lebanon`,parameters:{category:`Category from the last segment of the URL of the corresponding site, see below for more information, /977-Lebanon by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,requireConfig:[{name:`LORIENTLEJOUR_USERNAME`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Email or Username`},{name:`LORIENTLEJOUR_PASSWORD`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Password`},{name:`LORIENTLEJOUR_TOKEN`,optional:!0,description:`To obtain a token, log into L'Orient-Le Jour/L'Orient Today App and inspect the connection request to find the token parameter from the request URL`}]},name:`Category`,maintainers:[`quiniapiezoelectricity`],handler:m,description:`  ::: tip
For example, the path for the sites https://today.lorientlejour.com/section/977-lebanon and https://www.lorientlejour.com/rubrique/1-liban would be /lorientlejour/977-lebanon and /lorientlejour/1-liban respectively.
Multiple categories seperated by '|' is also supported, e.g. /lorientlejour/977-lebanon|1-liban.
:::`,radar:[{source:[`www.lorientlejour.com/*/:category`],target:`/:category`},{source:[`www.lorientlejour.com`],target:`/1-Liban`},{source:[`today.lorientlejour.com/*/:category`],target:`/:category`},{source:[`today.lorientlejour.com`],target:`/977-Lebanon`}]};async function p(e){let t=`https://www.lorientlejour.com/cmsapi/categories.php?key=${d}&action=view&categoryId=${e}`;return(await r.tryGet(t,async()=>await o({method:`get`,url:t}),n.cache.routeExpire,!1)).data.data[0]}async function m(e){let f=(e.req.param(`category`)??`977-Lebanon`).split(`|`).map(e=>e.match(/^(\d+)/i)[0]??e),m=e.req.query(`limit`)??25,h,g=await r.get(`lorientlejour:token`);if(g?h=g:n.lorientlejour.token?(h=n.lorientlejour.token,r.set(`lorientlejour:token`,h)):n.lorientlejour.username&&n.lorientlejour.password&&(h=(await o(`https://www.lorientlejour.com/cmsapi/visitors.php?key=${d}&action=login&loginName=${n.lorientlejour.username}&password=${n.lorientlejour.password}`)).data.data.token,r.set(`lorientlejour:token`,h)),h)try{await o(`https://www.lorientlejour.com/cmsapi/visitors.php?key=${d}&action=login_token&token=${h}`)}catch(e){throw e instanceof l&&e.statusCode===403&&await r.set(`lorientlejour:token`,``),e}let _=`L'Orient Le Jour/L'Orient Today`,v=``,y=`https://www.lorientlejour.com`,b=``;if(f.length===1){let e=await p(f[0]);b=e.typeId.locale?e.typeId.locale:e.typeId.name===`English`?`en-US`:`fr-FR`,_=b===`en-US`?`L'Orient Today - ${e.name}`:`L'Orient Le Jour - ${e.name}`,v=e.description,y=e.url}let x=await Promise.all(f.map(async e=>(await p(e)).children.map(e=>e.id))),S=[...new Set([...f,...x.flat()])],C=`https://www.lorientlejour.com/cmsapi/content.php?text=clean&key=${d}&action=search&category=${encodeURIComponent(JSON.stringify(S))}&limit=${m}&text=false&page=1`;h&&(C+=`&token=${h}`);let w=(await o(C)).data.data.map(e=>{e.link=e.url,e.author=e.authors.map(e=>e.name).join(`, `),e.pubDate=s(a(e.firstPublished),3),e.updated=s(a(e.lastUpdate),3),e.category=e.categories.map(e=>e.name);let n=e.contents,r=u(n),o=r(`html`);return o.find(`.inline-embeded-article`).remove(),o.find(`.relatedArticles`).remove(),e.inline_attachments&&o.find(`.inlineImage`).each(function(){let t=r(this).attr(`src`),n=e.inline_attachments.find(e=>e.url===t);n&&n.description&&(r(this).wrap(`<figure></figure>`),r(this).after(`<figcaption>${n.description}</figcaption>`))}),e.description=i(c.join(t,`templates/description-b70dec08.art`),{summary:e.summary,attachments:e.attachments,article:o.html()}),e});return{title:_,description:v,language:b,link:y,item:w}}export{f as route};