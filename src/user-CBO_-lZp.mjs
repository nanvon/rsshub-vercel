import{t as e}from"./config-L8Ls2W7q.mjs";import"./logger-C50fTRi5.mjs";import{t}from"./cache-ZTWfXd2T.mjs";import{n}from"./parse-date-bKmkZ9gg.mjs";import{t as r}from"./types-BD1MU_-b.mjs";import{load as i}from"cheerio";import{connect as a}from"puppeteer-real-browser";const o={args:[`--start-maximized`],turnstile:!0,headless:!1,customConfig:{chromePath:e.chromiumExecutablePath},connectOption:{defaultViewport:null},plugins:[]};async function s(t,n){if(e.puppeteerRealBrowserService)return(await(await fetch(`${e.puppeteerRealBrowserService}?url=${encodeURIComponent(t)}&selector=${encodeURIComponent(n)}`)).json()).data.at(0)||``;{let{page:e,browser:r}=await a(o);await e.goto(t,{timeout:5e4});let i=null,s=Date.now();for(;!i&&Date.now()-s<5e4;)i=await e.evaluate(e=>document.querySelector(e)?!0:null,n).catch(()=>null),await new Promise(e=>setTimeout(e,1e3));let c=await e.content();return await r.close(),c}}function c(e){return s(e,`.post_box`)}const l={path:`/user/:id/:type?`,categories:[`social-media`],example:`/picnob/user/xlisa_olivex`,parameters:{id:`Instagram id`,type:`Type of profile page (profile or tagged)`},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.pixnoy.com/profile/:id`],target:`/user/:id`},{source:[`www.pixnoy.com/profile/:id/tagged`],target:`/user/:id/tagged`}],name:`User Profile - Picnob`,maintainers:[`TonyRL`,`micheal-death`,`AiraNadih`,`DIYgod`,`hyoban`],handler:u,view:r.Pictures};async function u(r){if(!e.puppeteerRealBrowserService&&!e.chromiumExecutablePath)throw Error(`PUPPETEER_REAL_BROWSER_SERVICE or CHROMIUM_EXECUTABLE_PATH is required to use this route.`);let s=`https://www.pixnoy.com`,l=r.req.param(`id`),u=r.req.param(`type`)??`profile`,d=`${s}/profile/${l}/${u===`tagged`?`tagged/`:``}`,f=i(await c(d)),p=f(`.post_box`).toArray().map(e=>{let t=f(e),r=t.find(`.cover_link`).attr(`href`),i=r?.split(`/`)?.[2],a=t.find(`.cover .cover_link img`),o=a.attr(`alt`)||``;return{title:o,description:`<img src="${a.attr(`data-src`)}" /><br />${o}`,link:`${s}${r}`,guid:i,pubDate:n(t.find(`.time .txt`).text())}}),m;if(e.puppeteerRealBrowserService)m=await Promise.all(p.map(n=>t.tryGet(`picnob:user:${l}:${n.guid}:html`,async()=>(await(await fetch(`${e.puppeteerRealBrowserService}?url=${encodeURIComponent(n.link)}&selector=.video_img%2C%20.swiper-slide`)).json()).data?.at(0)||``)));else{let{browser:e}=await a(o);try{m=await Promise.all(p.map(n=>t.tryGet(`picnob:user:${l}:${n.guid}:html`,async()=>{let t=await e.newPage();try{await t.goto(n.link,{timeout:5e4});let e=null,r=Date.now();for(;!e&&Date.now()-r<5e4;)e=await t.evaluate(()=>document.querySelector(`.video_img`)||document.querySelector(`.swiper-slide`)?!0:null).catch(()=>null),await new Promise(e=>setTimeout(e,1e3));return await t.content()}catch{return``}finally{await t.close()}})))}finally{await e.close()}}let h=m.map(e=>{if(!e)return``;let t=i(e);if(t(`.video_img`).length>0)return`<video src="${t(`.video_img a`).attr(`href`)}" poster="${t(`.video_img img`).attr(`data-src`)}"></video><br />${t(`.sum_full`).text()}`;{let e=``;for(let n of t(`.swiper-slide`).toArray()){let r=t(n);e+=`<img src="${r.find(`.pic img`).attr(`data-src`)}" /><br />`}return e+=t(`.sum_full`).text(),e}});return{title:`${f(`h1.fullname`).text()} (@${l}) ${u===`tagged`?`tagged`:`public`} posts - Picnob`,description:f(`.info .sum`).text(),link:d,image:f(`.ava .pic img`).attr(`src`),item:p.map((e,t)=>({...e,description:h[t]||e.description}))}}export{l as route};