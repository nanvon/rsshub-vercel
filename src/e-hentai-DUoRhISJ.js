import{__dirname as e,init_esm_shims as t}from"./esm-shims-BGJi2y--.js";import"./config-CVBRPN4O.js";import"./logger-BvonkID1.js";import"./ofetch-rK3Yp7nj.js";import"./helpers-qpI1t-yV.js";import{cache_default as n}from"./cache-Dfid4xgQ.js";import{art as r}from"./render-DftO2d-b.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-CoH3ye0k.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],features:{nsfw:!0},handler:l};async function l(t){let c=t.req.param(`id`)??``,l=t.req.param(`what`)??``,u=/t|y/i.test(t.req.param(`needTorrents`)??`true`),d=/t|y/i.test(t.req.param(`needImages`)??`true`),f=`https://e-hentai.org/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,p=s((await a({method:`get`,url:f})).data);p(`.itd`).parent().remove();let m=p(`table.gltc tbody tr`).slice(1,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=p(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:i(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>p(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return m=await Promise.all(m.map(async t=>{if(t.enclosure_url){let e=``,r=await n.get(t.enclosure_url);if(!r){let i=s((await a({method:`get`,url:t.enclosure_url})).data);i(`h1, input[name="torrent_info"]`).remove(),e=i(`form`).parent().html(),r=i(`table tbody tr td a`).toArray().map(e=>(e=i(e),{link:e.attr(`href`),title:e.text()})),n.set(t.enclosure_url,r)}t.description+=e,t.enclosure_url=r[0].link,t.enclosure_type=`application/x-bittorrent`}if(d){let i=await n.get(t.link);if(!i){let e=s((await a({method:`get`,url:t.link})).data);i=await Promise.all(e(`.gdtm a`).toArray().map(t=>n.tryGet(e(t).attr(`href`),async()=>s((await a({method:`get`,url:e(t).attr(`href`)})).data)(`#img`).attr(`src`)))),n.set(t.link,i)}t.description+=r(o.join(e,`templates/images-c6c5dab2.art`),{images:i})}return t})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:f,item:m}}export{c as route};