import{n as e,t}from"./esm-shims-CaZMYoY8.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import{t as n}from"./ofetch-VsB2Peor.js";import{t as r}from"./cache-CpEhLexq.js";import{t as i}from"./render-d6AVTUl2.js";import{t as a}from"./parse-date-CHEO0z5G.js";import o from"node:path";import{load as s}from"cheerio";e();const c={path:`/:category{.+}?`,example:`/wa`,radar:[{source:[`abc.net.au/:category*`],target:`/:category`}],parameters:{category:"Category, can be found in the URL, can also be filled in with the `documentId` in the source code of the page, `news/justin` as **Just In** by default"},name:`Channel & Topic`,categories:[`traditional-media`],description:"\n::: tip\n  All Topics in [Topic Library](https://abc.net.au/news/topics) are supported, you can fill in the field after `topic` in its URL, or fill in the `documentId`.\n\n  For example, the URL for [Computer Science](https://www.abc.net.au/news/topic/computer-science) is `https://www.abc.net.au/news/topic/computer-science`, the `category` is `news/topic/computer-science`, and the `documentId` of the Topic is `2302`, so the route is [/abc/news/topic/computer-science](https://rsshub.app/abc/news/topic/computer-science) and [/abc/2302](https://rsshub.app/abc/2302).\n\n  The supported channels are all listed in the table below. For other channels, please find the `documentId` in the source code of the channel page and fill it in as above.\n:::",maintainers:[`nczitzk`,`pseudoyu`],handler:l};async function l(e){let{category:c=`news/justin`}=e.req.param(),l=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):30,u=`https://www.abc.net.au`,d=new URL(`news-web/api/loader/channelrefetch`,u).href,f=``,p;if(Number.isNaN(c))f=new URL(c,u).href;else{p=c;let e=new URL(`news/feed/${p}/rss.xml`,u).href;f=(await n(e)).match(/<link>([\w-./:?]+)<\/link>/)[1]}let m=s(await n(f));p??=m(`div[data-uri^="coremedia://collection/"]`).first().prop(`data-uri`).split(/\//).pop();let h=(await n(d,{query:{name:`PaginationArticles`,documentId:p,size:l}})).collection.slice(0,l).map(e=>{let n={title:e.title.children??e.title,link:e.link.startsWith(`https://`)?e.link:new URL(e.link,u).href,description:i(o.join(t,`templates/description-bd10ae5e.art`),{image:e.image?{src:e.image.imgSrc.split(/\?/)[0],alt:e.image.alt}:void 0}),author:e.newsBylineProps?.authors?.map(e=>e.name).join(`/`)??void 0,guid:`abc-${e.id}`,pubDate:a(e.dates.firstPublished),updated:e.dates.lastUpdated?a(e.dates.lastUpdated):void 0};return e.mediaIndicator&&(n.enclosure_type=`audio/mpeg`,n.itunes_item_image=e.image?.imgSrc.split(/\?/)[0]??void 0,n.itunes_duration=e.mediaIndicator.duration),n});h=await Promise.all(h.map(e=>r.tryGet(e.link,async()=>{try{let r=await n(e.link),c=s(r);c(`aside, header, [data-print="inline-media"], [data-component="EmbedBlock"]`).remove(),c(`#body *, div[data-component="FeatureMedia"]`).children().each(function(){let e=c(this);e.prop(`tagName`).toLowerCase()===`figure`?e.replaceWith(i(o.join(t,`templates/description-bd10ae5e.art`),{image:{src:e.find(`img`).prop(`src`).split(/\?/)[0],alt:e.find(`figcaption`).text().trim()}})):e.removeAttr(`id class role data-component data-uri`)}),e.title=c(`meta[property="og:title"]`).prop(`content`),e.description=``;let l=String.raw`"(?:MIME|content)?Type":"([\w]+/[\w]+)".*?"(?:fileS|s)?ize":(\d+),.*?"url":"([\w-.:/?]+)"`,u=r.match(new RegExp(l,`g`));if(u){let n=u.map(e=>e.match(new RegExp(l))).toSorted((e,t)=>Number.parseInt(e[2],10)-Number.parseInt(t[2],10)).pop();e.enclosure_url=n[3],e.enclosure_length=n[2],e.enclosure_type=n[1],e.description=i(o.join(t,`templates/description-bd10ae5e.art`),{enclosure:{src:e.enclosure_url,type:e.enclosure_type}})}e.description=i(o.join(t,`templates/description-bd10ae5e.art`),{description:(c(`div[data-component="FeatureMedia"]`).html()||``)+(c(`#body div[data-component="LayoutContainer"] div`).first().html()||``)})+e.description,e.category=c(`meta[property="article:tag"]`).toArray().flatMap(e=>c(e).prop(`content`).split(/ï¼Œ/).map(e=>e.trim())),e.guid=`abc-${c(`meta[name="ContentId"]`).prop(`content`)}`,e.pubDate=a(c(`meta[property="article:published_time"]`).prop(`content`)),e.updated=a(c(`meta[property="article:modified_time"]`).prop(`content`))}catch{}return e})));let g=new URL(m(`link[rel="apple-touch-icon"]`).prop(`href`)||``,u).href;return{item:h,title:m(`title`).first().text(),link:f,description:m(`meta[property="og:description"]`).prop(`content`),language:m(`html`).prop(`lang`),image:m(`meta[property="og:image"]`).prop(`content`).split(`?`)[0],icon:g,logo:g,subtitle:m(`meta[property="og:title"]`).prop(`content`),author:m(`meta[name="generator"]`).prop(`content`),allowEmpty:!0}}export{c as route};