import{n as e,t}from"./esm-shims-mGm6WwCc.js";import"./config-DZMnNPig.js";import"./logger-asV68Lay.js";import"./ofetch-BASlBuka.js";import"./helpers-Cqaav28H.js";import{t as n}from"./cache-CpEhLexq.js";import{t as r}from"./render-d6AVTUl2.js";import{t as i}from"./parse-date-CHEO0z5G.js";import{t as a}from"./got-CgQXMNWI.js";import o from"node:path";e();const s={path:`/:type?`,categories:[`new-media`],example:`/mittrchina/index`,parameters:{type:`类型，见下表，默认为首页资讯`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`首页`,maintainers:[`EsuRt`,`queensferryme`],handler:c,description:`| 快讯     | 本周热文 | 首页资讯 | 视频  |
| -------- | -------- | -------- | ----- |
| breaking | hot      | index    | video |`};async function c(e){let s={breaking:{title:`快讯`,apiPath:`/flash`},hot:{title:`本周热榜`,apiPath:`/information/hot`},index:{title:`首页资讯`,apiPath:`/information/index`},video:{title:`视频`,apiPath:`/movie/index`}},{type:c=`index`}=e.req.param(),l=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):10,u=`https://apii.web.mittrchina.com${s[c].apiPath}`,{data:d}=c===`breaking`?await a.post(u,{form:{page:1,size:l}}):await a(u,{searchParams:{limit:l}}),f=(c===`hot`?d.data:d.data.items).map(e=>({title:e.name||e.title,author:(e.authors||e.author||[]).map(e=>e.username).join(`, `),category:e.typeName,description:c===`video`?r(o.join(t,`templates/movie-1179cf74.art`),{poster:e.img,video:{address:e.address,type:e.address.split(`.`).pop()}}):c===`breaking`?e.content:e.summary,pubDate:e.start_time?i(e.start_time,`X`):e.push_time?i(e.push_time,`X`):void 0,id:e.id,link:`https://www.mittrchina.com/news/detail/${e.id}`})),p=f;return c!==`video`&&c!==`breaking`&&(p=await Promise.all(f.map(e=>n.tryGet(e.link,async()=>{let{data:{data:t}}=await a(`https://apii.web.mittrchina.com/information/details?id=${e.id}`);return e.description=t.content,e.author||=t.authors.map(e=>e.username).join(`, `),e.pubDate||=i(t.start_time,`X`),t.cover&&(e.enclosure_url=t.cover,e.enclosure_type=`image/${t.cover.split(`.`).pop()}`),e})))),{title:`MIT 科技评论 - ${s[c].title}`,link:`https://www.mittrchina.com/${c}`,item:p}}export{s as route};